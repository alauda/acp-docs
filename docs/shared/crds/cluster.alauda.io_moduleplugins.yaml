---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.12.1
  name: moduleplugins.cluster.alauda.io
spec:
  group: cluster.alauda.io
  names:
    kind: ModulePlugin
    listKind: ModulePluginList
    plural: moduleplugins
    shortNames:
    - mplugin
    singular: moduleplugin
  scope: Cluster
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ModuleConfig is the Schema for the moduleconfigs API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ModuleConfigSpec defines the desired state of ModuleConfig
            properties:
              affinity:
                description: Affinity is the affinity of the plugin.
                properties:
                  clusterAffinity:
                    description: ClusterAffinity defines the cluster affinity
                    properties:
                      matchExpressions:
                        description: MatchExpressions is the list of match expressions
                        items:
                          description: A node selector requirement is a selector that
                            contains values, a key, and an operator that relates the
                            key and values.
                          properties:
                            key:
                              description: The label key that the selector applies
                                to.
                              type: string
                            operator:
                              description: Represents a key's relationship to a set
                                of values. Valid operators are In, NotIn, Exists,
                                DoesNotExist. Gt, and Lt.
                              type: string
                            values:
                              description: An array of string values. If the operator
                                is In or NotIn, the values array must be non-empty.
                                If the operator is Exists or DoesNotExist, the values
                                array must be empty. If the operator is Gt or Lt,
                                the values array must have a single element, which
                                will be interpreted as an integer. This array is replaced
                                during a strategic merge patch.
                              items:
                                type: string
                              type: array
                          required:
                          - key
                          - operator
                          type: object
                        type: array
                      matchLabels:
                        additionalProperties:
                          type: string
                        description: MatchLabels is the cluster selector
                        type: object
                    type: object
                  clusterAntiAffinity:
                    description: ClusterAntiAffinity defines the cluster anti-affinity
                    properties:
                      matchExpressions:
                        description: MatchExpressions is the list of match expressions
                        items:
                          description: A node selector requirement is a selector that
                            contains values, a key, and an operator that relates the
                            key and values.
                          properties:
                            key:
                              description: The label key that the selector applies
                                to.
                              type: string
                            operator:
                              description: Represents a key's relationship to a set
                                of values. Valid operators are In, NotIn, Exists,
                                DoesNotExist. Gt, and Lt.
                              type: string
                            values:
                              description: An array of string values. If the operator
                                is In or NotIn, the values array must be non-empty.
                                If the operator is Exists or DoesNotExist, the values
                                array must be empty. If the operator is Gt or Lt,
                                the values array must have a single element, which
                                will be interpreted as an integer. This array is replaced
                                during a strategic merge patch.
                              items:
                                type: string
                              type: array
                          required:
                          - key
                          - operator
                          type: object
                        type: array
                      matchLabels:
                        additionalProperties:
                          type: string
                        description: MatchLabels is the cluster selector
                        type: object
                    type: object
                  pluginAntiAffinity:
                    description: PluginAntiAffinity defines the plugin anti-affinity
                    items:
                      type: string
                    type: array
                type: object
              appReleases:
                description: AppReleases is the app releases of the module.
                items:
                  description: AppRelease is the release of an application
                  properties:
                    chartVersions:
                      description: ChartVersions stands for the app's chart versions
                      items:
                        description: ChartVersion is the version of the chart
                        properties:
                          name:
                            description: Name stands for the chart's name
                            type: string
                          releaseName:
                            description: ReleaseName stands for the release name
                            type: string
                          version:
                            description: Version stands for the chart's version
                            type: string
                        required:
                        - name
                        - releaseName
                        - version
                        type: object
                      type: array
                    installCondition:
                      description: InstallCondition is the condition of installing
                      type: string
                    name:
                      description: Name stands for the release name
                      type: string
                    namespace:
                      description: Namespace stands for the release namespace
                      type: string
                  required:
                  - chartVersions
                  - name
                  type: object
                type: array
              cfgFilename:
                description: CfgFilename is the plugin config filename in chart.
                type: string
              config:
                description: Config is the config of the module.
                type: object
                x-kubernetes-preserve-unknown-fields: true
              crossClusterDependencies:
                description: CrossClusterDependencies indicates the cross-cluster
                  dependencies of this module. Deprecated
                items:
                  type: string
                type: array
              deleteBlockDescription:
                description: DeleteBlockDescription is the delete block description
                  of the module.
                type: string
              deleteBlockDescriptionEn:
                description: DeleteBlockDescriptionEn is the delete block description
                  of the module in English.
                type: string
              deleteRiskDescription:
                description: DeleteRiskDescription is the delete risk description
                  of the module.
                type: string
              deleteRiskDescriptionEn:
                description: DeleteRiskDescriptionEn is the delete risk description
                  of the module in English.
                type: string
              deleteable:
                description: Deleteable indicates whether the module can be deleted.
                type: boolean
              dependencies:
                description: Dependencies is the dependencies of the module.
                items:
                  description: ModuleDependency defines the module dependency
                  properties:
                    instanceName:
                      description: InstanceName stands for the dependent module's
                        ModuleInfo CR's name
                      type: string
                    moduleName:
                      description: ModuleName stands for the dependent module's name
                      type: string
                    versionsMatch:
                      description: VersionMatch stands for the version requirements
                        for the dependent module, any match will be acceptable.
                      items:
                        type: string
                      type: array
                  required:
                  - moduleName
                  type: object
                type: array
              deployDescriptors:
                description: DeployDescriptors is the descriptors of the module for
                  deployment.
                items:
                  description: Descriptors defines OLM descriptors http://confluence.alauda.cn/display/cp/OLM+Descriptor
                  properties:
                    description:
                      description: Description is the description of the descriptor
                      type: string
                    displayName:
                      description: DisplayName is the display name of the descriptor
                      type: string
                    path:
                      description: Path is the path of the descriptor
                      type: string
                    x-descriptors:
                      description: X-Descriptors is the list of descriptors
                      items:
                        type: string
                      type: array
                  required:
                  - path
                  - x-descriptors
                  type: object
                type: array
              description:
                description: Description is the description of the module.
                properties:
                  en:
                    description: En is the English description
                    type: string
                  zh:
                    description: Zh is the Chinese description
                    type: string
                type: object
              editDescriptors:
                description: EditDescriptors is the descriptors of the module for
                  edit.
                items:
                  description: Descriptors defines OLM descriptors http://confluence.alauda.cn/display/cp/OLM+Descriptor
                  properties:
                    description:
                      description: Description is the description of the descriptor
                      type: string
                    displayName:
                      description: DisplayName is the display name of the descriptor
                      type: string
                    path:
                      description: Path is the path of the descriptor
                      type: string
                    x-descriptors:
                      description: X-Descriptors is the list of descriptors
                      items:
                        type: string
                      type: array
                  required:
                  - path
                  - x-descriptors
                  type: object
                type: array
              entrypointTemplate:
                description: EntrypointTemplate is the entrypoint template of the
                  module.
                type: string
              labelCluster:
                description: LabelCluster is the flag of whether label cluster resource.
                type: string
              logo:
                description: Logo is the logo of the module.
                type: string
              mainChart:
                description: MainChart is the main chart of the module.
                type: string
              mustUpgrade:
                description: MustUpgrade is the flag of whether the module must upgrade.
                type: boolean
              name:
                description: Name is the name of the module.
                type: string
              pluginDependencies:
                description: PluginDependencies define the plugins dependent relationship
                properties:
                  crossCluster:
                    properties:
                      oneOf:
                        items:
                          properties:
                            clusterName:
                              type: string
                            pluginName:
                              type: string
                          required:
                          - clusterName
                          - pluginName
                          type: object
                        type: array
                    type: object
                type: object
              resourcesBlockRemove:
                description: ResourcesBlockRemove stands for the resources reference
                  with can block remove this plugin, all of theses resources must
                  be deleted before you can remove this plugin.
                items:
                  description: ResourceReference defines the resource reference
                  properties:
                    apiVersion:
                      description: API version of the referent.
                      type: string
                    kind:
                      description: Kind of the referent.
                      type: string
                    name:
                      description: Name of the referent.
                      type: string
                    namespace:
                      description: Namespace of the referent.
                      type: string
                  type: object
                type: array
              skipPlatformConfig:
                description: SkipPlatformConfig stands for skip reference the platform
                  values when renderering the values for AppRelease.
                type: boolean
              supportedUpgradeVersions:
                description: SupportedUpgradeVersions is the supported old versions
                  of the module for upgrade.
                type: string
              targetClusterVersions:
                description: TargetClusterVersions is the target clusters of the module.
                items:
                  type: string
                type: array
              transitTimeout:
                description: TransitTimeout is the timeout duration for upgrade.
                format: int64
                type: integer
              uiContext:
                description: UIContext is the additional attributes for module config.
                properties:
                  sizeSettings:
                    description: SizeSettings defines a list of size config
                    properties:
                      default:
                        description: Default is name for default size
                        type: string
                      quotaTip:
                        description: QuotaTip is quota tip
                        properties:
                          en:
                            description: En is the English text
                            type: string
                          zh:
                            description: Zh is the Chinese text
                            type: string
                        type: object
                      sizes:
                        description: Sizes defines a list of size config
                        items:
                          description: SizeConfig defines a list of components config
                          properties:
                            components:
                              additionalProperties:
                                description: Component defines config for a component
                                properties:
                                  resources:
                                    description: Resources defines quota for this
                                      component
                                    properties:
                                      limits:
                                        additionalProperties:
                                          anyOf:
                                          - type: integer
                                          - type: string
                                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                          x-kubernetes-int-or-string: true
                                        description: 'Limits describes the maximum
                                          amount of compute resources allowed. More
                                          info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/'
                                        type: object
                                      requests:
                                        additionalProperties:
                                          anyOf:
                                          - type: integer
                                          - type: string
                                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                          x-kubernetes-int-or-string: true
                                        description: 'Requests describes the minimum
                                          amount of compute resources required. If
                                          Requests is omitted for a container, it
                                          defaults to Limits if that is explicitly
                                          specified, otherwise to an implementation-defined
                                          value. More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/'
                                        type: object
                                    type: object
                                type: object
                              description: Components defines a list of component
                                config
                              type: object
                            description:
                              description: Description defines description for this
                                size config
                              properties:
                                en:
                                  description: En is the English text
                                  type: string
                                zh:
                                  description: Zh is the Chinese text
                                  type: string
                              type: object
                            name:
                              description: Name defines name for this size config
                              properties:
                                en:
                                  description: En is the English text
                                  type: string
                                zh:
                                  description: Zh is the Chinese text
                                  type: string
                              type: object
                            size:
                              description: Size is name for this config
                              type: string
                          required:
                          - components
                          - description
                          - name
                          - size
                          type: object
                        type: array
                    type: object
                type: object
              upgradeBefore:
                description: UpgradeBefore stands for need upgrade before these mouldes
                items:
                  description: ModuleRef defines the reference for the module
                  properties:
                    moduleName:
                      description: ModuleName stands for the dependent module's name
                      type: string
                  required:
                  - moduleName
                  type: object
                type: array
              upgradeDescriptors:
                description: UpgradeDescriptors is the descriptors of the module for
                  upgrade.
                items:
                  description: Descriptors defines OLM descriptors http://confluence.alauda.cn/display/cp/OLM+Descriptor
                  properties:
                    description:
                      description: Description is the description of the descriptor
                      type: string
                    displayName:
                      description: DisplayName is the display name of the descriptor
                      type: string
                    path:
                      description: Path is the path of the descriptor
                      type: string
                    x-descriptors:
                      description: X-Descriptors is the list of descriptors
                      items:
                        type: string
                      type: array
                  required:
                  - path
                  - x-descriptors
                  type: object
                type: array
              upgradeRiskDescription:
                description: UpgradeRiskDescription is the upgrade risk description
                  of the module.
                type: string
              upgradeRiskDescriptionEn:
                description: UpgradeRiskDescriptionEn is the upgrade risk description
                  of the module in English.
                type: string
              upgradeRiskLevel:
                description: UpgradeRiskLevel is the upgrade risk level of the module.
                type: string
              valuesTemplates:
                additionalProperties:
                  type: string
                description: ValuesTemplates is the values templates of the module.
                type: object
              version:
                description: Version is the version of the module.
                type: string
            required:
            - deleteable
            - description
            - logo
            - name
            type: object
          status:
            description: ModulePluginStatus defines the observed state of ModulePlugin
            properties:
              conditions:
                description: conditions is the conditions on this plugin
                items:
                  description: "Condition contains details for one aspect of the current
                    state of this API Resource. --- This struct is intended for direct
                    use as an array at the field path .status.conditions.  For example,
                    type FooStatus struct{ // Represents the observations of a foo's
                    current state. // Known .status.conditions.type are: \"Available\",
                    \"Progressing\", and \"Degraded\" // +patchMergeKey=type // +patchStrategy=merge
                    // +listType=map // +listMapKey=type Conditions []metav1.Condition
                    `json:\"conditions,omitempty\" patchStrategy:\"merge\" patchMergeKey:\"type\"
                    protobuf:\"bytes,1,rep,name=conditions\"` \n // other fields }"
                  properties:
                    lastTransitionTime:
                      description: lastTransitionTime is the last time the condition
                        transitioned from one status to another. This should be when
                        the underlying condition changed.  If that is not known, then
                        using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: message is a human readable message indicating
                        details about the transition. This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: observedGeneration represents the .metadata.generation
                        that the condition was set based upon. For instance, if .metadata.generation
                        is currently 12, but the .status.conditions[x].observedGeneration
                        is 9, the condition is out of date with respect to the current
                        state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: reason contains a programmatic identifier indicating
                        the reason for the condition's last transition. Producers
                        of specific condition types may define expected values and
                        meanings for this field, and whether the values are considered
                        a guaranteed API. The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        --- Many .condition.type values are consistent across resources
                        like Available, but because arbitrary conditions can be useful
                        (see .node.status.conditions), the ability to deconflict is
                        important. The regex it matches is (dns1123SubdomainFmt/)?(qualifiedNameFmt)
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              installed:
                description: installed are the installed instances of this plugin
                items:
                  description: InstalledPlugin defines the installed plugin's info
                  properties:
                    cluster:
                      type: string
                    name:
                      type: string
                    phase:
                      type: string
                    version:
                      type: string
                  required:
                  - cluster
                  - name
                  - phase
                  - version
                  type: object
                type: array
              latestVersion:
                description: latestVersion is the latest version of the ModuleConfig
                type: string
              moduleConfigs:
                description: moduleConfigs is the module config versions of the ModulePlugin
                items:
                  description: ModuleConfigStatus defines the module config of the
                    plugin
                  properties:
                    affinity:
                      description: Affinity is the affinity of the plugin
                      properties:
                        clusterAffinity:
                          description: ClusterAffinity defines the cluster affinity
                          properties:
                            matchExpressions:
                              description: MatchExpressions is the list of match expressions
                              items:
                                description: A node selector requirement is a selector
                                  that contains values, a key, and an operator that
                                  relates the key and values.
                                properties:
                                  key:
                                    description: The label key that the selector applies
                                      to.
                                    type: string
                                  operator:
                                    description: Represents a key's relationship to
                                      a set of values. Valid operators are In, NotIn,
                                      Exists, DoesNotExist. Gt, and Lt.
                                    type: string
                                  values:
                                    description: An array of string values. If the
                                      operator is In or NotIn, the values array must
                                      be non-empty. If the operator is Exists or DoesNotExist,
                                      the values array must be empty. If the operator
                                      is Gt or Lt, the values array must have a single
                                      element, which will be interpreted as an integer.
                                      This array is replaced during a strategic merge
                                      patch.
                                    items:
                                      type: string
                                    type: array
                                required:
                                - key
                                - operator
                                type: object
                              type: array
                            matchLabels:
                              additionalProperties:
                                type: string
                              description: MatchLabels is the cluster selector
                              type: object
                          type: object
                        clusterAntiAffinity:
                          description: ClusterAntiAffinity defines the cluster anti-affinity
                          properties:
                            matchExpressions:
                              description: MatchExpressions is the list of match expressions
                              items:
                                description: A node selector requirement is a selector
                                  that contains values, a key, and an operator that
                                  relates the key and values.
                                properties:
                                  key:
                                    description: The label key that the selector applies
                                      to.
                                    type: string
                                  operator:
                                    description: Represents a key's relationship to
                                      a set of values. Valid operators are In, NotIn,
                                      Exists, DoesNotExist. Gt, and Lt.
                                    type: string
                                  values:
                                    description: An array of string values. If the
                                      operator is In or NotIn, the values array must
                                      be non-empty. If the operator is Exists or DoesNotExist,
                                      the values array must be empty. If the operator
                                      is Gt or Lt, the values array must have a single
                                      element, which will be interpreted as an integer.
                                      This array is replaced during a strategic merge
                                      patch.
                                    items:
                                      type: string
                                    type: array
                                required:
                                - key
                                - operator
                                type: object
                              type: array
                            matchLabels:
                              additionalProperties:
                                type: string
                              description: MatchLabels is the cluster selector
                              type: object
                          type: object
                        pluginAntiAffinity:
                          description: PluginAntiAffinity defines the plugin anti-affinity
                          items:
                            type: string
                          type: array
                      type: object
                    name:
                      description: Name is the name of the module config
                      type: string
                    readyForDeploy:
                      description: ReadyForDeploy indicates whether the module is
                        ready for deployment.
                      type: boolean
                    targetClusterVersions:
                      description: TargetClusterVersions is the target cluster versions
                        of the module config
                      items:
                        type: string
                      type: array
                    version:
                      description: Version is the version of the module config
                      type: string
                  required:
                  - name
                  - readyForDeploy
                  - targetClusterVersions
                  - version
                  type: object
                type: array
              specHash:
                description: SpecHash is the hash of the spec
                type: string
              targetClusterVersions:
                additionalProperties:
                  description: ClusterModuleStatus defines the state of ClusterModule
                  properties:
                    affinity:
                      description: Affinity is the affinity of the plugin
                      properties:
                        clusterAffinity:
                          description: ClusterAffinity defines the cluster affinity
                          properties:
                            matchExpressions:
                              description: MatchExpressions is the list of match expressions
                              items:
                                description: A node selector requirement is a selector
                                  that contains values, a key, and an operator that
                                  relates the key and values.
                                properties:
                                  key:
                                    description: The label key that the selector applies
                                      to.
                                    type: string
                                  operator:
                                    description: Represents a key's relationship to
                                      a set of values. Valid operators are In, NotIn,
                                      Exists, DoesNotExist. Gt, and Lt.
                                    type: string
                                  values:
                                    description: An array of string values. If the
                                      operator is In or NotIn, the values array must
                                      be non-empty. If the operator is Exists or DoesNotExist,
                                      the values array must be empty. If the operator
                                      is Gt or Lt, the values array must have a single
                                      element, which will be interpreted as an integer.
                                      This array is replaced during a strategic merge
                                      patch.
                                    items:
                                      type: string
                                    type: array
                                required:
                                - key
                                - operator
                                type: object
                              type: array
                            matchLabels:
                              additionalProperties:
                                type: string
                              description: MatchLabels is the cluster selector
                              type: object
                          type: object
                        clusterAntiAffinity:
                          description: ClusterAntiAffinity defines the cluster anti-affinity
                          properties:
                            matchExpressions:
                              description: MatchExpressions is the list of match expressions
                              items:
                                description: A node selector requirement is a selector
                                  that contains values, a key, and an operator that
                                  relates the key and values.
                                properties:
                                  key:
                                    description: The label key that the selector applies
                                      to.
                                    type: string
                                  operator:
                                    description: Represents a key's relationship to
                                      a set of values. Valid operators are In, NotIn,
                                      Exists, DoesNotExist. Gt, and Lt.
                                    type: string
                                  values:
                                    description: An array of string values. If the
                                      operator is In or NotIn, the values array must
                                      be non-empty. If the operator is Exists or DoesNotExist,
                                      the values array must be empty. If the operator
                                      is Gt or Lt, the values array must have a single
                                      element, which will be interpreted as an integer.
                                      This array is replaced during a strategic merge
                                      patch.
                                    items:
                                      type: string
                                    type: array
                                required:
                                - key
                                - operator
                                type: object
                              type: array
                            matchLabels:
                              additionalProperties:
                                type: string
                              description: MatchLabels is the cluster selector
                              type: object
                          type: object
                        pluginAntiAffinity:
                          description: PluginAntiAffinity defines the plugin anti-affinity
                          items:
                            type: string
                          type: array
                      type: object
                    description:
                      description: Description is the description of the plugin
                      properties:
                        en:
                          description: En is the English description
                          type: string
                        zh:
                          description: Zh is the Chinese description
                          type: string
                      type: object
                    logo:
                      description: Logo is the logo of the plugin
                      type: string
                    moduleConfigSpecHash:
                      description: ModuleConfigSpecHash is the hash of the module
                        config spec
                      type: string
                    readyForDeploy:
                      description: ReadyForDeploy indicates whether the module is
                        ready for deployment.
                      type: boolean
                    version:
                      description: Version is the version of the plugin
                      type: string
                  required:
                  - description
                  - logo
                  - moduleConfigSpecHash
                  - readyForDeploy
                  - version
                  type: object
                description: targetClusterVersions is the target cluster versions
                  of the ModuleConfig
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
