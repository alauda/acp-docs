---
weight: 40
sourceSHA: 3a276a5141c26cdfff6f47a64fd25c6b84c0968f0002958b064facc81b8e4a4a
---

# Квоты ресурсов

Смотрите официальную документацию Kubernetes: [Квоты ресурсов](https://kubernetes.io/docs/concepts/policy/resource-quotas/)

## Запросы ресурсов и ограничения ресурсов

Это используется для ограничения ресурсов, доступных для **определенного пространства имен**. Общее использование ресурсов всеми Pod в пространстве имен, за исключением тех, которые находятся в состоянии, отличном от завершающего, не может превышать это значение.

- **Запросы ресурсов** определяют минимальное количество ресурсов (например, CPU, память), необходимых контейнеру, указывая планировщику Kubernetes, чтобы разместить Pod на узле с достаточными ресурсами.
- **Ограничения ресурсов** устанавливают максимальное количество ресурсов, которое может потреблять контейнер, предотвращая исчерпание ресурсов и обеспечивая стабильность системы.

## Квоты

### Квоты ресурсов

> Неограниченный означает, что нет ограничений на ввод и использование, но фактическое использование не может превышать доступное значение соответствующего ресурса в кластере.

Каждое ограничение вычислительных ресурсов контейнеров (limits), указанных в пространстве имен, или каждое новое добавленное Pod или PVC будет потреблять квоту, установленную здесь.

**Включает следующие квоты ресурсов**

| Поле                     | Описание                                                                             |
| ------------------------- | ----------------------------------------------------------------------------------- |
| **Запросы ресурсов**     | Указывает значение квоты запросов ресурсов.<ul><li>CPU</li><li>Память</li></ul>   |
| **Ограничения ресурсов** | Указывает значение квоты ограничений ресурсов.<ul><li>CPU</li><li>Память</li></ul> |
| **Количество Pod**       | Указывает квоту на количество Pod.                                                  |

Примечание:

- Квота ресурсов пространства имен исходит из квоты, выделенной проекту кластером. Для любых ресурсов максимальная квота, которую можно установить, — это неиспользованная квота в проекте. Если доступное количество любого ресурса равно 0, вы не сможете создать пространство имен. Пожалуйста, свяжитесь с администратором платформы для получения поддержки.
- Квота ресурсов GPU может быть настроена только при развертывании ресурсов GPU (vGPU или pGPU) в кластере. Когда используются ресурсы vGPU, также может быть настроена квота vMemory.
  GPU единицы: 100 единиц виртуальных ядер равны 1 физическому ядру (1 pGPU = 1 ядро = 100 vGPU), и pGPU выделяется целыми единицами. 1 единица памяти равна 256 MiB, и 1024 MiB = 1 GiB.
- Если для определенного ресурса не указана квота, по умолчанию она считается неограниченной. Это означает, что пространство имен может использовать доступные ресурсы соответствующего типа, выделенные проекту в кластере, по мере необходимости, без каких-либо ограничений.

### Квоты на хранилище

**Тип квоты**:

- **Все**: Общая запрашиваемая емкость хранения всех запросов постоянного хранилища (PVC) в этом пространстве имен не может превышать это значение.
- **Класс хранения**: В этом пространстве имен общая запрашиваемая емкость хранения всех запросов постоянного хранилища (PVC), связанных с выбранным классом хранения, не может превышать это значение.

**Примечание**: Пожалуйста, заранее выделите класс хранения проекту, в котором находится пространство имен.

### Расширенные квоты ресурсов

**Типы квот** для расширенных ресурсов получают из словаря конфигурации (ConfigMap). Если соответствующий словарь конфигурации не существует, эта категория не будет отображаться.

**Описание полей словаря конфигурации**

| Поле                         | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ----------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **data.dataType**            | Указывает тип данных значения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **data.defaultValue**        | Устанавливает значение по умолчанию. Если это поле не существует или значение пустое, это означает, что значение по умолчанию отсутствует.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **data.descriptionEn**       | Сообщение на английском языке, которое можно увидеть, щелкнув иконку справа от значения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **data.descriptionZh**       | Сообщение на китайском языке, которое можно увидеть, щелкнув иконку справа от значения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **data.excludeResources**    | Взаимоисключающие ресурсы. Это поле используется для добавления ресурсов, которые не могут быть настроены одновременно, разделенных `,`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **data.group**               | Группа                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **data.groupI18n**           | Английские и китайские названия группы, которые можно увидеть и выбрать в выпадающих опциях, соответствующих типам квот. Применимо, когда один и тот же ресурс имеет одно или несколько значений.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **data.key**                 | Указывает значение ключа. Один словарь конфигурации может описывать только один ключ.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **data.labelEn/data.labelZh**| Английское/китайское название ресурса, которое можно увидеть и выбрать в выпадающих опциях, соответствующих типам квот. Это поле выполняет ту же функцию, что и поле data.groupI18n, но применимо только тогда, когда один и тот же ресурс имеет одно значение, что гарантирует совместимость со старой версией словаря конфигурации (ConfigMap).                                                                                                                                                                                                                                                          |
| **data.limits**              | Указывает, следует ли настраивать ограничения для ресурсов. Допустимые значения включают: disabled означает, что ограничения не могут быть настроены для ресурса, required означает, что оно должно быть введено, и optional означает, что это необязательный ввод.                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **data.requests**            | Указывает, следует ли настраивать запросы для ресурсов. Допустимые значения включают: disabled означает, что запросы не могут быть настроены для ресурса, required означает, что оно должно быть введено, optional означает, что это необязательный ввод, и fromLimits означает, что будет использоваться та же конфигурация, что и для ограничений.                                                                                                                                                                                                                                                                 |
| **data.relatedResources**    | Связанные ресурсы. Это поле зарезервировано и в настоящее время не может быть использовано.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **data.resourceUnit**        | Единица ресурса, должна быть введена английскими буквами и в настоящее время не поддерживает ввод на китайском.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **data.runtimeClassName**    | Необходимый класс выполнения, по умолчанию пустой, с необязательным значением nvidia.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **metadata.labels**          | <ul><li>features.cpaas.io/type: CustomResourceLimitation, эта метка обязательна и не может быть изменена.</li><li>`features.cpaas.io/group: <*groupName*>`, эта метка обязательна и должна изменить groupName на соответствующую группу.</li><li>features.cpaas.io/enabled: "true", эта метка обязательна и указывает, включена ли она, по умолчанию true.</li></ul>                                                                                                                                                                                                                                                                                   |
| **metadata.name**            | Формат `cf-crl-<*groupName*>-<*name*>`, где <ul><li>cf-crl — фиксированное поле и не может быть изменено.</li><li>groupName — название соответствующей группы ресурсов, например, gpu-manager, galaxy и т. д.</li><li>name — название ресурса: <ul><li>Название ресурса может быть названиями стандартных типов ресурсов, например, cpu, память, pod и т. д. Названия стандартных ресурсов должны соответствовать правилам [квалифицированных имен](#name) Kubernetes и должны существовать в рамках определенных стандартных типов ресурсов в Kubernetes.</li><li>Названия ресурсов также могут быть специальными типами ресурсов, начинающимися с определенных префиксов, таких как: hugepages- или requests.hugepages-.</li></ul></li></ul> |
| **metadata.namespace**       | Должно быть указано как пространство имен kube-public и не может быть изменено.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

**Пример словаря конфигурации**

Этот документ предоставляет только примеры конфигурации YAML для физических GPU, количества ядер GPU Manager и памяти, количества ядер MPS и памяти. Для использования других ресурсов, пожалуйста, обратитесь к приведенным выше описаниям полей для настройки.

- Пример конфигурации физических GPU
  ```yaml
  apiVersion: v1
  data:
    dataType: integer
    defaultValue: "1"
    descriptionEn: Количество GPU
    descriptionZh: GPU 数量
    excludeResources: nvidia.com/mps-core,nvidia.com/mps-memory,tencent.com/vcuda-core,tencent.com/vcuda-memory
    group: nvidia-device-plugin
    groupI18n: '{"zh": "pGPU", "en": "pGPU"}'
    key: nvidia.com/gpu
    labelEn: Ядро GPU
    labelZh: 物理 GPU
    limits: optional
    relatedResources: ""
    requests: disabled
    resourceUnit: count
    runtimeClassName: nvidia
  kind: ConfigMap
  metadata:
    labels:
      features.cpaas.io/enabled: "true"
      features.cpaas.io/group: nvidia-device-plugin
      features.cpaas.io/type: CustomResourceLimitation
    name: cf-crl-nvidia-device-plugin
    namespace: kube-public
  ```

- Пример конфигурации GPU Manager

  - Количество ядер GPU Manager:
    ```yaml
    apiVersion: v1
    data:
      dataType: integer
      defaultValue: "20"
      descriptionEn: "Количество ядер GPU, 100 ядер равны 1 ядру GPU"
      descriptionZh: 虚拟 GPU 核心数，100个虚拟核心等于 1 个 GPU 物理核心
      excludeResources: nvidia.com/gpu,nvidia.com/mps-core,nvidia.com/mps-memory
      group: gpu-manager
      groupI18n: '{"zh": "GPU Manager", "en": "GPU Manager"}'
      key: tencent.com/vcuda-core
      labelEn: Ядро GPU vcore
      labelZh: 虚拟 GPU
      limits: optional
      relatedResources: tencent.com/vcuda-memory
      requests: disabled
      resourceUnit: vcore
      runtimeClassName: ""
    kind: ConfigMap
    metadata:
      labels:
        device-recource.cpaas.io/config: "true"
        features.cpaas.io/enabled: "true"
        features.cpaas.io/group: gpu-manager
        features.cpaas.io/type: CustomResourceLimitation
      name: demo-gpu-manager-core
      namespace: kube-public
    ```

  - Память GPU Manager:
    ```yaml
    apiVersion: v1
    data:
      dataType: integer
      defaultValue: "20"
      descriptionEn: GPU vmemory, 256 Mi физической памяти на единицу
      descriptionZh: 虚拟 GPU 显存，每单位等于 256Mi 显存
      excludeResources: nvidia.com/gpu,nvidia.com/mps-core,nvidia.com/mps-memory
      group: gpu-manager
      groupI18n: '{"zh": "GPU Manager", "en": "GPU Manager"}'
      key: tencent.com/vcuda-memory
      labelEn: GPU vmemory
      labelZh: 显存
      limits: optional
      relatedResources: tencent.com/vcuda-core
      requests: disabled
      resourceUnit: unit
      runtimeClassName: ""
    kind: ConfigMap
    metadata:
      labels:
        device-recource.cpaas.io/config: "true"
        features.cpaas.io/enabled: "true"
        features.cpaas.io/group: gpu-manager
        features.cpaas.io/type: CustomResourceLimitation
      name: demo-gpu-manager-memory
      namespace: kube-public
    ```

- Пример конфигурации MPS

  - Количество ядер MPS:
    ```yaml
    apiVersion: v1
    data:
      dataType: integer
      defaultValue: "20"
      descriptionEn: "Количество ядер MPS GPU, 100 ядер MPS равны 1 ядру GPU"
      descriptionZh: MPS GPU 核心数，100个 MPS 核心等于 1 个 GPU 物理核心
      excludeResources: nvidia.com/gpu,tencent.com/vcuda-core,tencent.com/vcuda-memory
      group: nvidia-mps-device-plugin
      groupI18n: '{"zh": "MPS", "en": "MPS"}'
      key: nvidia.com/mps-core
      labelEn: Ядро MPS GPU
      labelZh: MPS GPU
      limits: optional
      relatedResources: nvidia.com/mps-memory
      requests: disabled
      resourceUnit: vcore
      runtimeClassName: nvidia
    kind: ConfigMap
    metadata:
      labels:
        features.cpaas.io/enabled: "true"
        features.cpaas.io/group: nvidia-mps-device-plugin
        features.cpaas.io/type: CustomResourceLimitation
      name: cf-crl-nvidia-mps-device-plugin-core
      namespace: kube-public
    ```

  - Память MPS:
    ```yaml
    apiVersion: v1
    data:
      dataType: integer
      defaultValue: "1"
      descriptionEn: "Память MPS GPU, 1 Gi физической памяти на единицу"
      descriptionZh: MPS GPU 显存，每单位等于 1Gi 显存
      excludeResources: nvidia.com/gpu,tencent.com/vcuda-core,tencent.com/vcuda-memory
      group: nvidia-mps-device-plugin
      groupI18n: '{"zh": "MPS", "en": "MPS"}'
      key: nvidia.com/mps-memory
      labelEn: Память MPS GPU
      labelZh: MPS 显存
      limits: optional
      relatedResources: nvidia.com/mps-core
      requests: disabled
      resourceUnit: unit
      runtimeClassName: nvidia
    kind: ConfigMap
    metadata:
      labels:
        features.cpaas.io/enabled: "true"
        features.cpaas.io/group: nvidia-mps-device-plugin
        features.cpaas.io/type: CustomResourceLimitation
      name: cf-crl-nvidia-mps-device-plugin-memory
      namespace: kube-public
    ```

### Другие квоты

Формат имен пользовательских квот должен соответствовать следующим спецификациям:

- Если имя пользовательской квоты не содержит косую черту (/): оно должно начинаться и заканчиваться буквой или цифрой и может содержать буквы, цифры, дефисы (-), подчеркивания (_) или точки (.), формируя квалифицированное имя максимальной длиной 63 символа.
- Если имя пользовательской квоты содержит косую черту (/): имя делится на две части: префикс и имя, в форме: prefix/name. Префикс должен быть допустимым DNS-поддоменом, в то время как имя должно соответствовать правилам квалифицированного имени.
- DNS-поддомен:
  - Метка: Должна начинаться и заканчиваться строчными буквами или цифрами, может содержать дефисы (-), но не может состоять исключительно из дефисов, максимальная длина составляет 63 символа.
  - Поддомен: Расширяет правила метки, позволяя нескольким меткам соединяться с помощью точек (.) для формирования поддомена, максимальная длина составляет 253 символа.
