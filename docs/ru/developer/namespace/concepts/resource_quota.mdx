---
weight: 40
sourceSHA: 3a276a5141c26cdfff6f47a64fd25c6b84c0968f0002958b064facc81b8e4a4a
---

# Квоты ресурсов

См. официальную документацию Kubernetes: [Квоты ресурсов](https://kubernetes.io/docs/concepts/policy/resource-quotas/)

## Запросы ресурсов и пределы ресурсов

Это используется для ограничения ресурсов, доступных для **определенного пространства имен**. Общее использование ресурсов всеми Pods в пространстве имен, за исключением тех, которые находятся в состоянии, не требующем завершения, не может превышать это значение.

- **Запросы ресурсов** определяют минимальное количество ресурсов (например, CPU, память), необходимых контейнеру, что направляет Kubernetes Scheduler размещать Pod на узле с достаточными ресурсами.
- **Пределы ресурсов** устанавливают максимальное количество ресурсов, которые контейнер может потреблять, предотвращая исчерпание ресурсов и обеспечивая стабильность системы.

## Квоты

### Квоты ресурсов

> Без ограничений означает, что нет никаких ограничений на ввод и использование, но фактическое использование не может превышать доступное значение соответствующего ресурса в кластере.

Каждое вычислительное ограничение ресурса контейнера (limits), указанное под пространством имен, или каждый новый Pod или PVC, добавленный здесь, будет потреблять квоту, установленную здесь.

**Включает следующие квоты ресурсов**

| Поле                  | Описание                                                                             |
| --------------------- | --------------------------------------------------------------------------------------- |
| **Запросы ресурсов** | Указывает квоту значения запросов ресурсов.<ul><li>CPU</li><li>Память</li></ul> |
| **Пределы ресурсов**   | Указывает квоту значения пределов ресурсов.<ul><li>CPU</li><li>Память</li></ul>   |
| **Количество Pods**    | Указывает квоту количества Pods.                                                     |

Примечание:

- Квота ресурсов пространства имен поступает из квоты, выделенной проекту кластером. Для любого данного ресурса максимальная квота, которую можно установить, является неиспользованной квотой в проекте. Если доступное количество любого ресурса равно 0, вы не сможете создать пространство имен. Пожалуйста, свяжитесь с администратором платформы для получения поддержки.
- Квота ресурса GPU может быть настроена только тогда, когда ресурсы GPU (vGPU или pGPU) развернуты в кластере. Когда используются ресурсы vGPU, также можно настроить квоту vMemory.
  GPU Units: 100 единиц виртуальных ядер эквивалентны 1 физическому ядру (1 pGPU = 1 ядро = 100 vGPU), и pGPU выделяется целыми единицами. 1 единица памяти равна 256 MiB, а 1024 MiB = 1 GiB.
- Если для определенного ресурса не указана квота, по умолчанию она будет равна Без ограничений. Это означает, что пространство имен может использовать доступные ресурсы соответствующего типа, выделенные проекту в кластере, по мере необходимости, без каких-либо ограничений.

### Квоты хранения

**Тип квоты**:

- **Все**: Общая запрашиваемая емкость хранения всех постоянных заявок на объем (PVC) в этом пространстве имен не может превышать это значение.
- **Класс хранилища**: В этом пространстве имен общая запрашиваемая емкость хранения всех постоянных заявок на объем (PVC), связанных с выбранным классом хранилища, не может превышать это значение.

**Примечание**: Пожалуйста, заранее выделите класс хранилища проекту, в котором находится пространство имен.

### Расширенные квоты ресурсов

**Типы квот** для расширенных ресурсов извлекаются из конфигурационного словаря (ConfigMap). Если соответствующий конфигурационный словарь не существует, эта категория не будет отображаться.

**Описание полей конфигурационного словаря**

| Поле                         | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **data.dataType**             | Указывает тип данных значения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **data.defaultValue**         | Устанавливает значение по умолчанию. Если это поле отсутствует или значение пустое, это указывает на отсутствие значения по умолчанию.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **data.descriptionEn**        | Сообщение подсказки на английском, которое можно посмотреть, кликнув на иконку справа от значения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **data.descriptionZh**        | Сообщение подсказки на китайском, которое можно посмотреть, кликнув на иконку справа от значения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **data.excludeResources**     | Взаимно исключающие ресурсы. Это поле используется для добавления ресурсов, которые не могут быть настроены одновременно, разделенных запятой.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **data.group**                | Группа                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **data.groupI18n**            | Названия группы на английском и китайском языках, которые можно просматривать и выбирать в выпадающих списках, соответствующих типам квот. Применимо, когда один и тот же ресурс имеет одно или несколько значений.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **data.key**                  | Указывает значение ключа. Конфигурационный словарь может описывать только один ключ.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **data.labelEn/data.labelZh** | Английское/китайское имя ресурса, которое можно просматривать и выбирать в выпадающих списках, соответствующих типам квот. Это поле выполняет ту же функцию, что и поле data.groupI18n, но применимо только в том случае, если один и тот же ресурс имеет одно значение, что обеспечивает совместимость со старой версией конфигурационного словаря (ConfigMap).                                                                                                                                                                                                                                                                                                      |
| **data.limits**               | Указывает, следует ли настраивать пределы для ресурсов. Допустимые значения: disabled означает, что пределы не могут быть настроены для ресурса, required означает, что его необходимо ввести, и optional означает, что это необязательный ввод.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **data.requests**             | Указывает, следует ли настраивать запросы для ресурсов. Допустимые значения: disabled означает, что запросы не могут быть настроены для ресурса, required означает, что его необходимо ввести, optional означает, что это необязательный ввод, и fromLimits означает, что будет использована та же конфигурация, что и для пределов.                                                                                                                                                                                                                                                                                                                                                              |
| **data.relatedResources**     | Ассоциированные ресурсы. Это поле зарезервировано и в настоящее время не может быть использовано.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **data.resourceUnit**         | Единица ресурса, должна быть введена английскими буквами и в настоящее время не поддерживает ввод на китайском.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **data.runtimeClassName**     | Обязательный класс времени выполнения, по умолчанию пустой с необязательным значением nvidia.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **metadata.labels**           | <ul><li>features.cpaas.io/type: CustomResourceLimitation, этот ярлык обязательный и не может быть изменен.</li><li> `features.cpaas.io/group: <*groupName*>`, этот ярлык обязательный и следует изменить groupName на соответствующую группу.</li><li> features.cpaas.io/enabled: "true", этот ярлык обязательный и указывает, включен ли он, по умолчанию true.</li></ul>                                                                                                                                                                                                                                                                                       |
| **metadata.name**             | Формат `cf-crl-<*groupName*>-<*name*>`, где <ul><li>cf-crl — фиксированное поле и не может быть изменено.</li><li>groupName — имя соответствующей группы ресурсов, например, gpu-manager, galaxy и т. д.</li><li>name — имя ресурса: <ul><li>Имя ресурса может быть стандартными именами типов ресурсов, например, cpu, memory, pods и т.д. Стандартные имена ресурсов должны соответствовать правилам [полных имен](#name), установленным в Kubernetes, и должны существовать в пределах определенных стандартных типов ресурсов в Kubernetes.</li><li>Имена ресурсов могут также быть специальными типами ресурсов, начинающимися с определенных префиксов, таких как: hugepages- или requests.hugepages-.</li></ul></li></ul> |
| **metadata.namespace**        | Должно быть указано как пространство имен kube-public и не может быть изменено.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

**Пример конфигурационного словаря**

В этом документе представлены только примеры конфигурации YAML для физического GPU, количества ядер GPU Manager и памяти, количества ядер и памяти MPS. Для использования других ресурсов, пожалуйста, обратитесь к вышеуказанным описаниям полей для настройки.

- Пример конфигурации физического GPU
  ```yaml
  apiVersion: v1
  data:
    dataType: integer
    defaultValue: "1"
    descriptionEn: Количество GPU
    descriptionZh: GPU 数量
    excludeResources: nvidia.com/mps-core,nvidia.com/mps-memory,tencent.com/vcuda-core,tencent.com/vcuda-memory
    group: nvidia-device-plugin
    groupI18n: '{"zh": "pGPU", "en": "pGPU"}'
    key: nvidia.com/gpu
    labelEn: Ядро GPU
    labelZh: 物理 GPU
    limits: optional
    relatedResources: ""
    requests: disabled
    resourceUnit: count
    runtimeClassName: nvidia
  kind: ConfigMap
  metadata:
    labels:
      features.cpaas.io/enabled: "true"
      features.cpaas.io/group: nvidia-device-plugin
      features.cpaas.io/type: CustomResourceLimitation
    name: cf-crl-nvidia-device-plugin
    namespace: kube-public
  ```

- Пример конфигурации GPU Manager

  - Количество ядер GPU Manager:
    ```yaml
    apiVersion: v1
    data:
      dataType: integer
      defaultValue: "20"
      descriptionEn: "Количество виртуальных ядер GPU, 100 виртуальных ядер равно 1 ядру GPU"
      descriptionZh: 虚拟 GPU 核心数，100个虚拟核心等于 1 个 GPU 物理核心
      excludeResources: nvidia.com/gpu,nvidia.com/mps-core,nvidia.com/mps-memory
      group: gpu-manager
      groupI18n: '{"zh": "GPU Manager", "en": "GPU Manager"}'
      key: tencent.com/vcuda-core
      labelEn: Виртуальное ядро GPU
      labelZh: 虚拟 GPU
      limits: optional
      relatedResources: tencent.com/vcuda-memory
      requests: disabled
      resourceUnit: vcore
      runtimeClassName: ""
    kind: ConfigMap
    metadata:
      labels:
        device-recource.cpaas.io/config: "true"
        features.cpaas.io/enabled: "true"
        features.cpaas.io/group: gpu-manager
        features.cpaas.io/type: CustomResourceLimitation
      name: demo-gpu-manager-core
      namespace: kube-public
    ```

  - Память GPU Manager:
    ```yaml
    apiVersion: v1
    data:
      dataType: integer
      defaultValue: "20"
      descriptionEn: Память GPU vmemory, 256 Mi физической памяти на единицу
      descriptionZh: 虚拟 GPU 显存，每单位等于 256Mi 显存
      excludeResources: nvidia.com/gpu,nvidia.com/mps-core,nvidia.com/mps-memory
      group: gpu-manager
      groupI18n: '{"zh": "GPU Manager", "en": "GPU Manager"}'
      key: tencent.com/vcuda-memory
      labelEn: Память GPU vmemory
      labelZh: 显存
      limits: optional
      relatedResources: tencent.com/vcuda-core
      requests: disabled
      resourceUnit: unit
      runtimeClassName: ""
    kind: ConfigMap
    metadata:
      labels:
        device-recource.cpaas.io/config: "true"
        features.cpaas.io/enabled: "true"
        features.cpaas.io/group: gpu-manager
        features.cpaas.io/type: CustomResourceLimitation
      name: demo-gpu-manager-memory
      namespace: kube-public
    ```

- Пример конфигурации MPS

  - Количество ядер MPS:
    ```yaml
    apiVersion: v1
    data:
      dataType: integer
      defaultValue: "20"
      descriptionEn: "Количество ядра MPS GPU, 100 ядер MPS равно 1 ядру GPU"
      descriptionZh: MPS GPU 核心数，100个 MPS 核心等于 1 个 GPU 物理核心
      excludeResources: nvidia.com/gpu,tencent.com/vcuda-core,tencent.com/vcuda-memory
      group: nvidia-mps-device-plugin
      groupI18n: '{"zh": "MPS", "en": "MPS"}'
      key: nvidia.com/mps-core
      labelEn: Ядро MPS GPU
      labelZh: MPS GPU
      limits: optional
      relatedResources: nvidia.com/mps-memory
      requests: disabled
      resourceUnit: vcore
      runtimeClassName: nvidia
    kind: ConfigMap
    metadata:
      labels:
        features.cpaas.io/enabled: "true"
        features.cpaas.io/group: nvidia-mps-device-plugin
        features.cpaas.io/type: CustomResourceLimitation
      name: cf-crl-nvidia-mps-device-plugin-core
      namespace: kube-public
    ```

  - Память MPS:
    ```yaml
    apiVersion: v1
    data:
      dataType: integer
      defaultValue: "1"
      descriptionEn: Память MPS GPU, 1 Gi физической памяти на единицу
      descriptionZh: MPS GPU 显存，每单位等于 1Gi 显存
      excludeResources: nvidia.com/gpu,tencent.com/vcuda-core,tencent.com/vcuda-memory
      group: nvidia-mps-device-plugin
      groupI18n: '{"zh": "MPS", "en": "MPS"}'
      key: nvidia.com/mps-memory
      labelEn: Память MPS GPU
      labelZh: MPS 显存
      limits: optional
      relatedResources: nvidia.com/mps-core
      requests: disabled
      resourceUnit: unit
      runtimeClassName: nvidia
    kind: ConfigMap
    metadata:
      labels:
        features.cpaas.io/enabled: "true"
        features.cpaas.io/group: nvidia-mps-device-plugin
        features.cpaas.io/type: CustomResourceLimitation
      name: cf-crl-nvidia-mps-device-plugin-memory
      namespace: kube-public
    ```

### Другие квоты

Формат имен настраиваемых квот должен соответствовать следующим спецификациям:

- Если имя настраиваемой квоты не содержит косую черту (/): Оно должно начинаться и заканчиваться буквой или цифрой и может содержать буквы, цифры, тире (-), подчеркивания (_) или точки (.), образуя полное имя максимальной длиной 63 символа.
- Если имя настраиваемой квоты содержит косую черту (/): Имя делится на две части: префикс и имя, в формате: префикс/имя. Префикс должен быть допустимым поддоменом DNS, в то время как имя должно соответствовать правилам полного имени.
- Поддомен DNS:
  - Ярлык: Должен начинаться и заканчиваться строчными буквами или цифрами, может содержать тире (-), но не может состоять исключительно из тире, с максимальной длиной 63 символа.
  - Поддомен: Расширяет правила ярлыка, позволяя нескольким ярлыкам соединяться точками (.) для формирования поддомена с максимальной длиной 253 символа.
