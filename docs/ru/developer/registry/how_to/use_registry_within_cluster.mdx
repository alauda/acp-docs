---
weight: 12
i18n:
  title:
    zh: 在 Kubernetes 集群内部使用 Alauda Container Platform Registry
sourceSHA: 3787cfad23e3363b7ef9233a8a62452637519030c916abd6466eb75267723ce6
---

# Использование реестра Alauda Container Platform в кластере Kubernetes

Реестр Alauda Container Platform (ACP) обеспечивает безопасное управление образами контейнеров для рабочих нагрузок Kubernetes. При развертывании приложений внутри кластера используйте адрес входа (например, `registry.cluster.local`) для оптимизации производительности и безопасности.

## Развертывание примера приложения

1. Пространство имен developer создает приложение с именем `my-app` в пространстве имен `my-ns`.
2. Образ приложения хранится в реестре по адресу `registry.cluster.local/my-ns/my-app:v1`.
3. **По умолчанию** ServiceAccount в каждом пространстве имен автоматически настраивается с imagePullSecret для доступа к образам из `registry.cluster.local`.

Пример развертывания:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
  namespace: my-ns
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: main-container
        image: registry.cluster.local/my-ns/my-app:v1
        ports:
        - containerPort: 8080
```

## Доступ между пространствами имен

Чтобы разрешить пользователям из `my-ns` извлекать образы из `shared-ns`, администратор `shared-ns` может создать привязку роли для предоставления необходимых разрешений.

### Пример привязки роли

```bash
# Доступ к образам из общего пространства имен (требуются разрешения)
kubectl create rolebinding cross-ns-pull \
  --clusterrole=system:image-puller \
  --serviceaccount=my-ns:default \
  -n shared-ns
```

## Рекомендации по лучшим практикам

- **Используйте реестр**: Всегда используйте `registry.cluster.local` для развертываний, чтобы обеспечить безопасность и производительность.
- **Изоляция пространств имен**: Используйте изоляцию пространств имен для лучшей безопасности и управления образами.
  - Используйте пути образов на основе пространств имен: `registry.cluster.local/<namespace>/<image>:<tag>`.
- **Привязки ролей**: Используйте привязки ролей для управления доступом между пространствами имен для пользователей и сервисных аккаунтов.

## Контрольный список для проверки

1. Проверьте доступность образа для ServiceAccount по умолчанию в `my-ns`:

```bash
kubectl auth can-i get images.registry.alauda.io --namespace my-ns --as=system:serviceaccount:my-ns:default
```

2. Проверьте доступность образа для пользователя в `my-ns`:

```bash
kubectl auth can-i get images.registry.alauda.io --namespace my-ns --as=<username>
```

## Устранение неполадок

- **Ошибки извлечения образов**: Проверьте imagePullSecrets в спецификации пода и убедитесь, что они правильно настроены.
- **Отказ в доступе**: Убедитесь, что у пользователя или ServiceAccount есть необходимые привязки ролей в целевом пространстве имен.
- **Сетевые проблемы**: Проверьте сетевые политики и конфигурации служб, чтобы обеспечить подключение к внутреннему реестру.
