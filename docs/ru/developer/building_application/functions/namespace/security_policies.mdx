---
weight: 50
sourceSHA: 13ffaad9839386f1234d301073463d0a9466af93eac7183449cadc7d78888d1e
---

# Поддержка безопасности подов

Смотрите официальную документацию Kubernetes: [Поддержка безопасности подов](https://kubernetes.io/docs/concepts/security/pod-security-admission/)

Поддержка безопасности подов (PSA) — это контроллер допуска Kubernetes, который обеспечивает соблюдение политик безопасности на уровне пространства имен, проверяя спецификации подов на соответствие заранее определенным стандартам.

## Режимы безопасности

PSA определяет три режима для контроля обработки нарушений политики:

| Режим       | Поведение                                                        | Случай использования                                                       |
| ----------- | --------------------------------------------------------------- | ------------------------------------------------------------------------ |
| **Принудительно** | Отказывает в создании/изменении несоответствующих подов.             | Производственные среды, требующие строгого соблюдения безопасности.      |
| **Аудит**   | Позволяет создание подов, но регистрирует нарушения в журналах аудита. | Мониторинг и анализ инцидентов безопасности без блокировки рабочих нагрузок. |
| **Предупреждение**    | Позволяет создание подов, но возвращает клиентские предупреждения о нарушениях. | Тестовые среды или переходные этапы для корректировки политики.          |

**Ключевые заметки**:

- **Принудительно** действует только на поды (например, отклоняет поды, но позволяет не подовые ресурсы, такие как развертывания).
- **Аудит** и **Предупреждение** применяются как к подам, так и к их контроллерам (например, развертываниям).

## Стандарты безопасности

PSA определяет три стандарта безопасности для ограничения привилегий подов:

| Стандарт       | Описание                                                                    | Ключевые ограничения                                                                                                         |
| -------------- | ------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------ |
| **Привилегированный** | Неограниченный доступ. Подходит для доверенных рабочих нагрузок (например, системные компоненты). | Нет проверки полей `securityContext`.                                                                               |
| **Базовый**   | Минимальные ограничения для предотвращения известных эскалаций привилегий.                   | Блокирует `hostNetwork`, `hostPID`, привилегированные контейнеры и неограниченные тома `hostPath`.                             |
| **Ограниченный** | Самая строгая политика, обеспечивающая соблюдение лучших практик безопасности.                            | Требуется: <br />- `runAsNonRoot: true` <br />- `seccompProfile.type: RuntimeDefault` <br />- Удаленные возможности Linux. |

## Конфигурация

<a id="update-psa" />

### Метки пространства имен

Примените метки к пространствам имен для определения политик PSA.

**Пример YAML файла**

```yaml
apiVersion: v1  
kind: Namespace  
metadata:  
  name: example-namespace  
  labels:  
    pod-security.kubernetes.io/enforce: restricted   
    pod-security.kubernetes.io/audit: baseline  
    pod-security.kubernetes.io/warn: baseline  
```

**Команда CLI**

```bash
# Шаг 1: Обновите метки допуска подов  
kubectl label namespace <namespace-name> \  
  pod-security.kubernetes.io/enforce=baseline \  
  pod-security.kubernetes.io/audit=restricted \  
  --overwrite  

# Шаг 2: Проверьте метки  
kubectl get namespace <namespace-name> --show-labels  
```

### Исключения

Исключите конкретных пользователей, пространства имен или классы выполнения из проверок PSA.

**Пример конфигурации**:

```yaml
apiVersion: pod-security.admission.config.k8s.io/v1  
kind: PodSecurityConfiguration  
exemptions:  
  usernames: ["admin"]  
  runtimeClasses: ["nvidia"]  
  namespaces: ["kube-system"]  
```
