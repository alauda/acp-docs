---
weight: 30
sourceSHA: b5a06d8bacde2809e9e5be173ddb7547c324bf6f48e6b8aa29a78654cb8f3ba8
---

# Квота ресурсов

Смотрите официальную документацию Kubernetes: [Квоты ресурсов](https://kubernetes.io/docs/concepts/policy/resource-quotas/)

## Понимание запросов и лимитов ресурсов

Используется для ограничения ресурсов, доступных для конкретного пространства имен. Общее использование ресурсов всеми Pod'ами в пространстве имен (за исключением тех, которые находятся в состоянии `Terminating`) не должно превышать квоту.

**Запросы ресурсов**: Определяют минимальные ресурсы (например, CPU, память), необходимые контейнеру, направляя планировщик Kubernetes размещать Pod на узле с достаточной мощностью.

**Лимиты ресурсов**: Определяют максимальные ресурсы, которые может потреблять контейнер, предотвращая исчерпание ресурсов и обеспечивая стабильность кластера.

## Квоты

### Квоты ресурсов

> Если ресурс помечен как `Unlimited`, явная квота не применяется, но использование не может превышать доступную мощность кластера.

Квоты ресурсов отслеживают совокупное потребление ресурсов (например, лимиты контейнеров, новые Pod'ы или PVC) в пространстве имен.

**Поддерживаемые типы квот**

| Поле                   | Описание                                                                                  |
| --------------------- | -------------------------------------------------------------------------------------------- |
| **Запросы ресурсов**  | Общие запрашиваемые ресурсы для всех Pod'ов в пространстве имен:<ul><li>CPU</li><li>Память</li></ul> |
| **Лимиты ресурсов**   | Общие лимиты ресурсов для всех Pod'ов в пространстве имен:<ul><li>CPU</li><li>Память</li></ul>     |
| **Количество Pod'ов**  | Максимальное количество Pod'ов, разрешенное в пространстве имен.                                             |

Примечание:

- Квоты пространства имен выводятся из выделенных ресурсов кластера проекта. Если доступная квота любого ресурса равна 0, создание пространства имен завершится неудачей. Свяжитесь с администратором.
- `Unlimited` подразумевает, что пространство имен может использовать оставшиеся ресурсы кластера проекта для этого типа ресурса.

#### Пример файла YAML

```yaml
# example-resourcequota.yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: example-resourcequota
  namespace: <example>
spec:
  hard:
    limits.cpu: "20"
    limits.memory: 20Gi
    pods: "500"
    requests.cpu: "2"
    requests.memory: 2Gi

```

#### Создание квоты ресурсов с помощью CLI

**Создание через файл YAML**

```bash
kubectl apply -f example-resourcequota.yaml
```

\*\* Создание через командную строку напрямую\*\*

```bash
kubectl create resourcequota example-resourcequota --namespace=<example> --hard=limits.cpu=20,limits.memory=20Gi,pods=500 
```

### Квоты на хранение

**Тип квоты**:

- **Все**: Общая емкость хранения PVC в пространстве имен.
- **Класс хранения**: Общая емкость хранения PVC для конкретного класса хранения.

**Примечание**: Убедитесь, что класс хранения предварительно назначен проекту, содержащему пространство имен.

<a id="extended-resources-quotas" />

### Расширенные квоты ресурсов

Расширенные квоты ресурсов определяются через **ConfigMap**. Если ConfigMap отсутствует, категория ресурса не появится.

**Описание полей ConfigMap**

| Поле                         | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ----------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **data.dataType**             | Тип данных (например, `vGPU`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **data.defaultValue**         | Значение по умолчанию (пусто = без значения по умолчанию).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **data.descriptionEn**        | Текст подсказки на английском (отображается при наведении на поле).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **data.descriptionZh**        | Текст подсказки на китайском (отображается при наведении на поле).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **data.excludeResources**     | Взаимно исключающие ресурсы (разделенные запятыми).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **data.group**                | Группа ресурсов (например, `MPS`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **data.groupI18n**            | Название группы на английском/китайском для выпадающих списков UI.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **data.key**                  | Указывает значение ключа. Словарь конфигурации может описывать только один ключ.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **data.labelEn/data.labelZh** | Английское/китайское название ресурса, которое можно просмотреть и выбрать в выпадающих опциях, соответствующих типам квот. Это поле выполняет ту же функцию, что и поле data.groupI18n, но применимо только в том случае, если один и тот же ресурс имеет одно значение, что обеспечивает совместимость со старой версией словаря конфигурации (ConfigMap).                                                                                                                                                                                                                                                                                                 |
| **data.limits**               | Указывает, следует ли настраивать лимиты для ресурсов. Допустимые значения: disabled указывает, что лимиты не могут быть настроены для ресурса, required указывает, что они должны быть введены, и optional указывает, что это необязательный ввод.                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **data.requests**             | Указывает, следует ли настраивать запросы для ресурсов. Допустимые значения: disabled указывает, что запросы не могут быть настроены для ресурса, required указывает, что они должны быть введены, optional указывает, что это необязательный ввод, и fromLimits указывает, что будет использоваться та же конфигурация, что и для лимитов.                                                                                                                                                                                                                                                                                                                                                         |
| **data.relatedResources**     | Связанные ресурсы. Это поле зарезервировано и в настоящее время не может быть использовано.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **data.resourceUnit**         | Единица ресурса (например, `cores`, `GiB`). Не поддерживает ввод на китайском.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **data.runtimeClassName**     | Класс выполнения (по умолчанию: `nvidia` для GPU).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **metadata.labels**           | Обязательные метки:<ul><li>`features.cpaas.io/type: CustomResourceLimitation`</li><li> `features.cpaas.io/group: <groupName>`</li><li>`features.cpaas.io/enabled`: `true` или `false`, метка обязательна и указывает, включена ли она, по умолчанию true.</li></ul>                                                                                                                                                                                                                                                                                                                                                                                       |
| **metadata.name**             | Формат: `cf-crl-<*groupName*>-<*name*>`, где <ul><li>cf-crl - фиксированное поле и не может быть изменено.</li><li>groupName - название соответствующей группы ресурсов, например, gpu-manager, galaxy и т.д.</li><li>name - название ресурса: <ul><li>Название ресурса может быть стандартными именами типов ресурсов, например, cpu, memory, pods и т.д. Стандартные имена ресурсов должны соответствовать правилам квалифицированных имен Kubernetes и должны существовать в пределах определенных стандартных типов ресурсов в Kubernetes.</li><li>Названия ресурсов также могут быть специальными типами ресурсов, начинающимися с определенных префиксов, таких как: `hugepages-` или `requests.hugepages-.`</li></ul></li></ul> |
| **metadata.namespace**        | Должно быть `kube-public`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

<a id="other-quotas" />

### Другие квоты

Формат имен пользовательских квот должен соответствовать следующим спецификациям:

- Если имя пользовательской квоты не содержит косую черту (/): Оно должно начинаться и заканчиваться буквой или цифрой и может содержать буквы, цифры, дефисы (-), подчеркивания (_) или точки (.), образуя квалифицированное имя максимальной длиной 63 символа.
- Если имя пользовательской квоты содержит косую черту (/): Имя делится на две части: префикс и имя, в форме: префикс/имя. Префикс должен быть допустимым DNS поддоменом, в то время как имя должно соответствовать правилам для квалифицированного имени.
- DNS поддомен:
  - Метка: Должна начинаться и заканчиваться строчными буквами или цифрами, может содержать дефисы (-), но не может состоять исключительно из дефисов, максимальная длина 63 символа.
  - Поддомен: Расширяет правила метки, позволяя нескольким меткам соединяться точками (.) для формирования поддомена, максимальная длина 253 символа.
