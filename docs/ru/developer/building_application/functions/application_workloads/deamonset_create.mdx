---
weight: 20
i18n:
  title:
    en: Создание DaemonSets
    zh: 创建 DaemonSets
title: Создание DaemonSets
sourceSHA: 94a6ada4fa0324e66c6e0df917154d9e5070badb314d5a7476389bb32233d51d
---

# Создание DaemonSets

**DaemonSet** — это объект контроллера Kubernetes, который гарантирует, что на всех (или некоторых) узлах кластера работает ровно одна реплика указанного Pod. В отличие от развертываний (Deployments), DaemonSets ориентированы на узлы, а не на приложение, что делает их идеальными для инфраструктурных сервисов в кластере.

:::warning
**Операционные заметки DaemonSet**

1. **Характеристики поведения**
   - **Распределение Pod**
     - Развёртывает ровно **одну реплику Pod на каждом узле, который можно запланировать**, соответствующем:
       - критериям `nodeSelector`
       - Не находится в состоянии `NotReady`
       - Не имеет меток `NoSchedule` / `NoExecute` (если не настроены терпимости)
     - **Формула количества Pod**:\
       `Число Pod = Число квалифицированных узлов`

   - **Обработка узлов с двойной ролью**
     - Узлы, выполняющие роли как управляющего узла, так и рабочего, будут запускать только **один экземпляр Pod**, независимо от меток ролей.

2. **Ключевые ограничения**: ❌ Исключенные узлы
   - Узлы с флагом `Unschedulable: true`
   - Узлы со статусом `NotReady`
   - Узлы с несовместимыми метками без соответствующих терпимостей
     :::

## Предварительные требования

Получите адрес изображения. Источник изображений может быть взят из репозитория изображений, интегрированного администратором платформы через инструментальную цепочку, или из репозиториев изображений сторонних платформ.

- В первом случае администратор обычно назначает репозиторий изображений вашему проекту, и вы можете использовать изображения из него. Если нужный репозиторий изображений не найден, свяжитесь с администратором для его выделения.

- Если это репозиторий изображений сторонней платформы, убедитесь, что изображения можно загрузить непосредственно из него в текущем кластере.

## Процедура

1. В **Платформе контейнеров** перейдите в **Рабочие нагрузки** > **DaemonSets** в левом боковом меню.

2. Нажмите **Создать DaemonSets**.

3. **Выберите** или **Введите** изображение и нажмите **Подтвердить**.

:::info
**Примечание**: При использовании изображений из репозитория изображений, интегрированного в веб-консоль, вы можете фильтровать изображения по **Уже интегрированное**. **Имя интеграционного проекта**, например, изображения (docker-registry-projectname), который включает в себя имя проекта projectname в этой веб-консоли и имя проекта containers в репозитории изображений.
:::

### Настройка основной информации

В разделе **Основная информация** настройте декларативные параметры для рабочих нагрузок развертывания:

| **Параметры**                  | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| :----------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Дополнительно** > **Стратегия обновления** | Настраивает стратегию `rollingUpdate` для развертываний без простоев: <br />  **Максимальный прирост** (`maxSurge`):  <ul><li>Максимальное количество Pod, которое может превышать запрашиваемое количество реплик во время обновления. </li><li> Принимает абсолютные значения (например, `2`) или проценты (например, `20%`). </li><li> Расчет процента: `ceil(current_replicas × percentage)`. </li><li>Пример: 4.1 → `5`, когда рассчитывается от 10 реплик. </li></ul> **Максимально недоступно** (`maxUnavailable`): <ul><li> Максимальное количество Pod, которое может быть временно недоступно во время обновления.  </li><li>Процентные значения не могут превышать `100%`.  </li><li> Расчет процента: `floor(current_replicas × percentage)`.   </li><li> Пример: 4.9 → `4`, когда рассчитывается от 10 реплик.  </li></ul> **Заметки**: <br /> 1. **Значения по умолчанию**: `maxSurge=1`, `maxUnavailable=1`, если не указано явно.  <br /> 2. **Под, не работающий** (например, в состояниях `Pending`/`CrashLoopBackOff`) считается недоступным.  <br /> 3. **Одновременные ограничения**: <ul><li> `maxSurge` и `maxUnavailable` не могут быть одновременно равными `0` или `0%`. </li><li>Если процентные значения приводят к `0` для обоих параметров, Kubernetes принуждает `maxUnavailable=1`, чтобы гарантировать прогресс обновления.  </li></ul> **Пример**: <br /> Для развертывания с 10 репликами: <br /><ul><li> `maxSurge=2` → Всего Pod во время обновления: `10 + 2 = 12`. </li><li>`maxUnavailable=3` → Минимально доступные Pod: `10 - 3 = 7`. </li><li> Это обеспечивает доступность при контролируемом развертывании. </li></ul> |

### Настройка Pod

В разделе **Pod** пожалуйста, смотрите [Создание развертывания - Настройка Pod](./deployment_create.mdx#configurepod)

### Настройка контейнеров

В разделе **Контейнер** пожалуйста, смотрите [Создание развертывания - Настройка контейнеров](./deployment_create.mdx#configurecontainers)

### Создание

Нажмите **Создать**.
После нажатия **Создать** DaemonSet:

✅ Автоматически развернёт реплики Pod на всех **подходящих узлах**, соответствующих:

- критериям `nodeSelector` (если определены)
- настройкам `tolerations`
- Узел в состоянии `Ready` & `Schedulable: true`

❌ **Исключенные узлы**:

- Узлы с меткой `NoSchedule` (если не терпимо)
- Узлы, закрытые вручную (`kubectl cordon`)
- Узлы в состоянии `NotReady`/`Unschedulable`
