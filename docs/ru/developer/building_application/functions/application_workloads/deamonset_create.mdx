---
weight: 20
i18n:
  title:
    en: Создание DaemonSets
    zh: 创建 DaemonSets
title: Создание DaemonSets
sourceSHA: 94a6ada4fa0324e66c6e0df917154d9e5070badb314d5a7476389bb32233d51d
---

# Создание DaemonSets

**DaemonSet** — это объект контроллера Kubernetes, который обеспечивает выполнение всех (или подмножества) узлов кластера ровно одной реплики указанного Pod. В отличие от Deployment, DaemonSet ориентирован на узлы, а не на приложения, что делает его идеальным для инфраструктурных служб, охватывающих весь кластер.

:::warning
**Операционные заметки DaemonSet**

1. **Характеристики поведения**
   - **Распределение Pod**
     - Размещает ровно **одну реплику Pod на каждом планируемом узле**, соответствующем:
       - критериям `nodeSelector`
       - состоянию, отличному от `NotReady`
       - отсутствию меток `NoSchedule`/`NoExecute` (если не предусмотрены толерантности)
     - **Формула подсчета Pod**:\
       `Количество Pod = Количество квалифицированных узлов`

   - **Обработка узлов с двойной ролью**
     - Узлы, выполняющие как функции управления, так и рабочие роли, будут запускать только **один экземпляр Pod**, независимо от меток ролей.

2. **Ключевые ограничения**: ❌ Исключенные узлы
   - Узлы с флагом `Unschedulable: true`
   - Узлы с состоянием `NotReady`
   - Узлы с несовместимыми метками без соответствующих толерантностей
     :::

## Предварительные требования

Получите адрес изображения. Исходниками изображений могут быть как репозиторий изображений, интегрированный администратором платформы через цепочку инструментов, так и репозитории изображений сторонних платформ.

- В первом случае администратор обычно назначает репозиторий изображений вашему проекту, и вы можете использовать изображения из него. Если нужный репозиторий изображения не найден, обратитесь к администратору для его выделения.

- Если это репозиторий изображений сторонней платформы, убедитесь, что изображения можно напрямую получить из него в текущем кластере.

## Процедура

1. В **Container Platform** перейдите в раздел **Workloads** > **DaemonSets** в левой боковой панели.

2. Нажмите **Создать DaemonSets**.

3. **Выберите** или **введите** изображение и нажмите **Подтвердить**.

:::info
**Примечание**: При использовании изображений из репозитория изображений, интегрированного в веб-консоль, вы можете фильтровать изображения по критерию **Уже интегрировано**. **Имя интеграционного проекта**, например, изображения (docker-registry-projectname), которое включает имя проекта projectname в этой веб-консоли и имя проекта containers в репозитории изображений.
:::

### Настройка основной информации

В разделе **Основная информация** настройте декларативные параметры для нагрузок Deployment:

| **Параметры**                 | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| :----------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Больше** > **Стратегия обновления** | Настройка стратегии `rollingUpdate` для развертываний без простоев: <br />  **Максимальное увеличение** (`maxSurge`):  <ul><li>Максимальное количество Pod, которое может превышать желаемое количество реплик во время обновления. </li><li> Принимает абсолютные значения (например, `2`) или проценты (например, `20%`). </li><li> Расчет процента: `ceil(current_replicas × percentage)`. </li><li>Пример: 4.1 → `5`, когда рассчитывается из 10 реплик. </li></ul> **Максимально недоступно** (`maxUnavailable`): <ul><li> Максимальное количество Pod, которое может быть временно недоступно во время обновления.  </li><li>Процентные значения не могут превышать `100%`.  </li><li> Расчет процента: `floor(current_replicas × percentage)`.   </li><li> Пример: 4.9 → `4`, когда рассчитывается из 10 реплик.  </li></ul> **Замечания**: <br /> 1. **Значения по умолчанию**: `maxSurge=1`, `maxUnavailable=1`, если не установлены явно.  <br /> 2. **Неисполнимые Pods** (например, в состояниях `Pending`/`CrashLoopBackOff`) считаются недоступными.  <br /> 3. **Одновременные ограничения**: <ul><li> `maxSurge` и `maxUnavailable` не могут одновременно быть `0` или `0%`. </li><li>Если процентные значения равны `0` для обоих параметров, Kubernetes принудительно устанавливает `maxUnavailable=1`, чтобы обеспечить прогресс обновления.  </li></ul> **Пример**: <br /> Для развертывания с 10 репликами: <br /><ul><li> `maxSurge=2` → Всего Pod во время обновления: `10 + 2 = 12`. </li><li>`maxUnavailable=3` → Минимальное количество доступных Pod: `10 - 3 = 7`. </li><li> Это обеспечивает доступность при контролируемом развёртывании. </li></ul> |

### Настройка Pod

В разделе **Pod** обращайтесь к [Создание развертывания - Настройка Pod](./deployment_create.mdx#configurepod)

### Настройка контейнеров

В разделе **Контейнер** обращайтесь к [Создание развертывания - Настройка контейнеров](./deployment_create.mdx#configurecontainers)

### Создать

Нажмите **Создать**.
После нажатия **Создать** DaemonSet:

✅ Автоматически развернет реплики Pod на всех **подходящих узлах**, соответствующих:

- критериям `nodeSelector` (если определены)
- конфигурации `tolerations`
- Узлу в состоянии `Ready` и `Schedulable: true`

❌ **Исключенные узлы**:

- Узлы с меткой `NoSchedule` (если не терпятся)
- Узлы, вручную выделенные (`kubectl cordon`)
- Узлы в состоянии `NotReady`/`Unschedulable`
