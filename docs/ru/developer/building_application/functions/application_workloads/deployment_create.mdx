---
weight: 10
i18n:
  title:
    en: Создание развертываний
    zh: 创建 Deployments
title: Создание развертываний
sourceSHA: e9cdb864287f97d5700efc019391f1115be029a6b3b931d3705933b696c3102e
---

# Создание развертываний

**Развертывание** — это контроллер рабочих нагрузок Kubernetes, который декларативно управляет жизненным циклом контейнеризированных приложений. Он позволяет развертывать и управлять реплицированными Pod'ами с автоматизированными обновлениями/откатами, масштабированием и возможностями самовосстановления. В архитектуре микросервисов вы можете координировать несколько развертываний в одном приложении Kubernetes для реализации различных микросервисов, что делает их особенно подходящими для безсостояния рабочих нагрузок, которые требуют горизонтального масштабирования и контроля версий.

## Предпосылки

Получите адрес изображения. Источник изображений может быть из репозитория изображений, интегрированного администратором платформы через инструментальную цепочку, или из репозиториев изображений сторонних платформ.

- В первом случае администратор обычно назначает репозиторий изображений вашему проекту, и вы можете использовать изображения в нем. Если необходимый репозиторий изображений не найден, обратитесь к администратору для его выделения.

- Если это репозиторий изображений сторонней платформы, убедитесь, что изображения можно извлекать напрямую из него в текущем кластере.

<a id="updatepolicy" />

## Процедура 1 - Настройка основной информации

1. В **Платформе контейнеров** перейдите в **Рабочие нагрузки** > **Развертывания** в левом боковом меню.

2. Нажмите **Создать развертывание**.

3. **Выберите** или **введите** изображение, и нажмите **Подтвердить**.

:::info
**Примечание**: При использовании изображений из репозитория изображений, интегрированного в веб-консоль, вы можете фильтровать изображения по **Уже интегрированным**. **Имя проекта интеграции**, например, изображения (docker-registry-projectname), которое включает имя проекта projectname в этой веб-консоли и имя проекта containers в репозитории изображений.
:::

4. В разделе **Основная информация** настройте декларативные параметры для рабочих нагрузок развертывания:

   | **Параметры**                      | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   | :---------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Реплики**                        | Определяет желаемое количество реплик Pod в развертывании (по умолчанию: `1`). Настройте в зависимости от требований рабочей нагрузки.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   | **Дополнительно** > **Стратегия обновления** | Настройка стратегии `rollingUpdate` для развертываний без времени простоя: <br />  **Максимальный рост** (`maxSurge`):  <ul><li> Максимальное количество Pod'ов, которое может превышать желаемое количество реплик во время обновления. </li><li> Принимает абсолютные значения (например, `2`) или процентные значения (например, `20%`). </li><li> Расчет процента: `ceil(current_replicas × percentage)`. </li><li>Пример: 4.1 → `5` при расчете из 10 реплик. </li></ul> **Максимально недоступно** (`maxUnavailable`): <ul><li> Максимальное количество Pod'ов, которые могут быть временно недоступны во время обновления.  </li><li>Процентные значения не могут превышать `100%`.  </li><li> Расчет процента: `floor(current_replicas × percentage)`.   </li><li> Пример: 4.9 → `4` при расчете из 10 реплик.  </li></ul> **Примечания**: <br /> 1. **Значения по умолчанию**: `maxSurge=1`, `maxUnavailable=1`, если не установлены явно.  <br /> 2. **Неработающие Pod'ы** (например, в состояниях `Pending`/`CrashLoopBackOff`) считаются недоступными.  <br /> 3. **Ограничения на одновременное использование**: <ul><li> `maxSurge` и `maxUnavailable` не могут быть одновременно равны `0` или `0%`. </li><li>Если процентные значения приводят к `0` для обоих параметров, Kubernetes принуждает `maxUnavailable=1`, чтобы обеспечить прогресс обновления.  </li></ul> **Пример**: <br /> Для развертывания с 10 репликами: <br /><ul><li> `maxSurge=2` → Всего Pod'ов во время обновления: `10 + 2 = 12`. </li><li>`maxUnavailable=3` → Минимальное количество доступных Pod'ов: `10 - 3 = 7`. </li><li> Это обеспечивает доступность при контролируемой реализации. </li></ul> |

<a id="configurepod" />

## Процедура 2 - Настройка Pod

**Примечание**: В кластерах с смешанной архитектурой, развертывающих изображения единой архитектуры, убедитесь, что установлены правильные [Правила привязки узлов](#schuconf) для планирования Pod'ов.

1. В разделе **Pod** настройте параметры времени выполнения контейнера и управления жизненным циклом:

   | **Параметры**                      | **Описание**                                                                                                                                                                                                                                                                                         |
   | :---------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | **Томa**                            | Подключите постоянные тома к контейнерам. Поддерживаемые типы томов включают `PVC`, `ConfigMap`, `Secret`, `emptyDir`, `hostPath` и другие. Для деталей реализации смотрите [Руководство по подключению томов](#pvmount).                                                                                              |
   | **Учетные данные изображения**      | Необходимы **только** при извлечении изображений из сторонних реестров (через ручной ввод URL изображения). <br /> **Примечание**: Изображения из интегрированного реестра платформы автоматически унаследуют связанные секреты.                                                                                              |
   | **Период завершения**               | Длительность (по умолчанию: `30s`), разрешенная для Pod на завершение корректного завершения после получения сигнала об остановке. <br /> - В течение этого времени Pod завершает запросы в полете и освобождает ресурсы. <br /> - Установка `0` принуждает немедленное удаление (SIGKILL), что может вызвать прерывание запросов. |

<a id="schuconf" />

2. **Правила привязки узлов**
   | **Параметры**                       | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   | :---------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Дополнительно** > **Селектор узлов** | Ограничьте Pod'ы для узлов с определенными метками (например, `kubernetes.io/os: linux`). <br /> ![Селектор ОС узлов](../../../../../en/developer/building_application/functions/application_workloads/assets/nodeselector_os.png)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   | **Дополнительно** > **Привязка**      | Определите тонкие правила планирования на основе существующих Pod'ов: <br /> **Типы привязки Pod'ов**: <ul><li> **Привязка между Pod'ами**: Запланируйте новые Pod'ы на узлы, на которых размещены определенные Pod'ы (в том же домене топологии). </li><li> **Антипривязка между Pod'ами**: Предотвращайте совместное размещение новых Pod'ов с определенными Pod'ами. </li></ul> **Режимы применения**:  <ul><li> **RequiredDuringSchedulingIgnoredDuringExecution**: Pod'ы распределяются *только* в том случае, если правила соблюдены.  </li><li> **PreferredDuringSchedulingIgnoredDuringExecution**: Приоритет узлов, соответствующих правилам, но допускаются исключения. </li></ul>**Поля конфигурации**:  <br /> <ul><li>`topologyKey`: Метка узла, определяющая домены топологии (по умолчанию: `kubernetes.io/hostname`).  </li><li>`labelSelector`: Фильтры целевых Pod'ов, используя запросы меток.  </li></ul> |

3. **Сетевая конфигурация**
   - Kube-OVN
     | **Параметры**                     | **Описание**                                                                                                                                                                                                                    |
     | :--------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
     | **Ограничения по пропускной способности**  | Применение QoS для сетевого трафика Pod'ов:  <ul><li>**Ограничение скорости выхода**: Максимальная скорость исходящего трафика (например, `10Mbps`). </li><li>**Ограничение скорости входа**: Максимальная скорость входящего трафика.</li></ul>                                      |
     | **Подсеть**                       | Назначение IP-адресов из предопределенного пула подсетей. Если не указано, используется подсеть по умолчанию для пространства имен.                                                                                                                                     |
     | **Статический IP-адрес**         | Привязка постоянных IP-адресов к Pod'ам:  <ul><li>Несколько Pod'ов через развертывания могут претендовать на один и тот же IP, но только один Pod может использовать его одновременно.  </li><li>**Критично**: Количество статических IP должно быть ≥ количество реплик Pod'ов. </li></ul> |

   - Calico
     | **Параметры**                       | **Описание**                                                                                                                                                                         |
     | :---------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
     | **Статический IP-адрес**           | Назначение фиксированных IP с строгой уникальностью:  <ul><li>Каждый IP может быть связан **только с одним Pod'ом** в кластере.  </li><li> **Критично**: Количество статических IP должно быть ≥ количества реплик Pod'ов.</li></ul> |

<a id="configurecontainers" />

## Процедура 3 - Настройка контейнеров

1. В разделе **Контейнер** ознакомьтесь со следующими инструкциями по настройке соответствующей информации.
   | **Параметры**                       | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   | :----------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | **Запросы ресурсов и ограничения**   | <ul><li>**Запросы**: Минимальные ресурсы CPU/памяти, необходимые для работы контейнера.</li><li>**Ограничения**: Максимальные ресурсы CPU/памяти, позволенные во время выполнения контейнера. Для определений единиц смотрите [Единицы ресурсов](/developer/overview/concepts/unit.mdx).</li></ul>**Коэффициент перерасхода пространства имен**:<ul><li>**Без коэффициента перерасхода**:<br />Если существуют лимиты ресурсов пространства имен: Запросы/ограничения контейнера унаследуют значения по умолчанию для пространства имен (можно изменить).<br /> Если лимиты пространства имен не установлены: Нет значений по умолчанию; пользовательский запрос.</li><li>**С коэффициентом перерасхода**:<br />Запросы автоматически вычисляются как `Limits / Overcommit ratio` (неизменяемые).</li></ul> **Ограничения**:<ul><li>Запрос ≤ Ограничение ≤ Максимальная квота пространства имен.</li><li>Изменения коэффициента перерасхода требуют пересоздания Pod'ов для вступления в силу.</li><li>Коэффициент перерасхода отключает ручную настройку запросов.</li><li>Нет квот пространства имен → нет ограничений по ресурсам контейнеров.</li></ul> |
   | **Дополнительные ресурсы**           | Настройка доступных в кластере дополнительных ресурсов (например, vGPU, pGPU).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   | **Подключение тома**                 | Конфигурация постоянного хранилища. См. [Инструкции по подключению томов хранилищ](#pvmount).<br />**Операции**:<ul><li>Существующие тома pod'ов: Нажмите **Добавить**</li><li>Нет томов pod'ов: Нажмите **Добавить и подключить**</li></ul>**Параметры**:<ul><li>`mountPath`: Путь к файловой системе контейнера (например, `/data`)</li><li>`subPath`: Относительный путь к файлу/каталогу в томе.<br /> Для `ConfigMap`/`Secret`: Выберите конкретный ключ</li><li>`readOnly`: Подключите как доступ только для чтения (по умолчанию: чтение-запись)</li></ul>См. [Тома Kubernetes](https://kubernetes.io/docs/concepts/storage/volumes/).                                                                                                                                                                                                                                                                                                                                   |
   | **Порт**                               | Открытие портов контейнера.<br />**Пример**: Открыть TCP порт `6379` с именем `redis`.<br />**Поля**:<ul><li>`protocol`: TCP/UDP</li><li>`Port`: Открытый порт (например, `6379`)</li><li>`name`: Соответствующий ДНС идентификатор (например, `redis`)</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   | **Команды и аргументы запуска**       | Переопределите параметры ENTRYPOINT/CMD по умолчанию:<br />**Пример 1**: Выполнить `top -b`<br />- **Команда**: `["top", "-b"]`<br />- **ИЛИ** Команда: `["top"]`, Аргументы: `["-b"]`<br />**Пример 2**: Вывод `$MESSAGE`:<br />`/bin/sh -c "while true; do echo $(MESSAGE); sleep 10; done"`<br />См. [Определение команд](https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   | **Дополнительно** > **Переменные окружения**   | <ul><li>Статические значения: Прямые пары ключ-значение</li><li>Динамические значения: Ссылки на ключи ConfigMap/Secret, поля pod'ов (`fieldRef`), метрики ресурсов (`resourceFieldRef`)</li></ul>**Примечание**: Переменные окружения переопределяют настройки изображения/конфигурационного файла.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   | **Дополнительно** > **Ссылаемая ConfigMap**    | Внедрите всю ConfigMap/Secret как переменные окружения. Поддерживаемые типы секретов: `Opaque`, `kubernetes.io/basic-auth`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   | **Дополнительно** > **Проверки состояния**           | <ul><li>**Проверка живучести**: Обнаружение состояния контейнера (перезапуск при сбое)</li><li>**Проверка готовности**: Обнаружение доступности сервиса (удаление из конечных точек при сбое)</li></ul>См. [Параметры проверки состояния](#healthcheck).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   | **Дополнительно** > **Файл журнала**                | Настройка путей для журнала:<br />- По умолчанию: Сбор `stdout`<br />- Шаблоны файлов: например, `/var/log/*.log`<br />**Требования**:<ul><li>Драйвер хранения `overlay2`: Поддерживается по умолчанию</li><li>`devicemapper`: Вручную смонтируйте EmptyDir в каталог журнала</li><li>Узлы Windows: Убедитесь, что родительский каталог смонтирован (например, `c:/a` для `c:/a/b/c/*.log`)</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   | **Дополнительно** > **Исключить файл журнала**        | Исключите конкретные логи из сбора (например, `/var/log/aaa.log`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   | **Дополнительно** > **Выполнить перед остановкой** | Выполнение команд перед завершением контейнера.<br />**Пример**: `echo "stop"`<br />**Примечание**: Время выполнения команды должно быть короче, чем `terminationGracePeriodSeconds` pod'а.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

2. Нажмите **Добавить контейнер** (в правом верхнем углу) ИЛИ **Добавить контейнер инициализации**.

   См. [Контейнеры инициализации](https://kubernetes.io/docs/concepts/workloads/pods/init-containers/).
   Контейнер инициализации:

   1. Запускается перед контейнерами приложения (последовательное выполнение).
   2. Освобождает ресурсы после завершения.
   3. Удаление допускается, когда:
      - Pod имеет >1 контейнер приложения И ≥1 контейнер инициализации.
      - Не разрешено для pod'ов с одним контейнером приложения.

3. Нажмите **Создать**.

## Справочная информация​

<a id="pvmount" />

### Инструкции по подключению томов для хранения

| **Тип**                           | **Цель**                                                                                                                                                                                                                                                                                           |
| :------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Запрос постоянного тома**       | Привязывает существующий [PVC](/developer/building_application/functions/preparation_before_creating/add_pvc.mdx) для запроса постоянного хранилища.<br />**Примечание**: Только связанные PVC (с ассоциированным PV) подлежат выбору. Независимые PVC приведут к сбоям создания pod'ов.                                          |
| **ConfigMap**                     | Монтирует полные/частичные данные [ConfigMap](/developer/building_application/functions/preparation_before_creating/add_configmap.mdx) как файлы:<ul><li>Полный ConfigMap: Создает файлы, названные по ключам под путем монтирования</li><li>Выбор подкаталога: Монтировать конкретный ключ (например, `my.cnf`)</li></ul>               |
| **Секрет**                        | Монтирует полные/частичные данные [Секрета](/developer/building_application/functions/preparation_before_creating/add_secret.mdx) как файлы:<ul><li>Полный Секрет: Создает файлы, названные по ключам под путем монтирования</li><li>Выбор подкаталога: Монтировать конкретный ключ (например, `tls.crt`)</li></ul>                       |
| **Эфемерные тома**               | Временный том, предоставленный кластером с функциями:<ul><li> Динамическое предоставление</li><li>Цикл жизни, связанный с pod'ом</li><li>Поддержка декларативной конфигурации</li></ul>**Сценарий использования**: Временное хранение данных. См. [PVC](/developer/building_application/functions/preparation_before_creating/add_pvc.mdx) |
| **Пустой каталог**               | эфемерное хранилище, делящееся между контейнерами в одном pod:<br />- Создается на узле при запуске pod<br />- Удаляется с удалением pod<br />**Сценарий использования**: Совместное использование файлов между контейнерами, временное хранение данных.                                                                                              |
| **Host Path**                     | Монтирует директорию хоста (должно начинаться с `/`, например, `/volumepath`).                                                                                                                                                                                                                             |

<a id="healthcheck" />

### Параметры проверки состояния

#### Общие параметры

| **Параметры**        | **Описание**                                                                                                                                |
| :-------------------- | :------------------------------------------------------------------------------------------------------------------------------------------- |
| **Первоначальная задержка**     | Период (в секундах) перед началом проверок. По умолчанию: `300`.                                                                               |
| **Период**            | Интервал между проверками (1-120с). По умолчанию: `60`.                                                                                                      |
| **Таймаут**           | Время ожидания проверки (1-300с). По умолчанию: `30`.                                                                                              |
| **Порог успешности** | Минимальное количество последовательных успешных проверок для маркировки как здорового. По умолчанию: `0`.                                                                                 |
| **Порог неуспешности** | Максимальное количество последовательных неудач для инициирования действия:<br />- `0`: Отключает действия, основанные на неудачах<br />- По умолчанию: `5` неудач → перезапуск контейнера. |

#### Параметры, специфичные для протокола

| **Параметр**    | **Применимые протоколы** | **Описание**                                                                                                                                              |
| :--------------- | :----------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Протокол**     | HTTP/HTTPS               | Протокол проверки состояния                                                                                                                                        |
| **Порт**         | HTTP/HTTPS/TCP           | Целевой порт контейнера для проверки.                                                                                                                           |
| **Путь**         | HTTP/HTTPS               | Путь конечной точки (например, `/healthz`).                                                                                                                            |
| **HTTP Заголовки** | HTTP/HTTPS               | Пользовательские заголовки (добавьте пары ключ-значение).                                                                                                                        |
| **Команда**      | EXEC                     | Проверочная команда, исполняемая контейнером (например, `sh -c "curl -I localhost:8080 \| grep OK"`).<br />**Примечание**: Экранируйте специальные символы и протестируйте осуществимость команды. |
