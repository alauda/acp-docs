---
weight: 40
i18n:
  title:
    en: Создание CronJobs
    zh: 创建 CronJobs
title: Создание CronJobs
sourceSHA: fe31a8c03e508f333c21788ed5a2a1efb41c9967d2976db54af2538c7b2053cd
---

# Создание CronJobs

CronJob предоставляет различные способы определения задач, которые выполняются до завершения, а затем останавливаются. Вы можете использовать CronJob для выполнения одной и той же задачи несколько раз в соответствии с расписанием.

Запланированная задача (CronJob) является типом контроллера нагрузки в Kubernetes. Вы можете создать CronJob через веб-консоль или CLI, чтобы периодически или многократно выполнять непостоянную программу, такую как запланированные резервные копии, запланированные очистки или запланированные рассылки электронной почты.

## Предварительные требования

Получите адрес образа. Источник образов может быть из репозитория образов, интегрированного администратором платформы через цепочку инструментов, или из репозиториев образов сторонних платформ.

- В первом случае администратор обычно назначает репозиторий образов вашему проекту, и вы можете использовать образы внутри него. Если требуемый репозиторий образов не найден, обратитесь к администратору для его выделения.

- Если это репозиторий образов третьей стороны, убедитесь, что образы можно извлекать напрямую из него в текущем кластере.

## Процедура

1. **Платформа контейнеров**, перейдите в **Рабочие нагрузki** > **CronJobs** в левой боковой панели.

2. Нажмите **Создать CronJob**.

3. **Выберите** или **введите** образ и нажмите **Подтвердить**.

   **Примечание**: Вы можете фильтровать образы, выбирая только те, которые используются из интегрированного репозитория образов этой платформы. Например, интегрированное имя проекта, такое как *containers (docker-registry-projectname)*, включает в себя имя проекта *projectname* из этой платформы и имя проекта *containers* из репозитория образов.

### Настройка основной информации

1. В разделе **Cron Configuration** настройте метод выполнения задачи и связанные параметры.

   **Тип выполнения**:

   - **Вручную**: Вручную ejecución требует явного ручного запуска для каждого запуска задачи.
   - **Запланировано**: Запланированное выполнение настраивает следующие параметры расписания:

     | **Параметр**          | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                           |
     | :--------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
     | **Расписание**        | Определите cron расписание, используя [синтаксис Crontab](https://crontab.guru/). Контроллер CronJob вычисляет следующее время выполнения на основе выбранного часового пояса. <br /><br />**Примечания**:<ul><li>Для кластеров Kubernetes \< v1.25: Поддержка выбора часового пояса отсутствует; расписания ДОЛЖНЫ использовать UTC.</li><li>Для кластеров Kubernetes ≥ v1.25: Поддержка выбора часового пояса (по умолчанию: местный часовой пояс пользователя).</li></ul> |
     | **Политика параллельности** | Укажите, как обрабатываются параллельные выполнения задач (`Разрешить`, `Запретить` или `Заменить` согласно [K8s spec](https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/#concurrency-policy)).                                                                                                                                                                                                                              |

   **Хранение истории заданий**:

   - Установите пределы хранения для завершенных заданий:
     - **Исторические пределы**: Предел исторических записей успешных заданий (по умолчанию: 20)
     - **Неудавшиеся задания**: Предел исторических записей неудавшихся заданий\*\* (по умолчанию: 20)
   - Когда пределы хранения превышены, самые старые задания удаляются в первую очередь.

2. В разделе **Конфигурация задания** выберите тип задания.
   CronJob управляет заданиями, состоящими из Pods. Настройте шаблон задания в зависимости от вашего типа рабочей нагрузки:

   | **Параметр**     | **Описание**                                                                                                                                                                                            |
   | :---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Тип задания**   | Выберите режим завершения задачи (`Не параллельно`, `Параллельно с фиксированным количеством завершений` или `Индексация задания` согласно [K8s Job patterns](https://kubernetes.io/docs/concepts/workloads/controllers/job/#job-patterns)). |
   | **Предел повторных попыток** | Установите максимальное количество попыток повторного выполнения перед тем, как пометить задание как провалившееся.                                                                                                                                                 |

### Настройка Pod

В разделе **Pod** обратитесь к [Создание развертывания - Настройка Pod](./deployment_create.mdx#configurepod)

### Настройка контейнеров

В разделе **Контейнер** обратитесь к [Создание развертывания - Настройка контейнеров](./deployment_create.mdx#configurecontainers)

### Создать

Нажмите **Создать**.

## Немедленное выполнение

1. Найдите ресурс CronJob:
   - **веб-консоль**: **Платформа контейнеров**, перейдите в **Рабочие нагрузки** > **CronJob** в левой боковой панели.
   - **CLI**: Выполните
     ```bash
     kubectl get cronjobs -n <namespace>
     ```

2. Инициируйте разовое выполнение:
   - **веб-консоль**: **Выполнить немедленно**
     1. Нажмите вертикальные троеточия (⋮) справа от списка приложений.
     2. Нажмите **Действия** в правом верхнем углу страницы с деталями приложения.
   - **CLI**:
     ```bash
     kubectl create job --from=cronjob/<cronjob-name> <job-name> -n <namespace>
     ```

3. Мониторинг состояния выполнения:
   | Статус        | Описание                                                     |
   | ------------- | --------------------------------------------------------------- |
   | **Ожидание**  | Задание создано, но еще не запланировано                               |
   | **Запуск**    | Pods задания активно выполняются                               |
   | **Успешно**   | Все Pods успешно завершены (код выхода 0)                   |
   | **Неудача**   | По крайней мере один Pod завершился неудачно (не нулевой код выхода) |

4. Подтверждение деталей задания:
   ```bash
   kubectl describe job/<job-name> -n <namespace>
   kubectl logs job/<job-name> -n <namespace>
   ```  
