---
weight: 40
i18n:
  title:
    en: Создание CronJobs
    zh: 创建 CronJobs
title: Создание CronJobs
sourceSHA: fe31a8c03e508f333c21788ed5a2a1efb41c9967d2976db54af2538c7b2053cd
---

# Создание CronJobs

CronJob предоставляет различные способы определения задач, которые выполняются до завершения, а затем останавливаются. Вы можете использовать CronJob для многократного выполнения одной и той же задачи в соответствии с расписанием.

Запланированная задача (CronJob) является типом контроллера нагрузки в Kubernetes. Вы можете создать CronJob через веб-консоль или командную строку для периодического или повторяющегося выполнения непостоянной программы, такой как запланированные резервные копии, запланированные очистки или запланированные отправки электронной почты.

## Предпосылки

Получите адрес изображения. Источник изображений может быть из репозитория изображений, интегрированного администратором платформы через цепочку инструментов, или из репозиториев изображений сторонних платформ.

- В первом случае администратор обычно назначает репозиторий изображений вашему проекту, и вы можете использовать изображения в нем. Если требуемый репозиторий изображений не найден, пожалуйста, свяжитесь с администратором для его выделения.

- Если это репозиторий изображений сторонней платформы, убедитесь, что изображения могут быть загружены непосредственно из него в текущем кластере.

## Процедура

1. **Платформа контейнеров**, перейдите в **Нагрузки** > **CronJobs** в боковом меню слева.

2. Нажмите **Создать CronJob**.

3. **Выберите** или **Введите** изображение и нажмите **Подтвердить**.

   **Примечание**: Вы можете фильтровать изображения, выбирая только при использовании изображений из интегрированного репозитория изображений этой платформы. Например, интегрированное имя проекта, например *containers (docker-registry-projectname)*, включает имя проекта *projectname* из этой платформы и имя проекта *containers* из репозитория изображений.

### Настройка основной информации

1. В разделе **Конфигурация Cron** настройте метод выполнения задачи и связанные параметры.

   **Тип выполнения**:

   - **Ручной**: Ручное выполнение требует явного ручного запуска для каждого выполнения задачи.
   - **Запланированный**: Запланированное выполнение настраивает следующие параметры расписания:

     | **Параметр**           | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                           |
     | :--------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
     | **Расписание**         | Определите расписание cron, используя [синтаксис Crontab](https://crontab.guru/). Контроллер CronJob рассчитывает следующее время выполнения на основе выбранного часового пояса. <br /><br />**Примечания**:<ul><li>Для кластеров Kubernetes \< v1.25: Выбор часового пояса не поддерживается; расписания ДОЛЖНЫ использовать UTC.</li><li>Для кластеров Kubernetes ≥ v1.25: Поддерживается учет часовых поясов (по умолчанию: местное время пользователя).</li></ul> |
     | **Политика конкуренции** | Укажите, как обрабатываются параллельные выполнения задач (`Разрешить`, `Запретить` или `Заменить` согласно [спецификации K8s](https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/#concurrency-policy)).                                                                                                                                                                                                                              |

   **Сохранение истории задач**:

   - Установите пределы хранения для завершенных задач:
     - **Исторические пределы**: Предел истории успешных задач (по умолчанию: 20)
     - **Неуспешные задачи**: Предел истории неуспешных задач\*\* (по умолчанию: 20)
   - Когда пределы хранения превышены, самые старые задачи сначала подвергаются сбору мусора.

2. В разделе **Конфигурация задачи** выберите тип задачи.
   CronJob управляет задачами, состоящими из Pods. Настройте шаблон задачи в зависимости от типа вашей нагрузки:

   | **Параметр**      | **Описание**                                                                                                                                                                                            |
   | :---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Тип задачи**     | Выберите режим завершения задачи (`Не параллельный`, `Параллельный с фиксированным количеством завершений` или `Индексионная задача` согласно [шаблонам Job K8s](https://kubernetes.io/docs/concepts/workloads/controllers/job/#job-patterns)). |
   | **Предельное количество повторных попыток** | Установите максимальное количество попыток повторного выполнения перед тем, как пометить задачу как неуспешную.                                                                                                                                                 |

### Настройка Pod

В разделе **Pod** смотрите [Создание развертывания - Настройка Pod](./deployment_create.mdx#configurepod)

### Настройка контейнеров

В разделе **Контейнер** смотрите [Создание развертывания - Настройка контейнеров](./deployment_create.mdx#configurecontainers)

### Создать

Нажмите **Создать**.

## Выполнить немедленно

1. Найдите ресурс CronJob:
   - **веб-консоль**: **Платформа контейнеров**, перейдите в **Нагрузки** > **CronJob** в боковом меню слева.
   - **CLI**: Выполните
     ```bash
     kubectl get cronjobs -n <namespace>
     ```

2. Запустите ад-хок выполнение:
   - **веб-консоль**: **Выполнить немедленно**
     1. Нажмите на вертикальные многоточие (⋮) с правой стороны списка приложений.
     2. Нажмите **Действия** в верхнем правом углу страницы сведений о приложении.
   - **CLI**:
     ```bash
     kubectl create job --from=cronjob/<cronjob-name> <job-name> -n <namespace>
     ```

3. Мониторинг статуса выполнения:
   | Статус        | Описание                                                     |
   | ------------- | --------------------------------------------------------------- |
   | **В ожидании**   | Задача создана, но еще не запланирована                               |
   | **Выполняется**   | Задача Pod(ы) активно выполняется                               |
   | **Успешно** | Все Pods успешно завершили выполнение (код выхода 0)                   |
   | **Неуспешно**    | По меньшей мере один Pod завершился с ошибкой (код выхода не равен нулю) |

4. Проверьте детали задачи:
   ```bash
   kubectl describe job/<job-name> -n <namespace>
   kubectl logs job/<job-name> -n <namespace>
   ```
