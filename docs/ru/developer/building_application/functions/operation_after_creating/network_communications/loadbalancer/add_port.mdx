---
weight: 20
sourceSHA: 09d82d8bb031fa12e7caceecd383382dcb454dd6279e8d2b23cec53ddbcbceb5
---

# Добавление портов слушателя

Балансировщик нагрузки поддерживает прием клиентских запросов на соединение через порты слушателя и соответствующие протоколы, включая HTTPS, HTTP, gRPC, TCP и UDP.

## Предварительные условия

Если вам необходимо добавить порт слушателя HTTPS, вам также следует обратиться к администратору для назначения сертификата TLS текущему проекту для шифрования.

## Шаги

1. Перейдите в **Платформу контейнеров**.

2. В левой навигационной панели нажмите **Сеть** > **Балансировка нагрузки**.

3. Нажмите на имя балансировщика нагрузки, чтобы перейти на страницу деталей.

4. Нажмите **Добавить порт слушателя**.

5. Ознакомьтесь с следующими инструкциями для настройки соответствующих параметров.

   | Параметр                  | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   | -------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Протокол**               | Поддерживаемые протоколы включают HTTPS, HTTP, gRPC, TCP и UDP. При выборе HTTPS должен быть добавлен сертификат; добавление сертификата является необязательным для протокола gRPC. <br /><br />**Примечание**: <br /><ul><li>При выборе протокола gRPC, протокол на стороне сервера по умолчанию устанавливается как gRPC, который не поддерживает сохранение сеансов.</li><li>Если для протокола gRPC установлен сертификат, балансировщик нагрузки выгрузит сертификат gRPC и будет пересылать незашифрованный gRPC-трафик на бэкенд-сервис.</li><li>Если вы используете кластер Google GKE, балансировщик нагрузки одного и того же **типа контейнерной сети** не может одновременно иметь как TCP, так и UDP порты слушателя.</li></ul> |
   | **Внутренняя группа маршрутизации** | - Когда алгоритм балансировки нагрузки установлен на **Круговая (RR)**, трафик будет распределяться между внутренними маршрутами в порядке, установленном внутренней группой маршрутизации. <br />- Когда алгоритм балансировки нагрузки установлен на **Взвешенная круговая (WRR)**, внутренние маршруты с более высокими значениями веса имеют более высокую вероятность выбора; трафик будет распределяться по внутренним маршрутам на основе установленного **веса**. <br />**Подсказка**: Вероятность расчета равна отношению текущего значения веса к сумме всех значений веса.                                                                                                             |
   | **Сохранение сеансов**    | Всегда перенаправляйте определенные запросы к бэкенд-сервису, соответствующему вышеупомянутой внутренней группе маршрутизации. <br /><br />Определенные запросы включают (выберите одно):<ul><li>Хеш исходного адреса: Все запросы с одного и того же IP-адреса. <br />**Примечание**: В публичных облачных средах исходный адрес часто изменяется, что может привести к тому, что запросы от одного и того же клиента будут иметь разные исходные IP-адреса в разное время, что приводит к тому, что техника хеширования исходного адреса не достигает ожидаемого эффекта.</li><li>Ключ cookie: Запросы, содержащие указанный cookie.</li><li>Имя заголовка: Запросы, содержащие указанный заголовок.</li></ul>                               |
   | **Протокол на стороне сервера**       | Протокол, используемый для перенаправления трафика к бэкенд-сервисам. Например, если трафик перенаправляется к бэкенд-сервисам Kubernetes или dex, необходимо выбрать протокол HTTPS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

6. Нажмите **ОК**.

## Последующие действия

Для трафика с HTTP, gRPC и HTTPS портов, помимо стандартной внутренней группы маршрутизации, вы можете установить более разнообразные правила сопоставления бэкенд-сервисов [правил](./add_rule.mdx). Балансировщик нагрузки сначала будет сопоставлять соответствующий бэкенд-сервис в соответствии с установленными правилами; если сопоставление правил не удается, он затем сопоставит бэкенд-сервисы, соответствующие вышеупомянутой внутренней группе маршрутизации.

## Связанные операции

Вы можете нажать на значок ⋮ с правой стороны страницы списка или нажать **Действия** в верхнем правом углу страницы деталей, чтобы обновить маршрут по умолчанию или удалить порт слушателя по необходимости.

**Примечание**: Если метод распределения ресурсов балансировщика нагрузки — это **Порт**, только администраторы могут удалить соответствующие порты слушателя в представлении **Управление платформой**.
