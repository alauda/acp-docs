---
weight: 20
sourceSHA: 09d82d8bb031fa12e7caceecd383382dcb454dd6279e8d2b23cec53ddbcbceb5
---

# Добавление портов слушателя

Балансировщик нагрузки поддерживает получение запросов на подключение клиентов через порты слушателя и соответствующие протоколы, включая HTTPS, HTTP, gRPC, TCP и UDP.

## Предварительные условия

Если вам нужно добавить порт слушателя HTTPS, вам также следует обратиться к администратору, чтобы назначить TLS-сертификат текущему проекту для шифрования.

## Шаги

1. Перейдите в **Container Platform**.

2. В левой боковой панели навигации нажмите **Сеть** > **Балансировка нагрузки**.

3. Щелкните по имени балансировщика нагрузки, чтобы перейти на страницу подробной информации.

4. Нажмите **Добавить порт слушателя**.

5. Ознакомьтесь со следующими инструкциями для настройки соответствующих параметров.

   | Параметр                  | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   | ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Протокол**              | Поддерживаемые протоколы включают HTTPS, HTTP, gRPC, TCP и UDP. При выборе HTTPS необходимо добавить сертификат; добавление сертификата для протокола gRPC является необязательным. <br /><br />**Примечание**: <br /><ul><li>При выборе протокола gRPC протокол бэкенда по умолчанию устанавливается на gRPC, который не поддерживает устойчивость сеанса.</li><li>Если для протокола gRPC установлен сертификат, балансировщик нагрузки выгрузит сертификат gRPC и перенаправит незашифрованный трафик gRPC на бэкенд-сервис.</li><li>Если используется кластер Google GKE, балансировщик нагрузки одного и того же **типа контейнерной сети** не может одновременно иметь протоколы слушателя TCP и UDP.</li></ul> |
   | **Группа внутренней маршрутизации** | - Когда алгоритм балансировки нагрузки установлен на **Круговая (RR)**, трафик будет распределяться по внутренним маршрутизирующим портам в порядке группы внутренней маршрутизации. <br />- Когда алгоритм балансировки нагрузки установлен на **Взвешенная круговая (WRR)**, внутренние маршруты с более высокими значениями веса имеют более высокую вероятность выбора; трафик будет распределяться по внутренним маршрутизирующим портам на основе настроенного **веса**. <br />**Совет**: Вероятностный расчет - это отношение текущего значения веса к сумме всех значений веса.                                                                                                             |
   | **Устойчивость сеанса**   | Всегда перенаправляйте определенные запросы на бэкенд-сервис, соответствующий вышеупомянутой группе внутренней маршрутизации. <br /><br />Определенные запросы включают (выберите один):<ul><li>Хэш исходного адреса: Все запросы с одного и того же IP-адреса. <br />**Примечание**: В публичных облачных средах исходный адрес часто изменяется, что может привести к тому, что запросы от одного и того же клиента будут иметь разные исходные IP-адреса в разные моменты времени, что приведет к тому, что техника хэша исходного адреса не достигнет ожидаемого эффекта.</li><li>Ключ cookie: Запросы, которые содержат определенный cookie.</li><li>Имя заголовка: Запросы, которые содержат определенный заголовок.</li></ul>                               |
   | **Протокол бэкенда**      | Протокол, используемый для перенаправления трафика на бэкенд-сервисы. Например, если трафик перенаправляется на бэкенд-сервисы Kubernetes или dex, необходимо выбрать протокол HTTPS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

6. Нажмите **ОК**.

## Последующие действия

Для трафика с портов HTTP, gRPC и HTTPS, помимо группы внутренних маршрутов по умолчанию, вы можете установить более разнообразные правила соответствия для бэкенд-сервисов [rules](./add_rule.mdx). Балансировщик нагрузки изначально будет сопоставлять соответствующий бэкенд-сервис в соответствии с установленными правилами; если совпадение правила не удастся, он затем сопоставит бэкенд-сервисы, соответствующие вышеупомянутой группе внутренней маршрутизации.

## Связанные операции

Вы можете нажать на значок ⋮ с правой стороны страницы списка или нажать **Действия** в правом верхнем углу страницы деталей, чтобы обновить маршрут по умолчанию или удалить порт слушателя по мере необходимости.

**Примечание**: Если способ распределения ресурсов балансировщика нагрузки - **Порт**, только администраторы могут удалять соответствующие порты слушателей в представлении **Управление платформой**.
