---
weight: 30
sourceSHA: 68e14f02ae20b2154818613d09ca216efdc80e486b7b2ae8c6c3ed9d58541390
---

# Создание правил маршрутизации

Правила маршрутизации предоставляют политики маршрутизации для входящего трафика, аналогично входящим правилам (Kubernetes Ingress). Они открывают сетевой трафик, который контролируется шлюзом, для внутренней маршрутизации кластера (Kubernetes Service), облегчая стратегии маршрутизации. Основное отличие заключается в том, что они нацелены на разные объекты службы: входящие правила служат контроллеру Ingress, тогда как правила маршрутизации обслуживают шлюз Ingress. 

После настройки прослушивания в шлюзе ingress, шлюз будет в реальном времени отслеживать трафик из указанных доменов и портов. Правила маршрутизации могут перенаправлять входящий трафик на экземпляры сервера согласно требованиям.

## Заметки

Если для объекта **Path** в типе маршрутизации HTTPRoute нет соответствующего правила, автоматически будет добавлено соответствующее правило с режимом PathPrefix и значением /.

## Шаги

1. Доступ к **Платформе контейнеров**.

2. В левой боковой панели навигации нажмите **Сеть** > **Правила маршрутизации**.

3. Нажмите **Создать правило маршрутизации**.

4. Следуйте приведенным ниже инструкциям, чтобы настроить некоторые параметры.

   | Параметр                | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   | ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | **Тип маршрута**        | В данный момент поддерживаются следующие типы маршрутов: HTTPRoute, TCPRoute, UDPRoute.<br />**Совет:** HTTPRoute поддерживает публикацию на слушателях протокола HTTP и HTTPS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   | **Опубликовать на слушателе** | В левом поле выбора выберите созданный **Шлюз Ingress**, а в правом поле выбора выберите созданный **Слушатель**. Платформа опубликует созданные правила маршрутизации на нижеперечисленном слушателе, позволяя шлюзу перенаправлять захваченный трафик на указанные экземпляры сервера.<br /><br />**Примечание:** Не разрешается публиковать правила маршрутизации на слушателе, который находится на порту **11782** или уже настроен для TCP или UDP маршрутов.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   | **Сопоставление**       | Вы можете добавить одно или несколько правил сопоставления, чтобы захватить трафик, соответствующий требованиям. Например, **захватить трафик с указанным Path**, **захватить трафик с указанным методом** и т. д.<br /><br />**Примечание:** <ul><li>Нажмите **Добавить**; при добавлении нескольких правил маршрутизации связь между правилами будет 'И', и все правила должны быть совпадают, чтобы быть действительными.</li><li>Нажмите **Добавить сопоставление**; при добавлении нескольких групп правил маршрутизации связь между группами будет 'ИЛИ', и любая группа, соответствующая правилу, может быть действительной.</li><li>TCPRoute и UDPRoute не поддерживают настройку правил сопоставления.</li><li>Когда сопоставляемый объект - **path**, и метод сопоставления - **Exact** или **PathPrefix**, входное **значение** должно начинаться с "/" и запрещать такие символы, как "//", "/./", "/../", "%2f", "%2F", "#", "/..", "/." и т. д.</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                          |
   | **Действие**            | Вы можете добавить одно или несколько действий для обработки захваченного трафика. <ul><li>Заголовок: Заголовок HTTP-сообщения содержит много метаданных, которые предоставляют дополнительную информацию о запросе или ответе. Изменяя поля заголовка, сервер может влиять на то, как запрос и ответ обрабатываются.</li><li>Перенаправление: Соответствующий URL будет обработан определенным образом, после чего запрос будет инициирован снова.</li><li>Переименование: Соответствующий URL будет обработан определенным образом, после чего запрос будет перенаправлен на другой путь ресурса или имя файла.</li></ul><br /><br />**Примечание:** <ul><li>Нажмите **Добавить**; при добавлении нескольких правил действий платформа выполнит все действия в порядке, основанном на отображаемой последовательности правил.</li><li>TCPRoute и UDPRoute не поддерживают настройку правил действий.</li><li>В рамках одного и того же правила маршрута не может быть несколько действий типа **Заголовок** с одинаковым **значением**.</li><li>В рамках одного и того же правила маршрута может существовать только один тип - либо **Перенаправление**, либо **Переименование**, и только один режим - либо **FullPath**, либо **PrefixPath**.</li><li>Если вы хотите использовать операцию **PrefixPath**, пожалуйста, сначала добавьте правило сопоставления режима **PathPrefix**.</li></ul> |
   | **Экземпляр сервера**   | После того как правило вступает в силу, оно будет перенаправлено на экземпляр сервера в соответствии с выбранными внутренними маршрутами и портами в текущем пространстве имен. Вы также можете установить веса, где более высокие значения веса будут давать более высокую вероятность выбора.<br />**Совет:** Процент рядом с весом указывает вероятность перенаправления на этот экземпляр, рассчитывается как отношение текущего значения веса к сумме всех значений веса.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

5. Нажмите **Создать**.
