---
weight: 30
sourceSHA: 68e14f02ae20b2154818613d09ca216efdc80e486b7b2ae8c6c3ed9d58541390
---

# Создание правил маршрутизации

Правила маршрутизации обеспечивают политики маршрутизации для входящего трафика, аналогично входящим правилам (Kubernetes Ingress). Они выставляют сетевой трафик, контролируемый шлюзом, во внутреннюю маршрутизацию кластера (Kubernetes Service), облегчая стратегии маршрутизации. Ключевое отличие состоит в том, что они нацелены на разные объекты службы: входящие правила обслуживают Ingress Controller, в то время как правила маршрутизации обслуживают Ingress Gateway.

После настройки прослушивания в ingress gateway шлюз будет в реальном времени отслеживать трафик с указанных доменов и портов. Правила маршрутизации могут направлять входящий трафик на рабочие экземпляры по желанию.

## Заметки

Если для объекта **Path** в типе правила маршрутизации HTTPRoute нет соответствующего правила, будет автоматически добавлено соответствующее правило с режимом PathPrefix и значением /.

## Шаги

1. Получите доступ к **Container Platform**.

2. В левой навигационной панели нажмите **Сеть** > **Правила маршрутизации**.

3. Нажмите **Создать правило маршрутизации**.

4. Следуйте приведенным ниже инструкциям для конфигурации некоторых параметров.

   | Параметр               | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   | ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Тип маршрута**        | В настоящее время поддерживаются следующие типы маршрутов: HTTPRoute, TCPRoute, UDPRoute.<br />**Подсказка:** HTTPRoute поддерживает публикацию для слушателей протоколов HTTP и HTTPS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   | **Опубликовать на слушателе**  | В левом списке выберите созданный **Ingress Gateway**, а в правом списке выберите созданный **Слушатель**. Платформа опубликует созданные правила маршрутизации на указанном слушателе, позволяя шлюзу пересылать захваченный трафик на указанные рабочие экземпляры.<br /><br />**Примечание:** Нельзя публиковать правила маршрутизации на слушателе, работающем на порту **11782** или уже имеющем смонтированные TCP или UDP маршруты.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   | **Соответствие**         | Вы можете добавить одно или несколько правил соответствия для захвата трафика, соответствующего требованиям. Например, **захватить трафик с указанным Path**, **захватить трафик с указанным методом** и т.д.<br /><br />**Примечание:** <ul><li>Нажмите **Добавить**; при добавлении нескольких правил маршрутизации связь между правилами будет 'AND', и все правила должны совпадать, чтобы быть эффективными.</li><li>Нажмите **Добавить соответствие**; при добавлении нескольких групп правил маршрутизации связь между группами будет 'OR', и любое соответствие группы может быть эффективным.</li><li>TCPRoute и UDPRoute не поддерживают настройку правил соответствия.</li><li>Когда объект соответствия - это **path**, а метод соответствия - **Exact** или **PathPrefix**, значение **value** должно начинаться с "/" и не допускать символы вроде "//", "/./", "/../", "%2f", "%2F", "#", "/..", "/." и т.д.</li></ul>                                                                                                                                                                                                                                                                                                                                                  |
   | **Действие**            | Вы можете добавить одно или несколько действий для обработки захваченного трафика. <ul><li>Заголовок: Заголовок HTTP-сообщения содержит много метаданных, которые предоставляют дополнительную информацию о запросе или ответе. Изменив поля заголовка, сервер может повлиять на то, как обрабатываются запрос и ответ.</li><li>Переадресация: Соответствующий URL будет обработан заданным образом, после чего запрос будет инициирован снова.</li><li>Перезапись: Соответствующий URL будет обработан заданным образом, после чего запрос будет перенаправлен на другой путь или имя файла ресурса.</li></ul><br /><br />**Примечание:** <ul><li>Нажмите **Добавить**; при добавлении нескольких правил действий платформа выполнит все действия в порядке, основанном на отображаемой последовательности правил.</li><li>TCPRoute и UDPRoute не поддерживают настройку правил действий.</li><li>В рамках одного и того же правила маршрутизации может быть несколько действий типа **Header** с одним и тем же **value**.</li><li>В рамках одного и того же правила маршрутизации может существовать только один тип из **Redirect** или **Rewrite**, и только один режим из **FullPath** или **PrefixPath**.</li><li>Если вы хотите использовать операцию **PrefixPath**, сначала добавьте правило соответствия режима **PathPrefix**.</li></ul> |
   | **Рабочий экземпляр**     | После того как правило вступит в силу, оно будет перенаправлен на рабочий экземпляр в соответствии с выбранными внутренними маршрутами и портами в текущем пространстве имен. Вы также можете установить веса, причем более высокие значения веса приведут к более высокой вероятности опроса.<br />**Подсказка:** Процент рядом с весом показывает вероятность перенаправления на этот экземпляр, вычисляемую как отношение текущего значения веса к сумме всех значений веса.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

5. Нажмите **Создать**.
