---
weight: 20
i18n:
  title:
    en: Конфигурация ConfigMap
    zh: 配置 ConfigMap
title: Конфигурация ConfigMap
sourceSHA: 5bc77da900bebe4e36205d1fa84e4160004e04d489be50d529422207934eeafa
---

# Конфигурация ConfigMap

Сохраняйте данные конфигурации в парах ключ-значение в рамках ConfigMap, включая отдельные атрибуты или полные конфигурационные файлы. ConfigMaps могут быть использованы в рабочих нагрузках через переменные среды, ссылки на конфигурации и другими способами.

:::note
Pod может использовать только ConfigMaps в одной и той же области имен.
:::

## Пример ConfigMap

Теперь вы можете использовать app-config в `Pod`.

```yaml
# app-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: k-1
data:
  APP_ENV: "production"
  LOG_LEVEL: "debug"
```

## Создание ConfigMap с помощью веб-консоли

1. Перейдите в **Платформу Контейнеров**.

2. В левом боковом меню щелкните **Конфигурация** > **ConfigMap**.

3. Нажмите **Создать ConfigMap**.

4. Обратитесь к инструкциям ниже для настройки соответствующих параметров.

   | Параметр          | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Записи**        | Относится к парам `ключ:значение`, поддерживает как **Добавить**, так и **Импорт**. <br /><ul><li>**Добавить**: Вы можете добавлять элементы конфигурации по одному, или вы можете вставить одну или несколько строк пар ключ=значение в поле ввода Ключа для массового добавления элементов конфигурации.</li><li>**Импорт**: Импортируйте текстовый файл размером не более 1 МБ. Имя файла будет использоваться как ключ, а содержимое файла будет использоваться как значение, заполненное в элементе конфигурации.</li></ul> |
   | **Двоичные записи** | Относится к двоичным файлам размером не более 1 МБ. Имя файла будет использоваться как ключ, а содержимое файла будет использоваться как значение, заполненное в элементе конфигурации.<br />**Примечание**: После создания ConfigMap импортированные файлы не могут быть изменены.                                                                                                                                                                                                      |

   **Пример формата массового добавления**:

   ```
   # По одному ключ=значение на строку, несколько пар должны быть на отдельных строках, в противном случае они не будут распознаны правильно после вставки.
   ключ1=значение1
   ключ2=значение2
   ключ3=значение3
   ```

5. Нажмите **Создать**.

## Создание ConfigMap с помощью CLI

```shell
kubectl create configmap app-config \
  --from-literal=APP_ENV=production \
  --from-literal=LOG_LEVEL=debug
```

Или из файла:

```shell
kubectl apply -f app-config.yaml -n k-1
```

## Операции

Вы можете щелкнуть (⋮) на правой стороне страницы списка или нажать **Действия** в верхнем правом углу страницы деталей, чтобы обновить или удалить ConfigMap по мере необходимости.

Изменения в ConfigMap повлияют на рабочие нагрузки, которые ссылаются на конфигурацию, поэтому перед выполнением операций прочитайте инструкции.

| Операции | Описание                                                                                                                                                                                                                                                                                                                                   |
| ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Обновить** | <ul><li>После добавления или обновления ConfigMap любые рабочие нагрузки, которые ссылались на этот ConfigMap (или его элементы конфигурации) через переменные среды, нуждаются в перебилдениях своих Pods для применения новой конфигурации.</li><li>Для импортированных двоичных элементов конфигурации поддерживаются только обновления ключей, обновления значений не поддерживаются.</li></ul> |
| **Удалить** | После удаления ConfigMap рабочие нагрузки, которые ссылались на этот ConfigMap (или его элементы конфигурации) через переменные среды, могут негативно пострадать во время создания Pod, если они будут перебилдены и не смогут найти источник ссылки.                                                                                                  |

## Просмотр, редактирование и удаление с помощью CLI

```shell
kubectl get configmap app-config -n k-1 -o yaml
kubectl edit configmap app-config -n k-1
kubectl delete configmap app-config -n k-1
```

## Способы использования ConfigMap в Pod

### В качестве переменных среды

```yaml
envFrom:
  - configMapRef:
      name: app-config
```

Каждый ключ становится переменной среды в контейнере.

### В качестве файлов в томе

```yaml
volumes:
  - name: config-volume
    configMap:
      name: app-config

volumeMounts:
  - name: config-volume
    mountPath: /etc/config
```

Каждый ключ — это файл в `/etc/config`, а содержимое файла — это значение.

### В качестве отдельных переменных среды

```yaml
env:
  - name: APP_ENV
    valueFrom:
      configMapKeyRef:
        name: app-config
        key: APP_ENV
```

## ConfigMap против Secret

| Особенность | ConfigMap      | Secret                      |
| ----------- | -------------- | --------------------------- |
| Тип данных  | Не чувствительные  | Чувствительные (например, пароли) |
| Кодировка   | Обычный текст  | Закодированный в Base64     |
| Сценарии использования | Конфигурации, флаги | Пароли, токены           |
