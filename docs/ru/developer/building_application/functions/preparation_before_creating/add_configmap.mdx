---
weight: 20
i18n:
  title:
    en: Конфигурация ConfigMap
    zh: 配置 ConfigMap
title: Конфигурация ConfigMap
sourceSHA: f1bf6912599da8d9aee57e20820774b2fc91442ac83db4595aa057eeef207649
---

# Конфигурация ConfigMap

ConfigMap позволяет отделить артефакты конфигурации от содержимого образа, чтобы сохранить портативность контейнеризованных приложений. В следующих разделах определяются ConfigMap и описывается, как их создавать и использовать.

## Понимание ConfigMap

Многие приложения требуют конфигурации с использованием комбинации конфигурационных файлов, аргументов командной строки и переменных окружения. В OpenShift Container Platform эти артефакты конфигурации отделены от содержимого образа, чтобы сохранить портативность контейнеризованных приложений.

Объект `ConfigMap` предоставляет механизмы для внедрения конфигурационных данных в контейнеры, оставаясь при этом независимым от OpenShift Container Platform. ConfigMap может использоваться для хранения детализированной информации, такой как отдельные свойства, или более общей информации, такой как целые конфигурационные файлы или JSON-объекты.

Объект `ConfigMap` содержит пары ключ-значение конфигурационных данных, которые могут использоваться в подах или для хранения конфигурационных данных для системных компонентов, таких как контроллеры. Например:

```yaml
# my-app-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-app-config
  namespace: default
data:
  app_mode: "development"
  feature_flags: "true"
  database.properties: |-
    jdbc.url=jdbc:mysql://localhost:3306/mydb
    jdbc.username=user
    jdbc.password=password
  log_settings.json: |-
    {
      "level": "INFO",
      "format": "json"
    }
```

**Примечание**: Вы можете использовать поле `binaryData`, когда создаете ConfigMap из двоичного файла, такого как изображение.

Конфигурационные данные могут использоваться в подах различными способами. ConfigMap может использоваться для:

- Заполнения значений переменных окружения в контейнерах
- Установки аргументов командной строки в контейнере
- Заполнения конфигурационных файлов в томе

Пользователи и системные компоненты могут хранить конфигурационные данные в ConfigMap. ConfigMap похож на секрет, но предназначен для более удобной работы со строками, которые не содержат конфиденциальной информации.

## Ограничения ConfigMap

- ConfigMap должен быть создан до того, как его содержимое может быть использовано в подах.
- Контроллеры могут быть написаны так, чтобы терпеть отсутствие конфигурационных данных. Обратитесь к отдельным компонентам, настроенным с использованием ConfigMap, в каждом конкретном случае.
- Объекты `ConfigMap` находятся в проекте.
- Они могут быть использованы только подами в том же проекте.
- Kubectl поддерживает использование ConfigMap только для подов, которые он получает от API-сервера. Это включает любые поды, созданные с использованием CLI или косвенно через контроллер репликации. Это не включает поды, созданные с использованием флага `--manifest-url` узла OpenShift Container Platform, его флага `--config` или его REST API, так как это не общие способы создания подов.

## ConfigMap против Secret

| Особенность | ConfigMap      | Secret                      |
| ----------- | -------------- | --------------------------- |
| Тип данных  | Не чувствительные  | Чувствительные (например, пароли) |
| Кодировка   | Обычный текст  | Закодированный в Base64     |
| Сценарии использования | Конфигурации, флаги | Пароли, токены           |

## Создание ConfigMap с помощью веб-консоли

1. Перейдите в **Платформу Контейнеров**.

2. В левом боковом меню щелкните **Конфигурация** > **ConfigMap**.

3. Нажмите **Создать ConfigMap**.

4. Обратитесь к инструкциям ниже для настройки соответствующих параметров.

   | Параметр          | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Записи**        | Относится к парам `ключ:значение`, поддерживает как **Добавить**, так и **Импорт**. <br /><ul><li>**Добавить**: Вы можете добавлять элементы конфигурации по одному, или вы можете вставить одну или несколько строк пар ключ=значение в поле ввода Ключа для массового добавления элементов конфигурации.</li><li>**Импорт**: Импортируйте текстовый файл размером не более 1 МБ. Имя файла будет использоваться как ключ, а содержимое файла будет использоваться как значение, заполненное в элементе конфигурации.</li></ul> |
   | **Двоичные записи** | Относится к двоичным файлам размером не более 1 МБ. Имя файла будет использоваться как ключ, а содержимое файла будет использоваться как значение, заполненное в элементе конфигурации.<br />**Примечание**: После создания ConfigMap импортированные файлы не могут быть изменены.                                                                                                                                                                                                      |

   **Пример формата массового добавления**:

   ```
   # По одному ключ=значение на строку, несколько пар должны быть на отдельных строках, в противном случае они не будут распознаны правильно после вставки.
   ключ1=значение1
   ключ2=значение2
   ключ3=значение3
   ```

5. Нажмите **Создать**.

## Создание ConfigMap с помощью CLI

```shell
kubectl create configmap app-config \
  --from-literal=APP_ENV=production \
  --from-literal=LOG_LEVEL=debug
```

Или из файла:

```shell
kubectl apply -f app-config.yaml -n k-1
```

## Операции

Вы можете щелкнуть (⋮) на правой стороне страницы списка или нажать **Действия** в верхнем правом углу страницы деталей, чтобы обновить или удалить ConfigMap по мере необходимости.

Изменения в ConfigMap повлияют на рабочие нагрузки, которые ссылаются на конфигурацию, поэтому перед выполнением операций прочитайте инструкции.

| Операции | Описание                                                                                                                                                                                                                                                                                                                                   |
| ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Обновить** | <ul><li>После добавления или обновления ConfigMap любые рабочие нагрузки, которые ссылались на этот ConfigMap (или его элементы конфигурации) через переменные среды, нуждаются в перебилдениях своих Pods для применения новой конфигурации.</li><li>Для импортированных двоичных элементов конфигурации поддерживаются только обновления ключей, обновления значений не поддерживаются.</li></ul> |
| **Удалить** | После удаления ConfigMap рабочие нагрузки, которые ссылались на этот ConfigMap (или его элементы конфигурации) через переменные среды, могут негативно пострадать во время создания Pod, если они будут перебилдены и не смогут найти источник ссылки.                                                                                                  |

## Просмотр, редактирование и удаление с помощью CLI

```shell
kubectl get configmap app-config -n k-1 -o yaml
kubectl edit configmap app-config -n k-1
kubectl delete configmap app-config -n k-1
```

## Способы использования ConfigMap в Pod

### В качестве переменных среды

```yaml
envFrom:
  - configMapRef:
      name: app-config
```

Каждый ключ становится переменной среды в контейнере.

### В качестве файлов в томе

```yaml
volumes:
  - name: config-volume
    configMap:
      name: app-config

volumeMounts:
  - name: config-volume
    mountPath: /etc/config
```

Каждый ключ — это файл в `/etc/config`, а содержимое файла — это значение.

### В качестве отдельных переменных среды

```yaml
env:
  - name: APP_ENV
    valueFrom:
      configMapKeyRef:
        name: app-config
        key: APP_ENV
```

## ConfigMap против Secret

| Особенность | ConfigMap      | Secret                      |
| ----------- | -------------- | --------------------------- |
| Тип данных  | Не чувствительные  | Чувствительные (например, пароли) |
| Кодировка   | Обычный текст  | Закодированный в Base64     |
| Сценарии использования | Конфигурации, флаги | Пароли, токены           |
