---
weight: 30
i18n:
  title:
    en: Configuring Secrets
    zh: 配置 Secrets
title: Настройка секретов
sourceSHA: c58e71ed2d8ab5b8b799f82b5d29e8d059da572db4da07439e43b8921d486dd0
---

# Настройка секретов

В Kubernetes (k8s) секрет — это объект, используемый для хранения конфиденциальных данных, таких как:

- Пароли

- OAuth токены

- SSH ключи

- TLS сертификаты

- API ключи

Цель секрета — избежать размещения конфиденциальной информации непосредственно в спецификациях ваших подов или образах контейнеров. Секреты кодируются в формате base64 и могут быть смонтированы как тома или выставлены в качестве переменных окружения.

Создайте секрет в соответствии с вашими потребностями, выберите соответствующий тип секрета и настройте параметры.

## Создание секрета типа Opaque

```shell
kubectl create secret generic my-secret \
  --from-literal=username=admin \
  --from-literal=password=Pa$$w0rd
```

YAML

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
data:
  username: YWRtaW4= # base64 от "admin"
  password: UGEkJHcwcmQ= # base64 от "Pa$$w0rd"
```

Вы можете декодировать их следующим образом:

```shell
echo YWRtaW4= | base64 --decode  # вывод: admin
```

## Создание секрета типа Docker registry

```shell
kubectl create secret docker-registry my-docker-creds \
  --docker-username=myuser \
  --docker-password=mypass \
  --docker-server=https://index.docker.io/v1/ \
  --docker-email=my@example.com
```

YAML

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-docker-creds
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJteXVzZXIiLCJwYXNzd29yZCI6Im15cGFzcyIsImVtYWlsIjoibXlAZXhhbXBsZS5jb20iLCJhdXRoIjoiYlhsMWMyVnlPbTE1Y0dGemN3PT0ifX19
```

K8s автоматически преобразует ваше имя пользователя, пароль, адрес электронной почты и информацию о сервере в стандартный формат входа Docker:

```json
{
  "auths": {
    "https://index.docker.io/v1/": {
      "username": "myuser",
      "password": "mypass",
      "email": "my@example.com",
      "auth": "bXl1c2VyOm15cGFzcw=="  # base64(username:password)
    }
  }
}
```

Этот JSON затем кодируется в base64 и используется как значение поля данных секрета.

Используйте его в поде:

```yaml
imagePullSecrets:
  - name: my-docker-creds
```

## Создание секрета типа Basic Auth

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: basic-auth-secret
type: kubernetes.io/basic-auth
stringData:
  username: myuser
  password: mypass
```

## Создание секрета типа SSH-Auth

Сценарий использования: Хранение приватных ключей SSH (например, для доступа к Git).

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: ssh-key-secret
type: kubernetes.io/ssh-auth
stringData:
  ssh-privatekey: |
    -----BEGIN OPENSSH PRIVATE KEY-----
    ...
    -----END OPENSSH PRIVATE KEY-----
```

## Создание секрета типа TLS

Сценарий использования: TLS сертификаты (используются Ingress, вебхуками и т.д.)

```shell
kubectl create secret tls tls-secret \
--cert=path/to/tls.crt \
--key=path/to/tls.key
```

YAML

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: tls-secret
type: kubernetes.io/tls
data:
  tls.crt: <base64>
  tls.key: <base64>
```

## Создание секрета с помощью веб-консоли

1. Перейдите в **Платформа контейнеров**.

2. В левой навигационной панели нажмите **Конфигурация** > **Секреты**.

3. Нажмите **Создать секрет**.

4. Настройте параметры.

   **Примечание**: В представлении формы чувствительные данные, такие как вводимое имя пользователя и пароль, будут автоматически закодированы в формате Base64 перед тем, как быть сохраненными в секрете. Преобразованные данные можно предварительно просмотреть в представлении YAML.

5. Нажмите **Создать**.

## Как использовать секрет в поде

### В качестве переменных окружения

```yaml
env:
  - name: DB_USERNAME
    valueFrom:
      secretKeyRef:
        name: my-secret
        key: username
```

Из секрета с именем `my-secret` возьмите значение с ключом `username` и присвойте его переменной окружения `DB_USERNAME`.

### В качестве смонтированных файлов (том)

```yaml
volumes:
  - name: secret-volume
    secret:
      secretName: my-secret

volumeMounts:
  - name: secret-volume
    mountPath: "/etc/secret"
```

## Последующие действия

При создании рабочих нагрузок для нативных приложений в том же пространстве имен вы можете ссылаться на уже созданные секреты.

## Операции

Вы можете нажать (⋮) на правой стороне страницы списка или нажать **Действия** в правом верхнем углу страницы сведений, чтобы при необходимости обновить или удалить секрет.

| Операция   | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Обновить** | После добавления или обновления секрета рабочие нагрузки, которые ссылались на этот секрет (или его конфигурационные элементы) через переменные окружения, должны иметь свои поды перестроенными, чтобы новая конфигурация вступила в силу.                                                                                                                                                                                                                                                                                             |
| **Удалить**  | <ul><li>После удаления секрета рабочие нагрузки, которые ссылались на этот секрет (или его конфигурационные элементы) через переменные окружения, могут быть затронуты из-за невозможности найти источник ссылки при перестройке подов.</li><li>Пожалуйста, не удаляйте секреты, автоматически сгенерированные платформой, так как это может предотвратить правильное функционирование платформы. Например: секреты типа service-account-token, содержащие информацию для аутентификации ресурсов пространства имен, и секреты в системных пространствах имен (таких как kube-system).</li></ul> |
