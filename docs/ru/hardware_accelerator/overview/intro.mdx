---
weight: 10
sourceSHA: 1520c5380271e3635c7b9e6233edd2c9e61e72c3f13a8eed8ed794c565edbf3d
---

# Введение

## Введение в аппаратные ускорители

Kubernetes Hardware accelerator Suite — это решение корпоративного уровня для оптимизации распределения, изоляции и совместного использования ресурсов GPU в облачных нативных средах. Созданное на основе плагинов устройств Kubernetes и технологий, разработанных NVIDIA, оно включает три основных модуля:

1. **Модуль vGPU**\
   Основанный на открытом исходном коде GPU-Manager, он позволяет осуществлять точную виртуализацию GPU, разделяя физические GPU на доступные виртуальные единицы с квотами на память и вычисления. Идеален для многопользовательских сред, требующих динамического распределения ресурсов.

2. **Модуль pGPU**\
   Используя официальный плагин устройств NVIDIA, он обеспечивает полную физическую изоляцию GPU с учетом NUMA-распределения ресурсов. Предназначен для вычислений высокой производительности (HPC), требующих выделенного доступа к GPU.

3. **Модуль MPS**\
   Реализует многоуровневую службу NVIDIA для выполнения нескольких контекстов GPU одновременно с ограничениями ресурсов. Оптимизирует приложения с чувствительностью к задержкам за счет объединения ядер CUDA.

## Преимущества продукта

### Модуль vGPU

- **Динамическое разделение**: Разделяйте GPU для поддержки нескольких процессов, используя один физический GPU
- **Контроль качества обслуживания (QoS)**: Гарантированные вычислительные единицы (vcuda-core) и квоты на память (vcuda-memory)

### Модуль pGPU

- **Изоляция на уровне аппаратуры**: Прямой доступ PCIe с защитой IOMMU
- **Оптимизация NUMA**: Минимальная передача данных между сокетами благодаря автоматическому связыванию с узлами NUMA

### Модуль MPS

- **Долгая задержка выполнения**: Снижение задержки на 30-50% за счет объединения контекстов CUDA
- **Ограничения ресурсов**: Ограничение вычислений GPU на процесс (0-100%) и использование памяти
- **Отсутствие изменений в коде**: Работает с некомпилированными приложениями CUDA

## Сценарии применения

### Примеры использования vGPU

- **Многопользовательские платформы AI**: Разделяйте GPUs A100/H100 между командами с гарантированными SLA
- **VDI среда**: Обеспечьте виртуальные рабочие столы с ускорением GPU для CAD/3D рендеринга
- **Пакетный вывод**: Параллелизуйте развертывание моделей с долевыми распределениями GPU

### Примеры использования pGPU

- **Кластеры HPC**: Запускайте задачи MPI с эксклюзивным доступом к GPU для метеорологического моделирования
- **Обучение ML**: Полное использование GPU для обучения больших языковых моделей
- **Медицинская визуализация**: Обработка данных МРТ высокой четкости без конкуренции за ресурсы

### Примеры использования MPS

- **Слушание в реальном времени**: Аналитика видео с низкой задержкой с использованием нескольких потоков CUDA
- **Оркестрация микросервисов**: Размещение нескольких микросервисов GPU на общей аппаратуре
- **Обслуживание с высокой пропускной способностью**: Увеличьте QPS в 3 раза для систем рекомендаций

## Технические ограничения

### Требование к привилегиям

#### Требования к доступу к аппаратным устройствам

Права доступа к файлам устройств
Устройства GPU NVIDIA требуют прямого доступа к защищенным ресурсам системы:

```bash
# Владение файлом устройства и права доступа
$ ls -l /dev/nvidia*
crw-rw-rw- 1 root root 195,   0 Авг 1 10:00 /dev/nvidia0
crw-rw-rw- 1 root root 195, 255 Авг 1 10:00 /dev/nvidiactl
crw-rw-rw- 1 root root 195, 254 Авг 1 10:00 /dev/nvidia-uvm
```

- **Требование**: Доступ root для чтения/записи файлов устройства
- **Последствие**: Контейнеры без прав root получают ошибки отказа в разрешении

#### Операции на уровне ядра

Взаимодействия с драйвером NVIDIA

| Операция           | Необходимая привилегия | Цель                        |
| ------------------ | ---------------------- | --------------------------- |
| Загрузка модуля    | CAP\_SYS\_MODULE       | Загрузка модулей ядра NVIDIA |
| Управление памятью  | CAP\_IPC\_LOCK         | Выделение памяти GPU        |
| Обработка прерываний| CAP\_SYS\_RAWIO        | Обработка прерываний GPU    |

#### Требования к архитектуре плагинов устройств K8s

1. **Создание сокета**: Запись в `/var/lib/kubelet/device-plugins`
2. **Мониторинг состояния**: Доступ к `nvidia-smi` и журналам ядра
3. **Распределение ресурсов**: Изменение cgroups для устройств

### Ограничения vGPU

- поддерживает только cuda менее 12.4
- Нет поддержки MIG при включенном vGPU

### Ограничения pGPU

- Нет возможности совместного использования GPU (отображение 1:1 пода на GPU)
- Требуется Kubernetes 1.25+ с включенным SR-IOV
- Ограничено GPU, подключенными через PCIe/NVSwitch

### Ограничения MPS

- Потенциальная передача ошибок между объединенными контекстами
- Требуется CUDA 11.4+ для ограничения памяти
- Нет поддержки GPUs, разделенных MIG

---
