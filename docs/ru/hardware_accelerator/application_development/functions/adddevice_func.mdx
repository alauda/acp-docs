---
weight: 10
sourceSHA: 45f1fd723d5ec123f5b5c29264f6ca6cc6d32941b9be8be57b9cac97d9f3ff05
---

# Добавление пользовательских устройств с помощью ConfigMap

## Введение

- Реализует стандартизованное определение и управление пользовательскими ресурсами Kubernetes через ConfigMap, решая следующие задачи:
- Унифицированное управление спецификациями пользовательских ресурсов для предотвращения фрагментации конфигурации
- Стандартизованный формат определения ресурсов для лучшей поддерживаемости
- Поддержка многоязычной описательной информации и конфигурация значений по умолчанию
- Подходит для сценариев, требующих расширения модели ресурсов Kubernetes (например, управление GPU-ресурсами), предоставляя стандартизированную структуру определения ресурсов

## Особенности

- Спецификация определения ресурса с одним ключом
- Связанное определение ресурсов с несколькими ключами
- Стандартизованный интерфейс запроса ресурсов
- Поддержка двуязычных описаний на китайском и английском языках
- Механизм конфигурации значения по умолчанию для ресурсов

## Преимущества

- **Расширяемость**: Управление группами ресурсов с помощью меток
- **Безопасность**: Изоляция пространств имен (kube-public)
- **Стабильность**: Обязательные правила проверки формата
- **Поддерживаемость**: Унифицированные спецификации метаданных меток

## Функциональный модуль 1: Спецификации создания ConfigMap

### Основные правила

1. **Принцип единственной ответственности**: Один ConfigMap для определения каждого ключа

2. **Пространство имен**: Фиксировано на `namespace=kube-public`

3. **Конвенция наименования**:
   ```
   cf-crl-{customName}-{keyName} 
   ```
   - `cf-crl`: Фиксированный префикс
   - `customName`: Допустимое имя пользователя
   - `keyName`: Идентификатор ключа (специальные символы заменяются на '-')

4. **Требования к меткам**:
   ```yaml
   labels:
     features.alauda.io/type: CustomResourceLimitation  # Фиксированное значение
     features.alauda.io/group: {resource-group}         # например, gpu-manager
     features.alauda.io/enabled: "true"               # Флаг активации
   ```

### Спецификация параметров

| Параметр   | Обязательный | Описание                             |
| :---------- | :------: | :-------------------------------------- |
| формат имени |    Да    | Соответствует cf-crl-\{customName}-\{keyName} |
| пространство имен |    Да    | Фиксировано как kube-public                    |
| метка группы |    Да    | Должна содержать указанные 3 метки функции |

## Функциональный модуль 2: Определение значения ресурса

### Пример с одним ключом

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: cf-crl-gpu-manager-vcuda-core
  namespace: kube-public
  labels:
    features.alauda.io/type: CustomResourceLimitation
    features.alauda.io/group: gpu-manager
    features.alauda.io/enabled: "true"
data:
  key: "tencent.com/vcuda-core"       # Ключ ресурса
  dataType: "integer"                # Тип значения
  defaultValue: "20"                 # Значение по умолчанию
  descriptionZh: "" # Описание на китайском
  descriptionEn: "Количество ядер GPU vcore, 100 виртуальных ядер равны 1 физическому ядру GPU" # Описание на английском
  group: "gpu-manager"               # Группа ресурсов
  limits: "optional"                 # Политика поля ограничений
  requests: "disabled"               # Политика поля запросов
```

### Ассоциация с несколькими ключами

```yaml
metadata:
  name: cf-crl-gpu-manager-vcuda-core
  labels: [те же метки группы]

metadata:
  name: cf-crl-gpu-manager-vcuda-memory
  labels: [те же метки группы]  # Ассоциация через идентичные метки
```

### Спецификация политики

| Поле      | Допустимые значения               | Описание                     |
| --------- | ---------------------------- | ------------------------------- |
| limits    | disabled/required/optional   | Конфигурация лимитов ресурсов   |
| requests  | disabled/required/fromLimits | Конфигурация запросов ресурсов |
