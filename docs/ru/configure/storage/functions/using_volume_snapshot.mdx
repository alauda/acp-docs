---
weight: 51
sourceSHA: 15d45474b5a0f993835d861d0effd9f6ccb4e80a5958938e995a65d74017f45f
---

# Использование снимков томов

Снимок тома — это копия постоянного запроса тома (PVC) на определенный момент времени, которую можно использовать для настройки новых постоянных запросов томов (предварительное заполнение данными снимка) или для отката существующих постоянных запросов томов к предыдущему состоянию, достигая эффекта резервного копирования данных приложения и восстановления их по мере необходимости, тем самым обеспечивая надежность данных приложения.

## Предварительные условия

- Администратор развернул компонент снимка тома **Snapshot Controller** для текущего кластера и включил функции, связанные со снимками, в кластер хранения.

- Постоянный запрос тома должен быть создан динамически, и его статус должен быть **Bound**.

- Класс хранения, связанный с постоянным запросом тома, должен поддерживать функциональность снимков, такую как **CephRBD Built-in Storage**, **CephFS Built-in Storage** или **TopoLVM**.

## Пример пользовательского ресурса VolumeSnapshot (CR)

Это создает снимок example-pvc `PVC`, используя класс снимка CSI.

```yaml
# example-snapshot.yaml
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshot
metadata:
  name: example-pvc-20250527-111124
  namespace: k-1
  labels:
    snapshot.cpaas.io/sourcepvc: example-pvc
  annotations:
    cpaas.io/description: demo
spec:
  volumeSnapshotClassName: csi-cephfs-snapshotclass
  source:
    persistentVolumeClaimName: example-pvc
```

## Создание снимков томов с помощью веб-консоли

### Создание снимка тома на основе указанного постоянного запроса тома (PVC)

**Метод первый**

1. Войдите в **Container Platform**.

2. В левой навигационной панели нажмите **Storage > Persistent Volume Claims (PVC)**.

3. Нажмите ⋮ рядом с соответствующим постоянным запросом тома в списке и выберите **Create Volume Snapshot**.

4. Заполните описание снимка. Это описание может помочь вам зафиксировать текущее состояние постоянного тома, например *Перед обновлением приложения*.

5. Нажмите **Create**. Время, необходимое для создания снимка, зависит от условий сети и объема данных; пожалуйста, наберитесь терпения.

   Когда статус снимка изменится на `Available`, это указывает на успешное создание.

**Метод второй**

1. Войдите в **Container Platform**.

2. В левой навигационной панели нажмите **Storage > Persistent Volume Claims (PVC)**.

3. Нажмите на имя постоянного запроса тома в списке.

4. Переключитесь на вкладку **Volume Snapshots**.

5. Нажмите **Create Volume Snapshot** и настройте соответствующие параметры по мере необходимости.

6. Нажмите **Create**. Время, необходимое для создания снимка, зависит от условий сети и объема данных; пожалуйста, наберитесь терпения.

   Когда статус снимка изменится на `Available`, это указывает на успешное создание.

### Создание снимков томов нестандартным способом

1. Войдите в **Container Platform**.

2. В левой навигационной панели нажмите **Storage > Volume Snapshots**.

3. Нажмите **Create Volume Snapshot** и настройте соответствующие параметры по мере необходимости.

4. Нажмите **Create**. Время, необходимое для создания снимка, зависит от условий сети и объема данных; пожалуйста, наберитесь терпения.

   Когда статус снимка изменится на `Available`, это указывает на успешное создание.

## Создание снимков томов с помощью CLI

```shell
kubectl apply -f example-snapshot.yaml
```

## Создание постоянных запросов томов из снимков томов

В настоящее время платформа поддерживает создание снимков томов только с использованием PVC, созданных из классов хранения с **Dynamic Provisioning**. Вы можете создать новые PVC на основе этого снимка и связать их.

**Примечание**: Режимы доступа, поддерживаемые при создании PVC из снимка, отличаются от тех, которые поддерживаются при создании PVC из класса хранения, как указано **жирным шрифтом** в таблице.

| Класс хранения, используемый для создания снимков томов | Чтение-запись для одного узла (RWO) | Чтение только для нескольких узлов (ROX) | Чтение-запись для нескольких узлов (RWX) |
| ------------------------------------------------------ | ------------------------------------ | ---------------------------------------- | ---------------------------------------- |
| **TopoLVM**                                          | Поддерживается                      | Не поддерживается                        | Не поддерживается                        |
| **CephRBD Block Storage**                            | Поддерживается                      | Не поддерживается                        | Не поддерживается                        |
| **CephFS File Storage**                              | Поддерживается                      | **Поддерживается**                      | Поддерживается                            |

### Метод первый

1. Войдите в **Container Platform**.

2. В левой навигационной панели нажмите **Storage > Persistent Volume Claims (PVC)**.

3. Нажмите на имя постоянного запроса тома в списке.

4. Переключитесь на вкладку **Volume Snapshots**.

5. Нажмите ⋮ рядом с соответствующим снимком тома в списке и выберите **Create Persistent Volume Claim**, настроив соответствующие параметры.

6. Нажмите **Create**.

### Метод второй

1. Войдите в **Container Platform**.

2. В левой навигационной панели нажмите **Storage > Volume Snapshots**.

3. Нажмите ⋮ рядом с соответствующим снимком тома в списке и выберите **Create Persistent Volume Claim**, настроив соответствующие параметры.

4. Нажмите **Create**.

## Дополнительные ресурсы

- [Создание PVC](./create_pvc.mdx)
