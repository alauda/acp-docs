---
weight: 10
sourceSHA: 1d7a340c59a7ebfb002ee8c95fa313bd3f12973ae9531b625edeba5c8e8daf4a
---

# Установка правил именования подпапок в классе общего хранилища NFS

## Обзор функции

Каждый PersistentVolumeClaim (PVC), созданный с использованием класса общего хранилища NFS, соответствует подпапке внутри общего хранилища NFS. По умолчанию подпапки именуются по шаблону `${pv.metadata.name}` (т.е. имя PersistentVolume). Если сгенерированное по умолчанию имя не соответствует вашим требованиям, вы можете настроить правила именования подпапок. Этот документ предоставляет методы конфигурации и лучшие практики для настройки соглашения об именовании.

## Сценарии использования

На стороне сервера NFS имена подпапок могут использоваться для идентификации соответствующих PersistentVolumeClaims (PVC) в Kubernetes. Это позволяет администраторам контролировать использование хранилища каждого PVC, тем самым упрощая оперативное управление.

## Предварительные требования

- Сервер NFS должен быть настроен, и необходимо получить методы доступа. В настоящее время платформа поддерживает три версии протокола NFS: `v3`, `v4.0` и `v4.1`. Вы можете выполнить команду `nfsstat -s` на стороне сервера, чтобы проверить информацию о версии.

## Процедура

<Steps>
  ### Развертывание плагина общего хранилища NFS

  Смотрите [Развертывание плагина общего хранилища NFS](../functions/nfs_storageclass.mdx#deploying-the-nfs-shared-storage-plugin).

  ### Создание класса общего хранилища NFS

  1. Смотрите [Создание класса общего хранилища NFS](../functions/nfs_storageclass.mdx#create-an-nfs-shared-storage-class).

  2. Прежде чем нажать **Создать**, переключитесь на просмотр YAML и добавьте конфигурацию subDir в разделе параметров для определения правил именования подпапок.

       <Tabs>
         <Tab label="Пример конфигурации">
           ```yaml
           parameters:
             subDir: ${pvc.metadata.namespace}_${pvc.metadata.name}_${pv.metadata.name}
           ```
         </Tab>

         <Tab label="Примеры именования подпапок">
           ```bash
           default_nfs-pvc-01_pvc-4411db0b-8ec4-461a-8bbd-062d50666249
           ```

           `default` — это пространство имен PVC, `nfs-pvc-01` — это имя PVC, `pvc-4411db0b-8ec4-461a-8bbd-062d50666249` — это имя PV.
         </Tab>
       </Tabs>

     **Примечание:**

     - Поле `subDir` поддерживает только три следующих переменных, которые драйвер NFS CSI автоматически разрешает:
       - `${pvc.metadata.namespace}`: Пространство имен PVC.
       - `${pvc.metadata.name}`: Имя PVC.
       - `${pv.metadata.name}`: Имя PV.
     - Правило именования `subDir` **ДОЛЖНО** гарантировать уникальные имена подпапок. В противном случае несколько PVC могут делить одну и ту же подпапку, что может привести к конфликтам данных.

     **Рекомендуемые конфигурации:**

     - `${pvc.metadata.namespace}_${pvc.metadata.name}_${pv.metadata.name}`
     - `<cluster-identifier>_${pvc.metadata.namespace}_${pvc.metadata.name}_${pv.metadata.name}`

       Разработано для нескольких кластеров Kubernetes, использующих один и тот же сервер NFS, эта конфигурация обеспечивает четкое различение кластеров, включая уникальный идентификатор кластера (например, имя кластера) в правила именования подпапок.

     **Не рекомендуемые конфигурации:**

     - `${pvc.metadata.namespace}-${pvc.metadata.name}-${pv.metadata.name}`

       Избегайте использования `-` в качестве разделителей, они могут привести к неоднозначным именам подпапок. Например: Если два PVC названы `ns-1/test` и `ns/1-test`, оба могут сгенерировать ту же подпапку `ns-1-test`.

     - `${pvc.metadata.namespace}/${pvc.metadata.name}/${pv.metadata.name}`

       Не настраивайте subDir для создания вложенных директорий. Драйвер NFS CSI удаляет только последний уровень директории `${pv.metadata.name}` при удалении PVC, оставляя оставшиеся родительские директории на сервере NFS.

  3. нажмите **Создать**.
</Steps>

:::info

Существующий StorageClass не может быть изменен.

:::
