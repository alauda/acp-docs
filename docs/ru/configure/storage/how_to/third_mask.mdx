---
sourceSHA: 12170c12e95eaa5c5a1959bb707a8acf7b97bd5a2d058a1b28c830bceab63a26
---

# Руководство по аннотированию возможностей стороннего хранения

> **Обзор функции:** Добавив **StorageDescription** ConfigMap в пространство имен `kube-public`, платформа автоматически определяет поддержку снимков для каждого стороннего StorageClass, а также поддерживаемые режимы томов и режимы доступа (включая специфические режимы доступа для блоков). Экран создания PVC затем отображает только действительные варианты, что помогает вам легко выбрать и использовать правильные функции хранения.

## 1. Начало работы

### 1.1 Создание или обновление ConfigMap

> **Важно:** Выполните следующую операцию **в пространстве имен `kube-public`**, в противном случае платформа не распознает возможности хранения.

Отредактируйте или создайте ConfigMap, имя которого начинается с `sd-`, например `sd-capabilities-enhanced`:

```bash
kubectl -n kube-public edit configmap sd-capabilities-enhanced
```

**Обязательная метка**

```yaml
metadata:
  labels:
    features.alauda.io/type: StorageDescription
```

### 1.2 Заполнение поля `data`

Каждый `key` соответствует `provisioner` StorageClass; значение — это строка YAML, описывающая его возможности. Ключевые поля:

| Поле               | Тип            | Описание                                                    |
| ------------------ | -------------- | ----------------------------------------------------------- |
| `snapshot`         | `Boolean`      | Указывает, поддерживаются ли снимки томов                  |
| `volumeMode`       | `List[String]` | Поддерживаемые режимы томов; хотя бы один из `Filesystem`, `Block` |
| `accessModes`      | `List[String]` | Режимы доступа, доступные при `volumeMode` равном `Filesystem` |
| `blockAccessModes` | `List[String]` | Режимы доступа, специфичные для `Block` томов (необязательно) |

> Если `blockAccessModes` опущен, платформа будет использовать `accessModes` для блоков.

### 1.3 Применение конфигурации

```bash
kubectl apply -f sd-capabilities-enhanced.yaml
```

После применения интерфейс автоматически настраивает доступные варианты, например:

- Когда выбран режим тома **Block**, выпадающий список режимов доступа заполняется `blockAccessModes`.
- Если `snapshot: true`, операции, связанные со снимками, становятся доступными на странице PVC.

## 2. Пример ConfigMap

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: sd-capabilities-enhanced
  namespace: kube-public
  labels:
    features.alauda.io/type: StorageDescription
data:
  storage.advanced-block-fs.com: |-
    snapshot: true
    volumeMode:
      - Filesystem
      - Block
    accessModes:
      - ReadWriteOnce
      - ReadOnlyMany
    blockAccessModes:
      - ReadWriteOnce
  storage.filesystem-basic.com: |-
    snapshot: false
    volumeMode:
      - Filesystem
    accessModes:
      - ReadWriteOnce
      - ReadWriteMany
```

## 3. Обновление существующих описаний возможностей

1. Найдите ключ `provisioner`, который вы хотите изменить.
2. Отредактируйте значения полей, чтобы отразить фактические возможности.
3. Повторно примените ConfigMap с помощью `kubectl apply -f ...`. Платформа опрашивает обновления и автоматически обновляет интерфейс; вы также можете обновить браузер, чтобы увидеть изменения немедленно.

## 4. Совместимость с устаревшим форматом

- Если `blockAccessModes` отсутствует, блоки будут наследовать `accessModes`.
- Вам не нужно удалять старые ConfigMaps; просто добавьте новые поля для плавного обновления.

## 5. Часто задаваемые вопросы

| Симптом                                   | Возможная причина                                          | Решение                             |
| ----------------------------------------- | --------------------------------------------------------- | ----------------------------------- |
| Список режимов доступа пуст для блоков    | `blockAccessModes` пуст и `accessModes` также пуст       | Укажите хотя бы один из двух        |
| Интерфейс по-прежнему показывает устаревшие возможности | ConfigMap не сохранен или кэш браузера                    | Проверьте с помощью `kubectl get cm`, обновите страницу |
