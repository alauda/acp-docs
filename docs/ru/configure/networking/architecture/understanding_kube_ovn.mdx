---
weight: 10
sourceSHA: 2a4af49cd3068424248ed6e4ae9736899e9c100de6062e666acfd63f8efd4ab1
---

# Понимание Kube-OVN

Этот документ описывает общую архитектуру Kube-OVN, функциональность каждого компонента и то, как они взаимодействуют друг с другом.

В целом, Kube-OVN служит мостом между Kubernetes и OVN, сочетая проверенные технологии SDN с облачными решениями.
Это означает, что Kube-OVN не только реализует сетевые спецификации в рамках Kubernetes, такие как CNI, Service и Networkpolicy,
но также приносит множество возможностей в области SDN в облачные решения, такие как логические коммутаторы, логические маршрутизаторы, VPC,
шлюзы, QoS, ACL и зеркалирование трафика.

Kube-OVN также сохраняет хорошую открытость для интеграции с множеством технологических решений, таких как Cilium, Submariner, Prometheus, KubeVirt и т.д.

Компоненты Kube-OVN можно разделить на три основные категории.

- Компоненты Upstream OVN/OVS.
- Центральный контроллер и агент.
- Инструменты мониторинга, эксплуатации и обслуживания, а также дополнительные компоненты.

![](../../../../en/configure/networking/assets/kube-ovn-architecture.png)

## Компоненты Upstream OVN/OVS

Этот тип компонентов происходит из сообщества OVN/OVS с конкретными модификациями для сценариев использования Kube-OVN.
OVN/OVS является зрелой системой SDN для управления виртуальными машинами и контейнерами,
и мы настоятельно рекомендуем пользователям, заинтересованным в реализации Kube-OVN, сначала прочитать [ovn-architecture(7)](https://www.mankier.com/7/ovn-architecture),
чтобы понять, что такое OVN и как с ним интегрироваться.
Kube-OVN использует интерфейс северного направления OVN для создания и координации виртуальных сетей и отображения концепций сети в Kubernetes.

Все компоненты, связанные с OVN/OVS, были упакованы в образы и готовы к запуску в Kubernetes.

### ovn-central

Развертывание `ovn-central` запускает компоненты управляющей плоскости OVN, включая `ovn-nb`, `ovn-sb` и `ovn-northd`.

- `ovn-nb`: Сохраняет конфигурацию виртуальной сети и предоставляет API для управления виртуальной сетью. `kube-ovn-controller` будет в основном взаимодействовать с `ovn-nb` для настройки виртуальной сети.
- `ovn-sb`: Содержит таблицу логических потоков, сгенерированную из логической сети `ovn-nb`, а также фактическое состояние физической сети каждого узла.
- `ovn-northd`: переводит виртуальную сеть из `ovn-nb` в логическую таблицу потоков в `ovn-sb`.

Несколько экземпляров `ovn-central` будут синхронизировать данные через протокол Raft для обеспечения высокой доступности.

### ovs-ovn

`ovs-ovn` работает как DaemonSet на каждом узле, с запущенными внутри Pod `openvswitch`, `ovsdb` и `ovn-controller`.
Эти компоненты выступают в качестве агентов для `ovn-central`, переводя логические таблицы потоков в реальные сетевые конфигурации.

## Центральный контроллер и агент

Эта часть является основным компонентом Kube-OVN, служащим мостом между OVN и Kubernetes, связывая две системы и переводя концепции сети между ними.
Большая часть основных функций реализована в этих компонентах.

### kube-ovn-controller

Этот компонент выполняет перевод всех ресурсов в Kubernetes в ресурсы OVN и действует как управляющая плоскость для всей системы Kube-OVN.
`kube-ovn-controller` отслеживает события всем ресурсам, связанным с сетевой функциональностью, и обновляет логическую сеть
в рамках OVN на основе изменений ресурсов. Основные ресурсы, за которыми ведется наблюдение, включают:

Pod, Service, Endpoint, Node, NetworkPolicy, VPC, Subnet, Vlan, ProviderNetwork.

В качестве примера события Pod, `kube-ovn-controller` следит за событием создания Pod, выделяет адрес через встроенную функцию IPAM в памяти
и вызывает `ovn-central` для создания логических портов, статических маршрутов и возможных правил ACL.
Затем `kube-ovn-controller` записывает назначенный адрес и информацию о подсети, такую как CIDR, шлюз, маршрут и т.д., в аннотацию Pod.
Эта аннотация затем считывается `kube-ovn-cni` и используется для настройки локальной сети.

### kube-ovn-cni

Этот компонент работает на каждом узле как DaemonSet, реализует интерфейс CNI и управляет локальным OVS для настройки локальной сети.

Этот DaemonSet копирует бинарный файл `kube-ovn` на каждую машину как инструмент для взаимодействия между `kubelet` и `kube-ovn-cni`.
Этот бинарный файл отправляет соответствующий CNI-запрос к `kube-ovn-cni` для дальнейшей обработки.
Бинарный файл будет скопирован в каталог `/opt/cni/bin` по умолчанию.

`kube-ovn-cni` будет конфигурировать конкретную сеть для выполнения соответствующих операций с трафиком,
и основные задачи включают:

1. Конфигурация `ovn-controller` и `vswitchd`.
2. Обработка запросов CNI Add/Del:
   1. Создание или удаление пары veth и привязка или отвязывание к OVS портам.
   2. Конфигурация OVS портов.
   3. Обновление правил iptables/ipset/route хоста.
3. Динамическое обновление QoS сети.
4. Создание и настройка сетевой карты `ovn0` для подключения сетевой контейнерной и сетевой хоста.
5. Настройка сетевой карты хоста для реализации Vlan/Underlay/EIP.
6. Динамическая конфигурация межкластерных шлюзов.

## Инструменты мониторинга, эксплуатации и обслуживания и дополнительные компоненты

Эти компоненты предоставляют инструменты мониторинга, диагностики, эксплуатации и внешний интерфейс для расширения основных сетевых возможностей Kube-OVN
и упрощают повседневные операции и обслуживание.

### kube-ovn-speaker

Этот компонент является DaemonSet, работающим на определенных помеченных узлах, который публикует маршруты во внешний мир,
обеспечивая прямой доступ к контейнеру через IP Pod.

### kube-ovn-pinger

Этот компонент является DaemonSet, работающим на каждом узле для сбора информации о статусе OVS, качестве сетевого соединения, задержках в сети и т.д.

### kube-ovn-monitor

Этот компонент собирает информацию о статусе OVN и метрики мониторинга.

### kubectl-ko

Этот компонент является плагином kubectl, который позволяет быстро выполнять общие операции.
