---
weight: 10
sourceSHA: dc8e1f0926136958b66c20d37f435007ff23650be66c6c2a99d6fc82887ef2c6
---

# L4/L7 Тайм-аут

## Основная концепция

Тайм-аут L4/L7 — это функция, предоставляемая ALB. Он используется для настройки времени тайм-аута для L4/L7 прокси.

Тайм-аут реализуется с помощью скрипта Lua, и Nginx **не нужно перезагружать**, когда он изменяется.

## CRD

```yaml
timeout:
  properties:
    proxy_connect_timeout_ms:
      type: integer
    proxy_read_timeout_ms:
      type: integer
    proxy_send_timeout_ms:
      type: integer
  type: object
```

Настройки могут быть сконфигурированы на:

- Frontend: `.spec.config.timeout`
- Rule: `.spec.config.timeout`

## Что означает тайм-аут

Существуют три типа тайм-аутов:

1. **proxy\_connect\_timeout\_ms**: Определяет тайм-аут для установления соединения с сервером в потоке. Если соединение не может быть установлено в течение этого времени, запрос завершится неудачно.

2. **proxy\_read\_timeout\_ms**: Определяет тайм-аут для чтения ответа от сервера в потоке. Тайм-аут устанавливается между двумя последовательными операциями чтения, а не на весь ответ. Если данные не поступают в течение этого времени, соединение закрывается.

3. **proxy\_send\_timeout\_ms**: Определяет тайм-аут для отправки запроса на сервер в потоке. Аналогично тайм-ауту чтения, он устанавливается между двумя последовательными операциями записи. Если данные не могут быть отправлены в течение этого времени, соединение закрывается.

## Аннотация Ingress

| Аннотация                                          | Описание                                        |
| --------------------------------------------------- | ---------------------------------------------- |
| nginx.ingress.kubernetes.io/proxy-connect-timeout   | Соответствует proxy\_connect\_timeout\_ms в CR |
| nginx.ingress.kubernetes.io/proxy-read-timeout      | Соответствует proxy\_read\_timeout\_ms в CR    |
| nginx.ingress.kubernetes.io/proxy-send-timeout      | Соответствует proxy\_send\_timeout\_ms в CR    |

## Тайм-аут на уровне порта

Вы можете настроить тайм-аут на порту напрямую, который используется в качестве L4 тайм-аута.
