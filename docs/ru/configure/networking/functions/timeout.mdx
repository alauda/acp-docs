---
weight: 10
sourceSHA: dc8e1f0926136958b66c20d37f435007ff23650be66c6c2a99d6fc82887ef2c6
---

# L4/L7 Тайм-аут

## Основная концепция

Тайм-аут L4/L7 — это функция, предоставляемая ALB. Она используется для настройки времени тайм-аута для L4/L7 прокси.

Тайм-аут реализуется с помощью скрипта Lua, и Nginx **не нужно перезагружать**, когда он изменяется.

## CRD

```yaml
timeout:
  properties:
    proxy_connect_timeout_ms:
      type: integer
    proxy_read_timeout_ms:
      type: integer
    proxy_send_timeout_ms:
      type: integer
  type: object
```

Конфигурация может быть настроена на:

- Frontend: `.spec.config.timeout`
- Правило: `.spec.config.timeout`

## Что означает тайм-аут

Существует три типа тайм-аутов:

1. **proxy\_connect\_timeout\_ms**: Определяет тайм-аут для установления соединения с сервером верхнего уровня. Если соединение не может быть установлено в течение этого времени, запрос завершится неудачей.

2. **proxy\_read\_timeout\_ms**: Определяет тайм-аут для чтения ответа от сервера верхнего уровня. Тайм-аут устанавливается между двумя последовательными операциями чтения, а не на весь ответ. Если данные не поступают в течение этого времени, соединение закрывается.

3. **proxy\_send\_timeout\_ms**: Определяет тайм-аут для отправки запроса на сервер верхнего уровня. Подобно тайм-ауту чтения, он устанавливается между двумя последовательными операциями записи. Если данные не могут быть отправлены в течение этого времени, соединение закрывается.

## Аннотация Ingress

| Аннотация                                        | Описание                                      |
| ------------------------------------------------- | ------------------------------------------------ |
| nginx.ingress.kubernetes.io/proxy-connect-timeout | Соответствует proxy\_connect\_timeout\_ms в CR |
| nginx.ingress.kubernetes.io/proxy-read-timeout    | Соответствует proxy\_read\_timeout\_ms в CR    |
| nginx.ingress.kubernetes.io/proxy-send-timeout    | Соответствует proxy\_send\_timeout\_ms в CR    |

## Тайм-аут на уровне порта

Вы можете настроить тайм-аут на порту непосредственно, который используется в качестве тайм-аута L4.
