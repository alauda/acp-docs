---
weight: 30
sourceSHA: b2ef7e7d3d1998ed75d44b16c5d95750dec528b9af4dd5c7f8cf3159e05875ad
---

# Создание подсетей (Kube-OVN Underlay Network)

Создание подсетей в Kube-OVN Underlay сети не только позволяет обеспечить более тонкую изоляцию сети для ресурсов, но и предоставляет лучший опыт работы с производительностью.

**Примечание**: Сетевая инфраструктура контейнеров в Kube-OVN Underlay требует поддержки со стороны физической сети. Пожалуйста, обратитесь к лучшим практикам [Подготовка физической сети Kube-OVN Underlay](../how_to/kubeovn_underlay_py.mdx), чтобы обеспечить сетевую связность.

## Правила распределения IP

**Примечание**: Если проекту или пространству имен назначено несколько подсетей, один из IP-адресов из соответствующей подсети будет использоваться случайным образом.

- Распределение по проекту:

  - Если проект не привязан к подсети, Pods во всех пространствах имен под этим проектом могут использовать только IP-адреса из подсети по умолчанию. Если в подсети по умолчанию недостаточно IP-адресов, Pods не смогут запуститься.
  - Если проект привязан к подсети, Pods во всех пространствах имен под этим проектом могут использовать только IP-адреса из этой подсети.

- Распределение по пространству имен:

  - Если пространство имен не привязано к подсети, Pods в этом пространстве имен могут использовать только IP-адреса из подсети по умолчанию. Если в подсети по умолчанию недостаточно IP-адресов, Pods не смогут запуститься.
  - Если пространство имен привязано к подсети, Pods в этом пространстве имен могут использовать только IP-адреса из этой подсети.

## Инструкции по использованию

Общий процесс создания подсетей в Kube-OVN Underlay сети: Добавить мостовую сеть > Добавить VLAN > Создать подсеть.

## (Необязательно) Добавить мостовую сеть \{#kube-ovn\_underlay\_bridge\_network}

Мостовая сеть относится к мосту, и после привязки сетевой карты к мосту она может пересылать трафик контейнерной сети, обеспечивая взаимодействие с физической сетью.

### Шаги

1. Перейдите в **Управление платформой**.

2. В левой навигационной панели нажмите **Управление сетью** > **Мостовая сеть**.

3. Нажмите **Добавить мостовую сеть**.

4. Настройте соответствующие параметры на основе следующих инструкций.

   **Примечание**:

   - *Целевой Pod* относится ко всем Pods, запланированным на текущем узле, или Pods в пространствах имен, привязанных к конкретным подсетям, запланированным на текущем узле. Это зависит от области подсети под мостовой сетью.

   - Узлы в подсети Underlay должны иметь несколько сетевых карт, и сетевая карта, используемая мостовой сетью, должна быть исключительно назначена для Underlay и не может передавать другой трафик, такой как SSH. Например, если мостовая сеть имеет три узла, планирующих использовать eth0, eth0, eth1 для исключительного использования Underlay, то сетевая карта по умолчанию может быть установлена как eth0, а сетевая карта для третьего узла может быть eth1.

   | Параметр                          | Описание                                                                                                                                                                                                                                                                                                                      |
   | ---------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Имя сетевой карты по умолчанию** | По умолчанию целевой Pod будет использовать это как сетевую карту мостовой сети для взаимодействия с физической сетью.                                                                                                                                                                                                            |
   | **Настроить сетевую карту по узлам** | Целевые Pods на настроенных узлах будут подключаться к указанной сетевой карте вместо сетевой карты по умолчанию.                                                                                                                                                                                                           |
   | **Исключить узлы**                  | Когда узлы исключены, все Pods, запланированные на этих узлах, не будут подключаться к какой-либо сетевой карте на этих узлах.<br /><br />**Примечание**: Pods на исключенных узлах не смогут взаимодействовать с физической сетью или межузловыми контейнерными сетями, и следует избегать планирования связанных Pods на этих узлах. |

5. Нажмите **Добавить**.

## (Необязательно) Добавить VLAN

Платформа имеет предварительно настроенную виртуальную локальную сеть **ovn-vlan**, которая будет подключаться к мостовой сети **provider**. Вы также можете настроить новую VLAN для подключения к другим мостовым сетям, тем самым обеспечивая сетевую изоляцию между VLAN.

### Шаги

1. Перейдите в **Управление платформой**.

2. В левой навигационной панели нажмите **Управление сетью** > **VLAN**.

3. Нажмите **Добавить VLAN**.

4. Настройте соответствующие параметры на основе следующих инструкций.

   | Параметр          | Описание                                                                                      |
   | ------------------ | ------------------------------------------------------------------------------------------------ |
   | **VLAN ID**        | Уникальный идентификатор для этой VLAN, который будет использоваться для различения различных виртуальных локальных сетей. |
   | **Мостовая сеть** | VLAN будет подключаться к этой мостовой сети для взаимодействия с физической сетью.   |

5. Нажмите **Добавить**.

## Создать подсеть и назначить проект или пространство имен

**Примечание**: Платформа также предварительно настраивает подсеть **join** для связи между узлами и Pods в режиме Overlay. Эта подсеть не будет использоваться в режиме Underlay, поэтому крайне важно избегать конфликтов IP-сегментов между **join** и другими подсетями.

### Шаги

1. Перейдите в **Управление платформой**.

2. В левой навигационной панели нажмите **Управление сетью** > **Подсеть**.

3. Нажмите **Создать подсеть**.

4. Настройте соответствующие параметры на основе следующих инструкций.

   | Параметр       | Описание                                                                                                                                 |
   | --------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
   | **VLAN**        | VLAN, к которой принадлежит подсеть.                                                                                                       |
   | **Подсеть**      | После назначения подсети проекту или пространству имен IP-адреса в физической подсети будут случайным образом распределены для использования Pods.            |
   | **Шлюз**     | Физический шлюз в указанной подсети.                                                                                               |
   | **Резервированный IP** | Указанный резервированный IP не будет автоматически назначен. Например, он может использоваться как IP для компонента вычислений **fixed IP**. |

5. Нажмите **Подтвердить**.

6. На странице деталей подсети выберите **Действие** > **Назначить проект** / **Пространство имен**.

7. Завершите настройку и нажмите **Назначить**.

## Связанные операции

Когда в кластере существуют как подсети Underlay, так и Overlay, вы можете настроить [Автоматическое взаимодействие между подсетями Underlay и Overlay](../how_to/underlay_overlay_st.mdx) по мере необходимости.
