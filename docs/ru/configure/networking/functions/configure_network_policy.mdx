---
weight: 18
title: Настройка сетевых политик
sourceSHA: 0172de67368ad758228a07dc025e4406730c91dd539478b661d0902334c9d366
---

# Создание сетевых политик

:::info
Платформа теперь предоставляет два различных интерфейса для сетевых политик. Старый интерфейс поддерживается по соображениям совместимости, в то время как новый более гибкий и предоставляет встроенный редактор YAML. Мы рекомендуем использовать новую версию.

Пожалуйста, свяжитесь с администратором платформы, чтобы включить функцию `network-policy-next`, чтобы получить доступ к новому интерфейсу.
:::

NetworkPolicy — это ресурс Kubernetes, ограниченный пространством имен, и реализуется плагинами CNI. С помощью сетевых политик вы можете контролировать сетевой трафик подов, достигая сетевой изоляции и снижая риск атак.

По умолчанию все поды могут свободно общаться, позволяя входящий и исходящий трафик из любого источника. Когда применяется сетевое правило, целевые поды будут принимать только трафик, соответствующий спецификации.

:::warning
Сетевые политики применяются только к трафику контейнеров. Они не влияют на поды, работающие в режиме **hostNetwork**.
:::

Пример сетевой политики:

```yaml
# example-network-policy.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: example
  namespace: demo-1
  annotations:
    cpaas.io/display-name: test
spec:
  podSelector:
    matchLabels:
      pod-template-hash: 55c84b59bb
  ingress:
    - ports:
        - protocol: TCP
          port: 8989
      from: # [!code callout]
        - podSelector:
            matchLabels:
              kubevirt.io/vm: test
  egress:
    - ports:
        - protocol: TCP
          port: 80
      to:
        - ipBlock:
            cidr: 192.168.66.221/23
            except: []
  policyTypes:
    - Ingress
    - Egress
```

<Callouts>
  1. `from` и 'to' поддерживают `namespaceSelector`, `podSelector`, 'ipBlock'
</Callouts>

## Создание сетевой политики с помощью веб-консоли

1. Войдите в **Container Platform**.

2. В левой навигационной панели нажмите **Network** > **Network Policies**.

3. Нажмите **Create Network Policy**.

4. Ознакомьтесь с приведенными ниже инструкциями, чтобы завершить соответствующую настройку.

<table>
  <thead>
    <tr>
      <th>Область</th>
      <th colSpan={2}>Параметр</th>
      <th>Описание</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td rowSpan={2}>Целевой под</td>
      <td colSpan={2}>Выбор пода</td>
      <td>Введите метки целевых подов в формате ключ-значение; если не указано, будет применяться ко всем подам в текущем пространстве имен.</td>
    </tr>

    <tr>
      <td colSpan={2}>Предварительный просмотр целевых подов, затронутых текущей политикой</td>
      <td>Нажмите <b>Preview</b>, чтобы увидеть целевые поды, затронутые этой сетевой политикой.</td>
    </tr>

    <tr>
      <td rowSpan={5}>Входящий трафик</td>
      <td colSpan={2}>Блокировать весь входящий трафик</td>
      <td>Блокировать весь входящий трафик к целевому поду. <br /><br /><b>Примечание</b>:<ul><li>Если входящий трафик добавлен в поле `spec.policyTypes` в YAML без настройки конкретных правил, опция <b>Блокировать весь входящий трафик</b> будет автоматически отмечена при возврате к форме.</li><li>Если поля `spec.ingress`, `spec.egress` и `spec.policyTypes` одновременно удалены в YAML, опция <b>Блокировать весь входящий трафик</b> будет автоматически отмечена при возврате к форме.</li></ul></td>
    </tr>

    <tr>
      <td rowSpan={3}>Правила<br /><br /><b>Описание</b>: Если в правилах добавлено несколько источников, между ними существует логическое <b>ИЛИ</b>.</td>
      <td>Поды в текущем пространстве имен</td>
      <td>Совпадение подов с указанными метками в текущем пространстве имен; только совпадающие поды могут получить доступ к целевому поду. Вы можете нажать <b>Preview</b>, чтобы увидеть поды, затронутые текущим правилом. Если этот элемент не настроен, все поды в текущем пространстве имен могут получить доступ к целевому поду по умолчанию.</td>
    </tr>

    <tr>
      <td>Поды в текущем кластере</td>
      <td>Совпадение пространств имен или подов с указанными метками в кластере; только совпадающие поды могут получить доступ к целевому поду. Вы можете нажать <b>Preview</b>, чтобы увидеть поды, затронутые текущим правилом. <ul><li>Если одновременно настроены выборщики пространств имен и подов, будет взято пересечение двух, что означает, что поды с указанными метками будут выбраны из указанного пространства имен.</li><li>Если этот элемент не настроен, все поды из всех пространств имен в кластере могут получить доступ к целевому поду по умолчанию.</li></ul></td>
    </tr>

    <tr>
      <td>Диапазон IP</td>
      <td>Введите CIDR, который может получить доступ к целевому поду, и можете исключить диапазоны CIDR, которые не могут получить доступ к целевому поду. Если этот элемент не настроен, любой трафик может получить доступ к целевому поду.<br /><br /><b>Описание</b>: Вы можете добавить элементы исключения в формате <i>exampleip</i>/32, чтобы исключить один IP-адрес.</td>
    </tr>

    <tr>
      <td colSpan={2}>Порт</td>
      <td>Совпадение трафика по указанным протоколам и портам; можно добавить числовые порты или имена портов на подах. Если этот элемент не настроен, будут совпадать все порты.</td>
    </tr>

    <tr>
      <td rowSpan={5}>Исходящий трафик</td>
      <td colSpan={2}>Блокировать весь исходящий трафик</td>
      <td>Блокировать весь исходящий трафик к целевому поду. <br /><br /><b>Примечание</b>:<ul><li>Если исходящий трафик добавлен в поле `spec.policyTypes` в YAML без настройки конкретных правил, опция <b>Блокировать весь исходящий трафик</b> будет автоматически отмечена при возврате к форме.</li></ul></td>
    </tr>

    <tr>
      <td colSpan={2}>Другие параметры</td>
      <td>Аналогично параметрам **Ingress**, здесь не будет подробного объяснения.</td>
    </tr>
  </tbody>
</table>

5. Нажмите **Create**.

## Создание сетевой политики с помощью CLI

```shell
kubectl apply -f example-network-policy.yaml
```

## Справка

Если вам нужны дополнительные детали, ознакомьтесь с официальной документацией по [сетевым политикам](https://kubernetes.io/docs/concepts/services-networking/network-policies/).
