---
weight: 10
sourceSHA: 9d2c1909d083171ab600ba48f7ff0457e5d9b43affea2efd042d5ebad28beaf7
---

# TCP/HTTP Keepalive

## Основная концепция

1. ALB поддерживает конфигурацию keepalive на уровне порта. Она может быть настроена на фронтенде.

2. Keepalive **между клиентом и ALB, а не между ALB и бэкендом**.

3. Он реализован через конфигурацию Nginx, и Nginx **нуждается в автоматической перезагрузке** при изменении конфигурации.

4. TCP keepalive и HTTP keepalive — это два разных понятия:
   1. **TCP keepalive** — это функция протокола TCP, которая отправляет периодические контрольные пакеты, чтобы проверить, активна ли связь, когда нет передачи данных. Это помогает обнаруживать и очищать мертвые соединения.
   2. **HTTP keepalive** (также известный как постоянные соединения) позволяет нескольким HTTP-запросам повторно использовать одно и то же TCP-соединение, избегая накладных расходов на установление новых соединений. Это улучшает производительность, снижая задержки и использование ресурсов.

## CRD

```yaml
keepalive:
  properties:
    http:
      description: Downstream L7 keepalive
      properties:
        header_timeout:
          description: Таймаут заголовка keepalive. По умолчанию не установлен.
          type: string
        requests:
          description: Запросы keepalive. По умолчанию 1000.
          type: integer
        timeout:
          description: Таймаут keepalive. По умолчанию 75s.
          type: string
      type: object
    tcp:
      description: TCPKeepAlive определяет параметры TCP keepalive (SO_KEEPALIVE)
      properties:
        count:
          description: Опция сокета TCP_KEEPCNT.
          type: integer
        idle:
          description: Опция сокета TCP_KEEPIDLE.
          type: string
        interval:
          description: Опция сокета TCP_KEEPINTVL.
          type: string
      type: object
  type: object
```

Его можно настроить только на фронтенде `.spec.config.keepalive`.
