---
weight: 4
sourceSHA: 40f70eca6c1df0b8b75a7d0d98291f5c1c35d2a4722ed98a9d2a87dbf5c059d0
---

# Правила ALB

Мы определяем ресурс, называемый правилом, который используется для описания того, как экземпляр alb должен обрабатывать запрос на уровне 7.

## CRD

```yaml
  spec:
    properties:
      backendProtocol:
        description: backendProtocol определяет протокол, используемый сервером
          в backend, это может быть https/http/grpc
        type: string
      certificate_name:
        description: certificate_name определяет сертификат, используемый с
          указанным именем хоста в правиле на https frontend
        type: string
      corsAllowHeaders:
        description: corsAllowHeaders определяет заголовки, разрешенные
          cors, когда enableCORS истинно
        type: string
      corsAllowOrigin:
        description: corsAllowOrigin определяет источник, разрешенный
          cors, когда enableCORS истинно
        type: string
      description:
        type: string
      domain:
        type: string
      dsl:
        description: используется для поиска в интерфейсе UI
        type: string
      dslx:
        description: dslx определяет критерии соответствия
        items:
          properties:
            key:
              type: string
            type:
              type: string
            values:
              items:
                items:
                  type: string
                type: array
              type: array
          type: object
        type: array
      enableCORS:
        description: enableCORS является переключателем, разрешающим
          кросс-доменное взаимодействие, когда EnableCORS ложно, alb2
          передает информацию на серверы backend, которые определяют,
          разрешать ли кросс-домены
        type: boolean
      priority:
        description: приоритет варьируется от [1,10], если несколько правил
          совпадают, меньшая величина имеет приоритет
        type: integer
      rewrite_base:
        type: string
      rewrite_target:
        type: string
      serviceGroup:
        properties:
          services:
            items:
              properties:
                name:
                  type: string
                namespace:
                  type: string
                port:
                  type: integer
                weight:
                  type: integer
              type: object
            type: array
          session_affinity_attribute:
            type: string
          session_affinity_policy:
            type: string
        type: object
      source:
        description: source - это место, откуда пришел frontend или правило.
          Его тип может быть "binding" для тех, которые созданы для аннотаций сервиса.
          И переносит информацию о входе, когда правило обобщается через ingress
        properties:
          name:
            type: string
          namespace:
            type: string
          type:
            type: string
        type: object
      type:
        description: type устарело
        type: string
      url:
        type: string
      vhost:
        description: vhost позволяет пользователю переопределить заголовок Host запроса
        type: string
    type: object
```

## dslx

dslx — это язык специального назначения, который используется для описания критериев соответствия.

например, ниже правило совпадает с запросом, который удовлетворяет всем следующим критериям:

- url начинается с /app-a или /app-b
- метод — POST
- группа параметров url — vip
- хост — \*.app.com
- местоположение заголовков — east-1 или east-2
- имеется cookie с именем uid
- IP-адреса источника находятся в диапазоне 1.1.1.1-1.1.1.100

```yaml
  dslx:                                     
  - type: METHOD
    values:
    - - EQ
      - POST
  - type: URL
    values:
    - - STARTS_WITH
      - /app-a
    - - STARTS_WITH
      - /app-b
  - type: PARAM
    key: group
    values:
    - - EQ
      - vip
  - type: HOST 
    values:
    - - ENDS_WITH
      - .app.com
  - type: HEADER
    key: LOCATION 
    values:
    - - IN
      - east-1
      - east-2
  - type: COOKIE
    key: uid
    values:
    - - EXIST 
  - type: SRC_IP
    values:
    - - RANGE
      - "1.1.1.1"
      - "1.1.1.100"
```

## Конфигурация

На самом деле, правило `.spec.config` содержит больше полей.

- [Auth](../functions/auth.mdx)
- [Настройка ModSecurity](../how_to/modsecurity.mdx)
- [Otel](../functions/otel.mdx)
- [HTTP Redirect](../functions/redirect.mdx)
- [L4/L7 Timeout](../functions/timeout.mdx)
