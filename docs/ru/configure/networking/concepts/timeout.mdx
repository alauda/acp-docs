---
weight: 10
sourceSHA: dc8e1f0926136958b66c20d37f435007ff23650be66c6c2a99d6fc82887ef2c6
---

# L4/L7 Таймаут

## Основная концепция

Таймаут L4/L7 — это функция, предоставляемая ALB. Она используется для настройки времени таймаута для прокси L4/L7.

Таймаут реализуется с помощью Lua-скрипта, и Nginx **не требует перезагрузки**, когда он изменяется.

## CRD

```yaml
timeout:
  properties:
    proxy_connect_timeout_ms:
      type: integer
    proxy_read_timeout_ms:
      type: integer
    proxy_send_timeout_ms:
      type: integer
  type: object
```

Конфигурация может быть настроена на:

- Фронтенд: `.spec.config.timeout`
- Правило: `.spec.config.timeout`

## Что означает таймаут

Существует три типа таймаутов:

1. **proxy\_connect\_timeout\_ms**: Определяет таймаут для установления соединения с сервером верхнего уровня. Если соединение не может быть установлено в течение этого времени, запрос завершится неудачей.

2. **proxy\_read\_timeout\_ms**: Определяет таймаут для чтения ответа от сервера верхнего уровня. Таймаут устанавливается между двумя последовательными операциями чтения, а не для всего ответа. Если данные не получены в течение этого времени, соединение закрывается.

3. **proxy\_send\_timeout\_ms**: Определяет таймаут для отправки запроса на сервер верхнего уровня. Аналогично таймауту чтения, он устанавливается между двумя последовательными операциями записи. Если данные не могут быть отправлены в течение этого времени, соединение закрывается.

## Аннотация Ingress

| Аннотация                                        | Описание                                      |
| ------------------------------------------------- | ------------------------------------------------ |
| nginx.ingress.kubernetes.io/proxy-connect-timeout | Соответствует proxy\_connect\_timeout\_ms в CR |
| nginx.ingress.kubernetes.io/proxy-read-timeout    | Соответствует proxy\_read\_timeout\_ms в CR    |
| nginx.ingress.kubernetes.io/proxy-send-timeout    | Соответствует proxy\_send\_timeout\_ms в CR    |

## Таймаут на уровне порта

Вы можете настроить таймаут на порту напрямую, который используется как таймаут L4.
