---
weight: 20
title: Выбор среды выполнения контейнеров
sourceSHA: 570965044a6101c3ed19ff93d95453bbe504cdb9cfae0b0e9f8a32a03c977ba7
---

# Выбор среды выполнения контейнеров

## Обзор

Среда выполнения контейнеров является основным компонентом Kubernetes, отвечающим за управление жизненным циклом образов и контейнеров.

При создании кластеров через платформу вы можете выбрать либо Containerd, либо Docker в качестве вашего компонента выполнения.

**Примечание**: Версия Kubernetes 1.24 и выше больше не поддерживает среду выполнения Docker. Официально рекомендуемой средой выполнения является Containerd. Если вам все же необходимо использовать среду выполнения Docker, вы должны сначала активировать `cri-docker` в файле управления функциями, прежде чем вы сможете выбрать Docker в качестве компонента выполнения при создании кластера. Для получения дополнительных сведений об использовании файлов управления функциями см. [Конфигурация файлов управления функциями](/configure/feature_toggles.mdx#feature_toggles).

## Быстрый справочник по выбору

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>Выберите Containerd</th>
      <th style={{ whiteSpace: 'nowrap' }}>Выберите Docker</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        - Более короткая цепочка вызовов<br />
        - Меньше компонентов<br />
        - Более стабильный<br />
        - Потребляет меньше ресурсов узлов<br />
      </td>

      <td>
        - Поддерживает docker-in-docker<br />
        - Позволяет использовать команды `docker build/push/save/load` на узлах<br />
        - Может вызывать Docker API<br />
        - Поддерживает docker compose или docker swarm
      </td>
    </tr>
  </tbody>
</table>

## Отличия между Docker и Containerd

### Общие команды

| Containerd                   | Docker           | Описание                          |
| ---------------------------- | ---------------- | -------------------------------- |
| **crictl ps**                | docker ps        | Просмотр работающих контейнеров  |
| **crictl inspect**           | docker inspect   | Просмотр деталей контейнера      |
| **crictl logs**              | docker logs      | Просмотр логов контейнера        |
| **crictl exec**              | docker exec      | Выполнение команд в контейнере   |
| **crictl attach**            | docker attach    | Присоединение к контейнеру       |
| **crictl stats**             | docker stats     | Отображение использования ресурсов контейнера |
| **crictl create**            | docker create    | Создание контейнера              |
| **crictl start**             | docker start     | Запуск контейнера                |
| **crictl stop**              | docker stop      | Остановка контейнера             |
| **crictl rm**                | docker rm        | Удаление контейнера              |
| **crictl images**            | docker images    | Просмотр списка образов          |
| **crictl pull**              | docker pull      | Получение образа                 |
| **None**                     | docker push      | Отправка образа                 |
| **crictl rmi**               | docker rmi       | Удаление образа                  |
| **crictl pods**              | None             | Просмотр списка подов            |
| **crictl inspectp**          | None             | Просмотр деталей пода            |
| **crictl runp**              | None             | Запуск пода                      |
| **crictl stopp**             | docker images    | Просмотр образов                 |
| **ctr images ls**            | None             | Остановка пода                   |
| **crictl stopp**             | docker load/save | Импорт/экспорт образов          |
| **ctr images import/export** | None             | Остановка пода                   |
| **ctr images pull/push**     | docker pull/push | Получение/отправка образов      |
| **ctr images tag**           | docker tag       | Пометка образов                  |

### Отличия в цепочке вызовов

- Docker в качестве среды выполнения контейнеров Kubernetes имеет следующую цепочку вызовов:

  kubelet > cri-dockerd > dockerd > containerd > runC

- Containerd в качестве среды выполнения контейнеров Kubernetes имеет следующую цепочку вызовов:

  kubelet > cri plugin (в процессе containerd) > containerd > runC

**Итог**: Хотя dockerd добавляет такие функции, как кластер swarm, сборка Docker и API Docker, это может привести к ошибкам и добавляет дополнительный уровень в цепочке вызовов. Containerd имеет более короткую цепочку вызовов, меньше компонентов, большую стабильность и потребляет меньше ресурсов узлов.

### Сравнение логов и параметров

| Сравнение                           | Docker                                                                                                                                                                                                                                                                                       | Containerd                                                                                                                                                                                                                                           |
| ----------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Путь хранения**                  | Когда Docker используется в качестве среды выполнения контейнеров Kubernetes, логи контейнеров хранятся Docker в директориях, таких как `/var/lib/docker/containers/$CONTAINERID`. Kubelet создает символические ссылки в `/var/log/pods` и `/var/log/containers`, указывающие на файлы логов контейнеров в этой директории. | Когда Containerd используется в качестве среды выполнения контейнеров Kubernetes, логи контейнеров хранятся Kubelet в каталоге `/var/log/pods/$CONTAINER_NAME`, при этом создаются символические ссылки в каталоге `/var/log/containers`, указывающие на файлы логов.     |
| **Параметры конфигурации**          | Указаны в файле конфигурации Docker:<br />`"log-driver": "json-file",`<br />`"log-opts": {"max-size": "100m","max-file": "5"}`                                                                                                                                                          | *Метод 1*: Указаны в параметрах Kubelet:<br />`--container-log-max-files=5`<br />`--container-log-max-size="100Mi"`<br />*Метод 2*: Указаны в KubeletConfiguration:<br />`"containerLogMaxSize": "100Mi",`<br />`"containerLogMaxFiles": 5,`                         |
| **Сохранение логов контейнеров на диске** | Примонтируйте диск данных к "data-root" (по умолчанию `/var/lib/docker`).                                                                                                                                                                                                                   | Создайте символическую ссылку `/var/log/pods`, указывающую на каталог по точке монтирования диска данных.                                                                                                                                                        |

### Сравнение сетей CNI

| Сравнение               | Docker                                                                    | Containerd                                                                                                                        |
| ---------------------- | ------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| **Кто вызывает CNI**    | cri-dockerd                                                               | cri-plugin встроенный в Containerd (после контейнера 1.1)                                                                           |
| **Как настроить CNI**   | параметры cri-dockerd `--cni-conf-dir` `--cni-bin-dir` `--cni-cache-dir` | Файл конфигурации Containerd (toml):<br />`[plugins.cri.cni]`<br />`bin_dir = "/opt/cni/bin"`<br />`conf_dir = "/etc/cni/net.d"` |
