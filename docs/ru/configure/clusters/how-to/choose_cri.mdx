---
weight: 20
title: Выбор среды контейнеров
sourceSHA: 570965044a6101c3ed19ff93d95453bbe504cdb9cfae0b0e9f8a32a03c977ba7
---

# Выбор среды контейнеров

## Обзор

Среда контейнеров является основной компонентой Kubernetes, отвечающей за управление жизненным циклом образов и контейнеров.

При создании кластеров через платформу вы можете выбрать либо Containerd, либо Docker в качестве компонента среды выполнения.

**Примечание**: Начиная с версии Kubernetes 1.24, официальная поддержка среды выполнения Docker больше не осуществляется. Рекомендуемая среда выполнения — это Containerd. Если вы все еще хотите использовать среду выполнения Docker, вы сначала должны включить `cri-docker` в функции, прежде чем сможете выбрать Docker в качестве компонента среды выполнения при создании кластера. Для получения дополнительной информации о использовании функций смотрите в [Конфигурации функций](/configure/feature_toggles.mdx#feature_toggles).

## Быстрый справочник по выбору

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>Выбор Containerd</th>
      <th style={{ whiteSpace: 'nowrap' }}>Выбор Docker</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        - Более короткая цепочка вызовов<br />
        - Меньше компонентов<br />
        - Более стабильный<br />
        - Потребляет меньше ресурсов узла<br />
      </td>

      <td>
        - Поддерживает docker-in-docker<br />
        - Позволяет использовать команды `docker build/push/save/load` на узлах<br />
        - Может вызывать API Docker<br />
        - Поддерживает docker compose или docker swarm
      </td>
    </tr>
  </tbody>
</table>

## Отличия между Docker и Containerd

### Общие команды

| Containerd                   | Docker           | Описание                         |
| ---------------------------- | ---------------- | -------------------------------- |
| **crictl ps**                | docker ps        | Просмотреть работающие контейнеры |
| **crictl inspect**           | docker inspect   | Просмотреть детали контейнера    |
| **crictl logs**              | docker logs      | Просмотреть логи контейнера      |
| **crictl exec**              | docker exec      | Выполнить команды в контейнере   |
| **crictl attach**            | docker attach    | Присоединиться к контейнеру      |
| **crictl stats**             | docker stats     | Показать использование ресурсов контейнера |
| **crictl create**            | docker create    | Создать контейнер                |
| **crictl start**             | docker start     | Запустить контейнер              |
| **crictl stop**              | docker stop      | Остановить контейнер             |
| **crictl rm**                | docker rm        | Удалить контейнер                |
| **crictl images**            | docker images    | Просмотреть список образов       |
| **crictl pull**              | docker pull      | Загрузить образ                  |
| **None**                     | docker push      | Отправить образ                  |
| **crictl rmi**               | docker rmi       | Удалить образ                    |
| **crictl pods**              | None             | Просмотреть список подов         |
| **crictl inspectp**          | None             | Просмотреть детали пода          |
| **crictl runp**              | None             | Запустить под                    |
| **crictl stopp**             | docker images    | Просмотреть образы               |
| **ctr images ls**            | None             | Остановить под                   |
| **crictl stopp**             | docker load/save | Импортировать/экспортировать образы |
| **ctr images import/export** | None             | Остановить под                   |
| **ctr images pull/push**     | docker pull/push | Загрузить/отправить образы       |
| **ctr images tag**           | docker tag       | Пометить образы                  |

### Отличия в цепочке вызовов

- Docker в качестве среды выполнения контейнеров Kubernetes имеет следующую цепочку вызовов:

  kubelet > cri-dockerd > dockerd > containerd > runC

- Containerd в качестве среды выполнения контейнеров Kubernetes имеет следующую цепочку вызовов:

  kubelet > cri-плагин (в процессе containerd) > containerd > runC

**Резюме**: Несмотря на то, что dockerd добавляет такие функции, как кластер swarm, сборка docker и Docker API, это может ввести ошибки и добавляет дополнительный уровень в цепочку вызовов. Containerd имеет более короткую цепочку вызовов, меньше компонентов, большую стабильность и потребляет меньше ресурсов узла.

### Сравнение логов и параметров

| Сравнение                             | Docker                                                                                                                                                                                                                                                                                        | Containerd                                                                                                                                                                                                                                           |
| -------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Путь к хранилищу**                  | Когда Docker используется в качестве среды выполнения контейнеров Kubernetes, логи контейнеров хранятся Docker в каталогах, таких как `/var/lib/docker/containers/$CONTAINERID`. Kubelet создает символические ссылки в `/var/log/pods` и `/var/log/containers`, указывая на файлы журналов контейнеров в этом каталоге. | Когда Containerd используется в качестве среды выполнения контейнеров Kubernetes, логи контейнеров хранятся Kubelet в каталоге `/var/log/pods/$CONTAINER_NAME`, с символическими ссылками, созданными в каталоге `/var/log/containers`, указывающими на файлы журналов.     |
| **Параметры конфигурации**            | Указываются в конфигурационном файле Docker:<br />`"log-driver": "json-file",`<br />`"log-opts": {"max-size": "100m","max-file": "5"}`                                                                                                                                                         | *Метод 1*: Указываются в параметрах kubelet:<br />`--container-log-max-files=5`<br />`--container-log-max-size="100Mi"`<br />*Метод 2*: Указываются в KubeletConfiguration:<br />`"containerLogMaxSize": "100Mi",`<br />`"containerLogMaxFiles": 5,` |
| **Сохранение логов контейнеров на диске данных** | Смонтируйте диск данных на "data-root" (по умолчанию — `/var/lib/docker`).                                                                                                                                                                                                                              | Создайте символическую ссылку `/var/log/pods`, указывающую на каталог в точке монтирования диска данных.                                                                                                                                                      |

### Сравнение сети CNI

| Сравнение               | Docker                                                                    | Containerd                                                                                                                        |
| ------------------------ | ------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| **Кто вызывает CNI**     | cri-dockerd                                                               | Встроенный в Containerd cri-плагин (после containerd 1.1)                                                                           |
| **Как настроить CNI**   | параметры cri-dockerd `--cni-conf-dir` `--cni-bin-dir` `--cni-cache-dir` | Файл конфигурации Containerd (toml):<br />`[plugins.cri.cni]`<br />`bin_dir = "/opt/cni/bin"`<br />`conf_dir = "/etc/cni/net.d"` |
