---
weight: 40
sourceSHA: 6a5468022ccd2bc1a91439f91058e79c494019edce3c4b4d8446d27bfae5c830
---

# Использование снимков

Снимок виртуальной машины сохраняет текущее состояние виртуальной машины и может использоваться для восстановления виртуальной машины в это состояние в случае неожиданного сбоя.

## Предварительные условия

- **Снимок тома** был развернут администратором в управлении платформой.

- Снимки виртуальных машин основаны на снимках томов. Убедитесь, что по крайней мере один диск подключен к классу хранения, который поддерживает снимки томов, например, встроенному хранилищу CephFS.

- Поддерживаются только оффлайн-снимки виртуальной машины. Пожалуйста, сначала [остановите виртуальную машину](../../virtual_machine/functions/batch_actions.mdx), прежде чем создавать или откатываться к снимку.

## Примечания

Если в кластере есть несколько типов хранилищ одного типа, например, подключение нескольких различных источников хранилища Ceph RBD, функция создания снимков дисков может не работать должным образом, когда виртуальная машина использует такое хранилище.

## Создание снимка

Содержимое, включенное в снимок виртуальной машины: настройки виртуальной машины и состояние дисков, поддерживающих снимки томов.

### Процедуры

1. Перейдите в **Container Platform**.

2. В левой навигационной панели нажмите **Виртуализация** > **Виртуальные машины**.

3. Найдите виртуальную машину и нажмите ⋮ > **Создать снимок**.

4. Заполните описание снимка. Описание поможет вам задокументировать текущее состояние виртуальной машины, например, `Первоначальная установка`, `Перед обновлением приложения`.

5. Нажмите **Создать**. Время, необходимое для создания снимка, зависит от условий сети и нагрузки, пожалуйста, наберитесь терпения.

6. Проверьте статус снимка.

   - Когда статус снимка изменится на `Готово`, это указывает на успешное создание.

   - Если снимок долго остается в статусе `Не готово`, нажмите <span style={{ display: 'inline-flex', alignItems: 'center', gap: '4px', verticalAlign: 'middle' }}><img src="../../../../../en/virtualization/virtualization/backup_recovery/functions/assets/icon_overview.png" alt="expand" style={{ verticalAlign: 'middle' }} /> <span> > Просмотреть причины и устранить неполадки, затем создайте снимок заново.</span></span>

## Откат к снимку

Откатите настройки виртуальной машины и диски, поддерживающие снимки томов, к состоянию на момент создания снимка. Например, диски, добавленные после создания снимка, будут удалены; измененные данные на диске будут восстановлены.

### Примечания

Если есть диски, подключенные к классу хранения, который поддерживает механизм LVM (например, TopoLVM), пожалуйста, подтвердите с администратором, что политика рекламации для этого класса хранения установлена в **Сохранять** (`reclaimPolicy: Retain`), чтобы правильно использовать функцию отката снимка.

### Процедуры

1. Перейдите в **Container Platform**.

2. В левой навигационной панели нажмите **Виртуализация** > **Виртуальные машины**.

3. Нажмите на ***Имя виртуальной машины***.

4. На вкладке **Снимки** найдите снимок и нажмите ⋮ > **Откат**.

5. Прочитайте информацию на интерфейсе и нажмите **Откат**, подтвердив, что все правильно.

   **Примечание**: Операцию отката нельзя прервать или отменить, пожалуйста, действуйте осторожно.

6. Нажмите на имя снимка, чтобы проверить в «Записях отката снимка», был ли завершен откат. Время, необходимое для отката, зависит от условий сети и нагрузки, пожалуйста, наберитесь терпения.

**Описание**

- Если откат завершится неудачно, состояние виртуальной машины останется без изменений. Вы можете запустить виртуальную машину нормально или попытаться снова откатить снимок.

- Если виртуальная машина запущена во время процесса отката, она вернется к состоянию до ее остановки, и после повторной остановки виртуальной машины откат продолжится до состояния на момент создания снимка.

- Чтобы избежать конфликтов операций, пожалуйста, убедитесь, что последняя запись отката была завершена, прежде чем выполнять другие операции с этой виртуальной машиной.

## Удаление снимка

Удалите ненужные снимки виртуальных машин, чтобы освободить ресурсы диска.

### Примечания

При удалении откатного снимка виртуальной машины, если диску виртуальной машины необходимо скопировать данные на основе снимка (например, TopoLVM), вы должны дождаться запуска виртуальной машины, основанной на версии отката, перед удалением, в противном случае виртуальная машина не сможет запуститься.

### Процедуры

1. Перейдите в **Container Platform**.

2. В левой навигационной панели нажмите **Виртуализация** > **Виртуальные машины**.

3. Нажмите на ***Имя виртуальной машины***.

4. На вкладке **Снимки** найдите целевой снимок и нажмите ⋮ > **Удалить**.

5. Прочитайте информацию на экране и нажмите **Удалить**, подтвердив, что все правильно.
