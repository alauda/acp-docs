---
weight: 40
sourceSHA: 6a5468022ccd2bc1a91439f91058e79c494019edce3c4b4d8446d27bfae5c830
---

# Использование снимков

Снимок виртуальной машины сохраняет текущее состояние виртуальной машины и может использоваться для восстановления виртуальной машины в это состояние в случае неожиданного сбоя.

## Предварительные условия

- **Снимок тома** был развернут администратором в управлении платформой.

- Снимки виртуальных машин основаны на снимках томов. Убедитесь, что по крайней мере один диск связан с классом хранения, поддерживающим снимки томов, таким как встроенное хранилище CephFS.

- Поддерживаются только офлайн-снимки виртуальной машины. Пожалуйста, сначала [остановите виртуальную машину](../../virtual_machine/functions/batch_actions.mdx) перед созданием или откатом на снимок.

## Примечания

Если в кластере есть несколько типов хранилищ одного и того же рода, например, подключение нескольких различных источников хранилища Ceph RBD, функциональность снимков дисков может не работать должным образом, когда виртуальная машина использует такое хранилище.

## Создание снимка

Содержимое, включенное в снимок виртуальной машины: настройки виртуальной машины и состояние дисков, которые поддерживают снимки томов.

### Процедуры

1. Перейдите в **Контейнерную платформу**.

2. В левой боковой панели навигации нажмите **Виртуализация** > **Виртуальные машины**.

3. Найдите виртуальную машину и нажмите ⋮ > **Создать снимок**.

4. Заполните описание снимка. Описание может помочь вам задокументировать текущее состояние виртуальной машины, например, `Первоначальная установка`, `Перед обновлением приложения`.

5. Нажмите **Создать**. Время, затраченное на создание снимка, зависит от условий сети и загрузки, пожалуйста, наберитесь терпения.

6. Проверьте статус снимка.

   - Когда статус снимка изменится на `Готов`, это указывает на успешное создание.

   - Если снимок долго остается в статусе `Не готов`, нажмите <span style={{ display: 'inline-flex', alignItems: 'center', gap: '4px', verticalAlign: 'middle' }}><img src="../../../../../en/virtualization/virtualization/backup_recovery/functions/assets/icon_overview.png" alt="развернуть" style={{ verticalAlign: 'middle' }} /> <span> > Просмотрите причины и устраните неполадки, затем создайте снимок заново.</span></span>

## Откат снимка

Вернуть настройки виртуальной машины и диски, поддерживающие снимки томов, в состояние на момент создания снимка. Например, диски, добавленные после создания снимка, будут удалены; измененные данные диска будут восстановлены.

### Примечания

Если диски связаны с классом хранения, поддерживающим механизм LVM (например, TopoLVM), пожалуйста, подтвердите у администратора, что политика рекламации для этого класса хранения установлена на **Сохранить** (`reclaimPolicy: Retain`), чтобы правильно использовать функцию отката снимка.

### Процедуры

1. Перейдите в **Контейнерную платформу**.

2. В левой боковой панели навигации нажмите **Виртуализация** > **Виртуальные машины**.

3. Щелкните на ***Имя виртуальной машины***.

4. На вкладке **Снимки** найдите снимок и нажмите ⋮ > **Откат**.

5. Ознакомьтесь с информацией на экране, и нажмите **Откат**, после того как убедитесь, что все верно.

   **Примечание**: Операция отката не может быть прервана или отменена, пожалуйста, действуйте осторожно.

6. Щелкните на имя снимка, чтобы проверить в «Записях отката снимков», был ли завершен откат. Время, необходимое для отката, зависит от условий сети и загрузки, пожалуйста, наберитесь терпения.

**Описание**

- Если откат не удался, состояние виртуальной машины останется неизменным. Вы можете запустить виртуальную машину в обычном режиме или попытаться снова откатить снимок.

- Если виртуальная машина будет запущена во время процесса отката, она вернется в состояние до остановки, а после повторной остановки виртуальной машины она продолжит откат до состояния на момент создания снимка.

- Чтобы избежать конфликтов операций, пожалуйста, убедитесь, что последняя запись отката завершена перед выполнением других операций с этой виртуальной машиной.

## Удаление снимка

Удалите ненужные снимки виртуальной машины, чтобы освободить дисковые ресурсы.

### Примечания

При удалении откатанного снимка виртуальной машины, если диск виртуальной машины нуждается в копировании данных на основе снимка (например, TopoLVM), вы должны подождать, пока виртуальная машина на основе версии отката не будет запущена, прежде чем удалять, в противном случае виртуальная машина не сможет запуститься.

### Процедуры

1. Перейдите в **Контейнерную платформу**.

2. В левой боковой панели навигации нажмите **Виртуализация** > **Виртуальные машины**.

3. Щелкните на ***Имя виртуальной машины***.

4. На вкладке **Снимки** найдите целевой снимок и нажмите ⋮ > **Удалить**.

5. Ознакомьтесь с информацией на экране и нажмите **Удалить**, после того как убедитесь, что все верно.
