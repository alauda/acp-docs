---
weight: 40
sourceSHA: 326707fd138ca032ceab4f80a848be8f17660038ca716b212baea868eadbac91
---

# Восстановление виртуальной машины

В некоторых ситуациях, таких как неправильные изменения в fstab или ошибки файловой системы, требующие fsck, виртуальные машины могут не запускаться должным образом. В таких случаях вы можете использовать режим восстановления для ремонта корневой файловой системы (rootfs) или извлечения данных из системы.

## Шаги для выполнения операций

### Получить адрес изображения\{#getimage}

1. В левом навигационном меню нажмите **Управление виртуализацией** > **Изображения виртуальных машин**.

2. Выберите предоставленный платформой **Источник** как **Репозиторий изображений** и **Операционную систему** - либо **CentOS**, либо **Ubuntu**. Нажмите ⋮ > **Обновить** справа.

3. Скопируйте и сохраните **Адрес изображения**. Этот документ использует `192.168.1.1:11443/3rdparty/vmdisks/centos:7.9` в качестве примера.

4. Нажмите **Отмена**.

### Изменить файл YAML виртуальной машины\{#vmyaml}

1. Доступ к **Платформе контейнеров**.

2. В левом навигационном меню нажмите **Виртуализация** > **Виртуальные машины**.

3. Нажмите ⋮ > **Остановить** справа от виртуальной машины, которую нужно отремонтировать, чтобы **Остановить** или **Принудительно остановить** её.

4. Нажмите ⋮ > **Обновить** справа от виртуальной машины.

5. Переключитесь на **YAML** и измените следующие поля.

   - Добавьте следующий контент под `spec.template.spec.domain.devices.disks`. Добавление параметра bootOrder может контролировать, какой диск будет иметь приоритет во время процесса загрузки виртуальной машины; более низкое значение bootOrder указывает на более высокий приоритет.

     **Примечание**: Если исходное поле `spec.template.spec.domain.devices.disks` содержит `bootOrder: 1`, увеличьте оригинальное значение, чтобы гарантировать, что новое значение bootOrder меньше оригинального.

     ```
     disks:
       - bootOrder: 1
         disk:
           bus: virtio
         name: containerdisk
     ```

     Пример измененного YAML:

     ```
     domain:
       devices:
         disks:
           - bootOrder: 1  # Добавлено поле
             disk:
               bus: virtio
             name: containerdisk
           - disk:
               bus: virtio
             name: cloudinitdisk
           - disk:      # Увеличить оригинальное значение bootOrder: 1
               bus: virtio
             name: rootfs
             bootOrder: 10
           - disk:
               bus: virtio
             name: "1"
     ```

   - Добавьте следующий контент под `spec.template.spec.volumes`.

     **Примечание**: Пожалуйста, замените адрес изображения в следующем поле `image` на тот, который был получен из [Получить адрес изображения](#getimage).

     ```
     - containerDisk:
         image: 192.168.1.1:11443/3rdparty/vmdisks/centos:7.9
       name: containerdisk
     ```

     Пример измененного YAML:

     ```
     volumes:
       - containerDisk:  # Добавлено поле
           image: 192.168.1.1:11443/3rdparty/vmdisks/centos:7.9
         name: containerdisk
       - dataVolume:
           name: k2-rootfs
         name: rootfs
       - dataVolume:
           name: k2-1
         name: "1"
     ```

6. Нажмите **Обновить**.

   **Примечание**: После изменения файла YAML не переключайтесь на **Форму**, просто нажмите **Обновить**.

7. Нажмите ⋮ > **Запустить** справа от виртуальной машины.

### Подключить оригинальный rootfs и выполнить ремонт

1. Войдите в виртуальную машину, используя оригинальный пароль или ключ, и введите команду `df -h /`, чтобы узнать, что файловая система rootfs была заменена. Вы можете использовать команды, связанные с монтированием, для подключения её или команды fsck для проверки и ремонта оригинальной файловой системы.

2. После завершения выключите виртуальную машину.

### Восстановить файл YAML виртуальной машины

Следуйте шагам в [Изменить файл YAML виртуальной машины](#vmyaml), чтобы восстановить файл YAML виртуальной машины в его оригинальное состояние. На этом этапе виртуальная машина может запускаться нормально.
