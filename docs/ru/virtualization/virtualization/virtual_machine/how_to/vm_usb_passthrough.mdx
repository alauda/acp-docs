---
weight: 10
sourceSHA: 4e793a442b5a720e7f215057b1dec3ae9ed66a52416f2b7ec98f6050660b2573
---

# Настройка пропуска USB-устройств

## Обзор функции

Функция пропуска USB (Universal Serial Bus) позволяет вам получать доступ и управлять USB-устройствами из виртуальной машины.

## Сценарии использования

Некоторые приложения, работающие в виртуальных машинах (VM), имеют требования к шифрованию и требуют взаимодействия с специализированными USB-устройствами. В таких случаях необходимо пропустить USB-устройства с хост-машины на VM.

## Предварительные условия

- Версия платформы должна быть не ниже v3.18.

## Шаги

<Steps>
  ### Подключение USB-устройств

  Чтобы назначить USB-устройство виртуальной машине, USB-устройство должно быть подключено через **ResourceName**. Это можно настроить, отредактировав раздел `spec.permittedHostDevices.usbHostDevices` в **HyperConverged CR** в пространстве имен kubevirt.

  Ниже приведен пример конфигурации для USB-устройства с **ResourceName** kubevirt.io/storage, где производитель `0bda`, а продукт `8812`:

  ```yaml "
  spec:
    permittedHostDevices:
      usbHostDevices:
      - resourceName: kubevirt.io/storage
        selectors:
        - vendor: "0bda"
          product: "8812"
  ```

  <Directive type="info" title="Совет">
    Идентификаторы производителя и продукта USB-устройства можно получить с помощью команды `lsusb`.\
    Например:

    ```
    $ lsusb
    Bus 001 Device 007: ID 0bda:8812 Realtek Semiconductor Corp. RTL8812AU 802.11a/b/g/n/ac 2T2R DB WLAN Adapter
    ```

    Эта команда отображает все подключенные USB-устройства, где ID показывает пару производитель:продукт.
  </Directive>

  ### Назначение USB-устройств виртуальной машине

  Теперь в конфигурации VM вы можете добавить `spec.domain.devices.hostDevices.deviceName`, чтобы сделать ссылку на `ResourceName`, предоставленный на предыдущем шаге, и назначить ему локальное имя.\
  Например:

  ```yaml "
  spec:
    domain:
      devices:
        hostDevices:
        - deviceName: kubevirt.io/storage
          name: usb-storage
  ```

  <Directive type="info" title="Совет">
    Убедитесь, что VM остановлена, перед внесением изменений в конфигурацию.
  </Directive>
</Steps>

## Результат операции

После завершения конфигурации выполните команду `lsusb` внутри виртуальной машины. Если вывод содержит USB-устройство хост-узла, пропуск был успешным.\
Например:

```
$ lsusb
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 002: ID 0bda:8812 Realtek Semiconductor Corp. RTL8812AU 802.11a/b/g/n/ac 2T2R DB WLAN Adapter
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
```

## Узнать больше

Вы можете захотеть пропустить несколько USB-устройств в виртуальную машину, таких как клавиатура, мышь или смарт-карта. Мы поддерживаем назначение нескольких USB-устройств под одним resourceName. Вот как это настроить:

<Steps>
  ### Подключение нескольких USB-устройств

  ```yaml "
  spec:
    permittedHostDevices:
      usbHostDevices:
      - resourceName: kubevirt.io/peripherals
        selectors:
        - vendor: "0bda"
          product: "8812"
        - vendor: "062a"
          product: "4102"
        - vendor: "072f"
          product: "b100"
  ```

  <Directive type="info" title="Совет">
    Примечание: Все USB-устройства должны быть физически подключены и обнаружены на хосте, чтобы обеспечить их успешное назначение виртуальной машине.
  </Directive>

  ### Назначение USB-устройств виртуальной машине

  ```yaml "
  spec:
    domain:
      devices:
        hostDevices:
        - deviceName: kubevirt.io/peripherals
          name: local-peripherals
  ```
</Steps>
