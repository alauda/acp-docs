---
weight: 20
sourceSHA: 4efa91414c7b2efaa2a64e7f3d2d667f2228033d2ca9036600b36f225afe1b43
---

# Горячая миграция виртуальных машин

## Обзор

Технология горячей миграции виртуальных машин позволяет перемещать виртуальную машину с одного физического сервера на другой без отключения или прерывания работы виртуальной машины. Решение по виртуальным машинам на платформе основано на компоненте с открытым исходным кодом KubeVirt, который по умолчанию использует режим, называемый ProCopy, для горячей миграции.

### ProCopy

ProCopy (предварительная миграция памяти) — это широко используемая технология миграции виртуальных машин, которая обеспечивает непрерывность обслуживания во время миграции за счет предварительного копирования данных памяти виртуальной машины. Конкретный процесс выглядит следующим образом:

1. **Изначальная фаза**: В начале миграции исходный хост копирует страницы памяти виртуальной машины на целевой хост, пока виртуальная машина продолжает работать. Поскольку виртуальная машина продолжает работать, некоторые страницы памяти могут быть изменены в процессе копирования.
2. **Итеративное копирование**: Исходный хост многократно копирует измененные страницы памяти на целевой хост до тех пор, пока число измененных страниц не снизится до приемлемого уровня. Каждый раунд копирования называется итерацией, и количество неизмененных страниц памяти постепенно уменьшается после каждой итерации.
3. **Остановка и копирование**: Когда оставшихся не скопированных страниц памяти становится достаточно мало, виртуальная машина на некоторое время приостанавливается (обычно всего на несколько секунд до десятков секунд), в течение которого последние страницы памяти копируются на целевой хост, а состояния ЦП и устройств виртуальной машины синхронизируются с целевым хостом.
4. **Возобновление работы**: Виртуальная машина возобновляет работу на целевом хосте.

## Ограничения и ограничения

Рекомендуется, чтобы два физических компьютера, участвующие в операции горячей миграции, использовали одну и ту же аппаратную конфигурацию. Если конфигурации несовместимы (например, разные модели ЦП), миграция может завершиться неудачно.

## Предварительные условия

Пожалуйста, заранее включите соответствующие функции горячей миграции виртуальных машин.

## Этапы операции

### Развертывание kubevirt-оператора

**Примечание**: Для подробных шагов и объяснений параметров, пожалуйста, обратитесь к [Развертыванию оператора]().

1. Перейдите в **Управление платформой**.

2. В левой панели навигации нажмите **Управление приложениями** > **Операторы**.

3. Нажмите **Кластер** в верхней части страницы, чтобы переключиться на кластер, в котором необходимо развернуть Оператора.

4. На вкладке OperatorHub нажмите **Развернуть** на карточке **KubeVirt HyperConverged Cluster Operator**.

5. Настройте параметры по мере необходимости и нажмите **Развернуть**. Вы можете проверить статус развертывания Оператора на вкладке **Развернутый**.

### Создание HyperConverged-инстанса

Для конкретных шагов по созданию обратитесь к [Созданию HyperConverged-инстанса](../../installation.mdx#creating-a-hyperconverged-instance).

### Подготовка виртуальной машины

**Примечание**: Рекомендуется использовать сетевую конфигурацию Kube-OVN Underlay. Для связанных конфигураций, пожалуйста, обратитесь к [Созданию подсети (сеть Kube-OVN Underlay)](/configure/networking/functions/subnet_kubeovn_underlay.mdx).

1. Перейдите в **Платформу контейнеров**.

2. В левой навигационной панели нажмите **Виртуализация** > **Виртуальная машина**.

3. Нажмите **Создать виртуальную машину**.

4. Нажмите **Больше** в области **Основная информация**, чтобы развернуть дополнительные параметры конфигурации, и нажмите **Добавить** рядом с **Аннотациями**, добавив аннотации по приведенным ниже парам ключ-значение. Если сетевой плагин — Kube-OVN, вручную заполнять эту аннотацию не нужно.

   **Примечание**: Из-за ограничений форм сначала введите **значение** аннотации, а затем введите **ключ** аннотации.

   |           | Аннотация                                       |
   | --------- | ------------------------------------------------ |
   | **Значение** | true                                           |
   | **Ключ**   | kubevirt.io/allow-pod-bridge-network-live-migration |

5. Настройте другие параметры виртуальной машины по мере необходимости. Для конкретных описаний параметров, пожалуйста, обратитесь к соответствующей документации по продукту.

   | Параметр         | Описание                                             |
   | ----------------- | ---------------------------------------------------- |
   | **Режим хранения**   | Должен использоваться **Блочный режим**.             |
   | **Класс хранения** | Должен использоваться **класс хранения типа CephRBD**. |
   | **Сетевой режим**  | Рекомендуется использовать **Мост**.                 |

6. Нажмите **Создать**.

### Запуск горячей миграции

**Примечание**: Горячая миграция может быть запущена только при состоянии виртуальной машины **Работает**.

1. Перейдите в **Платформу контейнеров**.

2. В левой навигационной панели нажмите **Виртуализация** > **Виртуальная машина**.

3. Начните горячую миграцию. Это можно сделать двумя способами:
   - Нажмите ⋮ > **Горячая миграция** справа от виртуальной машины, которую необходимо мигрировать, в списке.
   - Нажмите на имя виртуальной машины, которую необходимо мигрировать, в списке, чтобы перейти на страницу с подробной информацией, затем нажмите **Действия** > **Горячая миграция**.

4. Нажмите **Подтвердить**. Вы можете проверить ход миграции через **Статус виртуальной машины** или **События в реальном времени**. Когда статус изменится с **Миграция** на **Работает**, или когда появится событие в реальном времени с информацией вроде **Мигрировано: Виртуальная машина была перемещена на узел 10.1.1.1.**, это указывает на успешную миграцию.
