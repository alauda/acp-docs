---
weight: 20
sourceSHA: 4efa91414c7b2efaa2a64e7f3d2d667f2228033d2ca9036600b36f225afe1b43
---

# Горячая миграция виртуальной машины

## Обзор

Технология горячей миграции виртуальной машины позволяет перемещать виртуальную машину с одного физического сервера на другой без его отключения или прерывания работы виртуальной машины. Решение по виртуальной машине на платформе реализовано на основе открытого компонента KubeVirt, который по умолчанию использует режим, называемый ProCopy, для горячей миграции.

### ProCopy

ProCopy (предварительная миграция памяти) является распространенной технологией миграции виртуальных машин, которая обеспечивает непрерывность сервиса во время миграции, предварительно копируя данные памяти виртуальной машины. Конкретный процесс выглядит следующим образом:

1. **Начальная фаза**: В начале миграции исходный хост будет копировать страницы памяти виртуальной машины на целевой хост, пока виртуальная машина продолжает работать. Поскольку виртуальная машина продолжает работать, некоторые страницы памяти могут изменяться в процессе копирования.
2. **Итеративное копирование**: Исходный хост многократно копирует измененные страницы памяти на целевой хост, пока количество измененных страниц не снизится до приемлемого уровня. Каждую итерацию копирования называют итерацией, и количество неизмененных страниц памяти постепенно уменьшается после каждой итерации.
3. **Остановка и копирование**: Когда оставшиеся нескопированные страницы памяти становяться достаточно малым, виртуальная машина на короткое время приостанавливается (обычно всего на несколько секунд до десятка секунд), в течение которого последние страницы памяти копируются на целевой хост, и состояния ЦПУ и устройств виртуальной машины синхронизируются с целевым хостом.
4. **Возобновление работы**: Виртуальная машина возобновляет работу на целевом хосте.

## Ограничения и ограничения

Рекомендуется, чтобы два физических компьютера, участвующие в операции горячей миграции, использовали одну и ту же аппаратную конфигурацию. Если конфигурации не совпадают (например, различные модели ЦП), миграция может завершиться неудачно.

## Предварительные условия

Пожалуйста, включите соответствующие функции горячей миграции виртуальных машин заранее.

## Шаги операции

### Развертывание kubevirt-оператора

**Примечание**: Для получения подробных шагов и объяснений параметров обратитесь к [Развертывание оператора]().

1. Перейдите в **Управление платформой**.

2. В левом боковом меню нажмите **Управление магазином приложений** > **Операторы**.

3. Нажмите **Кластер** в верхней части страницы, чтобы переключиться на кластер, в котором необходимо развернуть оператор.

4. Вкладке OperatorHub нажмите **Развернуть** на карточке **Оператор гиперконвергентного кластера KubeVirt**.

5. Настройте параметры по мере необходимости и нажмите **Развернуть**. Вы можете проверить статус развертывания оператора на вкладке **Развернуто**.

### Создание гиперконвергентного экземпляра

Для конкретных шагов создания обратитесь к [Создание гиперконвергентного экземпляра](../../installation.mdx#создание-гиперконвергентного-экземпляра).

### Подготовка виртуальной машины

**Примечание**: Рекомендуется использовать сеть Kube-OVN Underlay. Для связанных конфигураций смотрите [Создание подсети (Сеть Kube-OVN Underlay)](/configure/networking/functions/subnet_kubeovn_underlay.mdx).

1. Перейдите в **Контейнерную платформу**.

2. В левом боковом меню нажмите **Виртуализация** > **Виртуальная машина**.

3. Нажмите **Создать виртуальную машину**.

4. Нажмите **Больше** в области **Основная информация**, чтобы развернуть дополнительные параметры конфигурации, и нажмите **Добавить** напротив **Аннотации**, добавляя аннотации в соответствии с представленными ниже ключ-значение. Если сетевой плагин - Kube-OVN, заполнять эту аннотацию вручную не нужно.

   **Примечание**: Из-за ограничений формы введите сначала **значение** аннотации, а затем **ключ** аннотации.

   |           | Аннотация                                         |
   | --------- | -------------------------------------------------- |
   | **Значение** | true                                             |
   | **Ключ**   | kubevirt.io/allow-pod-bridge-network-live-migration |

5. Настройте другие параметры виртуальной машины по мере необходимости. Для конкретных описаний параметров обратитесь к соответствующей документации по продукту.

   | Параметр         | Описание                                           |
   | ----------------- | -------------------------------------------------- |
   | **Режим тома**   | Должен использоваться **Блочный режим**.         |
   | **Класс хранения** | Должен использоваться **класс хранилища типа блочного хранилища CephRBD**. |
   | **Сетевой режим**  | Рекомендуется использовать **Мост**.              |

6. Нажмите **Создать**.

### Запуск горячей миграции

**Примечание**: Горячая миграция может быть начата только тогда, когда статус виртуальной машины **Работает**.

1. Перейдите в **Контейнерную платформу**.

2. В левом боковом меню нажмите **Виртуализация** > **Виртуальная машина**.

3. Начните горячую миграцию. Существует два способа сделать это:
   - Нажмите ⋮ > **Горячая миграция** справа от виртуальной машины, которую необходимо переместить в списке.
   - Нажмите на имя виртуальной машины, которую необходимо переместить в списке, чтобы перейти на страницу информации о деталях, затем нажмите **Действия** > **Горячая миграция**.

4. Нажмите **Подтвердить**. Вы можете проверить процесс миграции через **Статус виртуальной машины** или **События в реальном времени**. Когда статус изменится с **Миграция** на **Работает** или когда появится событие в реальном времени с информацией вроде **Перемещено: Виртуальная машина переместилась на узел 10.1.1.1.**, это будет означать, что миграция была успешной.
