---
weight: 10
sourceSHA: 3dd3a91fa8da8f089b57eecc2b5c2f201dc05e9e101cf58bbfe74548686cce7f
---

# Создание виртуальных машин/Групп виртуальных машин

Создайте виртуальную машину (VirtualMachineInstance), используя образ, и назначьте виртуальную машину физическим узлам с установленными компонентами Kubevirt и включенной виртуализацией.

Вы можете создать одну виртуальную машину через [Создать виртуальную машину](#virtual), или вы можете быстро создать несколько виртуальных машин (VirtualMachineInstance) с одной и той же конфигурацией, используя [Создать группу виртуальных машин](#virtual_group) (virtualMachinePool).

## Предварительные условия

- Перед созданием виртуальной машины с использованием образа, пожалуйста, подтвердите следующее с администратором платформы:

  - Целевой кластер — это самодельный кластер, и компоненты Kubevirt были развернуты.

  - Целевой узел должен быть физическим узлом с включенной виртуализацией.

  - Образ виртуальной машины был добавлен на платформу.

- Если вам нужно использовать функцию пропуска GPU физического узла для виртуальной машины, пожалуйста, свяжитесь с администратором платформы для следующей конфигурации:

  1. Получите план подготовки окружения для пропуска GPU и подготовьте необходимую среду.

  2. Подготовьте необходимый физический GPU и включите связанные функции для пропуска физического GPU для виртуальной машины.

## Примечания

При использовании виртуальных машин Windows поддерживаются только входы через **имя пользователя/пароль**, установленные в образе виртуальной машины. Пожалуйста, свяжитесь с администратором платформы, чтобы заранее получить эту информацию.

## Создать виртуальную машину\{#virtual}

### Процедура

**Примечание**: Следующее содержание представляет собой пример создания виртуальной машины с использованием формы, и вы также можете переключиться на формат YAML для выполнения операции.

1. Перейдите в **Контейнерную платформу**.

2. В левой навигационной панели нажмите **Виртуализация** > **Виртуальные машины**.

3. Нажмите **Создать виртуальную машину**.

4. В области **Основная информация** заполните имя и отображаемое имя виртуальной машины и установите теги или аннотации.

   | Параметр       | Описание                                                                                                                                                    |
   | :-------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Теги**        | Используется для выбора объектов и поиска наборов объектов, соответствующих определенным критериям. Должен быть в виде пары ключ-значение, например: *app.kubernetes.io/name: hello-app*. |
   | **Аннотации** | Используются для предоставления любой информации командам разработки и эксплуатации. Должен быть в виде пары ключ-значение, например: *cpaas.io/maintainer: kim*.                        |

5. Установите тип машины и выберите образ виртуальной машины.

   | Параметр                | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   | :----------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Спецификации**       | Вы можете выбрать рекомендуемые сценарии использования или пользовательские лимиты ресурсов в зависимости от ваших потребностей.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   | **Физический GPU (Alpha)** | Выберите модель физического GPU; только один физический GPU может быть выделен каждой виртуальной машине. <br /><br />**Примечание**: Пропуск физического GPU для виртуальной машины относится к прямому выделению фактического графического процессора (GPU) виртуальной машине в среде виртуализации, позволяя ей напрямую получать доступ и использовать физический GPU для достижения графической производительности, эквивалентной работе на физическом компьютере, избегая узких мест производительности, вызванных виртуальными графическими адаптерами, и повышая общую производительность. |
   | **Образ**                | Выберите публичный образ, который был назначен администратором платформы проекту. <br />**Примечание**: Поддерживается только выбор образов с той же **архитектурой ЦП** что и архитектура кластера.                                                                                                                                                                                                                                                                                                                                                           |

6. В области **Хранилище** обратитесь к следующим инструкциям для настройки соответствующей информации.

   | Параметр          | Описание                                                                                                                                                                                                                                                                                                                                                                        |
   | :----------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Имя диска**      | Имя диска хранения; имя системного диска нельзя изменять.                                                                                                                                                                                                                                                                                                             |
   | **Тип**           | <ul><li>**Корневой диск**: Система автоматически создает диск корневой файловой системы типа VirtIO для хранения операционной системы и данных.</li><li>**Диск данных**: Нажмите, чтобы добавить несколько дисков данных для постоянного хранения данных. По умолчанию используется устройство VirtIO.</li></ul>**Примечание**: Имена дисков данных не должны дублировать существующие имена дисков.                                                        |
   | **Режим тома**    | <ul><li>**Файловая система**: Монтирует диск как смонтированный файловый каталог.</li><li>**Блочное устройство**: Монтирует диск как блочное устройство.</li></ul>                                                                                                                                                                                                                                         |
   | **Класс хранения**  | Платформа управляет дисками виртуальной машины, создавая и управляя запросами на постоянные объемы. Вам нужно указать класс хранения, необходимый для динамического создания запросов на постоянные объемы. <br />Разные классы хранения поддерживают разные режимы томов; если для выбранного режима тома нет доступного класса хранения, пожалуйста, обратитесь к администратору для добавления. |
   | **Емкость**       | Емкость, необходимая для хранения виртуальной машины; минимум для системного диска составляет 20 Г.                                                                                                                                                                                                                                                                                    |
   | **Удалить с ВМ** | По умолчанию включено, не может быть изменено, что означает, что данные диска также будут удалены, когда виртуальная машина будет удалена.                                                                                                                                                                                                                                                   |

7. В области **Сеть** обратитесь к следующим инструкциям для настройки соответствующей информации.

   | Параметр                  | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   | :------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **IP-адрес**             | <ul><li>По умолчанию **Динамический (DHCP)**; IP-адрес выделяется динамически при запуске виртуальной машины, и IP-адрес освобождается, когда виртуальная машина останавливается.</li><li>Если привязывается **Статический IP**, виртуальная машина всегда будет использовать этот IP-адрес даже после перезагрузки. Если в текущем проекте нет доступных IP-адресов, пожалуйста, сначала освобождайте IP-адрес соответствующим образом.</li></ul>                                                                                                                                 |
   | **Сетевой режим**           | <ul><li>**Мостовой**: Виртуальная машина делит тот же IP-адрес, что и группа контейнеров, и общается с внешним миром через этот IP-адрес.</li><li>**NAT**: Виртуальной машине будет назначен внутренний IP-адрес, но он будет переводиться в IP-адрес группы контейнеров для внешней связи. Открытые порты указывают на открытые порты виртуальной машины, такие как порт службы SSH 22; если не заполнить **Открытые порты**, это означает, что все порты открыты.</li></ul>                               |
   | **Дополнительная сетевая карта** | Добавьте дополнительные сетевые карты по мере необходимости. <br />**Примечание**:<ul><li>Если требуются функции дополнительных сетевых карт или нет доступных типов сетей дополнительных сетевых карт, пожалуйста, свяжитесь с администратором платформы для конфигурации.</li><li>Типы SR-IOV поддерживают только операционные системы Linux на архитектуре x86\_64.</li><li>По умолчанию получение IP-адресов через DHCP.<li>После нескольких перезагрузок виртуальные машины SR-IOV могут проявлять два разных VF с одним и тем же MAC-адресом.</li></li></ul> |

8. В области **Настройки инициализации** обратитесь к следующим инструкциям для настройки соответствующей информации.

   | Параметр             | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   | :-------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Ключи**              | Всегда используйте SSH-ключи для проверки удаленного входа. Этот метод не требует проверки пароля; рекомендуется входить в виртуальную машину с помощью ключей. <ul><li>Вы можете использовать ключи, уже доступные на платформе, или немедленно создать новые ключи; все соответствующие ключи можно просмотреть на странице **Виртуализация > Пары ключей**.</li><li>Только лица с закрытым ключом могут получить доступ к виртуальной машине через SSH. Если несколько человек должны совместно поддерживать виртуальную машину, можно связать несколько ключей, а закрытые ключи могут быть назначены различным пользователям. Если произошла утечка ключа, связанный ключ можно быстро отозвать, чтобы уменьшить ущерб.</li><li>Открытый ключ SSH-ключа хранится на платформе в конфиденциальной форме; платформа не хранит ваш закрытый ключ, поэтому, пожалуйста, сохраняйте его в безопасности самостоятельно.</li><li>Пожалуйста, обратитесь к соответствующей документации операционной системы для получения пароля пользователя root.</li></ul> |
   | **Пароль**          | Используйте имя пользователя и пароль операционной системы для проверки входа, который может быть обновлен на метод ключа позже. <ul><li>Пользователь является только первоначальной учетной записью; после успешного создания виртуальной машины вы также можете создать других пользователей операционной системы в виртуальной машине для входа.</li><li>Платформа шифрует и хранит ваш пароль пользователя root, и вы больше не увидите его открытый пароль, поэтому, пожалуйста, сохраняйте его в безопасности самостоятельно.</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   | **Запустить немедленно** | По умолчанию включено. Включение этой опции запустит виртуальную машину сразу после создания, в противном случае будет создана только виртуальная машина.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

9. (По желанию) В области **Расширенная конфигурация** обратитесь к следующим инструкциям для настройки соответствующей информации.

   | Параметр         | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Проверка работоспособности**  | <ul><li>**Проверка живучести**: Проверяет, находится ли виртуальная машина в рабочем состоянии; если результат проверки аномален, он определит, необходимо ли перезапустить экземпляр на основе конфигурации проверки состояния.</li><li>**Проверка доступности**: Проверяет, завершила ли виртуальная машина запуск и находится ли в нормальном рабочем состоянии; если статус здоровья экземпляра виртуальной машины определяется как аномальный, состояние виртуальной машины будет обновлено.</li></ul><br />Для связанных описаний параметров. |
   | **Аффинность узлов** | <ul><li>**Предпочтительный**: Виртуальная машина будет назначаться узлам, которые соответствуют требованиям аффинности, когда это возможно. Система определит узлы, способные запускать виртуальную машину, комбинируя веса аффинности и другие требования к планированию (например, требования к вычислительным ресурсам).</li><li>**Обязательный**: Виртуальная машина будет назначаться только узлам, которые полностью соответствуют требованиям аффинности.</li></ul>                                                                                         |

10. После подтверждения, что информация верна, нажмите **Создать**.

    Дождитесь изменения состояния виртуальной машины с **Создание** на **Работающая**.

### Связанные операции

Вы можете нажать значок ⋮ с правой стороны страницы списка или **Действия** в правом верхнем углу страницы деталей, чтобы обновить или удалить виртуальную машину по мере необходимости. Для других связанных операций, таких как сброс паролей или обновление ключей, пожалуйста, обратитесь к [Управление виртуальными машинами](./virtual_management.mdx).

**Примечание**:

- Обновления могут выполняться только при состоянии виртуальной машины **Аномально**, **Неизвестно** или **Остановлено**.

- Обновления не поддерживают отображение дисков, которые были отдельно присоединены или созданы после создания виртуальной машины.

- По умолчанию **Запустить немедленно** отключено во время обновлений; вы можете включить это по мере необходимости.

## Создать группу виртуальных машин\{#virtual\_group}

### Процедура

**Примечание**: Следующее содержание представляет собой пример создания группы виртуальных машин с использованием формы, и вы также можете переключиться на формат YAML для выполнения операции.

1. Перейдите в **Контейнерную платформу**.

2. В левой навигационной панели нажмите **Виртуализация** > **Группы виртуальных машин**.

3. Нажмите **Создать группу виртуальных машин**.

4. В области **Основная информация** обратитесь к следующим инструкциям для настройки информации для группы виртуальных машин.

   | Параметр                           | Описание                                                                                                                                                                                                                |
   | :---------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Количество экземпляров**             | Количество виртуальных машин, созданных группой виртуальных машин.                                                                                                                                                       |
   | **Анти-аффинность между экземплярами** | Если включено, при планировании нескольких виртуальных машин на узлы они попытаются распределить виртуальные машины по разным узлам, что может повысить высокую доступность группы виртуальных машин.             |
   | **Теги**                            | Теги могут быть добавлены к группе виртуальных машин. Теги могут использоваться для выбора объектов и поиска наборов объектов, соответствующих определенным критериям. Должен быть в виде пары ключ-значение, например: *app.kubernetes.io/name: hello-app*. |

5. В области **Шаблон виртуальной машины** обратитесь к [Создать виртуальную машину](#virtual), чтобы настроить единые теги, аннотации, спецификации, образы, хранилище и другую информацию для всех виртуальных машин в группе.

6. После подтверждения, что информация верна, нажмите **Создать**.

   **Совет**: После успешного создания вы можете перейти на страницу списка **Виртуальные машины**, чтобы просмотреть информацию о виртуальных машинах, созданных через группу виртуальных машин.
