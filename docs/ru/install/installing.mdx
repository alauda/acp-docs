---
weight: 30
sourceSHA: 5a3aa296bb5f5ce40091cc5d6d964aa1ca620bb78413c000638405e516ed0d1e
---

# Установка

В этом разделе описаны конкретные шаги для установки кластера `global`.

Перед началом установки убедитесь, что вы завершили проверку предварительных условий, загрузку и проверку установочного пакета, предварительную обработку узлов и другую подготовительную работу.

## Процесс

<Steps>
  ### Загрузка и извлечение установочного пакета

  Загрузите установочный пакет Core Package на любой узел управляющей плоскости кластера `global` и извлеките его с помощью следующей команды:

  ```shell
  # Предполагается, что папка /root/cpaas-install уже существует на машине
  tar -xvf {Path to Core Package File}/{Core Package File Name} -C /root/cpaas-install
  cd /root/cpaas-install/installer || exit 1
  ```

  <Directive type="info" title="INFO">
    - Эта машина станет первым узлом управляющей плоскости после завершения установки кластера `global`.
    - После извлечения Core Package требуется как минимум **100 ГБ** дискового пространства. Пожалуйста, убедитесь в наличии достаточных ресурсов хранения.
    - Если вы загрузили пакет расширений, пожалуйста, извлеките его и ознакомьтесь с документацией, включенной в пакет, перед тем как перейти к следующим шагам.
  </Directive>

  ### Запуск установщика

  Выполните следующий установочный скрипт, чтобы запустить установщик. После успешного запуска установщика терминал командной строки выведет адрес доступа к веб-консоли.

  Подождите около 5 минут, после чего вы сможете использовать браузер на своем ПК для доступа к веб-консоли, предоставленной установщиком.

  ```bash
  bash setup.sh
  ```

  <Directive type="warning" title="WARNING">
    Убедитесь, что IP-адрес и порт 8080 узла, на котором находится установщик, доступны, чтобы веб-консоль, предоставленная установщиком, могла быть доступна без проблем после успешного запуска установщика.
  </Directive>

  #### Сетевой режим и семейство IP

  ```bash
  bash setup.sh --network-mode calico
  ```

  Параметр `--network-mode` влияет на CNI кластера `global`, создаваемого установщиком. Если этот параметр не указан, CNI кластера `global` по умолчанию будет Kube-OVN. Если вы хотите использовать Calico в качестве CNI, вы должны явно указать `--network-mode calico`.

  ```bash
  bash setup.sh --ip-family ipv6
  ```

  Если вы планируете создать кластер `global` с одноуровневой сетью IPv6, вы должны явно указать `--ip-family ipv6` при запуске установщика. Без этого параметра кластер `global`, создаваемый установщиком, будет по умолчанию поддерживать одноуровневую сеть IPv4 и двухуровневую сеть.

  ### Конфигурация параметров

  После завершения конфигурации параметров установки в соответствии с руководством на странице подтвердите установку.

  [Описание параметров](#parameters) предоставляет подробные описания ключевых параметров. Пожалуйста, внимательно прочитайте и настройте в соответствии с реальными потребностями.

  ### Проверка успешной установки

  После завершения установки адрес доступа к платформе будет отображен на странице. Нажмите кнопку **Доступ**, чтобы перейти к веб-интерфейсу платформы.

  В представлении **Управление платформой** последовательно нажмите **Управление кластерами > Кластеры** и найдите кластер с именем `global`.

  Выберите `CLI Tools` из выпадающего меню справа и выполните следующую команду для проверки статуса установки:

  ```shell
  # Проверьте, есть ли неудачные Charts
  kubectl get apprelease --all-namespaces
  # Проверьте, есть ли неудачные Pods
  kubectl get pod --all-namespaces | awk '{if ($4 != "Running" && $4 != "Completed")print}' | awk -F'[/ ]+' '{if ($3 != $4)print}'
  ```

  ### Установка плагина документации продукта

  :::info
  Плагин **Документация продукта Alauda Container Platform** предоставляет доступ к документации продукта внутри платформы. Все ссылки помощи на платформе будут направлять пользователей к этой документации. Если этот плагин не установлен, нажатие на ссылки помощи в платформе приведет к ошибкам доступа 404.
  :::

  1. Перейдите в **Администратор**.

  2. В левом боковом меню нажмите **Marketplace** > **Плагины кластера** и выберите кластер `global`.

  3. Найдите плагин **Документация продукта Alauda Container Platform** и нажмите **Установить**.
</Steps>

## Описание параметров \{#parameters}

<table>
  <tr>
    <th style={{ whiteSpace: 'nowrap' }}>Параметр</th>
    <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
  </tr>

  <tr>
    <td><b>Версия Kubernetes</b></td>

    <td>
      Все опциональные версии тщательно протестированы на стабильность и совместимость.<br />
      <b>Рекомендация:</b> Выберите последнюю версию для оптимальных функций и поддержки.
    </td>
  </tr>

  <tr>
    <td><b>Протокол сети кластера</b></td>

    <td>
      Поддерживает три режима: одноуровневый IPv4, одноуровневый IPv6, двухуровневый IPv4/IPv6.<br />
      <b>Примечание:</b> Если вы выберете режим двухуровневой сети, убедитесь, что все узлы имеют правильно настроенные IPv6-адреса; протокол сети не может быть изменен после настройки.
    </td>
  </tr>

  <tr>
    <td><b>Адрес кластера</b></td>

    <td>
      <ul>
        Введите заранее подготовленное доменное имя. Если доменное имя недоступно, введите заранее подготовленный <code>`global` VIP</code>.<br />
        <code>Self-Built VIP</code> по умолчанию отключен, включайте его только если вы не предоставили LoadBalancer. После включения установщик автоматически развернет <code>keepalived</code> для обеспечения поддержки программного балансировки нагрузки.<br />
        <b>Примечание:</b> При использовании <code>Self-Built VIP</code> должны быть выполнены следующие условия,<br />

        - Доступен используемый VRID;<br />
        - Сетевая инфраструктура хоста поддерживает протокол VRRP;<br />
        - Все узлы управляющей плоскости и VIP должны находиться в одной подсети.<br />
      </ul>

      <ul>
        <b>Совет:</b> Для развертывания на одном узле в сценариях опытного использования вы можете напрямую ввести IP узла. Нет необходимости включать <code>Self-Built VIP</code> или подготавливать сетевые ресурсы, такие как <code>`global` VIP</code>.
      </ul>
    </td>
  </tr>

  <tr>
    <td><b>Адрес доступа к платформе</b></td>

    <td>
      <ul>
        Если вам не нужно различать <b>Адрес кластера</b> и <b>Адрес доступа к платформе</b>, введите тот же адрес, что и <b>Адрес кластера</b>.<br />
        Если вам нужно различать, например, если кластер `global` предназначен только для доступа к внутренней сети, а платформа должна предоставлять доступ к внешней сети, введите заранее подготовленное доменное имя или <code>Внешний IP</code>.<br />
        Платформа использует доступ по HTTPS по умолчанию и не включает HTTP. Если вам нужно включить доступ по HTTP, включите его в <b>Расширенных настройках</b> (не рекомендуется).<br />
        <b>Примечание:</b> Доменное имя должно быть введено в следующих случаях,<br />

        - Запланирован план восстановления для кластера `global`;<br />
        - Платформа должна поддерживать доступ по IPv6.<br />
      </ul>

      <ul>
        <b>Совет:</b> Если вам нужно настроить больше адресов доступа к платформе, вы можете добавить их в <b>Другие настройки > Другие адреса доступа к платформе</b> на следующем шаге. Или, после установки, добавьте их в управление платформой в соответствии с руководством пользователя.<br />
      </ul>
    </td>
  </tr>

  <tr>
    <td><b>Сертификат</b></td>

    <td>
      Платформа предоставляет самоподписанные сертификаты для поддержки доступа по HTTPS по умолчанию.<br />
      Если вам нужно использовать пользовательский сертификат, вы можете загрузить существующий сертификат.
    </td>
  </tr>

  <tr>
    <td><b>Репозиторий образов</b></td>

    <td>
      По умолчанию используется репозиторий образов <code>Platform Deployment</code>, который содержит образы всех компонентов.<br />
      Если вам нужно использовать <code>Внешний</code> репозиторий образов, пожалуйста, свяжитесь с технической поддержкой, чтобы получить план синхронизации образов перед настройкой.
    </td>
  </tr>

  <tr>
    <td><b>Сетевая инфраструктура контейнеров</b></td>

    <td>
      Подсеть и сегмент сети службы кластера не могут пересекаться.<br />
      При использовании сети Kube-OVN Overlay убедитесь, что сетевая инфраструктура контейнеров и хоста не находятся в одном сетевом сегменте, иначе это может вызвать сетевые исключения.
    </td>
  </tr>

  <tr>
    <td><b>Имя узла</b></td>

    <td>
      Если вы выберете <code>Имя хоста в качестве имени узла</code>, убедитесь, что имена хостов всех узлов уникальны.
    </td>
  </tr>

  <tr>
    <td><b>Изоляция узлов платформы кластера `global`</b></td>

    <td>
      Включайте только если планируете запускать рабочие нагрузки приложений в кластере `global`.<br />
      <b>После включения:</b><br />

      - Узлы могут быть установлены в режим <code>Эксклюзивно для платформы</code>, т.е. запускать только компоненты платформы, обеспечивая изоляцию платформы и рабочих нагрузок приложений;<br />
      - Рабочие нагрузки типа DaemonSet исключаются.
    </td>
  </tr>

  <tr>
    <td><b>Добавить узел</b></td>

    <td>
      <b>Узел управляющей плоскости:</b>

      <ul>
        - Поддерживает добавление 1 или 3 узлов управляющей плоскости (3 для конфигурации высокой доступности);<br />
        - Если <code>Эксклюзивно для платформы</code> включено, <code>Разворачиваемые приложения</code> принудительно отключаются, и узлы управляющей плоскости запускают только компоненты платформы;<br />
        - Если <code>Эксклюзивно для платформы</code> отключено, вы можете выбрать, включать ли <code>Разворачиваемые приложения</code>, позволяя узлам управляющей плоскости запускать рабочие нагрузки приложений.<br />
      </ul>

      <b>Рабочий узел:</b>

      <ul>
        - Если <code>Эксклюзивно для платформы</code> включено, <code>Разворачиваемые приложения</code> принудительно отключаются;<br />
        - Если <code>Эксклюзивно для платформы</code> отключено, <code>Разворачиваемые приложения</code> принудительно включаются.<br />
      </ul>

      <p>При использовании Kube-OVN вы можете указать сетевой интерфейс узла, введя имя шлюза.</p>
      <p>Если проверка доступности узла не удалась, пожалуйста, скорректируйте это в соответствии с подсказкой на странице и добавьте снова.</p>
    </td>
  </tr>
</table>

## Очистка установщика

Обычно установщик будет автоматически удален после установки. Если установщик не был автоматически удален через 30 минут после установки, выполните следующую команду на узле, где находится установщик, чтобы принудительно удалить контейнер установщика:

```bash
docker rm -f minialauda-control-plane
```
