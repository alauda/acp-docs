---
weight: 30
sourceSHA: 63c66cd80b176e105f039024bd3a95da7ae98600ac407df0ea161015f75f526c
---

# Установка

В этом разделе описаны конкретные шаги для установки кластера `global`.

Перед началом установки убедитесь, что вы завершили предварительные проверки, загрузку и проверку установочного пакета, предварительную обработку узлов и другую подготовительную работу.

## Процесс

<Steps>
  ### Загрузка и извлечение установочного пакета

  Загрузите установочный пакет Core Package на любой узел управляющей плоскости кластера `global` и извлеките его с помощью следующей команды:

  ```shell
  # Предполагаем, что папка /root/cpaas-install уже существует на машине
  tar -xvf {Path to Core Package File}/{Core Package File Name} -C /root/cpaas-install
  cd /root/cpaas-install/installer || exit 1
  ```

  <Directive type="info" title="INFO">
    - Эта машина станет узлом первой управляющей плоскости после завершения установки кластера `global`.
    - После извлечения Core Package требуется как минимум **100 ГБ** дискового пространства. Пожалуйста, убедитесь, что ресурсы для хранения достаточны.
    - Если вы загрузили пакет расширений, извлеките его и ознакомьтесь с документацией, включенной в пакет, перед переходом к следующему этапу.
  </Directive>

  ### Запуск установщика

  Выполните следующий установочный скрипт, чтобы запустить установщик. После успешного запуска установщика командная строка выведет адрес доступа к веб-консоли.

  Подождите около 5 минут, а затем вы можете использовать браузер на своем ПК для доступа к веб-консоли, предоставленной установщиком.

  ```bash
  bash setup.sh
  ```

  <Directive type="warning" title="WARNING">
    Убедитесь, что IP-адрес и порт 8080 узла, на котором расположен установщик, доступны. Это обеспечит нормальный доступ к веб-консоли, предоставленной установщиком, после успешного его запуска.
  </Directive>

  #### Режим сети и семейство IP

  ```bash
  bash setup.sh --network-mode calico
  ```

  Параметр `--network-mode` влияет на CNI кластера `global`, создаваемого установщиком. Если этот параметр не задан, CNI кластера `global` будет по умолчанию Kube-OVN. Если вы хотите использовать Calico в качестве CNI, вы должны явно указать `--network-mode calico`.

  ```bash
  bash setup.sh --ip-family ipv6
  ```

  Если вы планируете создать кластер `global` с одним стеком сети IPv6, вы должны явно указать `--ip-family ipv6`, когда запускаете установщик. Без этого параметра кластер `global`, созданный установщиком, будет поддерживать стек сети IPv4 и двойной стек сети по умолчанию.

  ### Конфигурация параметров

  После завершения конфигурации параметров установки в соответствии с руководством на странице подтвердите установку.

  [Описание параметров](#parameters) предоставляет подробные описания ключевых параметров. Пожалуйста, прочитайте внимательно и выполните настройку в соответствии с фактическими потребностями.

  ### Подтверждение успешной установки

  После завершения установки адрес доступа к платформе будет отображен на странице. Нажмите кнопку **Доступ** для перехода к веб-интерфейсу платформы.

  На просмотре **Управление платформой** последовательно нажмите **Управление кластером > Кластеры** и найдите кластер с именем `global`.

  Выберите `CLI Tools` из выпадающего меню справа и выполните следующую команду, чтобы проверить состояние установки:

  ```shell
  # Проверьте, есть ли неудачные Charts
  kubectl get apprelease --all-namespaces
  # Проверьте, есть ли неудачные Pods
  kubectl get pod --all-namespaces | awk '{if ($4 != "Running" && $4 != "Completed")print}' | awk -F'[/ ]+' '{if ($3 != $4)print}'
  ```
</Steps>

## Описание параметров \{#parameters}

<table>
  <tr>
    <th style={{ whiteSpace: 'nowrap' }}>Параметр</th>
    <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
  </tr>

  <tr>
    <td><b>Версия Kubernetes</b></td>

    <td>
      Все опциональные версии тщательно протестированы на стабильность и совместимость.<br />
      <b>Рекомендуем:</b> Выберите последнюю версию для оптимальных функций и поддержки.
    </td>
  </tr>

  <tr>
    <td><b>Протокол сетевой кластера</b></td>

    <td>
      Поддерживает три режима: одиночный стек IPv4, одиночный стек IPv6, двойной стек IPv4/IPv6.<br />
      <b>Примечание:</b> Если вы выберете режим двойного стека, убедитесь, что все узлы имеют правильно настроенные IPv6-адреса; сетевой протокол нельзя изменить после настройки.
    </td>
  </tr>

  <tr>
    <td><b>Адрес кластера</b></td>

    <td>
      <ul>
        Введите заранее подготовленное доменное имя. Если доменное имя недоступно, введите заранее подготовленный <code>`global` VIP</code>.<br />
        <code>Self-Built VIP</code> по умолчанию отключено, включайте его только если вы не предоставили LoadBalancer. После включения установщик автоматически развернет <code>keepalived</code> для поддержки программного балансировки нагрузки.<br />
        <b>Примечание:</b> При использовании <code>Self-Built VIP</code> должны быть выполнены следующие условия,<br />

        - Доступен используемый VRID;<br />
        - Сетевая инфраструктура поддерживает протокол VRRP;<br />
        - Все узлы управляющей плоскости и VIP должны находиться в одной подсети.<br />
      </ul>

      <ul>
        <b>Совет:</b> Для одноузловых развертываний в сценариях опытов с функциями, вы можете напрямую ввести IP узла. Нет необходимости включать <code>Self-Built VIP</code> или подготавливать сетевые ресурсы, такие как <code>`global` VIP</code>.
      </ul>
    </td>
  </tr>

  <tr>
    <td><b>Адрес доступа к платформе</b></td>

    <td>
      <ul>
        Если вам не нужно различать <b>Адрес кластера</b> и <b>Адрес доступа к платформе</b>, введите тот же адрес, что и <b>Адрес кластера</b>.<br />
        Если вам нужно различать, например, если кластер `global` предназначен только для доступа к внутренней сети, а платформа должна предоставить доступ к внешней сети, введите заранее подготовленное доменное имя или <code>Внешний IP</code>.<br />
        Платформа по умолчанию использует доступ по HTTPS и не включает HTTP. Если вам нужно включить доступ по HTTP, активируйте его в <b>Расширенных настройках</b> (не рекомендуется).<br />
        <b>Примечание:</b> Доменное имя должно быть введено в следующих случаях,<br />

        - Запланирован план восстановления после катастрофы для кластера `global`;<br />
        - Платформе необходимо поддерживать доступ по IPv6.<br />
      </ul>

      <ul>
        <b>Совет:</b> Если вам нужно настроить больше адресов доступа к платформе, вы можете добавить их в <b>Другие настройки > Другие адреса доступа к платформе</b> на следующем этапе. Или, после установки, добавьте их в управлении платформой в соответствии с пользовательским руководством.<br />
      </ul>
    </td>
  </tr>

  <tr>
    <td><b>Сертификат</b></td>

    <td>
      Платформа предоставляет самоподписанные сертификаты для поддержки доступа по HTTPS по умолчанию.<br />
      Если вы хотите использовать пользовательский сертификат, вы можете загрузить уже существующий сертификат.
    </td>
  </tr>

  <tr>
    <td><b>Репозиторий изображений</b></td>

    <td>
      Репозиторий изображений <code>Platform Deployment</code> используется по умолчанию, который содержит изображения всех компонентов.<br />
      Если вам нужно использовать <code>Внешний</code> репозиторий изображений, пожалуйста, обратитесь в техническую поддержку, чтобы получить план синхронизации изображений перед настройкой.
    </td>
  </tr>

  <tr>
    <td><b>Сетевая инфраструктура контейнеров</b></td>

    <td>
      Подсеть и сегмент сети службы кластера не могут перекрываться.<br />
      При использовании сети Kube-OVN убедитесь, что сеть контейнеров и сеть хоста не находятся в одном и том же сетевом сегменте, иначе это может вызвать сетевые исключения.
    </td>
  </tr>

  <tr>
    <td><b>Имя узла</b></td>

    <td>
      Если вы выбрали <code>Имя хоста в качестве имени узла</code>, убедитесь, что имена хостов всех узлов уникальны.
    </td>
  </tr>

  <tr>
    <td><b>Изоляция узлов платформы кластера `global`</b></td>

    <td>
      Включайте только если вы планируете выполнять рабочие нагрузки приложений в кластере `global`.<br />
      <b>После включения:</b><br />

      - Узлы могут быть установлены как <code>Эксклюзивно для платформы</code>, т.е. запускать только компоненты платформы, гарантируя, что рабочие нагрузки платформы и приложений изолированы;<br />
      - Рабочие нагрузки типа DaemonSet исключаются.
    </td>
  </tr>

  <tr>
    <td><b>Добавить узел</b></td>

    <td>
      <b>Узел управляющей плоскости:</b>

      <ul>
        - Поддерживает добавление 1 или 3 узлов управляющей плоскости (3 для конфигурации с высокой доступностью);<br />
        - Если <code>Эксклюзивно для платформы</code> включено, <code>Приложения, подлежащие развертыванию</code>, принудительно отключаются, и узлы управляющей плоскости запускают только компоненты платформы;<br />
        - Если <code>Эксклюзивно для платформы</code> отключено, вы можете выбрать, включать ли <code>Приложения, подлежащие развертыванию</code>, позволяя узлам управляющей плоскости запускать рабочие нагрузки приложений.<br />
      </ul>

      <b>Рабочий узел:</b>

      <ul>
        - Если <code>Эксклюзивно для платформы</code> включено, <code>Приложения, подлежащие развертыванию</code>, принудительно отключаются;<br />
        - Если <code>Эксклюзивно для платформы</code> отключено, <code>Приложения, подлежащие развертыванию</code>, принудительно включаются.<br />
      </ul>

      <p>При использовании Kube-OVN вы можете указать сетевую карту узла, введя имя шлюза.</p>
      <p>Если проверка доступности узла не удалась, пожалуйста, скорректируйте ее в соответствии с подсказкой на странице и добавьте снова.</p>
    </td>
  </tr>
</table>

## Очистка установщика

Обычно установщик будет автоматически удален после установки. Если установщик не был автоматически удален через 30 минут после установки, выполните следующую команду на узле, где расположен установщик, чтобы принудительно удалить контейнер установщика:

```bash
docker rm -f minialauda-control-plane
```
