---
weight: 30
sourceSHA: 63c66cd80b176e105f039024bd3a95da7ae98600ac407df0ea161015f75f526c
---

# Установка

В этом разделе описаны конкретные шаги по установке кластера `global`.

Перед началом установки убедитесь, что вы завершили предварительные проверки, загрузку и проверку установочного пакета, предварительную обработку узлов и другие подготовительные работы.

## Процесс

<Steps>
  ### Загрузка и извлечение установочного пакета

  Загрузите установочный пакет Core Package на любой узел управляющей плоскости кластера `global` и извлеките его по следующей команде:

  ```shell
  # Предполагается, что папка /root/cpaas-install уже существует на машине
  tar -xvf {Path to Core Package File}/{Core Package File Name} -C /root/cpaas-install
  cd /root/cpaas-install/installer || exit 1
  ```

  <Directive type="info" title="INFO">
    - Эта машина станет первым узлом управляющей плоскости после завершения установки кластера `global`.
    - После извлечения Core Package потребуется как минимум **100 ГБ** свободного места на диске. Пожалуйста, убедитесь в наличии достаточных ресурсов для хранения.
    - Если вы загрузили пакет Extensions Package, пожалуйста, извлеките его и ознакомьтесь с документацией, содержащейся в пакете, прежде чем переходить к следующими шагам.
  </Directive>

  ### Запуск установщика

  Выполните следующий скрипт установки, чтобы запустить установщик. После успешного запуска установщика терминал командной строки выдаст адрес доступа к веб-консоли.

  После ожидания около 5 минут вы сможете использовать браузер на своем ПК для доступа к веб-консоли, предоставляемой установщиком.

  ```bash
  bash setup.sh
  ```

  <Directive type="warning" title="WARNING">
    Убедитесь, что IP-адрес и порт 8080 узла, на котором находится установщик, доступны нормально, чтобы веб-консоль, предоставляемая установщиком, могла быть успешно доступна после успешного запуска установщика.
  </Directive>

  #### Сетевой режим и семейство IP

  ```bash
  bash setup.sh --network-mode calico
  ```

  Параметр `--network-mode` влияет на CNI кластера `global`, создаваемого установщиком. Если этот параметр не указан, CNI кластера `global` по умолчанию будет Kube-OVN. Если вы хотите использовать Calico в качестве CNI, вы должны явно указать `--network-mode calico`.

  ```bash
  bash setup.sh --ip-family ipv6
  ```

  Если вы планируете создать кластер `global` с одиночной стековой сетью IPv6, вы должны явно указать `--ip-family ipv6` при запуске установщика. Без этого параметра кластер `global`, создаваемый установщиком, будет по умолчанию поддерживать одиночную стековую сеть IPv4 и двойную стековую сеть.

  ### Конфигурация параметров

  После завершения конфигурации параметров установки согласно указаниям на странице, подтвердите установку.

  [Описание параметров](#parameters) предоставляет подробные описания ключевых параметров. Пожалуйста, внимательно прочитайте и настройте в соответствии с реальными потребностями.

  ### Подтверждение успешной установки

  После завершения установки адрес доступа к платформе будет отображен на странице. Нажмите кнопку **Доступ** для перехода к интерфейсу веб-платформы.

  В представлении **Управление платформой** последовательно нажмите **Управление кластером > Кластеры** и найдите кластер с именем `global`.

  Выберите `CLI Tools` из выпадающего меню справа и выполните следующую команду, чтобы проверить статус установки:

  ```shell
  # Проверьте, есть ли неудачные Charts
  kubectl get apprelease --all-namespaces
  # Проверьте, есть ли неудачные Pods
  kubectl get pod --all-namespaces | awk '{if ($4 != "Running" && $4 != "Completed")print}' | awk -F'[/ ]+' '{if ($3 != $4)print}'
  ```
</Steps>

## Описание параметров \{#parameters}

<table>
  <tr>
    <th style={{ whiteSpace: 'nowrap' }}>Параметр</th>
    <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
  </tr>

  <tr>
    <td><b>Версия Kubernetes</b></td>

    <td>
      Все опциональные версии тщательно тестируются на стабильность и совместимость.<br />
      <b>Рекомендация:</b> Выбирайте последнюю версию для достижения оптимальных функций и поддержки.
    </td>
  </tr>

  <tr>
    <td><b>Протокол сетевого кластера</b></td>

    <td>
      Поддерживаются три режима: одиночный стек IPv4, одиночный стек IPv6, двойной стек IPv4/IPv6.<br />
      <b>Примечание:</b> Если вы выбираете режим двойного стека, убедитесь, что все узлы имеют правильно настроенные адреса IPv6; протокол сети не может быть изменен после установки.
    </td>
  </tr>

  <tr>
    <td><b>Адрес кластера</b></td>

    <td>
      <ul>
        Введите заранее подготовленное доменное имя. Если доменное имя недоступно, введите заранее подготовленный <code>`global` VIP</code>.<br />
        <code>VIP собственного построения</code> по умолчанию отключен, включите его только в том случае, если вы не предоставили LoadBalancer. После активации установщик автоматически развернет <code>keepalived</code> для предоставления поддержки программного балансировки нагрузки.<br />
        <b>Примечание:</b> При использовании <code>VIP собственного построения</code> должны быть выполнены следующие условия,<br />

        - Доступен используемый VRID;<br />
        - Сетевая служба хоста поддерживает протокол VRRP;<br />
        - Все узлы управляющей плоскости и VIP должны находиться в одной подсети.<br />
      </ul>

      <ul>
        <b>Совет:</b> Для развертывания на одном узле в сценариях запуска функций вы можете напрямую ввести IP-адрес узла. Не нужно включать <code>VIP собственного построения</code> или готовить сетевые ресурсы, такие как <code>`global` VIP</code>.
      </ul>
    </td>
  </tr>

  <tr>
    <td><b>Адрес доступа к платформе</b></td>

    <td>
      <ul>
        Если вам не нужно различать <b>Адрес кластера</b> и <b>Адрес доступа к платформе</b>, введите тот же адрес, что и <b>Адрес кластера</b>.<br />
        Если вам нужно различать, например, кластер `global` предназначен только для доступа из внутренней сети, а платформе необходимо предоставить доступ из внешней сети, введите заранее подготовленное доменное имя или <code>Внешний IP</code>.<br />
        Платформа использует доступ по HTTPS по умолчанию и не включает HTTP. Если вы хотите включить доступ по HTTP, включите его в <b>Дополнительные параметры</b> (не рекомендуется).<br />
        <b>Примечание:</b> Доменное имя должно быть введено в следующих случаях,<br />

        - Запланирован план восстановления для кластера `global`;<br />
        - Платформа должна поддерживать доступ по IPv6.<br />
      </ul>

      <ul>
        <b>Совет:</b> Если вам нужно настроить больше адресов доступа к платформе, вы можете добавить их в <b>Другие настройки > Другие адреса доступа к платформе</b> на следующем шаге. Или, после установки, добавьте их в управлении платформой согласно пользовательскому руководству.<br />
      </ul>
    </td>
  </tr>

  <tr>
    <td><b>Сертификат</b></td>

    <td>
      Платформа по умолчанию предоставляет самоподписанные сертификаты для поддержки доступа по HTTPS.<br />
      Если вам нужно использовать собственный сертификат, вы можете загрузить существующий сертификат.
    </td>
  </tr>

  <tr>
    <td><b>Репозиторий изображений</b></td>

    <td>
      По умолчанию используется репозиторий изображений <code>Платформенное развертывание</code>, который содержит образы всех компонентов.<br />
      Если вам нужно использовать <code>Внешний</code> репозиторий изображений, пожалуйста, свяжитесь с технической поддержкой, чтобы получить план синхронизации изображений перед настройкой.
    </td>
  </tr>

  <tr>
    <td><b>Сетевая сеть контейнеров</b></td>

    <td>
      Подсеть по умолчанию и сегмент сети службы кластера не могут пересекаться.<br />
      При использовании сети Kube-OVN Overlay убедитесь, что сеть контейнеров и сетевая служба хоста не находятся в одном сетевом сегменте, иначе это может вызвать сетевые исключения.
    </td>
  </tr>

  <tr>
    <td><b>Имя узла</b></td>

    <td>
      Если вы выбираете <code>Имя хоста в качестве имени узла</code>, убедитесь, что имена хостов всех узлов уникальны.
    </td>
  </tr>

  <tr>
    <td><b>Изоляция узлов платформы кластера `global`</b></td>

    <td>
      Включайте только если планируете запускать рабочие нагрузки приложений в кластере `global`.<br />
      <b>После включения:</b><br />

      - Узлы могут быть установлены в режим <code>Эксклюзивно для платформы</code>, т.е. запускать только компоненты платформы, обеспечивая изоляцию платформы и рабочих нагрузок приложений;<br />
      - Рабочие нагрузки типа DaemonSet исключены.
    </td>
  </tr>

  <tr>
    <td><b>Добавить узел</b></td>

    <td>
      <b>Узел управляющей плоскости:</b>

      <ul>
        - Поддерживается добавление 1 или 3 узлов управляющей плоскости (3 для конфигурации высокой доступности);<br />
        - Если <code>Эксклюзивно для платформы</code> включено, <code>Размещаемые приложения</code> принудительно отключены, и узлы управляющей плоскости запускают только компоненты платформы;<br />
        - Если <code>Эксклюзивно для платформы</code> отключено, вы можете выбрать, хотите ли вы включить <code>Размещаемые приложения</code>, позволяя узлам управляющей плоскости запускать рабочие нагрузки приложений.<br />
      </ul>

      <b>Рабочий узел:</b>

      <ul>
        - Если <code>Эксклюзивно для платформы</code> включено, <code>Размещаемые приложения</code> принудительно отключены;<br />
        - Если <code>Эксклюзивно для платформы</code> отключено, <code>Размещаемые приложения</code> принудительно включены.<br />
      </ul>

      <p>При использовании Kube-OVN вы можете указать сетевую карту узла, введя название шлюза.</p>
      <p>Если проверка доступности узла не удалась, пожалуйста, отрегулируйте ее согласно подсказкам на странице и добавьте снова.</p>
    </td>
  </tr>
</table>

## Очистка установщика

Обычно установщик будет автоматически удален после установки. Если установщик не был автоматически удален через 30 минут после установки, выполните следующую команду на узле, где находится установщик, чтобы принудительно удалить контейнер установщика:

```bash
docker rm -f minialauda-control-plane
```
