---
weight: 10
sourceSHA: b9a6ab82e9cba0db313069dd00e0c1e1a22c74a12f53c22021f9c0c0b6064025
---

# Предварительные требования

Перед установкой кластера `global` необходимо подготовить оборудование, сеть и операционную систему, которые соответствуют требованиям.

:::info
На данный момент платформа не поддерживает прямую установку кластера `global` в существующей среде Kubernetes. Если ваша среда уже имеет кластер Kubernetes, пожалуйста, создайте резервную копию ваших данных и очистите среду перед установкой.
:::

## Планирование емкости \{#scale}

Перед установкой необходимо выбрать подходящий сценарий установки в зависимости от ваших целей и фактических потребностей. Разные сценарии значительно отличаются по требованиям к конфигурации ресурсов инфраструктуры и архитектурному дизайну. Ниже приведены рекомендации по планированию для трех типичных сценариев:

<Tabs>
  <Tab label="Проверка функций">
    **Область применения**
    Подходит для проверки функций платформы, демонстраций или тестирования технической осуществимости. Этот сценарий используется только для проверки основных функций платформы и не предназначен для применения на уровне производства. Конфигурация ресурсов на минимальном уровне.

    **Требования к конфигурации ресурсов**

    | Размерность       | Требования к спецификациям              |
    | --------------- | --------------------------------------- |
    | Количество узлов | 1 (физическая машина или виртуальная машина) |
    | CPU             | ≥16 ядер                               |
    | Оперативная память | ≥32ГБ                                   |

    **Описание архитектуры**

    - **Все в одном**: Кластер имеет только один узел, и все компоненты контрольной плоскости и приложения работают на этом узле.
    - **Легкая нагрузка**: Может загрузить демонстрационные приложения не более чем с 10 Pod'ами.
    - **Не для производства**: Не поддерживает горизонтальное масштабирование и не отвечает требованиям к непрерывности приложений и высокой доступности.
  </Tab>

  <Tab label="Доставка интеграции ISV">
    **Область применения**
    Для стандартизированных потребностей ISV (независимых поставщиков программного обеспечения) кластер `global` обеспечивает управление платформой и непосредственное выполнение приложений ISV, без необходимости создавать дополнительные рабочие кластеры.

    **Требования к конфигурации ресурсов**

    <table>
      <tr>
        <th style={{ whiteSpace: 'nowrap' }}>План развертывания</th>
        <th style={{ whiteSpace: 'nowrap' }}>Тип узла</th>
        <th style={{ whiteSpace: 'nowrap' }}>Количество</th>
        <th style={{ whiteSpace: 'nowrap' }}>Минимальные спецификации</th>
        <th style={{ whiteSpace: 'nowrap' }}>Рекомендуемые спецификации</th>
        <th style={{ whiteSpace: 'nowrap' }}>Примечания</th>
      </tr>

      <tr>
        <td rowSpan={2}><b>Минимальная конфигурация</b></td>
        <td>Узел контрольной плоскости</td>
        <td>3</td>
        <td>8 ядер 16ГБ + требования ISV</td>
        <td>12 ядер 24ГБ + требования ISV</td>
        <td>Рекомендуется резервировать около 30% избыточных ресурсов</td>
      </tr>

      <tr>
        <td>Рабочий узел</td>
        <td>0</td>
        <td>—</td>
        <td>—</td>
        <td>Приложения ISV запускаются совместно на узлах контрольной плоскости</td>
      </tr>

      <tr>
        <td rowSpan={2}><b>Рекомендуемая конфигурация</b></td>
        <td>Узел контрольной плоскости</td>
        <td>3</td>
        <td>8 ядер 16ГБ</td>
        <td>12 ядер 24ГБ</td>
        <td>Запускает компоненты Kubernetes и контрольную плоскость платформы</td>
      </tr>

      <tr>
        <td>Рабочий узел</td>
        <td>≥2</td>
        <td>В соответствии с требованиями нагрузки приложений ISV</td>
        <td>—</td>
        <td>Независимо запускает приложения ISV, рекомендуется реализовать HA развертывание</td>
      </tr>
    </table>

    **Описание архитектуры**

    - **Готов к производству**: Кластер `global` одновременно запускает как компоненты контрольной плоскости, так и приложения ISV.
    - **Изоляция платформы и приложений**: Рекомендуется запускать приложения ISV на выделенных рабочих узлах, чтобы избежать конкуренции за ресурсы с контрольной плоскостью.
    - **Масштабирование**: На каждые 50 новых Pods приложений добавляйте 1 рабочий узел в зависимости от требований ресурсов приложений ISV.
  </Tab>

  <Tab label="Управление многими кластерами (уровень дата-центра)">
    **Область применения**
    Подходит для больших корпоративных центров обработки данных, которым требуется единое управление несколькими рабочими кластерами через облака и регионы. По мере увеличения числа рабочих кластеров кластер `global` должен динамически масштабировать рабочие узлы и конфигурации ресурсов, чтобы обеспечить высокую доступность и производительность.

    **Ключевые характеристики**

    - **Гибридное управление**: Поддерживает единое управление рабочими кластерами между облаками и регионами.
    - **Эластичное масштабирование**: Ресурсы кластера `global` масштабируются линейно с количеством доступных рабочих кластеров.
    - **Физическая изоляция**: Рекомендуется физически изолировать контрольную и вычислительную плоскости для обеспечения стабильности системы.

    **Базовая конфигурация ресурсов**

    <table>
      <thead>
        <tr>
          <th style={{ whiteSpace: 'nowrap' }}>Тип узла</th>
          <th style={{ whiteSpace: 'nowrap' }}>Количество</th>
          <th style={{ whiteSpace: 'nowrap' }}>Минимальные спецификации</th>
          <th style={{ whiteSpace: 'nowrap' }}>Рекомендуемые спецификации</th>
          <th style={{ whiteSpace: 'nowrap' }}>Примечания</th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>Узел контрольной плоскости</td>
          <td>3 или 5</td>
          <td>8 ядер 16ГБ</td>
          <td>16 ядер 32ГБ</td>
          <td>Включить политику анти-ассоциации</td>
        </tr>

        <tr>
          <td>Рабочий узел</td>
          <td>≥2</td>
          <td>12 ядер 24ГБ</td>
          <td>24 ядер 48ГБ</td>
          <td>Рекомендуется резервировать 30% избыточных ресурсов</td>
        </tr>
      </tbody>
    </table>

    **Правила динамического масштабирования**

    1. **Вертикальное масштабирование**: Один узел можно модернизировать порциями (например, 12 ядер 24ГБ → 24 ядер 48ГБ → 48 ядер 96ГБ).
    2. **Горизонтальное масштабирование**: На каждые 10 доступных рабочих кластеров рекомендуется увеличивать вычислительные ресурсы на 20% (увеличивайте количество узлов или повышайте спецификации узлов).
    3. **Мониторинг**, инициирующий масштабирование: Когда использование CPU/памяти постоянно превышает 70%, необходимо инициировать меры масштабирования.

    **Описание архитектуры**

    - Контрольная плоскость состоит из 3 узлов, образующих кластер ETCD. Рекомендуется включить шифрование TLS и периодические снимки.
    - Критические компоненты платформы рекомендуется развертывать на независимых рабочих узлах, чтобы избежать конкуренции за ресурсы.
    - Рекомендация по восстановлению после катастрофы: Развертывание должно быть выполнено в нескольких зонах доступности, чтобы гарантировать распределение рабочих узлов как минимум в 2 физических зонах отказов.
  </Tab>
</Tabs>

<Directive type="tip" title="TIP">
  1. **Избыточность ресурсов**: Для производственных сред рекомендуется резервировать как минимум 30% запас ресурсов для обработки резких нагрузок.
  2. **Планирование сети**: Кластер `global` должен быть развернут в независимой VPC или VLAN, чтобы обеспечить пропускную способность ≥1Gbps.
  3. **Изоляция хранения**: Для хранения ETCD рекомендуется использовать NVMe SSD и физически изолировать его от хранилища приложений.
</Directive>

## Машины

:::info
Этот раздел описывает минимальные аппаратные требования для создания высокодоступного кластера `global`. Если вы завершили планирование емкости, пожалуйста, подготовьте соответствующие ресурсы в соответствии с [Планированием емкости](#scale) или масштабируйте по мере необходимости после установки.
:::

### Основные требования

Необходимо предоставить как минимум **3** физические машины или виртуальные машины в качестве узлов контрольной плоскости для кластера. Минимальная конфигурация для каждого узла следующая:

| **Категория**     | **Минимальные требования**                                                             |
| -------------- | ------------------------------------------------------------------------------------ |
| **CPU**        | ≥ 8 ядер, тактовая частота ≥ 2.5GHz<br />Не следует переусердствовать; отключить режим энергосбережения |
| **Память**     | ≥ 16ГБ<br />Не следует переусердствовать; рекомендуется использовать как минимум шестиканальную DDR4       |
| **Жесткий диск** | Один накопитель IOPS ≥ 2000<br />Пропускная способность ≥ 200MB/s<br />Обязательно использовать SSD                |

### Требования к архитектуре ARM

Для архитектур ARM (например, Kunpeng 920) рекомендуется увеличить конфигурацию до **в 2 раза** больше минимальной конфигурации x86, но не менее **в 1.5 раза**.

Например: Если для x86 требуется 8 ядер 16ГБ, то для ARM должно быть как минимум 12 ядер 24ГБ, а рекомендованная конфигурация - 16 ядер 32ГБ.

## Поддерживаемые ОС и ядра \{#supported\_os\_and\_kernels}

:::info

1. **Требования к версиям ядра:**
   Эти версии ядер были официально выпущены и подтверждены тестами нашей платформы. В вашем фактическом развертывании критически важно придерживаться **главных версий A.B.C**, тогда как последующие минорные версии могут варьироваться.
2. **Не поддерживаемые среды:**
   Если ОС, версия ядра или архитектура CPU не соответствуют требованиям, пожалуйста, свяжитесь с технической поддержкой.
   :::

<Tabs>
  <Tab label="Red Hat Enterprise Linux (RHEL)">
    - RHEL 7.8: `3.10.0-1127.el7.x86_64`
    - RHEL 8.0 до 8.6: `4.18.0-80.el8.x86_64` до `4.18.0-372.9.1.el8.x86_64`

    <Directive type="warning" title="WARNING">
      RHEL 7.8 не поддерживает **Calico Vxlan IPv6**.
    </Directive>
  </Tab>

  <Tab label="CentOS">
    - CentOS 7.6 до 7.9: `3.10.0-1127` до `3.11`

    <Directive type="warning" title="WARNING">
      CentOS не поддерживает **Calico Vxlan IPv6**.
    </Directive>
  </Tab>

  <Tab label="Ubuntu">
    - Ubuntu 20.04 LTS: `5.4.0-124-generic`
    - Ubuntu 22.04 LTS: `5.15.0-56-generic`

    <Directive type="warning" title="WARNING">
      Версии Ubuntu HWE (Hardware Enablement) не поддерживаются.
    </Directive>
  </Tab>

  <Tab label="Kylin Linux Advanced Server">
    - Kylin V10 SP3: `4.19.90-52.22.v2207.ky10.x86_64`

    <Directive type="warning" title="WARNING">
      - У Kylin V10, V10-SP1 и V10-SP2 имеются известные проблемы с ядром, которые могут вызывать **сбои доступа к сети NodePort**; рекомендуется обновиться до **Kylin V10-SP3**.
      - Архитектура ARM поддерживает только `Kunpeng 920`. Для других моделей, пожалуйста, свяжитесь с технической поддержкой.
    </Directive>
  </Tab>
</Tabs>

## Сеть

Перед установкой следующие сетевые ресурсы должны быть предварительно настроены. Если аппаратный LoadBalancer не может быть предоставлен, установщик поддерживает настройку **haproxy + keepalived** в качестве программного балансировщика нагрузки, но вам нужно понимать:

- **Проблемы с производительностью**: Производительность программного балансирования ниже, чем у аппаратного LoadBalancer.
- **Высокая сложность**: Если вы не знакомы с keepalived, это может вызвать недоступность кластера `global`, устранение проблем займет много времени и серьезно повлияет на надежность платформы.

### Сетевые ресурсы \{#network-resources}

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>Ресурс</th>
      <th style={{ whiteSpace: 'nowrap' }}>Обязательно</th>
      <th style={{ whiteSpace: 'nowrap' }}>Количество</th>
      <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>`global` VIP</td>
      <td>Обязательно</td>
      <td>1</td>
      <td>Используется для доступа узлов в кластере к kube-apiserver, настраивается в устройстве балансировки нагрузки для обеспечения высокой доступности. <br />Этот IP также может использоваться в качестве адреса доступа для веб-интерфейса платформы. <br />Рабочие кластеры в той же сети, что и кластер `global`, также могут получить доступ к кластеру `global` через этот IP.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Внешний IP</td>
      <td>Необязательно</td>
      <td>По запросу</td>
      <td>Когда существуют рабочие кластеры, которые не находятся в той же сети, что и кластер `global`, например, в сценарии гибридного облака, он должен быть предоставлен. Рабочие кластеры в других сетях получают доступ к кластеру `global` через этот IP. <br />Этот IP необходимо настроить в устройстве балансировки нагрузки для обеспечения высокой доступности. <br />Этот IP также может использоваться в качестве адреса доступа для веб-интерфейса платформы.</td>
    </tr>

    <tr>
      <td>Доменное имя</td>
      <td>Необязательно</td>
      <td>По запросу</td>
      <td>Если вам нужно получить доступ к кластеру `global` или веб-интерфейсу платформы через доменное имя, пожалуйста, предоставьте его заранее и убедитесь, что разрешение доменного имени корректно.</td>
    </tr>

    <tr>
      <td>Сертификат</td>
      <td>Необязательно</td>
      <td>По запросу</td>
      <td>Рекомендуется использовать доверенный сертификат, чтобы избежать предупреждений безопасности браузера; если не предоставлен, установщик создаст самоподписанный сертификат, но использование HTTPS может представлять собой риски безопасности.</td>
    </tr>
  </tbody>
</table>

<Directive type="info" title="INFO">
  Доменное имя должно быть предоставлено в следующих случаях:

  1. Кластер `global` должен поддерживать доступ по IPv6.
  2. Планируется план восстановления для кластера `global`.
</Directive>

<Directive type="note" title="NOTE">
  Если платформа нуждается в конфигурации нескольких адресов доступа (например, адресов для внутренних и внешних сетей), пожалуйста, заранее подготовьте соответствующие IP-адреса или доменные имена согласно таблице выше. Вы можете настроить их в параметрах установки позже или добавить их согласно документации продукта после установки.
</Directive>

### Конфигурация сети

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>Тип</th>
      <th style={{ whiteSpace: 'nowrap' }}>Описание требований</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Скорость сети</td>
      <td>Скорость кластера `global` и рабочего кластера в одной сети ≥1Gbps (рекомендуется 10Gbps); скорость между сетями ≥100Mbps (рекомендуется 1Gbps). <br />Недостаточная скорость значительно снизит производительность обработки данных.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Задержка сети</td>
      <td>Задержка ≤2ms в одной сети; задержка ≤100ms (рекомендуется ≤30ms) между сетями.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Сетевая политика</td>
      <td>Пожалуйста, обратитесь к [Правилам пересылки LoadBalancer](#port-forward), чтобы убедиться, что необходимые порты открыты; при использовании Calico CNI убедитесь, что протокол **IP-in-IP** включен.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Диапазон IP-адресов</td>
      <td>Узлы кластера `global` должны избегать использования сетевого сегмента 172.16-32. Если он уже используется, пожалуйста, настройте конфигурацию Docker (добавьте параметр bip), чтобы избежать конфликтов.</td>
    </tr>
  </tbody>
</table>

### Правила пересылки LoadBalancer \{#port-forward}

Это правило разработано для обеспечения того, чтобы кластер `global` мог нормально принимать трафик от LoadBalancer. Пожалуйста, проверьте сетевую политику в соответствии со следующей таблицей, чтобы убедиться, что соответствующие порты открыты.

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>IP-адрес источника</th>
      <th style={{ whiteSpace: 'nowrap' }}>Протокол</th>
      <th style={{ whiteSpace: 'nowrap' }}>IP-адрес назначения</th>
      <th style={{ whiteSpace: 'nowrap' }}>Порт назначения</th>
      <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>`global` VIP, Внешний IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>Все IP-адреса узлов контрольной плоскости</td>
      <td style={{ whiteSpace: 'nowrap' }}>443</td>

      <td>
        Обеспечивает доступ к веб-интерфейсу платформы, репозиторию образов и Kubernetes API Server через протокол HTTPS. Порт по умолчанию — `443`. Если вы хотите использовать собственный HTTPS-порт, пожалуйста, выполните следующее:<br />

        - Замените порт назначения в правиле пересылки на свой собственный номер порта.<br />
        - Позже, в параметрах установки веб-интерфейса, укажите свой собственный номер порта.
      </td>
    </tr>

    <tr>
      <td>`global` VIP, Внешний IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>Все IP-адреса узлов контрольной плоскости</td>
      <td style={{ whiteSpace: 'nowrap' }}>6443</td>

      <td>
        Этот порт предоставляет доступ к Kubernetes API Server для узлов внутри кластера.
      </td>
    </tr>

    <tr>
      <td>`global` VIP, Внешний IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>Все IP-адреса узлов контрольной плоскости</td>
      <td style={{ whiteSpace: 'nowrap' }}>11443</td>

      <td>
        Этот порт предоставляет доступ к репозиторию образов для узлов внутри кластера.<br />
        <b>Примечание:</b> Если вы планируете использовать внешний репозиторий образов вместо репозитория образов по умолчанию, предоставляемого кластером `global`, вам не нужно настраивать этот порт.
      </td>
    </tr>
  </tbody>
</table>

<Directive type="tip" title="TIP">
  - Рекомендуется настроить проверки состояния на LoadBalancer для мониторинга состояния портов.
  - Если вы планируете реализовать план восстановления для кластера `global`, вам необходимо открыть порт `2379` для всех узлов контрольной плоскости для синхронизации данных ETCD между основным и аварийным кластерами.
  - Платформа по умолчанию поддерживает только HTTPS. Если требуется поддержка HTTP, вам необходимо открыть порт HTTP для всех узлов контрольной плоскости.
</Directive>
