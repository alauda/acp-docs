---
weight: 10
sourceSHA: cab3487b55c090c37008aae687eacf5d2f21434bfdbdbee02df32bcb616ffd9e
---

# Предварительные требования

Перед установкой кластера `global` необходимо подготовить оборудование, сеть и операционную систему, соответствующие требованиям.

:::info
Платформа в настоящее время не поддерживает прямую установку кластера `global` в существующей среде Kubernetes. Если в вашей среде уже есть кластер Kubernetes, пожалуйста, создайте резервную копию ваших данных и очистите среду перед установкой.
:::

## Планирование емкости \{#scale}

Перед установкой необходимо выбрать подходящий сценарий установки в зависимости от ваших целей и фактических потребностей. Разные сценарии имеют значительные различия в конфигурации ресурсов инфраструктуры и требованиях к архитектурному дизайну. Ниже приведены рекомендации по планированию для трех типичных сценариев:

<Tabs>
  <Tab label="Один узел">
    **Область применения**
    Подходит для проверки функциональности платформы, демонстрации или тестирования технической осуществимости. Этот сценарий используется только для проверки основных функций платформы и не обрабатывает трафик приложений на уровне производства. Конфигурация ресурсов находится на минимальном уровне.

    **Требования к конфигурации ресурсов**

    | Размерность      | Требования к спецификациям              |
    | ---------------- | --------------------------------------- |
    | Количество узлов | 1 (физическая машина или виртуальная машина) |
    | CPU              | ≥16 ядер                               |
    | Память           | ≥32 ГБ                                  |

    **Описание архитектуры**

    - **Все в одном**: Кластер состоит только из одного узла, и все компоненты контрольной плоскости и приложения работают на этом узле.
    - **Легкая нагрузка**: Может загружать демонстрационные приложения не более чем с 10 Pod'ами.
    - **Не для производства**: Не поддерживает горизонтальное масштабирование и не соответствует требованиям непрерывности приложений и высокой доступности.
  </Tab>

  <Tab label="Один кластер">
    **Область применения**
    Для стандартизированных потребностей поставщиков программного обеспечения (ISV) кластер `global` обрабатывает как управление платформой, так и прямое выполнение приложений ISV, без необходимости создания дополнительных рабочих кластеров.

    **Требования к конфигурации ресурсов**

    <table>
      <tr>
        <th style={{ whiteSpace: 'nowrap' }}>План развертывания</th>
        <th style={{ whiteSpace: 'nowrap' }}>Тип узла</th>
        <th style={{ whiteSpace: 'nowrap' }}>Количество</th>
        <th style={{ whiteSpace: 'nowrap' }}>Минимальные спецификации</th>
        <th style={{ whiteSpace: 'nowrap' }}>Рекомендуемые спецификации</th>
        <th style={{ whiteSpace: 'nowrap' }}>Примечания</th>
      </tr>

      <tr>
        <td rowSpan={2}><b>Минимальная конфигурация</b></td>
        <td>Узел контрольной плоскости</td>
        <td>3</td>
        <td>8 ядер 16 ГБ + требования ISV</td>
        <td>12 ядер 24 ГБ + требования ISV</td>
        <td>Рекомендуется зарезервировать примерно 30% резервных ресурсов</td>
      </tr>

      <tr>
        <td>Рабочий узел</td>
        <td>0</td>
        <td>—</td>
        <td>—</td>
        <td>Приложения ISV работают совместно на узлах контрольной плоскости</td>
      </tr>

      <tr>
        <td rowSpan={2}><b>Рекомендуемая конфигурация</b></td>
        <td>Узел контрольной плоскости</td>
        <td>3</td>
        <td>8 ядер 16 ГБ</td>
        <td>12 ядер 24 ГБ</td>
        <td>Запускает компоненты Kubernetes и контрольную плоскость платформы</td>
      </tr>

      <tr>
        <td>Рабочий узел</td>
        <td>≥2</td>
        <td>В соответствии с требованиями нагрузки приложений ISV</td>
        <td>—</td>
        <td>Независимо запускает приложения ISV, рекомендуется реализовать HA развертывание</td>
      </tr>
    </table>

    **Описание архитектуры**

    - **Готов к производству**: Кластер `global` одновременно запускает как компоненты контрольной плоскости, так и приложения ISV.
    - **Изоляция платформы и приложений**: Рекомендуется запускать приложения ISV на выделенных рабочих узлах, чтобы избежать конкуренции за ресурсы с контрольной плоскостью.
    - **Масштабирование**: На каждые 50 новых Pod'ов приложений добавляйте 1 рабочий узел в соответствии с требованиями ресурсов приложений ISV.
  </Tab>

  <Tab label="Мульти-кластер">
    **Область применения**
    Подходит для крупных корпоративных центров обработки данных, которые требуют единого управления несколькими рабочими кластерами в облаках и регионах. По мере увеличения количества рабочих кластеров кластер `global` должен динамически масштабировать рабочие узлы и конфигурации ресурсов, чтобы обеспечить высокую доступность и высокую производительность.

    **Ключевые функции**

    - **Гибридное управление**: Поддерживает единое управление рабочими кластерами в разных облаках и регионах.
    - **Эластичное масштабирование**: Ресурсы кластера `global` масштабируются линейно с увеличением количества рабочих кластеров.
    - **Физическая изоляция**: Рекомендуется физически изолировать контрольную плоскость и вычислительную плоскость для обеспечения стабильности системы.

    **Базовая конфигурация ресурсов**

    <table>
      <thead>
        <tr>
          <th style={{ whiteSpace: 'nowrap' }}>Тип узла</th>
          <th style={{ whiteSpace: 'nowrap' }}>Количество</th>
          <th style={{ whiteSpace: 'nowrap' }}>Минимальные спецификации</th>
          <th style={{ whiteSpace: 'nowrap' }}>Рекомендуемые спецификации</th>
          <th style={{ whiteSpace: 'nowrap' }}>Примечания</th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>Узел контрольной плоскости</td>
          <td>3 или 5</td>
          <td>8 ядер 16 ГБ</td>
          <td>16 ядер 32 ГБ</td>
          <td>Включить политику антиприоритетности</td>
        </tr>

        <tr>
          <td>Рабочий узел</td>
          <td>≥2</td>
          <td>12 ядер 24 ГБ</td>
          <td>24 ядер 48 ГБ</td>
          <td>Рекомендуется зарезервировать 30% резервных ресурсов</td>
        </tr>
      </tbody>
    </table>

    **Правила динамического масштабирования**

    1. **Вертикальное масштабирование**: Отдельные узлы могут быть обновлены поэтапно (например, 12 ядер 24 ГБ → 24 ядер 48 ГБ → 48 ядер 96 ГБ).
    2. **Горизонтальное масштабирование**: На каждые 10 рабочих кластеров рекомендуется увеличивать вычислительные ресурсы на 20% (увеличивать количество узлов или обновлять спецификации узлов).
    3. **Мониторинг триггеров**: Когда использование CPU/памяти постоянно превышает 70%, инициировать меры по масштабированию.

    **Описание архитектуры**

    - Контрольная плоскость состоит из 3 узлов, образующих кластер ETCD. Рекомендуется включить шифрование TLS и периодические снимки.
    - Критически важные компоненты платформы рекомендуется развертывать на независимых рабочих узлах, чтобы избежать конкуренции за ресурсы.
    - Рекомендация по восстановлению после катастрофы: Развертывать в нескольких зонах доступности, чтобы обеспечить распределение рабочих узлов как минимум в 2 физических доменах отказа.
  </Tab>
</Tabs>

<Directive type="tip" title="СОВЕТ">
  1. **Резервирование ресурсов**: В производственных средах рекомендуется зарезервировать как минимум 30% резервного запаса ресурсов для справления с внезапными нагрузками.
  2. **Планирование сети**: Кластер `global` должен быть развернут в независимом VPC или VLAN, чтобы обеспечить пропускную способность ≥1 Гбит/с.
  3. **Изоляция хранения**: Рекомендуется использовать NVMe SSD для хранения ETCD и физически изолировать его от хранения приложений.
</Directive>

## Машины

:::info
Этот раздел описывает минимальные аппаратные требования для создания высокодоступного кластера `global`. Если вы завершили планирование емкости, пожалуйста, подготовьте соответствующие ресурсы в соответствии с [Планированием емкости](#scale), или увеличьте их по мере необходимости после установки.
:::

### Основные требования

Необходимо предоставить как минимум **3** физических машины или виртуальные машины в качестве узлов контрольной плоскости для кластера. Минимальная конфигурация для каждого узла следующая:

| **Категория**   | **Минимальные требования**                                                             |
| -------------- | -------------------------------------------------------------------------------------- |
| **CPU**        | ≥ 8 ядер, тактовая частота ≥ 2.5 ГГц<br />Без избыточного выделения; отключите режим энергосбережения |
| **Память**     | ≥ 16 ГБ<br />Без избыточного выделения; рекомендуется использовать как минимум шестиканальную DDR4       |
| **Жесткий диск** | IOPS одного устройства ≥ 2000<br />Пропускная способность ≥ 200 МБ/с<br />Обязательно использовать SSD                |

### Требования к архитектуре ARM

Для архитектур ARM (таких как Kunpeng 920) рекомендуется увеличить конфигурацию до **в 2 раза** больше, чем минимальная конфигурация x86, но не менее **в 1.5 раза**.

Например: Если для x86 требуется 8 ядер 16 ГБ, то для ARM должно быть как минимум 12 ядер 24 ГБ, а рекомендуемая конфигурация — 16 ядер 32 ГБ.

## Поддерживаемые ОС и ядра \{#supported\_os\_and\_kernels}

:::info

1. **Требования к версии ядра:**
   Эти версии ядра были официально выпущены и проверены нашими тестами платформы. В вашей фактической развертке важно придерживаться **основных версий A.B.C**, в то время как последующие минорные версии могут варьироваться.
2. **Неподдерживаемые среды:**
   Если ОС, версия ядра или архитектура CPU не соответствуют требованиям, пожалуйста, свяжитесь с технической поддержкой.
   :::

<Tabs>
  <Tab label="Red Hat Enterprise Linux (RHEL)">
    - RHEL 7.8: `3.10.0-1127.el7.x86_64`
    - RHEL 8.0 до 8.6: `4.18.0-80.el8.x86_64` до `4.18.0-372.9.1.el8.x86_64`

    <Directive type="warning" title="ПРЕДУПРЕЖДЕНИЕ">
      RHEL 7.8 не поддерживает **Calico Vxlan IPv6**.
    </Directive>
  </Tab>

  <Tab label="CentOS">
    - CentOS 7.6 до 7.9: `3.10.0-1127` до `3.11`

    <Directive type="warning" title="ПРЕДУПРЕЖДЕНИЕ">
      CentOS не поддерживает **Calico Vxlan IPv6**.
    </Directive>
  </Tab>

  <Tab label="Ubuntu">
    - Ubuntu 20.04 LTS: `5.4.0-124-generic`
    - Ubuntu 22.04 LTS: `5.15.0-56-generic`

    <Directive type="warning" title="ПРЕДУПРЕЖДЕНИЕ">
      Версии Ubuntu HWE (Hardware Enablement) не поддерживаются.
    </Directive>
  </Tab>

  <Tab label="Kylin Linux Advanced Server">
    - Kylin V10 SP3: `4.19.90-52.22.v2207.ky10.x86_64`

    <Directive type="warning" title="ПРЕДУПРЕЖДЕНИЕ">
      * У Kylin V10, V10-SP1 и V10-SP2 есть известные проблемы с ядром, которые могут вызвать **неудачи доступа к сети NodePort**; рекомендуется обновиться до **Kylin V10-SP3**.
      * Архитектура ARM поддерживает только `Kunpeng 920`. Для других моделей, пожалуйста, свяжитесь с технической поддержкой.
    </Directive>
  </Tab>
</Tabs>

## Сеть

Перед установкой необходимо предварительно настроить следующие сетевые ресурсы. Если аппаратный LoadBalancer не может быть предоставлен, установщик поддерживает настройку **haproxy + keepalived** в качестве программного балансировщика нагрузки, но вам нужно понимать:

- **Плохая производительность**: Производительность программного балансировщика нагрузки ниже, чем у аппаратного LoadBalancer.
- **Высокая сложность**: Если вы не знакомы с keepalived, это может привести к недоступности кластера `global`, устранение проблем займет много времени и серьезно повлияет на надежность платформы.

### Сетевые ресурсы \{#network-resources}

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>Ресурс</th>
      <th style={{ whiteSpace: 'nowrap' }}>Обязательно</th>
      <th style={{ whiteSpace: 'nowrap' }}>Количество</th>
      <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>`global` VIP</td>
      <td>Обязательно</td>
      <td>1</td>
      <td>Используется для доступа узлов в кластере к kube-apiserver, настраивается в устройстве балансировки нагрузки для обеспечения высокой доступности. <br />Этот IP также может использоваться в качестве адреса доступа к веб-интерфейсу платформы. <br />Рабочие кластеры в одной сети с кластером `global` также могут получить доступ к кластеру `global` через этот IP.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Внешний IP</td>
      <td>Необязательно</td>
      <td>По запросу</td>
      <td>Когда есть рабочие кластеры, которые не находятся в одной сети с кластером `global`, например, в сценарии гибридного облака, он должен быть предоставлен. Рабочие кластеры в других сетях получают доступ к кластеру `global` через этот IP. <br />Этот IP необходимо настроить в устройстве балансировки нагрузки для обеспечения высокой доступности. <br />Этот IP также может использоваться в качестве адреса доступа к веб-интерфейсу платформы.</td>
    </tr>

    <tr>
      <td>Доменное имя</td>
      <td>Необязательно</td>
      <td>По запросу</td>
      <td>Если вам нужно получить доступ к кластеру `global` или веб-интерфейсу платформы через доменное имя, пожалуйста, предоставьте его заранее и убедитесь, что разрешение доменного имени корректно.</td>
    </tr>

    <tr>
      <td>Сертификат</td>
      <td>Необязательно</td>
      <td>По запросу</td>
      <td>Рекомендуется использовать доверенный сертификат, чтобы избежать предупреждений безопасности браузера; если не предоставлен, установщик сгенерирует самоподписанный сертификат, но могут возникнуть риски безопасности при использовании HTTPS.</td>
    </tr>
  </tbody>
</table>

<Directive type="info" title="ИНФОРМАЦИЯ">
  Доменное имя должно быть предоставлено в следующих случаях:

  1. Кластер `global` должен поддерживать доступ по IPv6.
  2. Запланирован план восстановления после катастрофы для кластера `global`.
</Directive>

<Directive type="note" title="ЗАМЕТКА">
  Если платформе необходимо настроить несколько адресов доступа (например, адреса для внутренних и внешних сетей), пожалуйста, заранее подготовьте соответствующие IP-адреса или доменные имена в соответствии с таблицей выше. Вы можете настроить их в параметрах установки позже или добавить их в соответствии с документацией продукта после установки.
</Directive>

### Конфигурация сети

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>Тип</th>
      <th style={{ whiteSpace: 'nowrap' }}>Описание требований</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Скорость сети</td>
      <td>Скорость кластера `global` и рабочего кластера в одной сети ≥1 Гбит/с (рекомендуется 10 Гбит/с); скорость между сетями ≥100 Мбит/с (рекомендуется 1 Гбит/с). <br />Недостаточная скорость значительно снизит производительность запросов данных.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Задержка сети</td>
      <td>Задержка ≤2 мс в одной сети; задержка ≤100 мс (рекомендуется ≤30 мс) между сетями.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Сетевая политика</td>
      <td>Пожалуйста, обратитесь к [Правилам пересылки LoadBalancer](#port-forward), чтобы убедиться, что необходимые порты открыты; при использовании Calico CNI убедитесь, что протокол **IP-in-IP** включен.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Диапазон IP-адресов</td>
      <td>Узлы кластера `global` должны избегать использования сетевого сегмента 172.16-32. Если он уже использовался, пожалуйста, отрегулируйте конфигурацию Docker (добавьте параметр bip), чтобы избежать конфликтов.</td>
    </tr>
  </tbody>
</table>

### Правила пересылки LoadBalancer \{#port-forward}

Это правило предназначено для обеспечения того, чтобы кластер `global` мог нормально получать трафик от LoadBalancer. Пожалуйста, проверьте сетевую политику в соответствии со следующей таблицей, чтобы убедиться, что соответствующие порты открыты.

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>IP-адрес источника</th>
      <th style={{ whiteSpace: 'nowrap' }}>Протокол</th>
      <th style={{ whiteSpace: 'nowrap' }}>IP-адрес назначения</th>
      <th style={{ whiteSpace: 'nowrap' }}>Порт назначения</th>
      <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>`global` VIP, Внешний IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>Все IP-адреса узлов контрольной плоскости</td>
      <td style={{ whiteSpace: 'nowrap' }}>443</td>

      <td>
        Обеспечивает доступ к веб-интерфейсу платформы, репозиторию образов и серверу API Kubernetes через протокол HTTPS. Порт по умолчанию — `443`. Если вам нужно использовать пользовательский порт HTTPS, пожалуйста, выполните следующие действия:<br />

        - Замените порт назначения в правиле пересылки на ваш пользовательский номер порта.<br />
        - Позже в параметрах установки веб-интерфейса заполните ваш пользовательский номер порта.
      </td>
    </tr>

    <tr>
      <td>`global` VIP, Внешний IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>Все IP-адреса узлов контрольной плоскости</td>
      <td style={{ whiteSpace: 'nowrap' }}>6443</td>

      <td>
        Этот порт обеспечивает доступ к серверу API Kubernetes для узлов внутри кластера.
      </td>
    </tr>

    <tr>
      <td>`global` VIP, Внешний IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>Все IP-адреса узлов контрольной плоскости</td>
      <td style={{ whiteSpace: 'nowrap' }}>11443</td>

      <td>
        Этот порт обеспечивает доступ к репозиторию образов для узлов внутри кластера.<br />
        <b>Примечание:</b> Если вы планируете использовать внешний репозиторий образов вместо репозитория образов, предоставляемого кластером `global`, вам не нужно настраивать этот порт.
      </td>
    </tr>
  </tbody>
</table>

<Directive type="tip" title="СОВЕТ">
  - Рекомендуется настроить проверки состояния на LoadBalancer для мониторинга состояния портов.
  - Если вы планируете реализовать план восстановления после катастрофы для кластера `global`, вам необходимо открыть порт `2379` для всех узлов контрольной плоскости для синхронизации данных ETCD между основным и резервным кластерами.
  - Платформа по умолчанию поддерживает только HTTPS. Если требуется поддержка HTTP, вам необходимо открыть HTTP-порт для всех узлов контрольной плоскости.
</Directive>
