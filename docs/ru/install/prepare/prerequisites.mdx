---
weight: 10
sourceSHA: b9a6ab82e9cba0db313069dd00e0c1e1a22c74a12f53c22021f9c0c0b6064025
---

# Предварительные требования

Перед установкой кластера `global` необходимо подготовить оборудование, сеть и операционную систему, соответствующие требованиям.

:::info
Платформа в настоящее время не поддерживает прямую установку кластера `global` в существующей среде Kubernetes. Если ваша среда уже содержит кластер Kubernetes, пожалуйста, сделайте резервное копирование ваших данных и очистите среду перед установкой.
:::

## Планирование мощности \{#scale}

Перед установкой вы должны выбрать подходящий сценарий установки на основе ваших целей и фактических потребностей. Разные сценарии имеют значительные различия в конфигурации инфраструктурных ресурсов и архитектурных требованиях. Ниже приведены рекомендации по планированию для трех типичных сценариев:

<Tabs>
  <Tab label="Проверка функции">
    **Область применения**
    Подходит для проверки функциональности платформы, демонстрации или тестирования технической осуществимости. Этот сценарий используется исключительно для проверки основных функций платформы и не обрабатывает трафик приложений на уровне производства. Конфигурация ресурсов находится на минимальном уровне.

    **Требования к конфигурации ресурсов**

    | Размерность     | Требования к спецификациям              |
    | --------------- | --------------------------------------- |
    | Количество узлов| 1 (физическая или виртуальная машина)  |
    | CPU             | ≥16 ядер                               |
    | Память          | ≥32ГБ                                   |

    **Описание архитектуры**

    - **Всё в одном**: В кластере только один узел, и все компоненты управления и приложения работают на этом узле.
    - **Легкая нагрузка**: Может загружать только демонстрационные приложения не более чем с 10 Pods.
    - **Не для производственного использования**: Не поддерживает горизонтальное масштабирование и не удовлетворяет требованиям к непрерывности приложений и высокой доступности.
  </Tab>

  <Tab label="Интеграция и поставка ISV">
    **Область применения**
    Для стандартизированных потребностей поставки ISV (независимых поставщиков программного обеспечения), кластер `global` обрабатывает как управление платформой, так и прямое выполнение приложений ISV, без необходимости создания дополнительных кластеров нагрузки.

    **Требования к конфигурации ресурсов**

    <table>
      <tr>
        <th style={{ whiteSpace: 'nowrap' }}>План развертывания</th>
        <th style={{ whiteSpace: 'nowrap' }}>Тип узла</th>
        <th style={{ whiteSpace: 'nowrap' }}>Количество</th>
        <th style={{ whiteSpace: 'nowrap' }}>Минимальные спецификации</th>
        <th style={{ whiteSpace: 'nowrap' }}>Рекомендуемые спецификации</th>
        <th style={{ whiteSpace: 'nowrap' }}>Заметки</th>
      </tr>

      <tr>
        <td rowSpan={2}><b>Минимальная конфигурация</b></td>
        <td>Узел управления</td>
        <td>3</td>
        <td>8 ядер 16ГБ + требования ISV</td>
        <td>12 ядер 24ГБ + требования ISV</td>
        <td>Рекомендуется зарезервировать примерно 30% избыточных ресурсов</td>
      </tr>

      <tr>
        <td>Рабочий узел</td>
        <td>0</td>
        <td>—</td>
        <td>—</td>
        <td>Приложения ISV работают совместно на узлах управления</td>
      </tr>

      <tr>
        <td rowSpan={2}><b>Рекомендуемая конфигурация</b></td>
        <td>Узел управления</td>
        <td>3</td>
        <td>8 ядер 16ГБ</td>
        <td>12 ядер 24ГБ</td>
        <td>Запускает компоненты Kubernetes и контрольную плоскость платформы</td>
      </tr>

      <tr>
        <td>Рабочий узел</td>
        <td>≥2</td>
        <td>В соответствии с требованиями нагрузки приложений ISV</td>
        <td>—</td>
        <td>Независимо запускает приложения ISV, рекомендовано реализовать HA-развертывание</td>
      </tr>
    </table>

    **Описание архитектуры**

    - **Готов к производству**: Кластер `global` одновременно запускает как компоненты управления, так и приложения ISV.
    - **Изоляция платформы и приложений**: Рекомендуется запускать приложения ISV на выделенных рабочих узлах, чтобы избежать конкуренции за ресурсы с контрольной плоскостью.
    - **Масштабирование**: На каждые 50 новых Pods приложений добавляйте 1 рабочий узел в соответствии с требованиями ресурсов приложений ISV.
  </Tab>

  <Tab label="Управление многокластером (уровень центра обработки данных)">
    **Область применения**
    Подходит для крупных корпоративных центров обработки данных, требующих единого управления несколькими кластерами нагрузки в облаках и регионах. С увеличением числа кластеров нагрузки кластер `global` должен динамически масштабировать рабочие узлы и конфигурацию ресурсов, чтобы обеспечить высокую доступность и высокую производительность.

    **Ключевые особенности**

    - **Гибридное управление**: Поддерживает единое управление межоблачными и межрегиональными кластерами нагрузки.
    - **Эластичное масштабирование**: Ресурсы кластера `global` масштабируются линейно с количеством доступных кластеров нагрузки.
    - **Физическая изоляция**: Рекомендуется физически изолировать контрольную и вычислительную плоскости для обеспечения стабильности системы.

    **Базовая конфигурация ресурсов**

    <table>
      <thead>
        <tr>
          <th style={{ whiteSpace: 'nowrap' }}>Тип узла</th>
          <th style={{ whiteSpace: 'nowrap' }}>Количество</th>
          <th style={{ whiteSpace: 'nowrap' }}>Минимальные спецификации</th>
          <th style={{ whiteSpace: 'nowrap' }}>Рекомендуемые спецификации</th>
          <th style={{ whiteSpace: 'nowrap' }}>Заметки</th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>Узел управления</td>
          <td>3 или 5</td>
          <td>8 ядер 16ГБ</td>
          <td>16 ядер 32ГБ</td>
          <td>Включить политику антиприоритетности</td>
        </tr>

        <tr>
          <td>Рабочий узел</td>
          <td>≥2</td>
          <td>12 ядер 24ГБ</td>
          <td>24 ядер 48ГБ</td>
          <td>Рекомендуется зарезервировать 30% избыточных ресурсов</td>
        </tr>
      </tbody>
    </table>

    **Правила динамического масштабирования**

    1. **Вертикальное масштабирование**: Одночипные узлы могут обновляться по шкале (например, 12 ядер 24ГБ → 24 ядра 48ГБ → 48 ядер 96ГБ).
    2. **Горизонтальное масштабирование**: На каждые 10 доступных кластеров нагрузки рекомендуется расширить вычислительные ресурсы на 20% (увеличить количество узлов или обновить спецификации узлов).
    3. **Мониторинг**: Если использование CPU/памяти непрерывно превышает 70%, инициировать меры масштабирования.

    **Описание архитектуры**

    - Контрольная плоскость состоит из 3 узлов, формируя кластер ETCD. Рекомендуется включить TLS-шифрование и периодические снимки.
    - Критически важные компоненты платформы рекомендуется развернуть на независимых рабочих узлах, чтобы избежать конкуренции за ресурсы.
    - Рекомендации по восстановлению после катастроф: Развернуть в нескольких зонах доступности, чтобы гарантировать распределение рабочих узлов как минимум в 2 физических доменных областях сбоев.
  </Tab>
</Tabs>

<Directive type="tip" title="СОВЕТ">
  1. **Резервирование ресурсов**: В производственных средах рекомендуется зарезервировать по крайней мере 30% ресурсного запаса для учета внезапных нагрузок.
  2. **Планирование сети**: Кластер `global` должен быть развернут в независимой VPC или VLAN для обеспечения пропускной способности ≥1Гбит/с.
  3. **Изоляция хранения**: Рекомендуется использовать NVMe SSD для хранения ETCD и физически изолировать его от хранения приложений.
</Directive>

## Машины

:::info
В этом разделе описываются минимальные аппаратные требования для создания высокодоступного кластера `global`. Если вы завершили планирование мощности, пожалуйста, подготовьте соответствующие ресурсы в соответствии с [Планированием мощности](#scale), или масштабируйте, по мере необходимости, после установки.
:::

### Основные требования

Необходимы как минимум **3** физических или виртуальных машины в качестве узлов управления для кластера. Минимальная конфигурация для каждого узла следующая:

| **Категория**   | **Минимальные требования**                                                             |
| --------------   | -------------------------------------------------------------------------------------- |
| **ЦП**          | ≥ 8 ядер, тактовая частота ≥ 2.5ГГц<br />Без избыточного выделения; отключить режим энергосбережения |
| **Память**      | ≥ 16ГБ<br />Без избыточного выделения; рекомендуется использовать как минимум DDR4 с шести каналами |
| **Жесткий диск**| IOPS для одного устройства ≥ 2000<br />Пропускная способность ≥ 200МБ/с<br />Должен использовать SSD |

### Требования к архитектуре ARM

Для ARM-архитектур (например, Kunpeng 920) рекомендуется увеличить конфигурацию до **2 раз** больше, чем минимальная конфигурация x86, но не менее **1.5 раз**.

Например: если x86 требует 8 ядер 16ГБ, то ARM должен достичь как минимум 12 ядер 24ГБ, а рекомендуемая конфигурация - 16 ядер 32ГБ.

## Поддерживаемые ОС и ядра \{#supported\_os\_and\_kernels}

:::info

1. **Требования к версиям ядер:**
   Эти версии ядер были официально выпущены и подтверждены нашими тестами платформы. В вашей реальной развертке соблюдение **A.B.C основных номеров версий** является критически важным, в то время как последующие младшие версии могут варьироваться.
2. **Неподдерживаемые среды:**
   Если ОС, версия ядра или архитектура ЦП не соответствуют требованиям, пожалуйста, свяжитесь с технической поддержкой.
   :::

<Tabs>
  <Tab label="Red Hat Enterprise Linux (RHEL)">
    - RHEL 7.8: `3.10.0-1127.el7.x86_64`
    - RHEL 8.0 до 8.6: `4.18.0-80.el8.x86_64` до `4.18.0-372.9.1.el8.x86_64`

    <Directive type="warning" title="ВНИМАНИЕ">
      RHEL 7.8 не поддерживает **Calico Vxlan IPv6**.
    </Directive>
  </Tab>

  <Tab label="CentOS">
    - CentOS 7.6 до 7.9: `3.10.0-1127` до `3.11`

    <Directive type="warning" title="ВНИМАНИЕ">
      CentOS не поддерживает **Calico Vxlan IPv6**.
    </Directive>
  </Tab>

  <Tab label="Ubuntu">
    - Ubuntu 20.04 LTS: `5.4.0-124-generic`
    - Ubuntu 22.04 LTS: `5.15.0-56-generic`

    <Directive type="warning" title="ВНИМАНИЕ">
      Версии HWE (Hardware Enablement) Ubuntu не поддерживаются.
    </Directive>
  </Tab>

  <Tab label="Kylin Linux Advanced Server">
    - Kylin V10 SP3: `4.19.90-52.22.v2207.ky10.x86_64`

    <Directive type="warning" title="ВНИМАНИЕ">
      - Kylin V10, V10-SP1 и V10-SP2 имеют известные проблемы ядра, которые могут вызвать **сбои сетевого доступа NodePort**; рекомендуется обновиться до **Kylin V10-SP3**.
      - Архитектура ARM поддерживает только `Kunpeng 920`. Для других моделей, пожалуйста, свяжитесь с технической поддержкой.
    </Directive>
  </Tab>
</Tabs>

## Сеть

Перед установкой следующие сетевые ресурсы должны быть предварительно настроены. Если аппаратный LoadBalancer не может быть предоставлен, установщик поддерживает конфигурирование **haproxy + keepalived** в качестве программного балансировщика нагрузки, но вам необходимо учитывать:

- **Ухудшенная производительность**: Производительность программного балансировщика нагрузки ниже, чем у аппаратного LoadBalancer.
- **Повышенная сложность**: Если вы не знакомы с keepalived, это может привести к тому, что кластер `global` будет недоступен, устранение проблемы займет много времени и серьезно повлияет на надежность платформы.

### Сетевые ресурсы \{#network-resources}

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>Ресурс</th>
      <th style={{ whiteSpace: 'nowrap' }}>Обязательно</th>
      <th style={{ whiteSpace: 'nowrap' }}>Количество</th>
      <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>`global` VIP</td>
      <td>Обязательно</td>
      <td>1</td>
      <td>Используется для доступа узлов в кластере к kube-apiserver, конфигурируется в устройстве балансировки нагрузки для обеспечения высокой доступности. <br />Этот IP также может быть использован в качестве адреса доступа к веб-интерфейсу платформы. <br />Кластеры нагрузки в той же сети, что и кластер `global`, также могут получить доступ к кластеру `global` через этот IP.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Внешний IP</td>
      <td>Опционально</td>
      <td>По мере необходимости</td>
      <td>Когда есть кластеры нагрузки, которые находятся не в той же сети, что и кластер `global`, например, в сценарии гибридного облака, он должен быть предоставлен. Кластеры нагрузки в других сетях получают доступ к кластеру `global` через этот IP. <br />Этот IP необходимо настроить в устройстве балансировки нагрузки для обеспечения высокой доступности. <br />Этот IP также может быть использован в качестве адреса доступа к веб-интерфейсу платформы.</td>
    </tr>

    <tr>
      <td>Доменное имя</td>
      <td>Опционально</td>
      <td>По мере необходимости</td>
      <td>Если вам нужно получить доступ к кластеру `global` или веб-интерфейсу платформы через доменное имя, пожалуйста, предоставьте его заранее и убедитесь, что разрешение доменного имени правильное.</td>
    </tr>

    <tr>
      <td>Сертификат</td>
      <td>Опционально</td>
      <td>По мере необходимости</td>
      <td>Рекомендуется использовать доверенный сертификат, чтобы избежать предупреждений безопасности браузера; если он не предоставлен, установщик сгенерирует самоподписанный сертификат, но при использовании HTTPS могут быть риски безопасности.</td>
    </tr>
  </tbody>
</table>

<Directive type="info" title="ИНФОРМАЦИЯ">
  Доменное имя должно быть предоставлено в следующих случаях:

  1. Кластер `global` должен поддерживать доступ IPv6.
  2. Планируется план восстановления после катастрофы для кластера `global`.
</Directive>

<Directive type="note" title="ЗАМЕТКА">
  Если платформе нужно настроить несколько адресов доступа (например, адреса для внутренних и внешних сетей), пожалуйста, подготовьте соответствующие IP-адреса или доменные имена заранее в соответствии с таблицей выше. Вы можете настроить их в параметрах установки позже или добавить в соответствии с документацией продукта после установки.
</Directive>

### Конфигурация сети

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>Тип</th>
      <th style={{ whiteSpace: 'nowrap' }}>Описание требований</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Скорость сети</td>
      <td>Скорость кластера `global` и кластера нагрузки в одной сети ≥1Гбит/с (рекомендуется 10Гбит/с); скорость между сетями ≥100Мбит/с (рекомендуется 1Гбит/с). <br />Недостаточная скорость значительно снижает производительность запроса данных.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Задержка сети</td>
      <td>Задержка ≤2мс в одной сети; задержка ≤100мс (рекомендуется ≤30мс) между сетями.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Сетевая политика</td>
      <td>Пожалуйста, ознакомьтесь с [Правилами переадресации LoadBalancer](#port-forward), чтобы гарантировать, что необходимые порты открыты; при использовании Calico CNI убедитесь, что включен протокол **IP-in-IP**.</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>Диапазон IP-адресов</td>
      <td>Узлы кластера `global` должны избегать использования подсети 172.16-32. Если она уже использовалась, пожалуйста, скорректируйте конфигурацию Docker (добавьте параметр bip), чтобы избежать конфликтов.</td>
    </tr>
  </tbody>
</table>

### Правила переадресации LoadBalancer \{#port-forward}

Это правило предназначено для обеспечения нормального получения трафика кластером `global` от LoadBalancer. Пожалуйста, проверьте сетевую политику в соответствии с таблицей ниже, чтобы гарантировать, что соответствующие порты открыты.

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>IP-адрес источника</th>
      <th style={{ whiteSpace: 'nowrap' }}>Протокол</th>
      <th style={{ whiteSpace: 'nowrap' }}>IP-адрес назначения</th>
      <th style={{ whiteSpace: 'nowrap' }}>Порт назначения</th>
      <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>`global` VIP, Внешний IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>Все IP-адреса узлов контрольной плоскости</td>
      <td style={{ whiteSpace: 'nowrap' }}>443</td>

      <td>
        Предоставляет услуги доступа для веб-интерфейса платформы, репозитория образов и Kubernetes API Server через протокол HTTPS. Порт по умолчанию — `443`. Если вам нужно использовать пользовательский HTTPS-порт, пожалуйста, выполните следующие действия:<br />

        - Замените порт назначения в правиле переадресации на ваш пользовательский номер порта.<br />
        - Позже в параметрах установки веб-интерфейса заполните ваш пользовательский номер порта.
      </td>
    </tr>

    <tr>
      <td>`global` VIP, Внешний IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>Все IP-адреса узлов контрольной плоскости</td>
      <td style={{ whiteSpace: 'nowrap' }}>6443</td>

      <td>
        Этот порт предоставляет доступ к Kubernetes API Server для узлов внутри кластера.
      </td>
    </tr>

    <tr>
      <td>`global` VIP, Внешний IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>Все IP-адреса узлов контрольной плоскости</td>
      <td style={{ whiteSpace: 'nowrap' }}>11443</td>

      <td>
        Этот порт предоставляет доступ к репозиторию образов для узлов внутри кластера.<br />
        <b>Примечание:</b> Если вы планируете использовать внешний репозиторий образов вместо стандартного репозитория, предоставляемого кластером `global`, вам не нужно настраивать этот порт.
      </td>
    </tr>
  </tbody>
</table>

<Directive type="tip" title="СОВЕТ">
  - Рекомендуется настраивать проверки состояния на LoadBalancer для мониторинга состояния порта.
  - Если вы планируете реализовать план восстановления после катастрофы для кластера `global`, вам необходимо открыть порт `2379` для всех узлов контрольной плоскости для синхронизации данных ETCD между основным кластером и кластером восстановления после катастрофы.
  - Платформа по умолчанию поддерживает только HTTPS. Если требуется поддержка HTTP, вам нужно открыть HTTP-порт для всех узлов контрольной плоскости.
</Directive>
