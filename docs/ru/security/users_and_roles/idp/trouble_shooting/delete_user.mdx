---
weight: 10
sourceSHA: 3f8010a7a10eaa571cea89573c7c22fb3636b2e9cf545209e2e62f5e34ed2c60
---

# Удалить пользователя

## Описание проблемы

**Проблема**: При создании или синхронизации нового пользователя система сообщает, что пользователь уже существует. Как следует поступить в этом случае?

По соображениям безопасности платформа не позволяет создавать новых пользователей (как локальных, так и IDP-пользователей) с именами, совпадающими с ранее удаленными пользователями. Это ограничение применяется к:

- Созданию новых локальных пользователей с именами, совпадающими с удаленными пользователями
- Синхронизации IDP-пользователей с именами, совпадающими с удаленными пользователями

После обновления до текущей версии вы можете столкнуться с этой проблемой, когда:

- Создаете новых пользователей с именами, совпадающими с пользователями, удаленными до обновления
- Синхронизируете новых пользователей с именами, совпадающими с пользователями, удаленными до обновления

## Решение

Чтобы решить эту проблему, вам необходимо очистить информацию о удаленных пользователях, выполнив определенные скрипты на ваших контрольных узлах глобального кластера.

### Очистить удаленных IDP-пользователей

Выполните следующую команду на любом контрольном узле вашего глобального кластера:

```bash
kubectl delete users -l 'auth.cpaas.io/user.connector_id=<IDP Name>,auth.cpaas.io/user.state=deleted'
```

Пример:

```bash
kubectl delete users -l 'auth.cpaas.io/user.connector_id=github,auth.cpaas.io/user.state=deleted'
```

### Очистить удаленных локальных пользователей

Выполните эти два скрипта последовательно на любом контрольном узле вашего глобального кластера:

1. Очистить пароли пользователей:

```bash
kubectl get users -l 'auth.cpaas.io/user.connector_id=local,auth.cpaas.io/user.state=deleted' | awk '{print $1}' | xargs kubectl delete password -n cpaas-system
```

2. Очистить пользователей:

```bash
kubectl delete users -l 'auth.cpaas.io/user.connector_id=local,auth.cpaas.io/user.state=deleted'
```
