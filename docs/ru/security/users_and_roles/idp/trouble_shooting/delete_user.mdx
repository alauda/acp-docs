---
weight: 10
sourceSHA: 3f8010a7a10eaa571cea89573c7c22fb3636b2e9cf545209e2e62f5e34ed2c60
---

# Удалить пользователя

## Описание проблемы

**Проблема**: При создании или синхронизации нового пользователя система сообщает, что пользователь уже существует. Как следует поступить в этой ситуации?

По соображениям безопасности платформа запрещает создание новых пользователей (как локальных, так и IDP пользователей) с именами, совпадающими с ранее удаленными пользователями. Это ограничение распространяется на:

- Создание новых локальных пользователей с именами, совпадающими с удаленными пользователями
- Синхронизацию IDP пользователей с именами, совпадающими с удаленными пользователями

После обновления до текущей версии вы можете столкнуться с этой проблемой при:

- Создании новых пользователей с именами, совпадающими с пользователями, удаленными до обновления
- Синхронизации новых пользователей с именами, совпадающими с пользователями, удаленными до обновления

## Решение

Чтобы решить эту проблему, необходимо очистить информацию оdeleted пользователях, выполнив конкретные скрипты на ваших контрольных узлах глобального кластера.

### Очистка удаленных IDP пользователей

Выполните следующую команду на любом контрольном узле вашего глобального кластера:

```bash
kubectl delete users -l 'auth.cpaas.io/user.connector_id=<IDP Name>,auth.cpaas.io/user.state=deleted'
```

Пример:

```bash
kubectl delete users -l 'auth.cpaas.io/user.connector_id=github,auth.cpaas.io/user.state=deleted'
```

### Очистка удаленных локальных пользователей

Выполните эти два скрипта последовательно на любом контрольном узле вашего глобального кластера:

1. Очистка паролей пользователей:

```bash
kubectl get users -l 'auth.cpaas.io/user.connector_id=local,auth.cpaas.io/user.state=deleted' | awk '{print $1}' | xargs kubectl delete password -n cpaas-system
```

2. Очистка пользователей:

```bash
kubectl delete users -l 'auth.cpaas.io/user.connector_id=local,auth.cpaas.io/user.state=deleted'
```
