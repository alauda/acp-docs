---
weight: 20
sourceSHA: 2273877ce77ecd41f71c89601002fe9860fbc95cfbc9772c8d3834b217d8ed2c
---

# Управление OIDC

Платформа поддерживает протокол OIDC (OpenID Connect), что позволяет администраторам платформы входить в систему, используя учетные записи сторонних поставщиков, после добавления конфигурации OIDC. Администраторы платформы также могут обновлять и удалять настроенные OIDC-сервисы.

## Обзор OIDC

OIDC (OpenID Connect) — это стандартный протокол аутентификации, основанный на протоколе OAuth 2.0. Он использует сервер авторизации OAuth 2.0 для предоставления аутентификации пользователей для клиентов сторонних поставщиков и передает соответствующую информацию аутентификации личности клиенту.

OIDC позволяет всем типам клиентов (включая серверные, мобильные и JavaScript-клиенты) запрашивать и получать аутентифицированные сессии и информацию о конечном пользователе. Этот набор спецификаций расширяемый, что позволяет участникам использовать необязательные функции, такие как шифрование данных о пользователе, обнаружение поставщика OpenID и управление сессиями, когда это имеет смысл. Для получения дополнительной информации обратитесь к [официальной документации OIDC](https://openid.net/connect/).

## Добавление OIDC

Добавив OIDC, вы можете использовать учетные записи сторонних платформ для входа в систему.

**Примечание**: После успешного входа пользователей OIDC в платформу, система будет использовать атрибут электронной почты пользователя в качестве уникального идентификатора. Пользователи сторонних платформ, поддерживающих OIDC, должны иметь атрибут **email**; в противном случае они не смогут войти в систему.

### Процедура выполнения

1. В левом навигационном меню щелкните **Пользователи** > **IDPs**.

2. Щелкните **Добавить OIDC**.

3. Настройте параметры **Основная информация**.

4. Настройте параметры **Конфигурация OIDC-сервера**:

   - **URL поставщика идентификации**: URL-адрес эмитента, который является адресом доступа поставщика идентификации OIDC.

   - **ID клиента**: идентификатор клиента для клиента OIDC.

   - **Секрет клиента**: секретный ключ для клиента OIDC.

   - **Redirect URI**: адрес обратного вызова после входа в систему на стороннюю платформу, который является URL-адресом эмитента dex + `/callback`.

   - **Logout URL**: адрес, который посещает пользователь после выполнения операции **Logout**. Если оставить пустым, адрес выхода будет являться первоначальной страницей входа платформы.

5. В области **Валидация конфигурации сервиса IDP** введите **Имя пользователя** и **Пароль** действительного OIDC-аккаунта для проверки конфигурации.

   **Совет**: Если имя пользователя и пароль неверные, при добавлении возникнет ошибка, указывающая на недействительные учетные данные, и OIDC не может быть добавлен.

6. Нажмите **Создать**.

## Добавление OIDC через YAML

Помимо конфигурации с помощью формы, платформа также поддерживает добавление OIDC через YAML, что позволяет более гибко настраивать параметры аутентификации, сопоставления заявок, синхронизацию групп пользователей и другие расширенные функции.

### Пример: Настройка OIDC-коннектора

Следующий пример демонстрирует, как настроить OIDC-коннектор для интеграции с сервисами аутентификации OIDC. Этот пример конфигурации подходит для следующих сценариев:

1. Необходимость интеграции OIDC в качестве сервера аутентификации.

2. Необходимость поддержки синхронизации информации о группах пользователей.

3. Необходимость настроить адрес перенаправления после выхода.

4. Необходимость настроить конкретные области OIDC.

5. Необходимость настроить сопоставление заявок.

```yaml
apiVersion: dex.coreos.com/v1
kind: Connector
# Основная информация о коннекторе
id: oidc               # Уникальный идентификатор коннектора
name: oidc             # Отображаемое имя коннектора
type: oidc             # Тип коннектора - OIDC
metadata:
  annotations:
    cpaas.io/description: "11"  # Описание коннектора
  name: oidc
  namespace: cpaas-system
spec:
  config:
    # Конфигурация сервера OIDC
    # Настройте информацию о соединении с сервером, включая адрес сервера, учетные данные клиента и адрес обратного вызова
    issuer: http://auth.com/auth/realms/master               # Адрес сервера OIDC
    clientID: dex                                            # ID клиента
    # Секретный ключ учетной записи сервиса, действителен при создании ресурсов Connector в первый раз
    clientSecret: xxxxxxx
    redirectURI: https://example.com/dex/callback            # Адрес обратного вызова, должен соответствовать адресу, зарегистрированному клиентом OIDC
    
    # Конфигурация безопасности
    # Настройте проверку SSL и метод получения информации о пользователе
    insecureSkipVerify: true                                # Необходимо пропустить проверку SSL, рекомендуется установить false в производственной среде
    getUserInfo: false                                      # Необходимо получать дополнительную информацию о пользователе через конечную точку UserInfo

    # Конфигурация выхода
    # Настройте адрес перенаправления после выхода пользователя
    logoutURL: https://test.com                            # Адрес перенаправления при выходе, может быть настроен на страницу, на которую переходят после выхода пользователя

    # Конфигурация областей
    # Настройте необходимые области авторизации, убедитесь, что сервер OIDC поддерживает эти области
    scopes:                                                 
      - openid                                             # Обязательная область, используется для базовой аутентификации OIDC
      - profile                                            # Необязательная область, используется для получения основной информации о пользователе
      - email                                              # Необязательная область, используется для получения электронной почты пользователя

    # Конфигурация сопоставления заявок
    # Настройте взаимосвязь между возвратом заявок OIDC и атрибутами пользователя платформы
    claimMapping:                                          
      email: email                                         # Сопоставление электронной почты, используется для уникальной идентификации пользователя
      groups: groups                                       # Сопоставление групп пользователей, используется для организационной структуры
      phone: ""                                            # Сопоставление телефонного номера, необязательное
      preferred_username: preferred_username               # Сопоставление имени пользователя, используется для отображаемого имени

    # Конфигурация групп пользователей
    # Настройте параметры, связанные с синхронизацией групп пользователей, убедитесь, что токен содержит информацию о группах
    groupsKey: groups                                      # Укажите имя ключа информации о группах
    insecureEnableGroups: false                           # Необходимо ли включать функцию синхронизации групп
```

## Соответствующие операции

Вы можете нажать на ![](/en/img/113point.png) справа на странице списка или щелкнуть **Действия** в верхнем правом углу на странице деталей, чтобы обновить или удалить OIDC по мере необходимости.

| Операция         | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Обновить OIDC** | Обновите добавленную конфигурацию OIDC. После обновления информации о конфигурации OIDC оригинальные пользователи и методы аутентификации будут сброшены и синхронизированы в соответствии с текущей конфигурацией.                                                                                                                                                                                                                                                                                                                                                                         |
| **Удалить OIDC** | Удалите OIDC, который больше не используется платформой. После удаления OIDC все пользователи, синхронизированные с платформой через этот OIDC, будут иметь статус **Неверный** (связь между пользователями и ролями останется неизменной), и они не смогут войти в систему. После повторной интеграции пользователи могут быть активированы, успешно войдя в систему.<br /><br />**Совет**: После удаления IDP, если вам нужно удалить пользователей и группы пользователей, синхронизированные с платформой через OIDC, отметьте флажок **Стереть пользователей и группы пользователей IDP** под диалоговым окном с подсказкой. |
