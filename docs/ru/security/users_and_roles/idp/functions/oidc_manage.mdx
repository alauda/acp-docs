---
weight: 20
sourceSHA: 2273877ce77ecd41f71c89601002fe9860fbc95cfbc9772c8d3834b217d8ed2c
---

# Управление OIDC

Платформа поддерживает протокол OIDC (OpenID Connect), позволяя администраторам платформы входить в систему с использованием сторонних учетных записей после добавления конфигурации OIDC. Администраторы платформы также могут обновлять и удалять настроенные OIDC-сервисы.

## Обзор OIDC

OIDC (OpenID Connect) — это стандарт протокола аутентификации личности, основанный на протоколе OAuth 2.0. Он использует сервер авторизации OAuth 2.0 для предоставления аутентификации пользовательской личности для сторонних клиентов и передает соответствующую информацию о аутентификации личности клиенту.

OIDC позволяет всем типам клиентов (включая клиентскую часть сервера, мобильные и JavaScript-клиенты) запрашивать и получать аутентифицированные сеансы и информацию о конечных пользователях. Этот набор спецификаций расширяем, позволяя участникам использовать необязательные функции, такие как шифрование данных личности, обнаружение поставщика OpenID и управление сеансами, когда это имеет смысл. Для получения дополнительной информации смотрите [официальную документацию OIDC](https://openid.net/connect/).

## Добавление OIDC

Добавив OIDC, вы сможете использовать сторонние учетные записи платформы для входа в платформу.

**Примечание**: После успешного входа пользователей OIDC на платформу она будет использовать атрибут электронной почты как уникальный идентификатор. У пользователей сторонних платформ, поддерживающих OIDC, должен быть атрибут **email**; в противном случае они не смогут войти в систему.

### Порядок выполнения операций

1. В левой панели навигации нажмите **Пользователи** > **IDP**.

2. Нажмите **Добавить OIDC**.

3. Настройте параметры **Основная информация**.

4. Настройте параметры **Конфигурация сервера OIDC**:

   - **URL поставщика идентификации**: URL-адрес эмитента, который является адресом доступа к поставщику идентичности OIDC.

   - **Идентификатор клиента**: идентификатор клиента для клиента OIDC.

   - **Секрет клиента**: секретный ключ для клиента OIDC.

   - **URL перенаправления**: адрес обратного вызова после входа в третью сторону платформы, который представляет собой URL-адрес эмитента dex + `/callback`.

   - **URL-адрес выхода**: адрес, который будет посещать пользователь после выполнения операции **Выход**. Если он пустой, адрес выхода будет начальной страницей входа в платформу.

5. В области **Проверка конфигурации сервиса IDP** введите **Имя пользователя** и **Пароль** действительной учетной записи OIDC для проверки конфигурации.

   **Совет**: Если имя пользователя и пароль неправильные, при добавлении будет сообщена ошибка, указывающая на недействительные учетные данные, и OIDC не может быть добавлен.

6. Нажмите **Создать**.

## Добавление OIDC через YAML

В дополнение к конфигурации форм платформа также поддерживает добавление OIDC через YAML, что позволяет более гибко настраивать параметры аутентификации, сопоставления утверждений, синхронизацию групп пользователей и другие расширенные функции.

### Пример: Настройка соединителя OIDC

Следующий пример демонстрирует, как настроить соединитель OIDC для интеграции с услугами аутентификации личности OIDC. Этот пример конфигурации подходит для следующих сценариев:

1. Необходимо интегрировать OIDC в качестве сервера аутентификации личности.

2. Необходимо поддерживать синхронизацию информации о группах пользователей.

3. Необходимо настроить адрес перенаправления при выходе.

4. Необходимо настраивать определенные области OIDC.

5. Необходимо настраивать сопоставление утверждений.

```yaml
apiVersion: dex.coreos.com/v1
kind: Connector
# Основная информация о соединителе
id: oidc               # Уникальный идентификатор соединителя
name: oidc             # Отображаемое имя соединителя
type: oidc             # Тип соединителя OIDC
metadata:
  annotations:
    cpaas.io/description: "11"  # Описание соединителя
  name: oidc
  namespace: cpaas-system
spec:
  config:
    # Конфигурация сервера OIDC
    # Настройка информации о соединении с сервером, включая адрес сервера, учетные данные клиента и адрес обратного вызова
    issuer: http://auth.com/auth/realms/master               # Адрес сервера OIDC
    clientID: dex                                            # Идентификатор клиента
    # Секретный ключ сервиса, действителен при создании ресурсов Connector в первый раз
    clientSecret: xxxxxxx
    redirectURI: https://example.com/dex/callback            # Адрес обратного вызова, должен совпадать с адресом, зарегистрированным клиентом OIDC
    
    # Конфигурация безопасности
    # Настройка проверки SSL и метода получения информации о пользователе
    insecureSkipVerify: true                                # Нужно ли пропустить проверку SSL, рекомендуется установить false в производственной среде
    getUserInfo: false                                      # Нужно ли получать дополнительную информацию о пользователе через конечную точку UserInfo

    # Конфигурация выхода
    # Настройка адреса перенаправления после выхода пользователя
    logoutURL: https://test.com                            # Адрес перенаправления при выходе, может быть настроен на страницу, на которую переходит пользователь после выхода

    # Конфигурация области
    # Настройка необходимых областей авторизации, убедитесь, что сервер OIDC поддерживает эти области
    scopes:                                                 
      - openid                                             # Обязательно, используется для базовой аутентификации OIDC
      - profile                                            # По желанию, используется для получения основной информации о пользователе
      - email                                              # По желанию, используется для получения электронной почты пользователя

    # Конфигурация сопоставления утверждений
    # Настройка отношений сопоставления между утверждениями, возвращаемыми OIDC, и атрибутами пользователей платформы
    claimMapping:                                          
      email: email                                         # Сопоставление электронной почты, используется для уникальной идентификации пользователей
      groups: groups                                       # Сопоставление групп пользователей, используется для организационной структуры
      phone: ""                                            # Сопоставление телефонов, по желанию
      preferred_username: preferred_username               # Сопоставление имени пользователя, используется для отображаемого имени

    # Конфигурация групп пользователей
    # Настройка параметров синхронизации групп пользователей, убедитесь, что токен содержит информацию о группах
    groupsKey: groups                                      # Указать имя ключа информации о группах
    insecureEnableGroups: false                           # Нужно ли включать функцию синхронизации групп
```

## Соответствующие операции

Вы можете нажать на ![](/en/img/113point.png) справа на странице списка или нажать **Действия** в правом верхнем углу на странице деталей, чтобы обновить или удалить OIDC по мере необходимости.

| Операция       | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Обновить OIDC** | Обновить добавленную конфигурацию OIDC. После обновления информации конфигурации OIDC оригинальные пользователи и методы аутентификации будут сброшены и синхронизированы в соответствии с текущей конфигурацией.                                                                                                                                                                                                                                                                                                                                                                         |
| **Удалить OIDC** | Удалить OIDC, который больше не используется платформой. После удаления OIDC все пользователи, синхронизированные с платформой через этот OIDC, будут иметь статус **Недействителен** (связь между пользователями и ролями остается неизменной), и они не смогут войти в систему. После повторной интеграции пользователи могут быть активированы путем успешного входа в систему.<br /><br />**Совет**: После удаления IDP, если вам нужно удалить пользователей и группы пользователей, синхронизированные с платформой через OIDC, отметьте флажок **Очистить пользователей и группы пользователей IDP** ниже всплывающего окна.
