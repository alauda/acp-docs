---
weight: 30
sourceSHA: 0a01c9b5a80e4bac698e98bd6964cfea8ee59cca61bfe7e8df201bc0fb21414d
---

# Доступ к сервисам хранения данных

Доступ к сервисам хранения данных поддерживает два метода интеграции: во-первых, интеграция распределенных ресурсов хранения из других бизнес-кластеров в рамках платформы для обеспечения хранения и бизнес-изоляции для облегчения управления и обслуживания; во-вторых, подключение внешних ресурсов хранения Ceph для использования распределенного хранения.

## Предварительные условия

### Подготовка хранения

Выберите один из следующих вариантов:

- Распределенное хранение было развернуто в других бизнес-кластерах, и пул хранения был создан. Пожалуйста, запишите название пула хранения для дальнейшего использования при интеграции.

- Внешнее хранилище Ceph вне платформы (версия ≥ 14.2.3) было создано с пулом хранения. Пожалуйста, запишите название пула хранения для дальнейшего использования при интеграции.

### Открытие портов

| IP-адрес назначения | Порт назначения               | IP-адрес источника                  | Порт источника |
| :------------------ | :---------------------------- | :----------------------------------- | :------------: |
| IP-адрес узла Ceph  | 3300, 6789, 6800-7300, 7480  | IP-адреса всех узлов в бизнес-кластере |      любой     |

### Получение информации для аутентификации (внешний Ceph)

Если подготовленное хранилище является внешним хранилищем Ceph, информацию для аутентификации необходимо получить с помощью следующих команд.

| Параметр                | Метод получения                                                                                                                                                    |
| :---------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **FSID**                | `ceph fsid`                                                                                                                                                       |
| **Информация о компоненте MON** | `ceph mon dump`<br />Должно быть в формате \{name= IP}, например *a=192.168.100.100:6789*.                                                                                 |
| **Ключ администратора**  | `ceph auth get-key client.admin`                                                                                                                                 |
| **Пул хранения**        | <ul><li>Файловое хранилище: Используйте команду `ceph fs ls`, чтобы получить значение `name`.</li><li>Блочное хранилище: `ceph osd dump` \| `grep "application rbd"` \| `awk '{print $3}'` </li></ul> |
| ***Пул хранения данных***       | (только для файлового хранения) Используйте команду `ceph fs ls`, чтобы получить значение `data pools`.                                                                               |

## Процедура

**Примечание**: Следующие шаги принимают **доступ к внешнему хранилищу Ceph** в качестве примера, операции для доступа к распределенному хранилищу аналогичны.

<Steps>
  1. В левом навигационном меню нажмите **Управление хранилищем** > **Распределенное хранилище**.

  2. Нажмите **Доступ к хранилищу**.

  3. На странице мастера **Конфигурация доступа** выберите **Внешний Ceph**.

     | Параметр                | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
     | :---------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
     | **Снимок**              | При включении поддерживает создание снимков PVC и использование снимков для настройки новых PVC для быстрого резервного копирования и восстановления бизнес-данных. <br />Если снимки не были включены во время доступа к хранилищу, вы все равно можете включить их позже в разделе **Операции** на странице деталей кластера хранилища по мере необходимости. <br />**Примечание**: Пожалуйста, убедитесь, что вы [развернули плагин снимка тома](/configure/storage/functions/snapshot_con.mdx) для текущего кластера перед использованием. |
     | **Сетевые настройки**   | <ul><li>**Сетевая хостительность**: Вычислительные компоненты в этом кластере будут обращаться к **кластеру хранения** с использованием **сети хоста**.</li><li>**Сетевая контейнеризация**: Вычислительные компоненты в этом кластере будут обращаться к **кластеру хранения** с использованием **сети контейнеров**. Вы можете создать подсеть в управлении сетью и назначить подсеть пространству имен `rook-ceph`. Если оставить пустым, будет использоваться подсеть по умолчанию.</li></ul>                                      |
     | **Другие параметры**    | Пожалуйста, заполните параметры аутентификации для внешнего Ceph, полученные на этапе предварительных условий.                                                                                                                                                                                                                                                                                                                                                                                        |

  4. На странице мастера **Создание класса хранения** завершите конфигурацию и нажмите **Доступ**.

     | Параметр                | Описание                                                                                                                                                                                                                                                                                     |
     | :---------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
     | **Тип**                 | В зависимости от типа пула хранения, созданного выше, соответствующий класс хранения по умолчанию будет: <br /><ul><li>Файловое хранилище: CephFS Файловое хранилище</li><li> Блочное хранилище: CephRBD Блочное хранилище </li></ul>                                                                                     |
     | **Политика возмещения** | Политика возмещения для постоянных томов. <br /><ul><li> Удалить: Когда претензия на постоянный том удаляется, связанный постоянный том также будет удален.</li><li> Сохранить: Даже если претензия на постоянный том удалена, связанный постоянный том все равно будет сохранен.</li></ul> |
     | **Распределение проекта** | Проекты, которые могут использовать этот тип хранения. <br />Если в данный момент нет проектов, требующих этот тип хранения, вы можете не выделять проекты на данный момент и обновить их позже.                                                                                                      |

  5. Подождите примерно 1–5 минут для успешной интеграции.
</Steps>

## Дальнейшие действия

- Создать классы хранения: [CephFS Файловое хранилище](/configure/storage/functions/cephfs_storageclass.mdx), [CephRBD Блочное хранилище](/configure/storage/functions/cephrbd_storageclass.mdx)

- Разработчики, использующие указанные выше классы хранения для создания заявок на постоянные тома, могут расширить использование с помощью снимков томов и функций масштабирования.

**Примечание**: Если вам нужно поддерживать пулы хранения, конфигурации устройств хранения и т. д. для внешнего хранилища, операции должны выполняться на платформе управления кластера хранения.
