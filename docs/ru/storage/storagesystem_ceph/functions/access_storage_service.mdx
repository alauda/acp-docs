---
weight: 30
sourceSHA: 0a01c9b5a80e4bac698e98bd6964cfea8ee59cca61bfe7e8df201bc0fb21414d
---

# Доступ к услугам хранения

Доступ к услугам хранения поддерживает два метода интеграции: во-первых, интеграция распределенных ресурсов хранения из других бизнес-кластеров внутри платформы для обеспечения хранения и изоляции бизнес-процессов, что упрощает управление и обслуживание; во-вторых, соединение с внешними ресурсами хранения Ceph для использования распределенного хранения.

## Предварительные условия

### Подготовка хранения

Выберите один из следующих вариантов:

- Распределенное хранилище развернуто в других бизнес-кластерах, и пул хранения был создан. Пожалуйста, запишите имя пула хранения для дальнейшего использования в интеграции.

- Внешнее хранилище Ceph вне платформы (версия ≥ 14.2.3) было создано с пулом хранения. Пожалуйста, запишите имя пула хранения для дальнейшего использования в интеграции.

### Открытие портов

| IP-адрес назначения | Порт назначения             | IP-адрес источника                      | Порт источника |
| :----------------- | :------------------------- | :-------------------------------------- | :-----------: |
| IP узла Ceph      | 3300, 6789, 6800-7300, 7480 | IP всех узлов в бизнес-кластере        |     любой     |

### Получение информации для аутентификации (внешний Ceph)

Если подготовленное хранилище является внешним хранилищем Ceph, информацию для аутентификации необходимо получить с помощью следующих команд.

| Параметр                     | Метод получения                                                                                                                                                       |
| :--------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **FSID**                     | `ceph fsid`                                                                                                                                                          |
| **Информация о компоненте MON** | `ceph mon dump`<br />Должно быть в формате \{name= IP\}, например, *a=192.168.100.100:6789*.                                                                                  |
| **Ключ администратора**      | `ceph auth get-key client.admin`                                                                                                                                   |
| **Пул хранения**             | <ul><li>Файловое хранилище: используйте команду `ceph fs ls` для получения значения `name`.</li><li>Блочное хранилище: `ceph osd dump` \| `grep "application rbd"` \| `awk '{print $3}'` </li></ul> |
| ***Пул данных***             | (необходимо только для файлового хранилища) Используйте команду `ceph fs ls` для получения значения `data pools`.                                                       |

## Процедура

**Примечание**: Следующие действия используют **доступ к внешнему хранилищу Ceph** в качестве примера, операции для доступа к распределенному хранилищу аналогичны.

<Steps>
  1. В левой панели навигации нажмите **Управление хранилищем** > **Распределенное хранилище**.

  2. Нажмите **Доступ к хранилищу**.

  3. На странице мастера **Конфигурация доступа** выберите **Внешний Ceph**.

     | Параметр                  | Описание                                                                                                                                                                                                                               |
     | :----------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
     | **Снимок**               | При включении поддерживает создание снимков PVC и использование снимков для конфигурации новых PVC для быстрого резервного копирования и восстановления бизнес-данных. <br />Если снимки не были включены во время доступа к хранилищу, вы все равно можете включить их позже в разделе **Операции** на странице деталей кластера хранения по мере необходимости. <br />**Примечание**: Пожалуйста, убедитесь, что вы [развернули плагин снимков томов](/configure/storage/functions/snapshot_con.mdx) для текущего кластера перед использованием. |
     | **Сетевая конфигурация**  | <ul><li>**Сеть хоста**: Вычислительные компоненты в этом кластере будут обращаться к **кластеру хранения** через **сеть хоста**.</li><li>**Сеть контейнеров**: Вычислительные компоненты в этом кластере будут обращаться к **кластеру хранения** через **сеть контейнеров**. Вы можете создать подсеть в управлении сетью и назначить подсеть пространству имен `rook-ceph`. Если оставить пустым, будет использоваться подсеть по умолчанию.</li></ul>                    |
     | **Другие параметры**      | Пожалуйста, заполните параметры аутентификации для внешнего Ceph, полученные на предварительных условиях.                                                                                                                                                             |

  4. На странице мастера **Создание класса хранения** завершите конфигурацию и нажмите **Доступ**.

     | Параметр                | Описание                                                                                                                                                                                                            |
     | :--------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
     | **Тип**                | В зависимости от типа созданного пула хранения выше, соответствующий класс хранения по умолчанию будет: <br /><ul><li>Файловое хранилище: CephFS файловое хранилище</li><li>Блочное хранилище: CephRBD блочное хранилище</li></ul> |
     | **Политика удержания** | Политика удержания для постоянных томов. <br /><ul><li> Удалить: Когда запрос на постоянный том удаляется, связанный постоянный том также будет удален.</li><li> Сохранить: Даже если запрос на постоянный том удаляется, связанный постоянный том все равно будет сохранен.</li></ul> |
     | **Распределение проекта** | Проекты, которые могут использовать этот тип хранилища. <br />Если в настоящее время нет проектов, требующих этот тип хранилища, вы можете выбрать не выделять проекты на данный момент и обновить их позже. |

  5. Подождите примерно 1-5 минут для успешной интеграции.
</Steps>

## Дальнейшие действия

- Создание классов хранения: [CephFS файловое хранилище](/configure/storage/functions/cephfs_storageclass.mdx), [CephRBD блочное хранилище](/configure/storage/functions/cephrbd_storageclass.mdx)

- Разработчики, использующие вышеуказанные классы хранилища для создания постоянных томов, могут расширить использование с функциями снимков томов и масштабирования.

**Примечание**: Если вам нужно управлять пулами хранения, конфигурациями хранилищ и т. д. для внешнего хранилища, операции необходимо выполнять на управленческой платформе кластера хранения.
