---
weight: 68
sourceSHA: 09e7069c521dcd874d40342fed787629c26a6bfda1bcab87e274187874d3776f
---

# Создание пользователя объекта хранилища Ceph

Мы допускаем создание и настройку пользователей объекта хранилища через определения пользовательских ресурсов (CRD).

## Предварительные требования

- Пул объектного хранилища был создан

## Процедура

<Steps>
  ### Создание пользователя

  Выполните команды на **контрольном узле** кластера.

  ```yaml
  cat << EOF | kubectl apply -f -
  apiVersion: ceph.rook.io/v1
  kind: CephObjectStoreUser
  metadata:
    name: <name>
    namespace: <namespace>
  spec:
    store: <ObjectStore>
    displayName: <displayName>
    clusterNamespace: <clusterNamespace>
    quotas:
      maxBuckets: -1
      maxSize: -1
      maxObjects: -1
    capabilities:
      user: "*"
      bucket: "*"
  EOF
  ```

  **Параметры**

  | **Параметры**       | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
  | :------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | **name**             | Имя создаваемого пользователя объекта хранилища.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
  | **namespace**        | Пространство имен, в котором создается пользователь объекта хранилища.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
  | **displayName**      | Отображаемое имя.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
  | **clusterNamespace** | Пространство имен, в котором находятся родительские `CephCluster` и `CephObjectStore`. Если не указано, пользователь должен находиться в том же пространстве имен, что и кластер и объектное хранилище. Чтобы включить эту функцию, `allowUsersInNamespaces` в CephObjectStore должен включать пространство имен этого пользователя.                                                                                                                                                                                                                                                                                                                                                                                                           |
  | **ObjectStore**      | Объектное хранилище, в котором будет создан пользователь. Это соответствует имени пула объектного хранилища.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
  | **quotas**           | **необязательно**<br />Это представляет собой ограничения квоты, которые могут быть установлены для пользователя.<li>maxBuckets: Максимальный лимит бакетов для пользователя. Установка в `-1` указывает на отсутствие ограничений.</li><li>maxSize: Максимальный лимит размера всех объектов во всех бакетах пользователя. Установка в `-1` указывает на отсутствие ограничений.</li><li>maxObjects: Максимальное количество объектов во всех бакетах пользователя. Установка в `-1` указывает на отсутствие ограничений.</li>                                                                                                                                                                                                                                                                          |
  | **capabilities**     | **необязательно**<br />Ceph позволяет предоставлять пользователям дополнительные разрешения. Эта настройка в настоящее время может использоваться только во время создания пользователя объекта хранилища. Если необходимо изменить разрешения пользователя, его необходимо удалить и создать заново. См. [документацию Ceph](https://docs.ceph.com/en/latest/radosgw/admin/#add-remove-admin-capabilities) для получения дополнительной информации. Мы поддерживаем добавление разрешений `read`, `write`, `read,write` или `*` для следующих ресурсов:<li>user</li><li>buckets</li><li>usage</li><li>metadata</li><li>zone</li><li>roles</li><li>info</li><li>amz-cache</li><li>bilog</li><li>mdlog</li><li>datalog</li><li>user-policy</li><li>odic-provider</li><li>ratelimit</li> |

  ### Разрешение на создание пользователя в других пространствах имен

  Если `CephObjectStoreUser` создается в пространстве имен, отличном от пространства имен кластера Rook, это пространство имен должно быть добавлено в этот список разрешенных пространств имен или указать "\*", чтобы разрешить все пространства имен. Это полезно для приложений, которым необходимо создавать учетные данные объекта хранилища в своем собственном пространстве имен.

  Выполните команды на **контрольном узле** кластера.

  ```bash
  kubectl -n rook-ceph patch cephobjectstore <ObjectStore> --type merge -p '{"spec":{"allowUsersInNamespaces":["*"]}}'
  ```

  ### Получение информации о пользователе

  Выполните команды на **контрольном узле** кластера.

  ```bash
  user_secret=$(kubectl -n <namespace> get cephobjectstoreuser <user-name> -o jsonpath='{.status.info.secretName}')

  # ACCESS_KEY
  kubectl -n <namespace> get secret $user_secret -o jsonpath='{.data.AccessKey}' | base64 --decode

  # SECRET_KEY
  kubectl -n <namespace> get secret $user_secret -o jsonpath='{.data.SecretKey}' | base64 --decode

  ```
</Steps>
