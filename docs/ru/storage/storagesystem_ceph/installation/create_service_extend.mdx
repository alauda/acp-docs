---
weight: 17
sourceSHA: 8e194d0174ba5e1e49d4439ab392ce66331507ce2c9af6f64ddd8a50370e5cbd
---

# Создание кластера Stretch Type

Кластер Stretch может охватывать две географически разные локации, обеспечивая возможности восстановления после катастроф для инфраструктуры хранения. В случае катастрофы, когда одна зона доступности из двух полностью недоступна, Ceph по-прежнему может поддерживать доступность.

## Терминология

| Термин                      | Объяснение                                                                                                                                                                                                                                        |
| --------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Кворумная зона доступности** | Обычно располагается в отдельной зоне, не несущей основные рабочие нагрузки, сосредотачиваясь на поддержании согласованности кластера и в основном используется для арбитражных решений при сбое в основном центре обработки данных или при сетевом разделе. |
| **Зона доступности данных**   | Основная область в кластере Ceph, где данные фактически хранятся и обрабатываются, несущая операционные нагрузки и задачи хранения данных, образуя вместе с кворумной зоной полный высокодоступный склад данных.                             |

## Типовая схема развертывания

Следующее содержимое предоставляет типовую схему развертывания для растянутых кластеров, вместе с описанием компонентов и принципами восстановления после катастроф.

### Описание компонентов

Узлы должны быть распределены по трем зонам доступности, включая две зоны доступности данных и одну кворумную зону.

- Обе зоны доступности данных должны полностью развернуть все основные [компоненты Ceph](../concepts/concept.mdx#ceph-module-functions) (MON, OSD, MGR, MDS, RGW), и каждая зона доступности данных должна настроить два экземпляра MON для высокой доступности. Когда оба экземпляра MON в одной зоне доступности данных недоступны, система определяет, что зона доступности находится в состоянии сбоя.

- Кворумная зона доступности требует развертывания только одного экземпляра MON, который служит узлом для арбитражных решений.

![](../../../../en/storage/storagesystem_ceph/assets/stretch_cluster.png)

### Объяснение восстановления после катастроф

- Когда зона доступности данных полностью выходит из строя, кластер Ceph автоматически переходит в ухудшенное состояние и вызывает уведомление об аварии. Система скорректирует минимальное количество реплик в пуле хранения (min\_size) с 2 до 1. Поскольку другая зона доступности данных по-прежнему поддерживает двойные реплики, кластер остается доступным. Когда неработающая зона доступности данных восстанавливается, система автоматически выполнит синхронизацию данных и вернется в здоровое состояние; если сбой невозможно устранить, рекомендуется заменить ее новой зоной доступности данных.

- Когда сетевое соединение между двумя зонами доступности данных прерывается, но они все еще могут нормально подключаться к кворумной зоне доступности, кворумная зона будет арбитрировать между двумя зонами доступности данных на основе заранее заданных политик, выбирая ту, которая в лучшем состоянии, чтобы продолжать предоставлять услуги в качестве основной зоны данных.

## Ограничения и ограничения

- **Ограничения пула хранения**: Эрационный кодированные пулы хранения не поддерживаются, и для защиты данных могут использоваться только механизмы репликации.

- **Ограничения классификации устройств**: Функциональность классификации устройств не поддерживается, и хранение не может быть стратифицировано на основе характеристик устройств.

- **Ограничения регионального развертывания**: Поддерживаются только две зоны доступности данных; не может существовать более двух зон доступности данных.

- **Требования к балансировке данных**: OSD веса двух зон доступности данных должны строго оставаться согласованными для обеспечения сбалансированного распределения данных.

- **Требования к среде хранения**: Разрешены только конфигурации OSD с полной флеш-памятью (All-Flash), минимизируя время, необходимое для восстановления после восстановления соединения и снижая вероятность потери данных.

- **Требования к задержке сети**: RTT (время в пути) между двумя зонами доступности данных не должен превышать 10 мс, а кворумная зона доступности должна соответствовать требованиям по задержке спецификаций ETCD для обеспечения надежности механизма арбитража.

## Предварительные условия\{#pre}

Пожалуйста, заранее классифицируйте все или часть узлов в кластере на три зоны доступности следующим образом:

- Убедитесь, что по крайней мере 5 узлов распределены между одной кворумной зоной доступности и двумя зонами доступности данных. Среди них кворумная зона доступности должна содержать хотя бы один узел, который может быть виртуальной машиной или облачным хостом.

- Убедитесь, что по крайней мере одна зона доступности из трех зон содержит основной узел (узел управления).

- Убедитесь, что как минимум 4 вычислительных узла равномерно распределены по 2 зонам доступности данных, с как минимум 2 вычислительными узлами, настроенными в каждой зоне доступности данных.

- Старайтесь обеспечить соответствие количества узлов и конфигураций дисков в двух зонах доступности данных.

## Процедура

<Steps>
  ### Тегирование узлов

  1. Перейдите в **Управление платформой**.

  2. В левой навигационной панели нажмите **Управление кластером** > **Кластер**.

  3. Нажмите на соответствующее имя кластера, чтобы перейти на страницу обзора кластера.

  4. Переключитесь на вкладку **Узлы**.

  5. На основании планирования в [Предварительных условиях](#pre) добавьте метку `topology.kubernetes.io/zone=<zone>` к этим узлам, чтобы классифицировать их в указанной зоне доступности. Здесь замените \<zone> на имя зоны доступности.

  ### Создание службы хранения

  Этот документ только описывает параметры, которые отличаются от стандартных кластеров; для других параметров, пожалуйста, обратитесь к [Созданию стандартного типа кластера](./create_service_stand.mdx).

  **Создать кластер**

  | Параметр                   | Описание                                                      |
  | --------------------------- | ---------------------------------------------------------------- |
  | **Тип кластера**           | Выберите **Stretch**.                                              |
  | **Кворумная зона доступности** | Выберите имя кворумной зоны доступности.                 |
  | **Зона доступности данных** | Выберите имена зон доступности и узлы. |

  **Создать пул хранения**

  | Параметр               | Описание                                                                                                                     |
  | ----------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
  | **Количество реплик**   | По умолчанию равно 4.                                                                                                                   |
  | **Количество экземпляров** | Когда тип хранения **Объектное Хранение**, для обеспечения доступности минимальное количество экземпляров составляет 2, а максимальное - 5. |
</Steps>

## Связанные операции

### Создание стандартного типа кластера

Для получения более подробной информации, пожалуйста, обратитесь к [Созданию стандартного типа кластера](./create_service_stand.mdx).

### Очистка распределенного хранилища

Для получения более подробной информации, пожалуйста, обратитесь к [Очистке распределенного хранилища](../how_to/clean_ceph.mdx).
