---
weight: 15
sourceSHA: 5d5fa25191b6bd1ab6f42579b77bc2d649e15795e5bcbfcde2a3b884bdbdc6c4
---

# Установка

Объектное хранилище Alauda Container Platform (ACP) с использованием MinIO является сервисом объектного хранения, основанным на открытом протоколе Apache License v2.0. Оно совместимо с интерфейсом облачного хранилища Amazon S3 и идеально подходит для хранения больших объемов неструктурированных данных, таких как изображения, видео, журналы, резервные данные и образы контейнеров/виртуальных машин. Объектный файл может иметь любой размер — от нескольких килобайт до максимума в 5 терабайтов.

## Предварительные условия

MinIO построен на основе хранилища, поэтому убедитесь, что в текущем кластере создан класс хранилища. Рекомендуется использовать TopoLVM.

## Развертывание оператора

1. В левом боковом меню нажмите **Хранение** > **Объектное хранилище**.

2. Нажмите **Настроить сейчас**.

3. На странице мастера **Развертывание оператора MinIO** нажмите **Развернуть оператора** в правом нижнем углу.

   - Как только страница автоматически перейдет к следующему шагу, это указывает на успешное развертывание оператора.

   - Если развертывание не удалось, обратитесь к подсказкам интерфейса для **Очистки развернутой информации и повторной попытки**, а затем повторно разверните оператора.

## Создание кластера

1. На странице мастера **Создание кластера** настройте базовую информацию.

   | Параметр      | Описание                                                                                                                                     |
   | -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Access Key** | Идентификатор ключа доступа. Уникальный идентификатор, связанный с закрытым ключом доступа; используется вместе с идентификатором ключа доступа для шифрования и подписи запросов.              |
   | **Secret Key** | Закрытый ключ доступа, используемый совместно с идентификатором ключа доступа для шифрования и подписи запросов, идентификации отправителя и предотвращения подделки запросов. |

2. В области **Конфигурация ресурсов** настройте спецификации в соответствии со следующими инструкциями.

   | Параметр        | Описание                                                                                                                                                                                                                                                                   |
   | ---------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Небольшой масштаб**  | Подходит для обработки до 100,000 объектов, поддерживает одновременный доступ не более 50 в тестовых средах или сценариях резервного копирования данных. Запрос и ограничение ресурсов на ЦП установлены по умолчанию на 2 ядра, а запрос и ограничение ресурсов по памяти установлены на 4 Gi.      |
   | **Средний масштаб** | Предназначен для корпоративных приложений, требующих хранения 1,000,000 объектов, и способен обрабатывать до 200 одновременных запросов. Запрос и ограничение ресурсов на ЦП установлены по умолчанию на 4 ядра, а запрос и ограничение ресурсов по памяти установлены на 8 Gi.         |
   | **Большой масштаб**  | Разработан для групповых пользователей с потребностями в хранении 10,000,000 объектов и обработке до 500 одновременных запросов, подходит для сценариев высокой нагрузки. Запрос и ограничение ресурсов на ЦП установлены по умолчанию на 8 ядер, а запрос и ограничение ресурсов по памяти установлены на 16 Gi. |
   | **Пользовательский**       | Предлагает гибкие параметры конфигурации для профессиональных пользователей с особыми потребностями, обеспечивая точное соответствие масштаба услуг и требований к производительности. Примечание: При настройке пользовательских спецификаций необходимо убедиться, что:                                                         |

   - Запрос ресурсов на ЦП составляет больше 100 м.
   - Запрос ресурсов по памяти составляет больше или равен 2 Gi.
   - Ограничения ресурсов на ЦП и память больше или равны запросам ресурсов. |

3. В области **Хранилище** настройте соответствующую информацию в соответствии со следующими инструкциями.

   | Параметр           | Описание                                                                                                                                                                                                        |
   | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | **Количество экземпляров** | Увеличение количества экземпляров в кластере MinIO может значительно повысить производительность и надежность системы, обеспечивая высокую доступность данных. Однако слишком большое количество экземпляров может привести к следующим проблемам: |

   - Увеличенное потребление ресурсов.
   - Если на узле размещено несколько экземпляров, сбой узла может привести к тому, что несколько экземпляров будут отключены одновременно, что снижает общую надежность кластера.\
     **Примечание**:
   - Минимальное количество экземпляров, которое можно указать, - 4.
   - Если количество экземпляров больше 16, указанное значение должно быть кратно 8.
   - При добавлении дополнительных пулов хранилища количество экземпляров не должно быть меньше количества экземпляров первого пула хранилища. |
     \| **Единичный объем хранилища** | Вместимость одного PVC хранилища. Каждый сервис хранения управляет одним объемом хранилища. После ввода вместимости одного объема хранилища платформа автоматически рассчитает вместимость пула хранилища и другую информацию, которую можно просмотреть в разделе **Обзор пула хранилища**. |
     \| **Основное хранилище** | Основное хранилище, используемое кластером MinIO. Пожалуйста, выберите класс хранилища, который был создан в текущем кластере. Рекомендуется использовать TopoLVM. |
     \| **Узлы хранилища** | Выберите узлы хранилища, необходимые для кластера MinIO. Рекомендуется использовать 4-16 узлов хранилища. Платформа развернет один сервис хранения для каждого выбранного узла хранилища. |
     \| **Обзор пула хранилища** | Для конкретных параметров и формул расчетов, пожалуйста, обратитесь к [Обзору пула хранилища](#stro). |

4. В области **Конфигурация доступа** настройте соответствующую информацию в соответствии со следующими инструкциями.

   | Параметр           | Описание                                                                                                                                                       |
   | ------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Внешний доступ** | Если включено, поддерживает кросс-кластерный доступ к MinIO; если отключено, поддерживает доступ только в пределах кластера.                                               |
   | **Протокол**        | Поддерживает HTTP и HTTPS; при выборе HTTPS вам необходимо ввести **Домен** и импортировать **Открытый ключ** и **Закрытый ключ** сертификата домена. |
   | **Примечание**:           |                                                                                                                                                                   |

   - Когда протокол доступа — HTTP, поды внутри кластера могут получить доступ к MinIO напрямую через полученный IP или доменное имя без необходимости настройки соответствия IP-адреса и доменного имени; узлы внутри кластера могут получить доступ к MinIO напрямую через полученный IP, и если требуется доступ через доменное имя, настройка соответствия IP-адреса и доменного имени должна быть выполнена вручную; внешний доступ может быть выполнен напрямую через полученный IP.
   - Когда протокол доступа — HTTPS, доступ к MinIO через IP невозможен как внутри, так и вне кластера. Необходимо вручную настроить соответствие между полученным IP-адресом и доменным именем, введенным во время создания кластера, чтобы получить доступ к MinIO нормально через доменное имя. |
     \| **Метод доступа** |
   - **NodePort**: Открывает фиксированный порт на каждом хосте вычислительного узла, чтобы предоставить внешний доступ к сервису. При настройке доступа через доменное имя рекомендуется использовать VIP для разрешения доменных имен, чтобы обеспечить высокую доступность.
   - **LoadBalancer**: Использует балансировщик нагрузки для перенаправления трафика на задние сервисы. Перед использованием убедитесь, что в текущем кластере развернут плагин MetalLB и в пуле внешних адресов есть доступные IP. |

5. Нажмите **Создать кластер** в правом нижнем углу.

   - Как только страница автоматически перейдет к **Деталям кластера**, это указывает на успешное создание кластера.

   - Если кластер остается в процессе создания, вы можете нажать **Отмена**. После отмены информация о развернутом кластере будет очищена, и вы можете вернуться на страницу создания кластера, чтобы повторно создать кластер.

## Создание ведра

Войдите в узел управления кластера и используйте команду для создания ведра.

### Процедура

1. На странице подробностей кластера нажмите вкладку **Метод доступа**, чтобы просмотреть адрес доступа к MinIO, или используйте следующую команду, чтобы запросить.

   ```bash
   kubectl get svc -n <tenant ns> minio | grep -w minio | awk '{print $3}'
   ```

   **Примечание:**

   - Замените `tenant ns` на актуальное пространство имен `minio-system`.
   - Пример: `kubectl get svc -n minio-system minio | grep -w minio | awk '{print $3}'`

2. Получите команду mc.

   ```bash
   wget https://dl.min.io/client/mc/release/linux-amd64/mc -O /bin/mc && chmod a+x /bin/mc
   ```

3. Настройте псевдоним кластера MinIO.

   - IPv4:

     ```bash
     mc --insecure alias set <minio cluster alias> http://<minio endpoint>:<port> <accessKey> <secretKey>
     ```

   - IPv6:
     ```bash
     mc --insecure alias set <minio cluster alias> http://[<minio endpoint>]:<port> <accessKey> <secretKey>
     ```

   - Доменное имя:
     ```bash
     mc --insecure alias set <minio cluster alias> http://<domain name>:<port> <accessKey> <secretKey>
     mc --insecure alias set <minio cluster alias> https://<domain name>:<port> <accessKey> <secretKey>
     ```

   **Примечание:**

   - Введите полученный на шаге 1 IP-адрес для `minio endpoint`.
   - Введите **Access Key** и **Secret Key**, созданные в ходе создания кластера, для `accessKey` и `secretKey`.
   - Примеры конфигурации:
     - IPv4: `mc --insecure alias set myminio http://12.4.121.250:80 07Apples@ 07Apples@`
     - IPv6: `mc --insecure alias set myminio http://[2004::192:168:143:117]:80 07Apples@ 07Apples@`
     - Доменное имя: `mc --insecure alias set myminio http://test.minio.alauda:80 07Apples@ 07Apples@` или `mc --insecure alias set myminio https://test.minio.alauda:443 07Apples@ 07Apples@`

4. Создайте ведро.

   ```bash
   mc --insecure mb <minio cluster alias>/<bucket name>
   ```

## Загрузка/Скачивание файлов

После создания ведра вы можете использовать командную строку для загрузки файлов в ведро или скачивания существующих файлов из ведра.

### Процедура

1. Создайте файл для тестирования загрузки. Этот шаг можно пропустить, если вы загружаете существующий файл.

   ```bash
   touch <file name>
   ```

2. Загрузите файлы в ведро.

   ```bash
   mc --insecure cp <file name> <minio cluster alias>/<bucket name>
   ```

3. Просмотрите файлы в ведре, чтобы подтвердить успешную загрузку.

   ```bash
   mc --insecure ls <minio cluster alias>/<bucket name>
   ```

4. Удалите загруженные файлы.

   ```bash
   mc --insecure rm <minio cluster alias>/<bucket name>/<file name>
   ```

## Связанная информация

### Таблица соответствия коэффициента резервирования

**Примечание**: При добавлении дополнительных пулов хранилища коэффициент резервирования необходимо рассчитывать на основе количества экземпляров в первом пуле хранилища.

| Количество экземпляров | Коэффициент резервирования |
| --------------- | ----------------- |
| **4 - 5**       | 2                 |
| **6 - 7**       | 3                 |
| **>= 8**        | 4                 |

### <span id="stro">Обзор пула хранилища</span>

| Параметр обзора пула хранилища                                                                                                                                                                                      | Формула расчета                                                                                                      |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| **Используемая емкость**                                                                                                                                                                                                  | Когда количество экземпляров ≤ 16, Используемая емкость = Вместимость одного объема хранилища × (Количество экземпляров - Коэффициент резервирования). |
| Когда количество экземпляров > 16, Используемая емкость = Вместимость одного объема хранилища × (Количество экземпляров - 4 × (Количество экземпляров + 15) / 16)). Результат "4 × (Количество экземпляров + 15) / 16)" должен быть округлен вниз. |                                                                                                                          |
| **Общая емкость**                                                                                                                                                                                                   | Общая емкость = Количество экземпляров × Вместимость одного объема хранилища                                                       |
| **Число допустимых отказов сервисов хранения**                                                                                                                                                                    | Когда количество экземпляров > 2 × Коэффициент резервирования, Число допустимых отказов сервисов хранения = Коэффициент резервирования.        |
| Когда количество экземпляров = 2 × Коэффициент резервирования, количество допустимых отказов сервисов хранения = Коэффициент резервирования - 1                                                                                             |                                                                                                                          |
