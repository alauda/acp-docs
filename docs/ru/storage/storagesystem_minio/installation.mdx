---
weight: 15
sourceSHA: 5d5fa25191b6bd1ab6f42579b77bc2d649e15795e5bcbfcde2a3b884bdbdc6c4
---

# Установка

Объектное хранилище Alauda Container Platform (ACP) с MinIO является службой объектного хранилища, основанной на открытом протоколе Apache License v2.0. Оно совместимо с интерфейсом службы облачного хранения Amazon S3 и идеально подходит для хранения больших объемов неструктурированных данных, таких как изображения, видео, файлы журналов, резервные данные и образы контейнеров/виртуальных машин. Объектный файл может иметь любой размер, начиная от нескольких килобайт до максимума в 5 терабайт.

## Предварительные требования

MinIO построен на базовом хранилище, поэтому убедитесь, что класс хранения был создан в текущем кластере. Рекомендуется использовать TopoLVM.

## Развертывание оператора

1. В левой навигационной панели нажмите **Хранение** > **Объектное хранилище**.

2. Нажмите **Настроить сейчас**.

3. На странице мастера **Развертывание оператора MinIO** нажмите **Развернуть оператор** в правом нижнем углу.

   - Как только страница автоматически перейдет к следующему шагу, это указывает на успешное развертывание оператора.

   - Если развертывание не удалось, обратитесь к подсказкам интерфейса для **Очистки развернутой информации и повторной попытки**, и повторно разверните оператора.

## Создание кластера

1. На странице мастера **Создание кластера** настройте основную информацию.

   | Параметр         | Описание                                                                                                                                     |
   | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
   | **Ключ доступа** | Идентификатор ключа доступа. Уникальный идентификатор, связанный с закрытым ключом доступа; используется с идентификатором ключа доступа для шифрования и подписи запросов.              |
   | **Секретный ключ** | Закрытый ключ доступа, используемый вместе с идентификатором ключа доступа для шифрования и подписи запросов, идентификации отправителя и предотвращения подделки запросов. |

2. В области **Конфигурация ресурсов** настройте спецификации в соответствии с следующими инструкциями.

   | Параметр           | Описание                                                                                                                                                                                                                                         |
   | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Малый масштаб**   | Подходит для обработки до 100,000 объектов, поддерживающих одновременный доступ не более 50 в тестовых средах или сценариях резервного копирования данных. Запрос и лимит ресурсов ЦП по умолчанию установлены на 2 ядра, а запрос и лимит памяти установлены на 4 Gi.      |
   | **Средний масштаб** | Разработан для приложений на уровне предприятия, требующих хранения 1,000,000 объектов и способного обрабатывать до 200 одновременных запросов. Запрос и лимит ресурсов ЦП по умолчанию установлены на 4 ядра, а запрос и лимит памяти установлены на 8 Gi.         |
   | **Большой масштаб** | Разработан для групп пользователей с потребностями в хранении 10,000,000 объектов и обработкой до 500 одновременных запросов, подходит для сценариев с высокой нагрузкой. Запрос и лимит ресурсов ЦП по умолчанию установлены на 8 ядер, а запрос и лимит памяти установлены на 16 Gi. |
   | **Пользовательский**| Предлагает гибкие параметры конфигурации для профессиональных пользователей с особыми потребностями, что обеспечивает точное соответствие масштаба обслуживания и требований к производительности. Примечание: При настройке пользовательских спецификаций убедитесь, что:                                                         |

   - Запрос ресурсов ЦП больше 100 м.
   - Запрос ресурсов памяти больше или равен 2 Gi.
   - Лимиты ресурсов ЦП и памяти больше или равны запросам ресурсов. |

3. В области **Хранилище Pool** настройте связанную информацию в соответствии с следующими инструкциями.

   | Параметр              | Описание                                                                                                                                                                                                        |
   | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | **Число экземпляров** | Увеличение числа экземпляров в кластере MinIO может значительно улучшить производительность и надежность системы, обеспечивая высокую доступность данных. Однако слишком большое количество экземпляров может привести к следующим проблемам: |

   - Увеличение потребления ресурсов.
   - Если узел хостит несколько экземпляров, сбой узла может привести к тому, что несколько экземпляров будут отключены одновременно, что снижает общую надежность кластера.\
     **Примечание**:
   - Минимальное количество экземпляров, которое можно ввести, составляет 4.
   - Если количество экземпляров больше 16, введенное значение должно быть кратным 8.
   - При добавлении дополнительных пулов хранения количество экземпляров не должно быть меньше количества экземпляров первого пула хранения. |
     \| **Единое хранилище** | Вместимость одного хранилища PVC. Каждая служба хранения управляет одним хранилищем. После ввода вместимости одного хранилища платформа автоматически вычислит вместимость пула хранения и другую информацию, которую можно просмотреть в **Обзоре пула хранения**. |
     \| **Базовое хранилище** | Базовое хранилище, используемое кластером MinIO. Пожалуйста, выберите класс хранения, который был создан в текущем кластере. Рекомендуется использовать TopoLVM. |
     \| **Узлы хранения** | Выберите узлы хранения, необходимые кластеру MinIO. Рекомендуется использовать от 4 до 16 узлов хранения. Платформа развернет одну службу хранения для каждого выбранного узла хранения. |
     \| **Обзор пула хранения** | Для конкретных параметров и формул расчета обратитесь к [Обзору пула хранения](#stro). |

4. В области **Конфигурация доступа** настройте связанную информацию в соответствии с следующими инструкциями.

   | Параметр             | Описание                                                                                                                                                         |
   | --------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Внешний доступ**    | При включении поддерживается кросс-кластерный доступ к MinIO; при выключении поддерживается только доступ внутри кластера.                                        |
   | **Протокол**          | Поддерживает HTTP и HTTPS; при выборе HTTPS нужно ввести **Домен** и импортировать **Открытый ключ** и **Закрытый ключ** сертификата доменного имени.               |
   | **Примечание**:       |                                                                                                                                                                   |

   - При использовании протокола доступа HTTP поды внутри кластера могут получить доступ к MinIO напрямую через полученный IP или доменное имя без настройки отображения IP-адресов и доменных имен; узлы внутри кластера могут получить доступ к MinIO напрямую через полученный IP, а если требуется доступ через доменное имя, необходимо ручное конфигурирование отображения IP-адреса и доменного имени; внешний доступ можно осуществить непосредственно через полученный IP.
   - При использовании протокола доступа HTTPS доступ к MinIO по IP невозможен как внутри, так и вне кластера. Необходимо вручную настроить отображение между полученным IP-адресом и доменным именем, введенным при создании кластера, для нормального доступа через доменное имя. |
     \| **Метод доступа** |
   - **NodePort**: Открывает фиксированный порт на каждом хосте вычислительного узла для внешнего обнародования службы. При конфигурировании доступа через доменное имя рекомендуется использовать VIP для разрешения доменных имен, чтобы обеспечить высокую доступность.
   - **LoadBalancer**: Использует балансировщик нагрузки для перенаправления трафика к бэкенд-сервисам. Перед использованием, пожалуйста, убедитесь, что плагин MetalLB развернут в текущем кластере и в пуле внешних адресов имеются доступные IP-адреса. |

5. Нажмите **Создать кластер** в правом нижнем углу.

   - Как только страница автоматически перейдет к **Деталям кластера**, это указывает на успешное создание кластера.

   - Если кластер остается в процессе создания, вы можете нажать **Отмена**. После отмены информация о развернутом кластере будет очищена, и вы сможете вернуться на страницу создания кластера, чтобы заново создать кластер.

## Создание корзины

Войдите в управляющий узел кластера и используйте команду для создания корзины.

### Процедура

1. На странице деталей кластера нажмите вкладку **Метод доступа**, чтобы просмотреть адрес доступа MinIO, или используйте следующую команду для запроса.

   ```bash
   kubectl get svc -n <tenant ns> minio | grep -w minio | awk '{print $3}'
   ```

   **Примечание:**

   - Замените `tenant ns` на фактическое пространство имен `minio-system`.
   - Пример: `kubectl get svc -n minio-system minio | grep -w minio | awk '{print $3}'`

2. Получите команду mc.

   ```bash
   wget https://dl.min.io/client/mc/release/linux-amd64/mc -O /bin/mc && chmod a+x /bin/mc
   ```

3. Настройте псевдоним кластера MinIO.

   - IPv4:

     ```bash
     mc --insecure alias set <псевдоним кластера minio> http://<адрес minio>:<порт> <доступный ключ> <секретный ключ>
     ```

   - IPv6:
     ```bash
     mc --insecure alias set <псевдоним кластера minio> http://[<адрес minio>]:<порт> <доступный ключ> <секретный ключ>
     ```

   - Доменное имя:
     ```bash
     mc --insecure alias set <псевдоним кластера minio> http://<доменное имя>:<порт> <доступный ключ> <секретный ключ>
     mc --insecure alias set <псевдоним кластера minio> https://<доменное имя>:<порт> <доступный ключ> <секретный ключ>
     ```

   **Примечание:**

   - Введите IP-адрес, полученный на шаге 1, для `адрес minio`.
   - Введите созданные при создании кластера **Ключ доступа** и **Секретный ключ** для `доступного ключа` и `секретного ключа`.
   - Примеры конфигурации:
     - IPv4: `mc --insecure alias set myminio http://12.4.121.250:80 07Apples@ 07Apples@`
     - IPv6: `mc --insecure alias set myminio http://[2004::192:168:143:117]:80 07Apples@ 07Apples@`
     - Доменное имя: `mc --insecure alias set myminio http://test.minio.alauda:80 07Apples@ 07Apples@` или `mc --insecure alias set myminio https://test.minio.alauda:443 07Apples@ 07Apples@`

4. Создайте корзину.

   ```bash
   mc --insecure mb <псевдоним кластера minio>/<имя корзины>
   ```

## Загрузка/Скачивание файлов

После создания корзины вы можете использовать командную строку, чтобы загрузить файлы в корзину или скачать существующие файлы из корзины.

### Процедура

1. Создайте файл для тестирования загрузки. Этот шаг можно пропустить, если вы загружаете существующий файл.

   ```bash
   touch <имя файла>
   ```

2. Загрузите файлы в корзину.

   ```bash
   mc --insecure cp <имя файла> <псевдоним кластера minio>/<имя корзины>
   ```

3. Просмотрите файлы в корзине, чтобы подтвердить успешную загрузку.

   ```bash
   mc --insecure ls <псевдоним кластера minio>/<имя корзины>
   ```

4. Удалите загруженные файлы.

   ```bash
   mc --insecure rm <псевдоним кластера minio>/<имя корзины>/<имя файла>
   ```

## Связанная информация

### Таблица соответствия коэффициента избыточности

**Примечание**: При добавлении дополнительных пулов хранения коэффициент избыточности должен рассчитываться на основе числа экземпляров в первом пуле хранения.

| Число экземпляров | Коэффициент избыточности |
| ------------------ | ------------------------- |
| **4 - 5**          | 2                         |
| **6 - 7**          | 3                         |
| **>= 8**           | 4                         |

### <span id="stro">Обзор пула хранения</span>

| Параметр обзора пула хранения                                                                                                                                                                                | Формула расчета                                                                                             |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| **Используемая вместимость**                                                                                                                                                                                  | Когда число экземпляров ≤ 16, Используемая вместимость = Вместимость одного хранилища × (Число экземпляров - Коэффициент избыточности). |
| Когда число экземпляров > 16, Используемая вместимость = Вместимость одного хранилища × (Число экземпляров - 4 × (Число экземпляров + 15) / 16). Результат "4 × (Число экземпляров + 15) / 16)" следует округлить вниз. |                                                                                                           |
| **Общая вместимость**                                                                                                                                                                                          | Общая вместимость = Число экземпляров × Вместимость одного хранилища                                       |
| **Число допустимых резервных служб хранения**                                                                                                                                                                 | Когда число экземпляров > 2 × Коэффициент избыточности, Число допустимых резервных служб хранения = Коэффициент избыточности.        |
| Когда число экземпляров = 2 × Коэффициент избыточности, число допустимых резервных служб хранения = Коэффициент избыточности - 1                                                                             |                                                                                                           |
