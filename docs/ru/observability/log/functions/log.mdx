---
weight: 20
sourceSHA: 6b985e1ba266fda02ad65e3a93f125dbaa50d954edee128020d7e8cb3e9b9a48
---

# Логи

## Анализ Запросов Логов

В панели анализа запросов логов Центра Операций вы можете просмотреть стандартные выходные логи (stdout) учетной записи с текущими правами доступа, включая системные логи, продуктовые логи, логи Kubernetes и логи приложений. С помощью этих логов вы можете получить представление о работе ресурсов.

- **Системные Логи**: Логи от узлов хоста, такие как: dmesg, syslog/messages, secure и др.
- **Продуктовые Логи**: Логи от собственных компонентов платформы и сторонних компонентов, интегрированных с платформой, такие как: Container-Platform, Platform-Center, DevOps, Service-Mesh и др.
- **Логи Kubernetes**: Логи от связанных с контейнерной оркестрацией Kubernetes компонентов, а также логи, сгенерированные kubelet, kubeproxy и docker, такие как: docker, kube-apiserver, kube-controller-manager, etcd и др.
- **Логи Приложений**: Логи от бизнес-приложений, включая файловые логи и стандартные выходные логи.

Условия запроса логов поддерживают фильтрацию логов в определенном временном диапазоне (выбранном или настраиваемом), и отображают результаты запроса через столбчатые диаграммы и стандартный вывод.

:::warning
В целях оптимизации производительности платформа может одновременно отображать максимум 10 000 логов. Если объем логов на платформе слишком велик за определенный промежуток времени, пожалуйста, уточните временной диапазон запроса и запрашивайте логи поэтапно.
:::

### Поиск Логов

1. В левом навигационном меню нажмите **Центр Операций** > **Логи** > **Анализ Запросов Логов**.

2. Выберите указанный тип логов, условия запроса, введите ключевые слова содержимого логов, которые вы хотите получить, и затем нажмите **Поиск**.

:::tip

- Разные **Типы Логов** позволяют устанавливать различные выбираемые условия запроса.

- Вы можете выбрать или ввести несколько тегов условий запроса; условия запроса для различных типов ресурсов находятся в логическом И. Некоторые теги условий запроса поддерживают множественный выбор; пожалуйста, убедитесь, что вы нажали клавишу `Enter` после выбора, чтобы отправить варианты.

- Условия поиска содержимого логов поддерживают нечеткий поиск; например, условие запроса `pod = nginx` может извлечь логи для `nginx-1`, `nginx-2`.

- Условия поиска содержимого логов используются только для извлечения ваших логовых ключевых слов и поддерживают использование параметров `AND` и `OR` для ассоциативных запросов. Тем не менее, пожалуйста, обратите внимание, что не следует одновременно использовать параметры `AND` и `OR` в одном запросе.

- Столбчатая диаграмма показывает общее количество логов в текущем временном диапазоне запроса и количество логов в разные моменты времени. Нажмите на столбец на диаграмме, чтобы просмотреть логи в промежутке времени между этим столбцом и следующим.

:::

### Экспорт Данных Логов

Страница может отображать максимум 10 000 записей логов. Когда количество извлеченных логов слишком велико, вы можете воспользоваться функцией экспорта логов для просмотра до 1 миллиона записей логов.

1. Нажмите кнопку **Экспорт** в правом верхнем углу столбчатой диаграммы и настройте следующие параметры в всплывающем диалоговом окне экспорта логов.

   - **Область**: Диапазон экспорта логов, вы можете выбрать **Текущая Страница** или **Все Результаты**.
     - **Текущая Страница**: Экспортировать только результаты запроса на текущей странице, максимум 1 000 записей.
     - **Все Результаты**: Экспортировать все данные логов, которые соответствуют текущим условиям запроса, максимум 1 миллион записей.

   - **Поля**: Поля отображения логов. Вы можете выбрать, какую информацию поля отображать в экспортируемом файле логов, нажав флажок рядом с названием поля.

     **Примечание**: Разные типы логов имеют различные доступные поля отображения, пожалуйста, выбирайте в соответствии с вашими реальными потребностями.

   - **Формат**: Формат экспорта файла логов, поддерживающий `txt` или `csv`. Платформа будет экспортировать в сжатом формате `gzip`.

2. Нажмите **Экспорт**, и браузер напрямую загрузит сжатый файл на ваш локальный компьютер.

### Просмотр Контекста Логов

1. Дважды щелкните по области содержимого логов, и текущее диалоговое окно отобразит 5 логов до и после времени печати текущего лога, помогая персоналу по эксплуатации и обслуживанию лучше понять причины появления текущих логов, сгенерированных ресурсами.

2. Вы можете установить отображаемые поля контекста логов или экспортировать контекст логов. При экспорте контекста логов нет необходимости выбирать **Область**; нажатие кнопки **Экспорт** напрямую загрузит файл контекста логов на ваш локальный компьютер через браузер.

## Управление Временем Сохранения Логов Приложений

Когда политика проекта не установлена, время хранения логов приложений на платформе определяется параметром `Время Сохранения Логов Приложений` установленного **Плагина Хранения Логов** на выбранном **Кластере Хранения**, когда **Сборщик Логов ACP** был установлен в кластер, где находится приложение.

Вы можете различать время хранения для **Логов Приложений** на платформе, добавляя и управляя политиками логов проекта.

:::tip
Политики проекта применяются только к **Логам Приложений** в рамках конкретного проекта. После установки политики проекта время хранения всех логов приложений этого проекта будет следовать политике проекта.
:::

### Установка Политик Хранения Администратором Платформы

1. В левом навигационном меню нажмите **Центр Операций** > **Логи** > **Управление Политикой**.

2. Нажмите **Добавить Политику Проекта**.

3. Нажмите на раскрывающееся меню для **Проекта** и выберите проект.

4. Установите **Время Хранения Логов**.

   - Используйте кнопки `-`/`+` по обеим сторонам счетчика, чтобы уменьшить/увеличить количество дней хранения, или введите значение напрямую в счетчик. Платформа позволяет устанавливать диапазон времени хранения от 1 до 30 дней.
   - Если введенное значение является десятичным, оно будет округлено до целого числа; если введенное значение меньше 1, оно будет округлено до 1, и кнопка `-` не будет доступна; если введенное значение превышает 30, оно будет округлено до 30, и кнопка `+` не будет доступна.

5. Нажмите **Добавить**.

### Установка Политик Хранения Администратором Проекта

1. Перейдите на страницу деталей текущего проекта.

2. Нажмите кнопку редактирования рядом с полем политики логов, чтобы активировать политику логов во всплывающем окне.

3. Установите **Время Хранения Логов**.

- Используйте кнопки `-`/`+` по обеим сторонам счетчика, чтобы уменьшить/увеличить количество дней хранения, или введите значение напрямую в счетчик. Платформа позволяет устанавливать диапазон времени хранения от 1 до 30 дней.
- Если введенное значение является десятичным, оно будет округлено до целого числа; если введенное значение меньше 1, оно будет округлено до 1, и кнопка `-` не будет доступна; если введенное значение превышает 30, оно будет округлено до 30, и кнопка `+` не будет доступна.

### Установка Политик Хранения Чрез CLI

1. Войдите в кластер `global` и выполните следующую команду:

```bash
kubectl edit project <Название Проекта>
```

2. Измените yaml в соответствии с приведенным ниже примером, сохраните и отправьте.

```yaml
apiVersion: auth.alauda.io/v1
kind: Project
metadata:
  annotations:
    cpaas.io/creator: mschen1@alauda.io
    cpaas.io/description: ""
    cpaas.io/display-name: ""
    cpaas.io/operator: leizhuc
    cpaas.io/project.esPolicyLastEnabledTimestamp: "2025-02-18T09:53:54Z"
    cpaas.io/updated-at: "2025-02-18T09:53:54Z"
creationTimestamp: "2025-02-13T08:19:11Z"
finalizers:
- namespace
generation: 1
labels:
  cpaas.io/project: bookinfo
  cpaas.io/project.esIndicesKeepDays: "7" # Продолжительность хранения логов приложений в проекте
  cpaas.io/project.esPolicyEnabled: "true" # Включить политику проекта
  cpaas.io/project.id: "95447321"
  cpaas.io/project.level: "1"
  cpaas.io/project.parent: ""
name: bookinfo
### Дополнительная информация yaml, не подлежащая модификации, опущена.
```

## Настройка Частичного Исключения Собираемых Логов Приложений

Если вам нужно только просмотреть **Логи В Реальном Времени** определенных приложений в кластере, не желая сохранять эти логи (сборщикdiscard соответствующие логи), вы можете обратиться к этой секции, чтобы установить область для остановки сбора логов (кластер, пространство имен, Pod) для тонкой настройки сбора логов приложений.

### Остановка Сбора Всех Логов Приложений В Кластере

Вы можете обновить **Параметры Конфигурации** сборщика **ACP Log Collector** кластера, чтобы отключить переключатель сбора **Логов Приложений**, тем самым единообразно обновив объем сбора логов для данного кластера. Как только переключатель сбора для определенного типа логов будет отключен, сбор всех логов этого типа в текущем кластере прекратится.

### Остановка Сбора Логов Приложений В Определенном Пространстве Имен

Вы можете отключить переключатель сбора логов для данного пространства имен, добавив метку `cpaas.io/log.mute=true` к указанному пространству имен, тем самым остановив сбор всех стандартных выходных логов и файловых логов для всех Pods в этом пространстве имен.

Методы конфигурации следующие:

- **Метод Командной Строки**: После входа в любую контрольную ноду кластера выполните следующую команду, чтобы обновить метку пространства имен.

  ```bash
  kubectl label namespace <Название Пространства Имен> cpaas.io/log.mute=true
  ```

- **Метод Действия Чрез Интерфейс**: В представлении **Управление Проектами** обновите метку пространства имен.

  1. В списке проектов представления **Управление Проектами** нажмите на ***Название Проекта***, в котором находится пространство имен.

  2. В левом навигационном меню нажмите **Пространства Имен**.

  3. Нажмите на ***Название Пространства Имен***, метка которого должна быть обновлена.

  4. На вкладке **Детали** нажмите кнопку действия справа от **Метки**.

  5. Добавьте метку (Ключ: `cpaas.io/log.mute`, Значение: `true`) или измените значение существующей метки, затем нажмите **Обновить**.

### Остановка Сбора Логов Pod

Вы можете отключить переключатель сбора логов для определенного Pod, добавив метку `cpaas.io/log.mute=true` к нему, тем самым остановив сбор стандартных выходных логов и файловых логов для этого Pod.

После входа в любую контрольную ноду кластера выполните следующую команду, чтобы обновить метку Pod.

```bash
kubectl label pod <Название Pod> -n <Название Пространства Имен> cpaas.io/log.mute=true
```

**Примечание**: Если Pod принадлежит вычислительному компоненту (Рабочей Нагрузке), вы можете обновить метки вычислительного компонента (Deployment, StatefulSet, DaemonSet, Job, CronJob) для единообразного обновления меток всех Pods под этим вычислительным компонентом, и метки не будут потеряны даже после воссоздания Pod.

Вы можете обновить метки вычислительного компонента следующим образом.

1. В представлении продукта **Платформа Контейнеров** щелкните верхнюю навигацию, чтобы переключиться на пространство имен, в котором находится Pod.

2. В левом навигационном меню нажмите **Вычислительные Компоненты** > ***Тип Вычислительного Компонента, к которому относится Pod***.

3. Нажмите кнопку действия справа от вычислительного компонента, который нужно обновить > **Обновить**.

4. Нажмите **YAML** в правом верхнем углу, чтобы переключиться на представление редактирования YAML.

5. Под полем **spec.template.labels** добавьте метку `cpaas.io/log.mute: 'true'`.

   Пример представлен ниже:

   ```yaml
   spec:
     template:
       metadata:
         namespace: tuhao-test
         creationTimestamp: null
         labels:
           app: spilo
           cpaas.io/log.mute: 'true'
           cluster-name: acid-minimal-cluster
           role: exporter
           middleware.instance/name: acid-minimal-cluster
           middleware.instance/type: PostgreSQL
   ```

6. Нажмите **Обновить**.
