---
weight: 20
sourceSHA: aacaf3a8dc9a145a774fcded014a160bb5e02e92aadd56cec5f53a0bcb30daee
---

# Как взаимодействовать с внешними кластерами ES-хранения

Вы можете взаимодействовать с внешними кластерами Elasticsearch или Kafka, написав конфигурации YAML. В зависимости от ваших бизнес-требований вы можете выбрать взаимодействие только с внешним кластером Elasticsearch (при этом устанавливая Kafka в текущем кластере) или одновременно взаимодействовать с внешними кластерами Elasticsearch и Kafka.

:::tip

Поддерживаемые версии для взаимодействия с внешним Elasticsearch следующие:

- Elasticsearch 6.x поддерживает версии 6.6 - 6.8;
- Elasticsearch 7.x поддерживает версии 7.0 - 7.10.2, рекомендуется использовать 7.10.2.

:::

## Подготовка ресурсов

Перед взаимодействием вам необходимо подготовить необходимую информацию для учетных данных.

1. В левом навигационном меню нажмите на **Управление кластером** > **Управление ресурсами**, затем переключитесь на кластер, который нуждается в установке плагина.

2. Нажмите на **Создать объект ресурса**, и заполните кодовое поле после изменения параметров в соответствии с комментариями коду.

- Учетные данные, необходимые для взаимодействия с внешним Elasticsearch:

  ```yaml
  apiVersion: v1
  type: Opaque
  data:
    password: dEdWQVduSX5kUW1mc21acg==  # Должен быть закодирован в base64. Ссылка на команду: echo -n <password_value>| base64
    username: YWRtaW4=                  # Должен быть закодирован в base64. Ссылка на команду: echo -n <username_value>| base64
  kind: Secret
  metadata:
    name: elasticsearch-basic-auth      # Имя учетной записи. Убедитесь, что значение elasticsearch.basicAuthSecretName в YAML для хранения логов совпадает с этим параметром.
    namespace: cpaas-system             # Пространство имен, в котором расположен компонент Elasticsearch, обычно cpaas-system.
  ```

- Если вам нужно использовать внешний кластер Kafka, вам также необходимо создать учетные данные для взаимодействия с внешним кластером Kafka:

  ```yaml
  apiVersion: v1
  type: Opaque
  data:
    password: dEdWQVduSX5kUW1mc21acg==  # Должен быть закодирован в base64. Ссылка на команду: echo -n <password_value>| base64
    username: YWRtaW4=                  # Должен быть закодирован в base64. Ссылка на команду: echo -n <username_value>| base64
  kind: Secret
  metadata:
    name: kafka-basic-auth              # Имя учетной записи. Убедитесь, что значение kafka.basicAuthSecretName в YAML для хранения логов совпадает с этим параметром.
    namespace: cpaas-system             # Пространство имен, в котором расположен компонент Kafka, обычно cpaas-system.
  ```

3. Нажмите на **Создать**.

## Процедуры работы

1. В левом навигационном меню нажмите на **Магазин приложений** > **Управление плагинами**.

2. В верхнем навигационном меню выберите ***Имя кластера***, в который вы хотите установить плагин хранения логов ACP с Elasticsearch.

3. Нажмите кнопку действия с правой стороны от **ACP Log Storage с Elasticsearch** > **Установить**.

4. Включите переключатель **Взаимодействие с внешним Elasticsearch**, настройте файл YAML, с примером взаимодействия и описаниями параметров, как показано ниже:

- Взаимодействие с внешним кластером Elasticsearch при установке Kafka в текущем кластере:

  ```yaml
  elasticsearch:
    install: false
    address: http://fake:9200                # Внешний адрес доступа к ES, например, http://192.168.143.252:11780/es_proxy
    basicAuthSecretName: elasticsearch-basic-auth # Учетные данные, необходимые для взаимодействия с внешним Elasticsearch, созданные предварительно.
  storageClassConfig:
    type: "LocalVolume"   # По умолчанию LocalVolume. Опции: "LocalVolume" или "StorageClass".
  kafka:
    auth: true                               # Необходимо ли включить аутентификацию.
    k8sNodes:
    - log1                                   # Имя узла, полученное с помощью kubectl get nodes.
    - log2
    - log3
    storageSize: 10                          # Размер хранилища, в Gi, по умолчанию 10 Gi.
  ```

- Взаимодействие как с внешним кластером Elasticsearch, так и с внешним кластером Kafka:

  ```yaml
  elasticsearch:
    install: false
    address: http://fake:9200                # Внешний адрес доступа к ES, например, http://192.168.143.252:11780/es_proxy
    basicAuthSecretName: elasticsearch-basic-auth # Учетные данные, необходимые для взаимодействия с внешним Elasticsearch, созданные предварительно.
  kafka:
    auth: true                               # Необходимо ли включить аутентификацию.
    install: false
    basicAuthSecretName: kafka-basic-auth  # Учетные данные, необходимые для взаимодействия с внешним Kafka, созданные предварительно.
    address: 192.168.130.169:9092,192.168.130.187:9092,192.168.130.193:9092     # Адреса доступа к Kafka, разделенные запятыми.
  ```
