---
weight: 20
sourceSHA: aacaf3a8dc9a145a774fcded014a160bb5e02e92aadd56cec5f53a0bcb30daee
---

# Как взаимодействовать с внешними кластерами хранения ES

Вы можете взаимодействовать с внешними кластерами Elasticsearch или Kafka, написав конфигурации YAML. В зависимости от ваших бизнес-требований, вы можете выбрать взаимодействие только с внешним кластером Elasticsearch (устанавливая Kafka в текущем кластере) или одновременно с обоими внешними кластерами Elasticsearch и Kafka.

:::tip

Поддерживаемые версии для взаимодействия с внешними Elasticsearch следующие:

- Elasticsearch 6.x поддерживает версии 6.6 - 6.8;
- Elasticsearch 7.x поддерживает версии 7.0 - 7.10.2, с рекомендацией использовать 7.10.2.

:::

## Подготовка ресурсов

Перед взаимодействием вам необходимо подготовить необходимую учетную информацию.

1. В левом навигационном баре нажмите на **Управление кластером** > **Управление ресурсами**, затем переключитесь на кластер, где требуется установка плагина.

2. Нажмите на **Создать объект ресурса** и заполните кодовое поле после изменения параметров в соответствии с комментариями к коду.

- Учетные данные, необходимые для взаимодействия с внешним Elasticsearch:

  ```yaml
  apiVersion: v1
  type: Opaque
  data:
    password: dEdWQVduSX5kUW1mc21acg==  # Должен быть закодирован в base64. Команда справки: echo -n <password_value>| base64
    username: YWRtaW4=                  # Должен быть закодирован в base64. Команда справки: echo -n <username_value>| base64
  kind: Secret
  metadata:
    name: elasticsearch-basic-auth      # Название учетных данных. Убедитесь, что значение elasticsearch.basicAuthSecretName в YAML для хранения журналов соответствует этому параметру.
    namespace: cpaas-system             # Пространство имен, где находится компонент Elasticsearch, обычно cpaas-system.
  ```

- Если вам нужно использовать внешний кластер Kafka, вам также необходимо создать учетные данные для взаимодействия с внешним кластером Kafka:

  ```yaml
  apiVersion: v1
  type: Opaque
  data:
    password: dEdWQVduSX5kUW1mc21acg==  # Должен быть закодирован в base64. Команда справки: echo -n <password_value>| base64
    username: YWRtaW4=                  # Должен быть закодирован в base64. Команда справки: echo -n <username_value>| base64
  kind: Secret
  metadata:
    name: kafka-basic-auth              # Название учетных данных. Убедитесь, что значение kafka.basicAuthSecretName в YAML для хранения журналов соответствует этому параметру.
    namespace: cpaas-system             # Пространство имен, где находится компонент Kafka, обычно cpaas-system.
  ```

3. Нажмите на **Создать**.

## Операционные процедуры

1. В левом навигационном баре нажмите на **Магазин приложений** > **Управление плагинами**.

2. В верхней навигации выберите ***Имя кластера***, где вы хотите установить плагин хранения журналов ACP с Elasticsearch.

3. Нажмите кнопку действия справа от **ACP Log Storage with Elasticsearch** > **Установить**.

4. Включите переключатель **Взаимодействие с внешним Elasticsearch**, настройте файл YAML, приведя пример взаимодействия и описания параметров, как указано ниже:

- Взаимодействие с внешним кластером Elasticsearch при установке Kafka в текущем кластере:

  ```yaml
  elasticsearch:
    install: false
    address: http://fake:9200                # Внешний адрес доступа ES, например, http://192.168.143.252:11780/es_proxy
    basicAuthSecretName: elasticsearch-basic-auth # Учетные данные, необходимые для взаимодействия с внешним Elasticsearch, созданные на этапе подготовки.
  storageClassConfig:
    type: "LocalVolume"   # По умолчанию LocalVolume. Варианты: "LocalVolume" или "StorageClass".
  kafka:
    auth: true                               # Включить ли аутентификацию.
    k8sNodes:
    - log1                                   # Название узла, получаемое с помощью kubectl get nodes.
    - log2
    - log3
    storageSize: 10                          # Размер хранилища, в Gi, по умолчанию 10 Gi.
  ```

- Взаимодействие как с внешним кластером Elasticsearch, так и с внешним кластером Kafka:

  ```yaml
  elasticsearch:
    install: false
    address: http://fake:9200                # Внешний адрес доступа ES, например, http://192.168.143.252:11780/es_proxy
    basicAuthSecretName: elasticsearch-basic-auth # Учетные данные, необходимые для взаимодействия с внешним Elasticsearch, созданные на этапе подготовки.
  kafka:
    auth: true                               # Включить ли аутентификацию.
    install: false
    basicAuthSecretName: kafka-basic-auth  # Учетные данные, необходимые для взаимодействия с внешним Kafka, созданные на этапе подготовки.
    address: 192.168.130.169:9092,192.168.130.187:9092,192.168.130.193:9092     # Адреса доступа Kafka, разделенные запятыми.
  ```
