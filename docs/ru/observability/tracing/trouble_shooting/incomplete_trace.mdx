---
weight: 20
sourceSHA: ff5ed037e8247239016cdf632f57ff1e6062dcb4273e9a09debea0b719f0b14a
---

# Неполные данные трассировки

## Описание проблемы

Результаты запроса трассировки демонстрируют следующие проблемы с неполными данными:

- Последние запросы (за последние 30 минут) не содержат некоторых спанов.
- Трассировка старше 1 часа испытывает отключения.

## Анализ первопричины

### 1. Задержка в сохранении данных

Процесс записи в Elasticsearch требует последовательности этапов, включая буфер памяти → транслог → сегментные файлы, что может привести к задержкам видимости для недавно записанных данных.

### 2. Ограничение временного диапазона

По умолчанию, когда `jaeger-query` запрашивает спаны, соответствующие трассировке, временной диапазон охватывает один час до и после времени начала спана.

Например, если спан начинается в `08:12:30` и заканчивается в `08:12:32`, временной диапазон для запроса этой трассировки будет с `07:12:30` до `09:12:32`.

Таким образом, если трассировка охватывает более 1 часа, запрос по этому спану может не вернуть полную трассировку.

## Решение для первопричины 1

Подождите немного и обновите страницу, чтобы попробовать выполнить запрос снова.

## Решение для первопричины 2 

Если спан трассировки в вашей среде длительный, вы можете настроить временной диапазон запроса для одной трассировки, используя параметр запуска `--es.asm.span-trace-query-time-adjustment-hours` в `jaeger-query`.

Значение по умолчанию для этого параметра составляет `1` час, и вы можете увеличить это значение по мере необходимости.
