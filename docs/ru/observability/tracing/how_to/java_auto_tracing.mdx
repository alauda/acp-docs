---
weight: 10
sourceSHA: 10364050b177ee8aefec71af8ac57c62afc90ae68b45cce0b49a25433a493cb1
---

# Ненеактивная интеграция трассировки в Java-приложениях

:::info

Автоматически внедряемый [OpenTelemetry Java Agent](https://github.com/open-telemetry/opentelemetry-java-instrumentation) поддерживает версии `Java 8+`.

:::

## Обзор функций

Трассировка является основной возможностью наблюдаемости в распределенных системах, которая может полностью записывать пути вызовов и данные о производительности запросов в системе. Эта статья описывает, как добиться ненеактивной интеграции трассировки в Java-приложениях с использованием автоматического внедрения OpenTelemetry Java Agent.

## Сценарии использования

Java-приложения могут быть интегрированы для следующих сценариев:

- Быстрое добавление возможностей трассировки в Java-приложения
- Избежание изменений в исходном коде приложения
- Развертывание служб с помощью Kubernetes
- Визуализация взаимосвязей между вызовами служб и анализ узких мест в производительности

## Предварительные требования

Перед использованием этой функции убедитесь, что:

- Целевая служба развернута на платформе Alauda Container Platform
- Служба использует версию JDK Java 8 или выше
- У вас есть права на редактирование развертывания в целевом пространстве имен
- Платформа завершила [развертывание трассировки](../installation.mdx)

## Шаги по эксплуатации

Для Java-приложения, которое необходимо интегрировать в трассировку платформы Alauda Container Platform, требуемые изменения следующие:

- Настройте аннотации автоматического внедрения для Java Deployment.
- Установите переменную окружения `SERVICE_NAME`.
- Установите переменную окружения `SERVICE_NAMESPACE`.

Пример адаптации Deployment:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-java-deploy
spec:
  template:
    metadata:
      annotations:
        instrumentation.opentelemetry.io/inject-java: cpaas-system/acp-common-java  # [!code callout]
      labels:
        app.kubernetes.io/name: my-java-app
    spec:
      containers:
      - env:
        - name: SERVICE_NAME  # [!code callout]
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.labels['app.kubernetes.io/name']
        - name: SERVICE_NAMESPACE  # [!code callout]
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
```

<Callouts>
  1. Выберите `cpaas-system/acp-common-java` как конфигурацию для внедрения Java Agent.
  2. Настройте переменную окружения `SERVICE_NAME`, которая может быть связана через ярлыки или фиксированные значения.
  3. Настройте переменную окружения `SERVICE_NAMESPACE`, со значением как `metadata.namespace`.
</Callouts>

## Результаты эксплуатации

После адаптации Java-приложения:

- Если новый запущенный Java-под с `opentelemetry-auto-instrumentation-java` init контейнером, это указывает на успешное внедрение.
- Отправьте тестовые запросы к Java-приложению.
- В представлении **Container Platform** выберите **проект**, **кластер** и **пространство имен**, где находится Java-приложение.
- Перейдите на страницу **Observability** -> **Tracing**, чтобы просмотреть данные трассировки и диаграмму временной шкалы Java-приложения.
