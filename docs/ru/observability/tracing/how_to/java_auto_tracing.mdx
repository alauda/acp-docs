---
weight: 10
sourceSHA: 10364050b177ee8aefec71af8ac57c62afc90ae68b45cce0b49a25433a493cb1
---

# Ненавязчивая интеграция трассировки в Java-приложениях

:::info

Автоматически встроенный [OpenTelemetry Java Agent](https://github.com/open-telemetry/opentelemetry-java-instrumentation) поддерживает версии `Java 8+`.

:::

## Обзор функции

Трассировка является ключевой возможностью наблюдаемости в распределенных системах, обеспечивая полную запись путей вызовов и данных о производительности запросов в системе. В данной статье описывается, как достичь ненавязчивой интеграции трассировки в Java-приложениях с использованием автоматического внедрения OpenTelemetry Java Agent.

## Сценарии использования

Java-приложения могут быть интегрированы для следующих сценариев:

- Быстрое добавление возможностей трассировки в Java-приложения
- Избежание изменений в исходном коде приложения
- Развертывание сервисов с помощью Kubernetes
- Визуализация межсервисных вызовов и анализ узких мест производительности

## Предварительные условия

Перед использованием этой функции убедитесь, что:

- Целевой сервис развернут на платформе Alauda Container Platform
- Сервис использует версию JDK Java 8 или выше
- У вас есть разрешения на редактирование Deployment в целевом пространстве имен
- Платформа завершила [развертывание трассировки](../installation.mdx)

## Шаги выполнения

Для Java-приложения, которое необходимо интегрировать в трассировку платформы Alauda Container, требуются следующие адаптации:

- Настройте аннотации автоматического внедрения для Java Deployment.
- Установите переменную окружения `SERVICE_NAME`.
- Установите переменную окружения `SERVICE_NAMESPACE`.

Пример адаптации Deployment:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-java-deploy
spec:
  template:
    metadata:
      annotations:
        instrumentation.opentelemetry.io/inject-java: cpaas-system/acp-common-java  # [!code callout]
      labels:
        app.kubernetes.io/name: my-java-app
    spec:
      containers:
      - env:
        - name: SERVICE_NAME  # [!code callout]
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.labels['app.kubernetes.io/name']
        - name: SERVICE_NAMESPACE  # [!code callout]
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
```

<Callouts>
  1. Выберите `cpaas-system/acp-common-java` в качестве конфигурации для внедрения Java Agent.
  2. Настройте переменную окружения `SERVICE_NAME`, которую можно ассоциировать с помощью меток или фиксированных значений.
  3. Настройте переменную окружения `SERVICE_NAMESPACE`, установив ее значение как `metadata.namespace`.
</Callouts>

## Результаты операции

После адаптации Java-приложения:

- Если вновь запущенный Java-под содержит init-контейнер `opentelemetry-auto-instrumentation-java`, это указывает на успешное внедрение.
- Отправьте тестовые запросы в Java-приложение.
- В представлении **Container Platform** выберите **проект**, **кластер** и **пространство имен**, в котором находится Java-приложение.
- Перейдите на страницу **Observability** -> **Tracing**, чтобы увидеть данные трассировки и диаграмму временной линии Java-приложения.
