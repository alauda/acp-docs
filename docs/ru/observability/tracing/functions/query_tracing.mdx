---
weight: 10
sourceSHA: 4c27cb43631fcea956fb1344f79936891877cd666224cdc1e6ba37af08b0b017
---

# Отслеживание запросов

## Обзор функции

Функция отслеживания запросов распределенной передачи данных предоставляет полное отслеживание ссылок для архитектуры микросервисов, собирая информацию о метаданных вызовов между сервисами, что помогает пользователям быстро находить проблемы кросс-сервисных вызовов. Эта функция в основном решает следующие проблемы:

- **Отслеживание ссылок на запросы**: Восстановление полного пути запроса в сложных распределенных системах.
- **Анализ узких мест производительности**: Определение аномальных узлов вызова по времени, затрачиваемому в рамках связи.
- **Определение корневой причины сбоя**: Быстрое определение места возникновения проблемы с помощью пометок об ошибках.

Применимые сценарии включают:

- Быстрое нахождение аномальных сервисов во время устранения сбоев в производственной среде.
- Определение вызовов с высокой задержкой во время настройки производительности.
- Проверка взаимосвязей межсервисных вызовов после релиза новой версии.

Основные ценности:

- Повышение наблюдаемости распределенных систем.
- Сокращение среднего времени восстановления (MTTR).
- Оптимизация производительности межсервисных вызовов.

## Основные функции

- Многомерные запросы: Поддерживает 6 комбинаций условий запроса, таких как TraceID, имя сервиса, метки и др.
- Визуальный анализ: Интуитивно отображает иерархию вызовов и распределение времени с помощью диаграмм водопадов временных рядов.
- Точное местоположение: Поддерживает фильтрацию ошибок Span и вторичные поиски с использованием меток.

## Преимущества функции

- **Быстрая идентификация проблем**: Сужение диапазона проверки через многомерные условия запроса ускоряет локализацию проблемы.
- **Визуальное представление**: Использование диаграмм водопадов временных рядов для интуитивного отображения взаимосвязей вызовов снижает сложность и повышает эффективность анализа сбоев.
- **Гибкость и разнообразие**: Поддержка как простых запросов, так и сложных комбинаций, адаптированных к различным сценариям работы и разработки.

## Запрос на отслеживание

<Steps>
  ### Шаг 1: Объединить условия запроса

  **Совет**: Условия запроса могут быть объединены для использования. Вы можете уточнить свой запрос, добавив несколько условий запроса.

  | Условие запроса                   | Описание                                                                                                                                                                                                                                                                                                                                                |
  | --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | **TraceID**                       | Уникальный идентификатор для полного связывания, который можно использовать для запроса указанного отслеживания.                                                                                                                                                                                                                                     |
  | **Сервис**                        | Сервис, который инициирует/принимает запрос на вызов (необходима выборка или ввод).                                                                                                                                                                                                                                                                 |
  | **Метка**                         | Вы можете фильтровать результаты запроса, вводя метки (Теги), поддерживаемые Теги включают те, что находятся в деталях Span.                                                                                                                                                                                                                           |
  | **Продолжительность Span больше** | Spans, которые имеют продолжительность больше или равную *введенному значению* (мс).                                                                                                                                                                                                                                                                  |
  | **Только поиск ошибочных Spans**   | Ошибочные Spans относятся к Spans, значение Тега **error** которых равно `true`.                                                                                                                                                                                                                                                                      |
  | **Тип Span**                     | **Корневой Span**: Поиск корневых Spans, инициированных настраиваемым **сервисом**. Этот режим поиска используется, когда настраиваемый сервис является инициатором всего запроса. <br />**Входной Span сервиса**: Поиск первого Span, созданного, когда настраиваемый **сервис** вызывается как сервер.                                          |
  | **Максимальное количество запросов** | Максимальное количество Spans, которые можно запросить, по умолчанию 200. <br />**Совет**: По соображениям производительности платформа может одновременно отображать максимум 1000 Spans. Если количество Spans, соответствующих условиям запроса, превышает **максимальное количество запросов**, вы можете уточнить условия запроса или сузить временной диапазон для поэтапных запросов. |

  ### Шаг 2: Выполнить запрос

  - После выбора условий запроса и ввода соответствующих значений нажмите кнопку **Добавить к условиям запроса**, и текущие условия будут отображаться в области результатов **Условия запроса**, запуская запрос.
  - Вы также можете развернуть **Общие условия запроса**, чтобы быстро добавить недавно использованные условия поиска.
</Steps>

## Анализ результатов запроса

После ввода условий запроса и выполнения поиска на странице будет сгенерирован участок результатов запроса.

### Список Span

Слева от области результатов запроса отображается список Spans, соответствующих условиям, вместе с основной информацией о Spans, включая: имя сервиса, вызываемый интерфейс или метод обработки запроса, продолжительность и время начала.

### Диаграмма водопадов временных рядов

Диаграмма водопадов временных рядов справа от области результатов запроса четко отображает взаимосвязи вызовов между Spans в одном отслеживании. Основные характеристики использования диаграмм водопадов временных рядов в анализе отслеживания таковы:

1. Расширение сверху вниз: В диаграмме водопадов временных рядов различные события вызова (Spans) обычно расширяются вниз от верхней части диаграммы, при этом каждая горизонтальная полоса представляет собой вызов сервиса или процесс. Положение обычно отражает логический порядок вызова операций.
2. Выравнивание по временной оси: Горизонтальная ось диаграммы водопадов временных рядов представляет время. Длина каждой полосы указывает на продолжительность этого вызова, что позволяет интуитивно сравнивать временные взаимосвязи между различными вызовами.
3. Описание отступа: Отступ указывает на иерархические взаимосвязи вызовов, при этом более глубокий отступ обозначает большую глубину вызова внутри данной связи.
4. Интерактивность и отображение подробных данных: Нажатие на полосы в диаграмме водопадов временных рядов может отображать более подробную информацию о данном вызове.

### Подробности Span

Щелкнув по строке Span в диаграмме водопадов временных рядов, вы можете развернуть и просмотреть подробную информацию о Span, включая:

- Сервис: Сервис внутри Span.
- Продолжительность Span (мс): Продолжительность Span.
- URL: URL, к которому обращается сервис, соответствующий **http.url** в тегах Span.
- Тег: Информация о метках Span, состоящая из пар ключ-значение, которые можно использовать для условий запроса по меткам. Нажав кнопку рядом с тегом, вы можете добавить текущее условие Тега к условиям запроса для более точных результатов запроса.
- JSON: Исходная структура JSON Span, позволяющая более подробно исследовать его внутреннюю информацию.
