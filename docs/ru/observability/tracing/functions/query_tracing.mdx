---
weight: 10
sourceSHA: 4c27cb43631fcea956fb1344f79936891877cd666224cdc1e6ba37af08b0b017
---

# Запись запросов

## Обзор функции

Функция распределенного отслеживания запросов предоставляет возможности полного отслеживания для архитектуры микросервисов, собирая метаданные информации о вызовах между сервисами, что помогает пользователям быстро выявлять проблемы с межсервисными вызовами. Эта функция в основном решает следующие задачи:

- **Отслеживание связей запросов**: Восстановление полного пути запроса в сложных распределенных системах.
- **Анализ узких мест производительности**: Выявление аномальных узлов вызовов в терминах времени потребления в рамках связи.
- **Локация коренных причин неисправностей**: Быстрая локализация точки возникновения проблемы через маркировку ошибок.

Применимые сценарии включают:

- Быстрое выявление аномальных сервисов во время устранения неисправностей в рабочей среде.
- Определение связей вызовов с высокой задержкой во время настройки производительности.
- Проверка взаимосвязей между сервисами после выпуска новой версии.

Основные ценности:

- Увеличение видимости распределенных систем.
- Сокращение среднего времени восстановления (MTTR).
- Оптимизация производительности межсервисных вызовов.

## Основные функции

- Мультидоменный запрос: Поддерживает 6 комбинаций условий запроса, таких как TraceID, имя сервиса, метки и др.
- Визуальный анализ: Интуитивно показывает иерархию вызовов и распределение времени с помощью водопадных диаграмм по временным рядам.
- Точное местоположение: Поддерживает фильтрацию ошибок Spans и вторичный поиск с использованием меток.

## Преимущества функции

- **Быстрое определение проблем**: Сужение диапазона проверки с помощью многомерных условий запроса ускоряет локализацию проблем.
- **Визуальное представление**: Использование водопадных диаграмм по временным рядам для интуитивного отображения взаимосвязей вызовов снижает сложность и повышает эффективность анализа неисправностей.
- **Гибкость и разнообразие**: Поддерживает как простые запросы, так и сложные комбинации, адаптируясь к различным сценариям эксплуатации и разработки.

## Запрос на отслеживание

<Steps>
  ### Шаг 1: Объединение условий запроса

  **Совет**: Условия запроса могут быть объединены для использования. Вы можете уточнить свой запрос, добавив несколько условий запроса.

  | Условие запроса                | Описание                                                                                                                                                                                                                                                                                                                                             |
  | ------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | **TraceID**                    | Уникальный идентификатор для полного отслеживания, который можно использовать для запроса указанного отслеживания.                                                                                                                                                                                                                                                          |
  | **Сервис**                    | Сервис, который инициирует/принимает запрашиваемый вызов (необходимо выбрать или ввести).                                                                                                                                                                                                                                                                   |
  | **Метка**                      | Вы можете отфильтровать результаты запроса, введя метки (Tag), поддерживаемые метки включают те, что в деталях Span.                                                                                                                                                                                                                                            |
  | **Длительность Span больше чем** | Spans, которые имеют длительность больше или равную *входному значению* (мс).                                                                                                                                                                                                                                                                                 |
  | **Искать только ошибочные Spans**    | Ошибочные Spans относятся к Spans, значение метки **error** которых равно `true`.                                                                                                                                                                                                                                                                                      |
  | **Тип Span**                  | **Корневой Span**: Поиск корневых Spans, инициированных настроенным **сервисом**. Этот режим поиска используется, когда настроенный сервис является инициатором всего запроса. <br />**Входящий Span сервиса**: Поиск первого Span, сгенерированного при вызове настроенного **сервиса** как сервера.                                            |
  | **Максимальное количество запросов**        | Максимальное количество Spans, которые можно запросить, по умолчанию 200. <br />**Совет**: В интересах производительности платформа может отображать максимум 1000 Spans за раз. Если количество Spans, которые соответствуют условиям запроса, превышает **максимальное количество запросов**, вы можете уточнить условия запроса или сократить временной диапазон для поэтапных запросов. |

  ### Шаг 2: Выполнить запрос

  - После того как вы выберете условия запроса и введете соответствующие значения, нажмите кнопку **Добавить к условиям запроса**, и текущие условия будут отображены в области результатов **Условия запроса**, что приведет к выполнению запроса.
  - Вы также можете развернуть **Общие условия запроса**, чтобы быстро добавить недавно использованные условия поиска.
</Steps>

## Анализ результатов запроса

После ввода условий запроса и поиска на странице будет сгенерирована область результатов запроса.

### Список Span

Левая сторона области результатов запроса отображает список Spans, которые соответствуют условиям, а также основную информацию о Spans, включая: имя сервиса, вызываемый интерфейс или метод обработки запроса, длительность и время начала.

### Водопадная диаграмма по временным рядам

Водопадная диаграмма по временным рядам на правой стороне области результатов запроса четко отображает взаимосвязи вызовов между Spans в одном отслеживании. Основные характеристики использования водопадных диаграмм по временным рядам в анализе отслеживания следующие:

1. Расширение сверху вниз: В водопадной диаграмме по временным рядам различные события вызова (Spans) обычно расширяются вниз от верхней части диаграммы, каждая горизонтальная полоса представляет собой вызов сервиса или процесс. Позиция обычно отражает логический порядок вызова операций.
2. Выравнивание по временной оси: Горизонтальная ось водопадной диаграммы по временным рядам представляет время. Длина каждой полосы указывает на продолжительность этого вызова, что позволяет интуитивно сравнивать временные отношения между различными вызовами.
3. Описание отступа: Отступ указывает на иерархические отношения вызовов, более глубокий отступ обозначает большую глубину вызова в рамках данной связи.
4. Интерактивность и детальная информация: Нажатие на полосы в водопадной диаграмме по временным рядам может отобразить более подробную информацию о данном вызове.

### Подробности о Span

Нажав на строку Span в водопадной диаграмме по временным рядам, вы можете развернуть и увидеть подробную информацию о Span, включая:

- Сервис: Сервис внутри Span.
- Длительность Span (мс): Длительность Span.
- URL: URL, доступный сервисом, соответствующий **http.url** в метках Span.
- Метка: Информация о метке Span, состоящая из пар «ключ-значение», которую можно использовать для условий продвинутого поискового запроса. Нажав на кнопку рядом с меткой, вы можете добавить текущее условие метки к условиям запроса для более точных результатов.
- JSON: Исходная структура JSON Span, позволяющая детально исследовать его внутреннюю информацию.
