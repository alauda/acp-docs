---
weight: 30
sourceSHA: be99256c2c51ae8183afc2988e28fd4be5364004bbc822d266942bfb1d34c279
---

# Руководство по выбору компонентов мониторинга

При установке мониторинга кластера платформа предоставляет вам два компонента мониторинга на выбор: VictoriaMetrics и Prometheus. В этой статье будут подробно описаны характеристики и применимые сценарии этих двух компонентов, помогая вам сделать наиболее подходящий выбор.

## Важные примечания

- При установке компонентов мониторинга кластера можно выбрать только один из VictoriaMetrics или Prometheus.
- Начиная с версии 3.18, VictoriaMetrics была обновлена до статуса Beta, что соответствует условиям использования в производственной среде.
- VictoriaMetrics подходит для сценариев с высокими требованиями доступности и многокластерного мониторинга.
- Prometheus подходит для сценариев мониторинга в рамках одного кластера, особенно для более мелких масштабов.

## Список компонентов

### Компоненты, связанные с Prometheus

| Название компонента   | Описание функции                                                                              |
| -------------------- | --------------------------------------------------------------------------------------------- |
| Сервер Prometheus    | Основной сервер, отвечающий за сбор, хранение и запрос данных мониторинга                    |
| Экспортёры           | Компоненты для сбора данных мониторинга, которые предоставляют метрики мониторинга через интерфейсы HTTP |
| AlertManager          | Центр управления оповещениями, обрабатывающий правила оповещения и уведомления                |
| PushGateway           | Поддерживает режим отправки для данных мониторинга, используется для передачи данных в специальных сетевых окружениях |

### Компоненты, связанные с VictoriaMetrics

| Название компонента | Описание функции                                                    |
| ------------------- | ------------------------------------------------------------------- |
| VMStorage           | Двигатель хранения данных мониторинга                                |
| VMInsert            | Компонент записи данных, отвечающий за распределение и хранение данных |
| VMSelect            | Компонент сервиса запросов, предоставляющий возможности для запросов данных |
| VMAlert             | Компонент оценки и обработки правил оповещения                      |
| VMAgent             | Компонент сбора метрик мониторинга                                   |

## Сравнение архитектуры

### Архитектура Prometheus

![](../../../../en/observability/monitor/assets/prometheus_flow.png)

Prometheus — это зрелая система мониторинга с открытым исходным кодом и второй проект, выпущенный CNCF после Kubernetes. Она обладает следующими характеристиками:

- Мощные возможности сбора данных.
- Гибкий язык запросов PromQL.
- Обширная экосистема.
- Поддержка мониторинга кластера на масштабах до тысячи узлов.

### Архитектура VictoriaMetrics

![](../../../../en/observability/monitor/assets/vm_flow.png)

VictoriaMetrics — это распределенная высокопроизводительная база данных временных рядов и решение для мониторинга, обладающее следующими преимуществами:

- Более высокий коэффициент сжатия данных.
- Более низкое потребление ресурсов.
- КорNative Поддержка высокой доступности кластера.
- Более простое управление эксплуатацией и обслуживанием.

## Сравнение функций

| Функция                    | Prometheus               | VictoriaMetrics        | Описание                                                                            |
| -------------------------- | ----------------------- | ---------------------- | ---------------------------------------------------------------------------------- |
| Установка с высокой доступностью | ❌                       | ✅                    | VictoriaMetrics поддерживает истинную высокую доступность кластера с лучшей согласованностью данных |
| Установка на одном узле    | ✅                       | ✅                    | Оба поддерживают режим установки на одном узле                                     |
| Долгосрочное хранение данных | Требуется удаленное хранилище | Поддерживается нативно | VictoriaMetrics более пригоден для долгосрочного хранения данных                    |
| Эффективность ресурсов      | Выше                    | Лучше                 | VictoriaMetrics имеет лучшую утилизацию ресурсов                                   |
| Поддержка сообщества        | Очень зрелая            | Быстро развивающаяся  | Prometheus имеет более крупную экосистему сообщества                              |

## Рекомендации по установке

### Обзор архитектуры установки мониторинга

![](../../../../en/observability/monitor/assets/vm_prometheus_flow.png)

На диаграмме выше показана архитектура установки и поток данных компонентов мониторинга, поддерживаемых платформой. Платформа предоставляет следующие два метода установки на выбор:

**Примечание**: При замене компонентов мониторинга убедитесь, что существующие компоненты полностью удалены, и данные мониторинга не поддерживают миграцию между компонентами.

#### Метод установки Prometheus

Этот метод соответствует архитектуре **cluster4** на вышеуказанной диаграмме:

- Использует компоненты Prometheus для сбора и обработки данных мониторинга.
- Запросы и отображения данных через панель мониторинга.
- Подходит для сценариев одного кластера.

#### Метод установки VictoriaMetrics

VictoriaMetrics поддерживает следующие два режима установки:

1. **Режим установки одного кластера**
   - Соответствует архитектуре **cluster2** на вышеуказанной диаграмме.
   - Все компоненты VictoriaMetrics устанавливаются в одном кластере.
   - Использует VMAgent для сбора данных и записи в VictoriaMetrics.
   - VMAlert отвечает за оценку правил оповещения.
   - Запросы и отображение данных через панель мониторинга.
     **Совет**: Рекомендуется использовать этот режим при объеме данных ниже 1 миллиона в секунду.

2. **Режим многокластерной установки**
   - Соответствует архитектуре **cluster1/cluster2/cluster3** на вышеуказанной диаграмме.
   - Устанавливает VMAgent в рабочем кластере в качестве агента сбора данных.
   - VMAgent записывает данные в VictoriaMetrics в центральном кластере мониторинга.
   - Поддерживает единое управление мониторингом в нескольких кластерах.
     **Совет**: Убедитесь, что службы VictoriaMetrics установлены в кластере мониторинга перед установкой VMAgent.

### Рекомендации по выбору

#### Сценарии, подходящие для использования VictoriaMetrics

- **Высокие требования к производительности и масштабируемости**: Подходит для сценариев мониторинга, которые обрабатывают данные с высокой пропускной способностью и долгосрочным хранением.
- **Соображения по стоимости**: Необходимость оптимизировать затраты на хранение и вычислительные ресурсы.
- **Требования к высокой доступности**: Требуется высокая доступность для компонентов мониторинга.
- **Управление несколькими кластерами**: Необходимость единого управления данными мониторинга в нескольких кластерах.

#### Сценарии, подходящие для использования Prometheus

- **Единый кластер с малым объемом**: Масштаб мониторинга небольшой, без требований к высокой доступности.
- **Существующие пользователи Prometheus**: Уже имеется полная система мониторинга Prometheus.
- **Простые требования к стабильности**: Стремление к простому и надежному решению для мониторинга.
- **Глубокая интеграция с экосистемой**: Тесная интеграция с экосистемой Prometheus, с высокими затратами на миграцию.
