---
weight: 30
sourceSHA: a4f4c5f980fff964c2672fee6fd1ebefeba2afb4df453c352a191b65be5d6db6
---

# Управление уведомлениями

## Обзор функции

С помощью уведомлений вы можете интегрировать функции мониторинга и оповещения платформы для своевременной отправки предварительной информации получателям уведомлений, напоминая соответствующему персоналу предпринять необходимые меры для решения проблем или предотвращения сбоев.

## Ключевые особенности

- **Сервер уведомлений**: Сервер уведомлений предоставляет услуги по отправке уведомительных сообщений группам контактных лиц на платформе, таким как почтовый сервер.
- **Группа контактных лиц для уведомления**: Группа контактных лиц для уведомления — это набор получателей уведомлений с аналогичными логическими характеристиками, что может снизить вашу нагрузку на обслуживание, позволяя категоризировать объекты, которые получают уведомительные сообщения.
- **Шаблон уведомления**: Шаблон уведомления — это стандартизированная структура, состоящая из пользовательского содержимого, переменных содержимого и параметров формата содержимого. Он используется для стандартизации содержимого и формата сообщений уведомлений для стратегий уведомлений. Например, настройка темы и содержания электронных уведомлений.
- **Правило уведомления**: Правило уведомления — это набор правил, определяющих, как отправлять уведомительные сообщения конкретным контактам. Использование правила уведомления необходимо для сценариев, таких как оповещения, проверки и аутентификация входа, которые требуют уведомления внешних служб.

## Сервер уведомлений

Сервер уведомлений предоставляет услуги по отправке уведомительных сообщений получателям на платформе. В настоящее время платформа поддерживает следующие серверы уведомлений:

- **Сервер корпоративного инструмента связи**: Поддерживает интеграцию с WeChat Work, DingTalk и встроенными приложениями Feishu для отправки уведомлений отдельным лицам.
- **Почтовый сервер**: Отправляет уведомления по электронной почте с помощью почтового сервера.
- **Сервер типа Webhook**: Поддерживает интеграцию с корпоративными ботами групп WeChat, ботами групп DingTalk, ботами групп Feishu или отправку WebHooks на ваш выделенный сервер.

:::warning
Можно добавить только один сервер корпоративного инструмента связи.
:::

### Сервер корпоративного инструмента связи

**WeChat Work**

1. Настройте параметры сервера уведомлений в соответствии с примером ниже. После заполнения параметров переключитесь на кластер `global` в **Управление кластерами** > **Управление ресурсами** и создайте объект ресурса.

   ```yaml
   # Методы получения corpId, corpSecret, agentId для WeChat Work можно найти в официальной документации: https://developer.work.weixin.qq.com/document/path/90665
   apiVersion: v1
   kind: Secret
   type: NotificationServer
   metadata:
     labels:
       cpaas.io/notification.server.type: CorpWeChat
       cpaas.io/notification.server.category: Corp
     name: platform-corp-wechat-server
     namespace: cpaas-system
   data:
     displayNameZh: 企业微信            # Китайское отображаемое имя сервера, по умолчанию закодировано в base64
     displayNameEn: WeChat             # Английское отображаемое имя сервера, по умолчанию закодировано в base64
     corpId:                           # Корпоративный идентификатор, по умолчанию закодирован в base64
     corpSecret:                       # Секрет приложения, по умолчанию закодирован в base64
     agentId:                          # Идентификатор корпоративного приложения, по умолчанию закодирован в base64
   ```

2. После создания вам необходимо обновить **WeChat Work ID** пользователя в **Управлении ролями пользователей** > **Управление пользователями** платформы или в **Личной информации** пользователя, чтобы гарантировать, что пользователь может нормально получать сообщения.

**DingTalk**

1. Настройте параметры сервера уведомлений в соответствии с примером ниже. После заполнения параметров переключитесь на кластер `global` в **Управление кластерами** > **Управление ресурсами** и создайте объект ресурса.

   ```yaml
   # Методы получения appKey, appSecret, agentId для DingTalk: https://open-dev.dingtalk.com/fe/app#/corp/app
   apiVersion: v1
   kind: Secret
   type: NotificationServer
   metadata:
     labels:
       cpaas.io/notification.server.type: CorpDingTalk
       cpaas.io/notification.server.category: Corp
     name: platform-corp-dingtalk-server
     namespace: cpaas-system
   data:
     displayNameZh: 钉钉                # Китайское отображаемое имя сервера, по умолчанию закодировано в base64
     displayNameEn: DingTalk           # Английское отображаемое имя сервера, по умолчанию закодировано в base64
     appKey:                           # Ключ приложения, по умолчанию закодирован в base64
     appSecret:                        # Секрет приложения, по умолчанию закодирован в base64
     agentId:                          # agent_id приложения, по умолчанию закодирован в base64
   ```

2. После создания вам необходимо обновить **DingTalk ID** пользователя в **Управлении ролями пользователей** > **Управление пользователями** платформы или в **Личной информации** пользователя, чтобы гарантировать, что пользователь может нормально получать сообщения.

**Feishu**

1. Настройте параметры сервера уведомлений в соответствии с примером ниже. После заполнения параметров переключитесь на кластер `global` в **Управление кластерами** > **Управление ресурсами** и создайте объект ресурса.

   ```yaml
   # Методы получения appId, appSecret для Feishu: https://open.feishu.cn/app/
   apiVersion: v1
   kind: Secret
   type: NotificationServer
   metadata:
     labels:
       cpaas.io/notification.server.type: CorpFeishu
       cpaas.io/notification.server.category: Corp
     name: platform-corp-feishu-server
     namespace: cpaas-system
   data:
     displayNameZh: 飞书                 # Китайское отображаемое имя сервера, по умолчанию закодировано в base64
     displayNameEn: Feishu             # Английское отображаемое имя сервера, по умолчанию закодировано в base64
     appId:                            # Идентификатор приложения, по умолчанию закодирован в base64
     appSecret:                        # Секрет приложения, по умолчанию закодирован в base64
   ```

2. После создания вам необходимо обновить **Feishu ID** пользователя в **Управлении ролями пользователей** > **Управление пользователями** платформы или в **Личной информации** пользователя, чтобы гарантировать, что пользователь может нормально получать сообщения.

### Почтовый сервер

1. В левой навигационной панели нажмите **Настройки платформы** > **Сервер уведомлений**.

2. Нажмите **Настроить сейчас**.

3. Ознакомьтесь с следующими инструкциями для настройки соответствующих параметров.

   | Параметр                 | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   | ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | **Адрес службы**        | Адрес сервера уведомлений, поддерживающего протокол SMTP, например, `smtp.yeah.net`.                                                                                                                                                                                                                                                                                                                                                                              |
   | **Порт**                 | Номер порта для сервера уведомлений. Когда **Использовать SSL** отмечено, необходимо ввести номер порта SSL.                                                                                                                                                                                                                                                                                                                                                           |
   | **Конфигурация сервера** | **Использовать SSL**: Защищенный протокол передачи данных (SSL) — это стандартная технология безопасности. Переключатель SSL используется для управления тем, следует ли устанавливать зашифрованную связь между сервером и клиентом. <br /> **Пропустить ненадежную проверку**: Переключатель insecureSkipVerify используется для управления тем, следует ли проверять сертификат клиента и имя хоста сервера. Если включен, то сертификаты и соответствие между именем хоста в сертификате и именем хоста сервера проверяться не будут. |
   | **Электронная почта отправителя** | Учетная запись электронной почты отправителя на сервере уведомлений, используемая для отправки уведомлений по электронной почте.                                                                                                                                                                                                                                                                                                                                                                             |
   | **Включить аутентификацию**   | Если требуется аутентификация, настройте имя пользователя и код авторизации для почтового сервера.                                                                                                                                                                                                                                                                                                                                                                |

4. Нажмите **ОК**.

### Сервер типа Webhook

Поддерживает интеграцию с корпоративными ботами групп WeChat, ботами групп DingTalk, ботами групп Feishu или отправку HTTP-запросов на ваш выделенный сервер Webhook.

**Корпоративный бот WeChat**

1. В левой навигационной панели нажмите **Управление кластерами** > **Кластер**.

2. Нажмите кнопку операции рядом с кластером `global` > **CLI Tool**.

3. Выполните следующую команду на главном узле кластера `global`:

   ```bash
   kubectl patch secret -n cpaas-system platform-wechat-server -p '{"data":{"enable":"dHJ1ZQo="}}'
   ```

   **Совет**: `dHJ1ZQo=` — это значение true в кодировке base64; для отключения замените `dHJ1ZQo=` на `ZmFsc2UK`, что является значением false в кодировке base64.

**Бот группы DingTalk**

1. В левой навигационной панели нажмите **Управление кластерами** > **Кластер**.

2. Нажмите кнопку операции рядом с кластером `global` > **CLI Tool**.

3. Выполните следующую команду на главном узле кластера `global`:

   ```bash
   kubectl patch secret -n cpaas-system platform-dingtalk-server -p '{"data":{"enable":"dHJ1ZQo="}}'
   ```

   **Совет**: `dHJ1ZQo=` — это значение true в кодировке base64; для отключения замените `dHJ1ZQo=` на `ZmFsc2UK`, что является значением false в кодировке base64.

**Бот группы Feishu**

1. В левой навигационной панели нажмите **Управление кластерами** > **Кластер**.

2. Нажмите кнопку операции рядом с кластером `global` > **CLI Tool**.

3. Выполните следующую команду на главном узле кластера `global`:

   ```bash
   kubectl patch secret -n cpaas-system platform-feishu-server -p '{"data":{"enable":"dHJ1ZQo="}}'
   ```

   **Совет**: `dHJ1ZQo=` — это значение true в кодировке base64; для отключения замените `dHJ1ZQo=` на `ZmFsc2UK`, что является значением false в кодировке base64.

**Webhook-сервер**

1. В левой навигационной панели нажмите **Управление кластерами** > **Кластер**.

2. Нажмите кнопку операции рядом с кластером `global` > **CLI Tool**.

3. Выполните следующую команду на главном узле кластера `global`:

   ```bash
   kubectl patch secret -n cpaas-system platform-webhook-server -p '{"data":{"enable":"dHJ1ZQo="}}'
   ```

   **Совет**: `dHJ1ZQo=` — это значение true в кодировке base64; для отключения замените `dHJ1ZQo=` на `ZmFsc2UK`, что является значением false в кодировке base64.

## Группа контактных лиц для уведомления \{#recipient}

Группа контактных лиц для уведомления — это набор получателей уведомлений с аналогичными логическими характеристиками. Например, вы можете установить команду эксплуатации и обслуживания в качестве группы контактных лиц для уведомлений для легкого выбора и управления при настройке стратегий уведомлений.

:::info

1. Платформа поддерживает различные серверы уведомлений, и соответствующие варианты конфигурации для типов уведомлений будут отображаться на основе конфигурации сервера уведомлений.
2. Если вам необходимо использовать сервер типа Webhook в качестве получателя уведомлений, вы должны настроить соответствующий URL в группе контактных лиц уведомления.

:::

1. В левой навигационной панели нажмите **Операционный центр** > **Уведомления**.

2. Переключитесь на вкладку **Группа контактных лиц для уведомления**.

3. Нажмите **Создать группу контактных лиц для уведомления** и настройте соответствующие параметры в соответствии с инструкциями ниже.

   | Параметр                                                            | Описание                                                                                                                                                                                                             |
   | ------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Электронная почта**                                              | Добавьте электронную почту в всю группу контактных лиц для уведомления. Платформа будет отправлять уведомления на этот адрес электронной почты и все адреса электронной почты контактов в группе.                       |
   | **Webhook URL/Бот группы WeChat/Бот группы DingTalk/Бот группы Feishu** | Пожалуйста, заполните соответствующий URL метода уведомления в зависимости от настроенного сервера уведомлений. После настройки контакты в этой группе будут уведомляться с использованием этого метода.             |
   | **Настройка контактов**                                            | Нажмите **Добавить контакт**, чтобы добавить существующих пользователей платформы в группу контактов. Убедитесь в точности контактной информации выбранных контактов (телефон, электронная почта, обратный вызов интерфейса), чтобы избежать пропуска уведомлений. |

4. Нажмите **Добавить**.

## Шаблон уведомления \{#template}

Шаблон уведомления — это стандартизированная структура, состоящая из пользовательского содержимого, переменных содержимого и параметров формата содержимого. Он используется для стандартизации содержимого и формата сообщений уведомлений об оповещениях для стратегий уведомлений.

Администраторы платформы или операционный персонал могут установить шаблоны уведомлений для настройки содержимого и формата уведомительных сообщений в зависимости от различных методов уведомлений об оповещениях, что помогает пользователям быстро получать критически важную информацию об оповещениях и повышать операционную эффективность.

:::info
Платформа поддерживает различные серверы уведомлений, и соответствующие шаблоны типов уведомлений будут отображаться в зависимости от конфигурации сервера уведомлений. Если сервер уведомлений не настроен, соответствующие шаблоны уведомлений по умолчанию отображаться не будут.
:::

### Создание шаблона уведомления

1. В левой навигационной панели нажмите **Операционный центр** > **Уведомления**.

2. Переключитесь на вкладку **Шаблон уведомления**.

3. Нажмите **Создать шаблон уведомления**.

4. В разделе **Основная информация** настройте следующие параметры.

   | Параметр        | Описание                                                                                                                                                                                                                                                                                                                    |
   | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | **Тип сообщения** | Выберите тип сообщения в зависимости от цели уведомления.<br />**Сообщение оповещения**: отправляет сообщения оповещения, инициированные правилами оповещения, в сочетании с функциональностью оповещения платформы;<br />**Сообщение о исключении компонента**: отправляет уведомительную информацию, инициированную исключениями в определенных компонентах. |

5. В разделе **Конфигурация шаблона** обратитесь к различным типам шаблонов для настройки переменных и параметров форматирования содержимого.

:::info

1. Содержимое шаблона может состоять только из переменных, отображаемых имен переменных и специального разметочного языка форматирования, поддерживаемого платформой. Переменные и другие элементы могут свободно сочетаться при условии соблюдения правил синтаксиса.
2. В шаблоне могут использоваться только переменные, поддерживаемые платформой. Вы можете изменять отображаемые имена переменных и форматы содержимого, но не можете изменять саму переменную. Справка по [Переменным](#varibales) и [Специальным разметочным языкам в электронных письмах](#email).
3. Платформа предоставляет содержимое шаблона уведомлений по умолчанию для различных типов уведомлений на основании реальных операционных сценариев, что может удовлетворить большинство потребностей в настройке сообщений уведомлений. Если нет специальных требований, вы можете напрямую использовать содержимое шаблона по умолчанию.

:::

6. Нажмите **Создать**.

### Справочные переменные \{#varibales}

Переменные — это ключи меток или аннотаций в уведомительных сообщениях (NotificationMessage), отформатированные как `{{.labelKey}}`. Для облегчения пользователям быстрого получения ключевой информации можно назначить пользовательские отображаемые имена переменным; например: `Уровень тревоги: {{ .externalLabels.severity }}`.

Когда правило уведомления отправляет уведомительные сообщения пользователям на основе шаблона уведомления, переменные в шаблоне будут ссылаться на соответствующие значения меток в уведомительном сообщении (фактические данные мониторинга). В конечном итоге данные мониторинга будут отправлены пользователям в стандартизированном формате содержимого.

Платформа предоставляет следующие базовые переменные по умолчанию:

| Отображаемое имя          | Переменная                                                                    | Описание                                                                           |
| --------------------- | --------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| **Статус тревоги**      | `{{ .externalLabels.status }}`                                              | Например: Тревога.                                                                |
| **Уровень тревоги**       | `{{ .externalLabels.severity }}`                                            | Например: Критический.                                                                |
| **Кластер тревоги**     | `{{ .labels.alert_cluster }}`                                               | Например: Кластер 1, в котором произошла тревога.                                      |
| **Объект тревоги**      | `{{ .externalLabels.object }}`                                              | Тип и имя ресурса, где произошла тревога, например: узел 192.168.16.53. |
| **имя правила**         | `{{ .labels.alert_resource }}`                                              | Имя правила тревоги, например: cpaas-node-rules.                                   |
| **Описание тревоги** | `{{ .externalLabels.summary }}`                                             | Описание правила тревоги.                                                        |
| **Значение триггера**     | `{{ .externalLabels.currentValue }}`                                        | Мониторинговое значение, которое инициировало тревогу.                                         |
| **Время тревоги**        | `{{ dateFormatWithZone .startsAt "2006-01-02 15:04:05" "Asia/Chongqing" }}` | Время начала тревоги.                                                          |
| **Время восстановления**     | `{{ dateFormatWithZone .endsAt "2006-01-02 15:04:05" "Asia/Chongqing" }}`   | Время завершения тревоги.                                                            |
| **Имя метрики**       | `{{ .labels.alert_indicator }}`                                             | Название мониторинговой метрики.                                                        |

### Специальный разметочный язык форматирования в электронных письмах \{#email}

В электронных уведомлениях обычно используются HTML-теги формата и их инструкции, указанные в таблице ниже:

| Элемент содержания | Тег                                                                   | Описание                                     |
| --------------- | --------------------------------------------------------------------- | --------------------------------------------- |
| **Текст**        | -                                                                     | Поддерживает ввод текста на китайском/английском языке. |
| **Шрифт**        | `<font color="#FF0000">Установить цвет шрифта</font>`<br />`<b>Жирный шрифт</b>` | Установить формат шрифта.                    |
| **Заголовок**       | `<h1>Заголовок уровня 1</h1>`, поддерживает до h6 (заголовок 6).               | Установить уровень заголовка.                |
| **Параграф**   | `<p>Параграф</p>`                                                    | Вставить обычный текст параграфа.            |
| **Цитата**       | `<q>Цитата</q>`                                                        | Вставить короткое цитируемое содержание.     |
| **Гиперссылка**   | `<a href="//www.example.com">Гиперссылка</a>`                           | Вставить гиперссылку.                        |

## Правило уведомления \{#notification}

Правило уведомления — это набор правил, определяющих, как отправлять уведомительные сообщения конкретным контактам. Использование стратегий уведомлений необходимо для сценариев, требующих уведомления внешних служб, таких как оповещения, проверки и аутентификация входа.

:::info
Платформа поддерживает различные серверы уведомлений, и режимы уведомлений, соответствующие типам уведомлений, будут отображаться на основании конфигурации сервера уведомлений. Если сервер уведомлений не настроен, соответствующие режимы уведомлений по умолчанию отображаться не будут.
:::

### Предварительные условия

Чтобы использовать **Сервер корпоративного инструмента связи** для уведомления контактов, пользователи должны сначала изменить свою контактную информацию в **Личной информации**, введя свой `WeChat Work ID`.

### Процедуры выполнения

1. В левой навигационной панели нажмите **Операционный центр** > **Уведомления**.

2. Нажмите **Создать правило уведомления** и настройте соответствующие параметры в соответствии с следующими инструкциями.

   | Параметр                      | Описание                                                                                                                                                                                                                                                                                                 |
   | ------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Группа контактных лиц для уведомления** | Группа контактных лиц для уведомления — это логический набор получателей уведомлений, которые платформа уведомляет с помощью указанного метода уведомления.                                                                                                                                                           |
   | **Получатели уведомлений**    | Выберите возможность добавить одного или нескольких получателей уведомлений, и платформа будет отправлять уведомления в соответствии с контактными методами **Личной информации** получателей.                                                                                                                                          |
   | **Метод уведомления**        | Поддерживает несколько методов, включая **WeChat Work**, **DingTalk**, **Feishu**, **Корпоративный бот WeChat**, **Бот группы DingTalk**, **Бот группы Feishu**, **WebHook URL**, и поддерживает многократные выборы.<br />**Примечание**: некоторые параметры будут отображаться после настройки сервера уведомлений. |
   | **Шаблон уведомления**      | Выберите шаблон уведомления для отображения информации об уведомлении.                                                                                                                                                                                                                                       |

3. Нажмите **Создать**.

## Установка правила уведомления для проектов

Стратегии уведомлений платформы, шаблоны уведомлений и группы контактных лиц для уведомлений изолированы для арендаторов. Как администратор проекта, вы не сможете просматривать или использовать стратегии уведомлений, шаблоны уведомлений или группы контактных лиц для уведомлений, настроенные другими проектами или администраторами платформы. Поэтому вам необходимо обратиться к этому документу, чтобы настроить подходящие стратегии уведомлений для вашего проекта.

### Предварительные условия

1. Вы связались с администратором платформы для завершения настройки сервера уведомлений.

2. Если вам необходимо уведомить через корпоративные инструменты связи, вам также необходимо убедиться, что контакты, подлежащие уведомлению, правильно настроили свои идентификаторы инструментов связи в **Личной информации**.

### Процедуры выполнения

1. В представлении **Управление проектом** нажмите ***Имя проекта***.

2. В левой навигационной панели нажмите **Уведомления**.

3. Переключитесь на вкладку **Группа контактных лиц для уведомления**, обратитесь к [Группе контактных лиц для уведомления](#recipient) для создания группы контактных лиц для уведомлений.

:::tip
Если вам не нужно управлять контактами уведомлений через группу контактных лиц для уведомления или вам не нужно уведомлять сервер уведомлений типа webhook, вы можете пропустить этот шаг.
:::

4. Переключитесь на вкладку **Шаблон уведомления**, обратитесь к [Шаблону уведомления](#template) для создания шаблона уведомления.

5. Переключитесь на вкладку **Правило уведомления**, обратитесь к [Правилу уведомления](#notification) для создания правила уведомления.
