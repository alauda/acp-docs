---
weight: 40
i18n:
  disableAutoTranslation: false
  title:
    en: Manage Dashboards
  additionalPrompts: Please translate '图表' as pannel and '面板' as dashboard
title: Управление панелями
sourceSHA: 08df5a407e6cd222a774b95b8b1586c131a81dccb518094fbca63f05148b8315
---

# Управление панелями мониторинга

## Обзор функций

Платформа предоставляет мощные функции управления панелями, разработанные для замены традиционных инструментов Grafana, предлагая пользователям более комплексный и гибкий опыт мониторинга. Эта функция агрегирует различные данные мониторинга из платформы, представляя единый обзор мониторинга, который значительно повышает эффективность вашей конфигурации.

### Основные функции

- Поддержка настройки пользовательских панелей мониторинга как для бизнес-видов, так и для видов платформы.
- Возможность просмотра публично共有的panel，在商户视图中，从平台视图中配置的面板，数据根据商户所属的命名空间隔离。
- Поддерживает управление панелями внутри панели, позволяя пользователям добавлять, удалять и изменять панели, увеличивать/уменьшать масштаб панелей и перемещать панели с помощью перетаскивания.
- Позволяет устанавливать пользовательские переменные внутри панели для фильтрации данных запроса.
- Поддерживает настройку групп внутри панели для управления панелями. Группы могут многократно отображаться в зависимости от пользовательских переменных.
- Поддерживаемые типы панелей включают: тренд, ступенчатая линейная диаграмма, столбчатая диаграмма, горизонтальная столбчатая диаграмма, график с показом столбцов, график с измерениями, таблица, график статусов, XY график, круговая диаграмма, текст.
- Функция импорта панелей Grafana одним щелчком мыши.

### Преимущества

- Поддерживает пользовательские сценарии мониторинга без ограничений предопределенными шаблонами, что позволяет действительно добиться персонализированного опыта мониторинга.
- Обеспечивает широкий спектр возможностей визуализации, включая линейные графики, столбчатые диаграммы, круговые графики, а также гибкие параметры макета и оформления.
- Плотная интеграция с правами роли платформы, позволяющая бизнес-визуализациям определять собственные панели мониторинга при обеспечении изоляции данных.
- Глубокая интеграция с различными функциональными возможностями контейнерной платформы, обеспечивающая мгновенный доступ к данным мониторинга для контейнеров, сетей, хранения и т. д., предоставляя пользователям полное наблюдение за производительностью и диагностику сбоев.
- Полная совместимость с JSON панелей Grafana, что позволяет легко мигрировать с Grafana для продолжения использования.

### Сценарии использования

- **Управление ИТ-операциями**: В качестве части команды по управлению ИТ вы можете использовать панелии мониторинга для объединения отображения и управления различными показателями производительности контейнерной платформы, такими как ЦП, память, сетевой трафик и др. Настраивая отчеты мониторинга и правила оповещения, вы можете своевременно обнаруживать и локализовать системные проблемы, повышая операционную эффективность.
- **Анализ производительности приложения**: Для разработчиков приложений и тестировщиков панели мониторинга предлагают разнообразные возможности визуализации, позволяя интуитивно отображать состояние работы приложений и потребление ресурсов. Вы можете настраивать специальные панели мониторинга, адаптированные к различным сценариям приложений, для глубокой аналитики узких мест производительности приложений и предоставления основы для оптимизации.
- **Управление многими кластерами**: Для пользователей, которые управляют несколькими контейнерными кластерами, панели мониторинга могут агрегировать данные мониторинга из различных кластеров, позволяя вам быстро осознать общее состояние работы системы.
- **Диагностика сбоев**: Когда возникает системная проблема, панели мониторинга предоставляют вам полные данные о производительности и аналитические инструменты для быстрого определения коренной причины проблемы. Вы можете быстро просматривать колебания соответствующих показателей мониторинга на основе информации о тревогах для глубокого анализа сбоев.

### Предварительные условия

В настоящее время панели мониторинга поддерживают только просмотр данных мониторинга, собранных компонентами мониторинга, установленными на платформе. Поэтому вам следует подготовиться следующим образом перед настройкой панели мониторинга:

- Убедитесь, что кластер, для которого вы хотите настроить панель мониторинга, имеет установленные компоненты мониторинга, в частности **ACP Monitor with Prometheus** или плагин **ACP Monitor with VictoriaMetrics**.
- Убедитесь, что данные, которые вы хотите отобразить на панели, были собраны компонентами мониторинга.

### Связь между панелями мониторинга и компонентами мониторинга

- Ресурсы панелей мониторинга хранятся в кластере Kubernetes. Вы можете переключать виды между различными кластерами, используя вкладку **Кластер** вверху.
- Панели мониторинга зависят от компонентов мониторинга в кластере для запроса источников данных. Поэтому перед использованием панелей мониторинга убедитесь, что текущий кластер успешно установил компоненты мониторинга и что они работают нормально.
- По умолчанию панель мониторинга будет запрашивать данные мониторинга из соответствующего кластера. Если вы устанавливаете плагин **VictoriaMetrics** в режиме прокси в кластере, мы будем запрашивать кластер хранения, чтобы получить соответствующие данные для этого кластера без необходимости специальной настройки.

## Удаление панелей \{#manage\_dashboard}

Панель – это коллекция, состоящая из одной или нескольких панелей, организованных и расположенных в одном или нескольких рядах для обеспечения четкого просмотра соответствующей информации. Эти панели могут запрашивать сырые данные из источников данных и преобразовывать их в ряд визуальных эффектов, поддерживаемых платформой.

### Создайте панель \{#create\_dashboard}

1. Нажмите **Создать панель**, обратитесь к следующим инструкциям для настройки соответствующих параметров.

| Параметр                  | Описание                                                                                                                                                                                             |
| ------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Папка**                | Папка, в которой расположена панель; вы можете ввести или выбрать существующую папку.                                                                                                              |
| **Метка**                 | Метка для панели мониторинга; вы можете быстро находить существующие панели, фильтруя по верхним меткам во время переключения.                                                                     |
| **Установить как основную панель** | Если включено, это установит текущую панель как основную панель после успешного создания; при повторном входе в функцию панели мониторинга данные основной панели будут отображаться по умолчанию. |
| **Переменные**             | Добавьте переменные при создании панели, чтобы ссылаться на них как на параметры метрики в добавленных панелях, которые также могут использоваться в качестве фильтров на главной странице панели мониторинга.                                   |

2. После добавления нажмите **Создать**, чтобы завершить создание панели. Далее вам нужно **добавить переменные**, **добавить панели** и **добавить группы**, чтобы завершить общий макет.

### Импорт панели

Платформа поддерживает прямой импорт JSON Grafana для преобразования в панель мониторинга для отображения.

- В настоящее время поддерживается только JSON Grafana версии V8+; более низкие версии будут заблокированы от импорта.
- Если какие-либо панели в импортированной панели не входят в поддерживаемый диапазон платформой, они могут отображаться как **несоответствующие типы панелей**, но вы можете изменить настройки панелей, чтобы достичь нормального отображения.
- После импорта панели вы можете выполнять любые действия по управлению, как обычно, они не будут отличаться от панелей, созданных на платформе.

### Добавление переменных

1. В области формы переменных нажмите **Добавить**.

   | Параметр               | Описание                                                                                                                                                                                                                                                                                                                                                                   |
   | ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Тип**                | В настоящее время поддерживается только тип переменных запросов, которые позволяют вам фильтровать данные в зависимости от характеристик временных рядов. Выражение запроса может быть указано для динамического расчета и генерации результатов запроса.                                                                                                                                                                 |
   | **Фильтр отображения**  | Значение по умолчанию для отображения вариантов фильтра в выпадающем списке на главной странице панели; поддерживает отображение имени и значения, только значения или отсутствие отображения (скрытие фильтра).                                                                                                                                                                             |
   | **Настройки запроса**  | Использование переменных типа запросов позволяет вам фильтровать данные на основе характеристик временных рядов. При определении параметров запроса, помимо использования PromQL для запроса временных рядов, платформа также предоставляет некоторые общие переменные и функции. Ссылка на [Общие функции и переменные](#ref-function).                                                                                                                |
   | **Регулярное выражение** | Используя регулярные выражения, вы можете отфильтровывать желаемые значения из содержимого, возвращаемого запросами переменных. Это делает каждое название опции в переменной более ожидаемым. Вы можете предварительно просмотреть, соответствуют ли отфильтрованные значения ожиданиям в **Предварительном просмотре значения переменной**.                                                                                      |
   | **Настройки выбора**   | - **Множественный выбор**: При выборе из верхних фильтров на главной странице панели позволяет одновременно выбирать несколько опций. Вам нужно использовать эту переменную в выражении запроса панелей, чтобы просмотреть данные, соответствующие значению переменной.<br />- **Все**: Если установлено, будет включена опция, содержащая **Все**, для выбора всех данных переменной. |

2. Нажмите **ОК**, чтобы добавить одну или несколько переменных.

### Добавить панели \{#add\_pannel}

Добавьте несколько панелей в текущую созданную панель мониторинга, чтобы отобразить информацию о данных для различных ресурсов.

**Совет**: Вы можете настроить размер панели, щелкнув по правому нижнему углу; щелкните в любом месте на панели, чтобы изменить порядок панелей.

1. Нажмите **Добавить панель**, обратитесь к следующим инструкциям для настройки соответствующих параметров.

- **Предпросмотр панели**: Эта область динамически отобразит информацию о данных, соответствующую добавленным метрикам.

- **Добавление метрики**: Настройте заголовок панели и метрики мониторинга в этой области.

- **Способы добавления**: Поддерживает использование встроенных метрик или использование нативно настроенных метрик. Оба метода объединяются и действуют одновременно.
  - **Встроенные метрики**: Выберите часто используемые метрики и легендарные параметры, встроенные в платформу, чтобы отобразить информацию о данных под текущей панелью.
    - **Примечание**: Все метрики, добавленные в панель, должны иметь единый размер; невозможно добавлять метрики с несколькими единицами в одну панель.
  - **Нативные**: Настройте единицу метрики, выражение метрики и параметры легенды. Выражение метрики следует синтаксису PromQL; для получения дополнительных сведений обратитесь к [Официальной документации PromQL](https://prometheus.io/docs/prometheus/latest/querying/basics/).

- **Параметры легенды**: Управляйте именами, соответствующими кривым на панелях. Можно использовать текст или шаблоны:
  - Правило: Введенное значение должно иметь формат `{{.xxxx}}`; например, `{{.hostname}}` будет заменено на значение, соответствующее метке hostname, возвращаемое выражением.
  - **Совет**: Если вы введете неправильно отформатированный параметр легенды, имена, соответствующие кривым на панели, будут отображаться в оригинальном формате.

- **Мгновенный переключатель**: Когда переключатель **Мгновенный** включен, он будет запрашивать мгновенные значения через интерфейс запросов Prometheus и сортировать их, как в статистических диаграммах и графиках. Если отключен, будет использоваться метод `query_range`, чтобы вычислить и запрашивать ряд данных за определенный период времени.

- **Настройки панели**: Поддержка выбора различных типов панелей для визуализации данных метрик. Ссылка на [Управление панелями](#pannel).

2. Нажмите **Сохранить**, чтобы завершить добавление панелей.

3. Вы можете добавлять одну или несколько панелей в пределах панели мониторинга.

4. После добавления панелей вы можете использовать следующие операции, чтобы убедиться, что отображение и размер панелей соответствуют вашим ожиданиям.

   - Щелкните по правому нижнему углу панели, чтобы настроить ее размер.
   - Щелкните в любом месте на панели, чтобы изменить порядок панелей.

5. После этого нажмите кнопку **Сохранить** на странице панели, чтобы сохранить свои изменения.

### Добавить группы

Группы представляют собой логические разделители в панели, которые могут объединять панели вместе.

1. Нажмите на выпадающее меню **Добавить панель** > **Добавить группу** и обратитесь к следующим инструкциям для настройки соответствующих параметров.

- **Группа**: Имя группы.
- **Повторить**: Поддерживает отключение повторов или выбор переменных для текущих панелей.
  - **Отключить повторение**: Не выбирайте переменную и воспользуйтесь созданной группой по умолчанию.
  - **Параметр переменных**: Выберите переменные, созданные в текущих панелях, и панель мониторинга создаст ряд идентичных подгрупп для каждого соответствующего значения переменной. Подгруппы не поддерживают изменения, удаления или перемещения панелей.

2. После добавления группы вы можете выполнять следующие операции с группой для управления отображением панелей внутри панели.

   - Группы можно свернуть или развернуть, чтобы скрыть часть содержимого на панели. Панели в свернутых группах не будут отправлять запросы.

   - Переместите панель в группу, чтобы позволить этой панели управляться этой группой. Группа будет управлять всеми панелями между ней и следующей группой.

   - Когда группа свернута, вы также можете переместить все панели, которыми управляет эта группа, вместе.

   - Свертывание и развертывание групп также составляют изменение панели. Если вы хотите сохранить это состояние при повторном открытии этой панели в следующий раз, пожалуйста, нажмите кнопку **Сохранить**.

### Переключение панелей

Установите созданную настраиваемую панель мониторинга в качестве основной панели. При повторном входе в функцию панели мониторинга данные основной панели будут отображаться по умолчанию.

1. В левой навигационной панели нажмите **Центр операций** > **Мониторинг** > **Панели мониторинга**.

2. По умолчанию будет открыта основная панель мониторинга. Нажмите **Сменить панель**.

3. Вы можете найти панели, фильтруя по меткам или ищу по названию и поменять основные панели через переключатель **Основная панель**.

### Другие операции

Вы можете нажать кнопку операции с правой стороны страницы панели, чтобы выполнять действия с панелью по мере необходимости.

| Операция             | Описание                                                                                                                                                         |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **YMAL**              | Открывает фактический код ресурса CR панели, хранящегося в кластере Kubernetes. Вы можете изменить все содержимое в панели, отредактировав параметры в YAML. |
| **Экспорт выражения** | Вы можете экспортировать метрики и соответствующие выражения запросов, используемые в текущей панели, в формате CSV.                                                         |
| **Копировать**        | Копирует текущую панель; Вы можете редактировать панели по мере необходимости и сохранить её как новую панель.                                                                    |
| **Настройки**         | Изменяет основную информацию о текущей панели, такую как изменение меток и добавление более переменных.                                                         |
| **Удалить**           | Удаляет текущую панель мониторинга.                                                                                                                           |

## Управление панелями \{#pannel}

Платформа предоставляет различные методы визуализации для поддержки различных случаев использования. Эта глава в основном познакомит с этими типами панелей, параметрами конфигурации и методами использования.

### Описание панели

| Номер   | Название панели      | Описание                                                                                                                   | Рекомендуемые случаи использования                                                                                                                                                                                                                                        |
| ------- | ---------------------- | --------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1**   | График тенденций        | Отображает тенденцию данных со временем с помощью одного или нескольких сегментов линий.                                   | Показывает тенденции со временем, такие как изменения в использовании ЦП, памяти и т. д.                                                                                                                                                                             |
| **2**   | Ступенчатая линейная диаграмма | Строится на основе линейного графика, соединяя точки данных горизонтальными и вертикальными сегментами, чтобы сформировать ступенчатую структуру. | Подходит для отображения временных меток дискретных событий, таких как количество предупреждений.                                                                                                                                                                   |
| **3**   | Столбчатая диаграмма    | Использует вертикальные прямоугольные столбцы для представления величины данных, при этом высота столбцов представляет значение.  | Столбчатые диаграммы интуитивно кажутся подходящими для сравнения различных значений, полезным для выявления паттернов и аномалий, подходят для сценариев, ориентированных на изменения значений, таких как количество подов, количество узлов и т. д.                                           |
| **4**   | Горизонтальная столбчатая диаграмма | Аналогична столбчатой диаграмме, но использует горизонтальные прямоугольные столбцы для представления данных.                   | Когда есть много измерений данных, горизонтальные столбчатые диаграммы могут лучше использовать пространственное расположение и улучшать читаемость.                                                                                                                                      |
| **5**   | График с измерениями || Использует полукруглые или кольцевые формы для представления текущего значения индикатора и его доли от общего.                | Интуитивно отражает текущее состояние ключевых показателей мониторинга, таких как использование ЦП системы и использование памяти. Рекомендуется использовать пороговые значения с изменением цвета для указания аномальных условий.                                       |
| **6**   | График с показом столбцов     | Использует вертикальные прямоугольные столбцы для отображения текущего значения индикаторов и их доли.                         | Интуитивно отражает текущее состояние ключевых индикаторов, таких как прогресс выполнения цели и нагрузка системы. Когда существуют несколько категорий одного и того же индикатора, график с показом столбцов более предпочтителен, например, доступное дисковое пространство или использование. |
| **7**   | Круговая диаграмма      | Использует сектора для отображения пропорционального отношения частей к целому.                                            | Подходит для демонстрации состава общих данных по различным измерениям, таким как пропорции кодов ответа 4XX, 3XX и 2XX за определенный период времени.                                                                                         |
| **8**   | Таблица                  | Организует данные в формате строк и столбцов, что упрощает просмотр и сравнение конкретных значений.                         | Подходит для отображения структурированных многомерных данных, таких как детальная информация об узлах, детальная информация о подах и т. д.                                                                                                                       |
| **9**   | График статусов         | Отображает текущее значение одного ключевого индикатора, обычно требуя текстового объяснения.                               | Подходит для отображения текущих значений важных индикаторов мониторинга, таких как количество подов, количество узлов, текущее количество предупреждений и т. д.                                                                                                              |
| **10**  | Диаграмма рассеяния      | Использует декартовые координаты для отображения серии точек данных, отражая корреляцию между двумя переменными.              | Подходит для анализа взаимосвязей между двумя индикаторами, выявления таких паттернов, как линейная корреляция и кластеризация на основе распределения точек данных, помогает выявлять взаимосвязи между метриками.                                        |
| **11**  | Текстовая карта          | Отображает ключевую текстовую информацию в формате карты, обычно содержащей заголовок и краткое описание.                     | Подходит для представления текстовой информации, такой как описания панелей и объяснения устранения неполадок.                                                                                                                                                 |

### Описание конфигурации панели

#### Общие параметры

| Параметр                 | Описание                                                                                                                                                                                                                         |
| ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Основная информация**   | Выберите соответствующий тип панели в зависимости от выбранных данных метрик и добавьте заголовки и описания; вы можете добавить одну или несколько ссылок, которые могут быть быстро доступны, выбрав соответствующее имя ссылки рядом с заголовком. |
| **Стандартные настройки** | Единицы, используемые для нативных данных метрик. Кроме того, графики и графики с показом столбцов также поддерживают настройку поля **Общая сумма**, которое будет отображаться как процент **Текщее значение/Общая сумма** на графике.           |
| **Всплывающие подсказки** | Всплывающие подсказки — это переключатель отображения для данных в реальном времени при наведении на панели и поддерживают выбранную сортировку.                                                                                       |
| **Параметры порога**     | Настройте переключатель порога для панелей; когда включен, порог будет отображаться в выделенных цветах на панелях, что позволяет регулировать размеры порога.                                                                     |
| **Значение**             | Установите метод расчета значений, такие как наиболее недавние значения или минимальные значения. Этот параметр конфигурации применяется только к графикам статуса и графикам с показом столбцов.                                       |
| **Сопоставление значений**| Переопределите указанные значения или диапазоны значений, такие как определение 100 как полной нагрузки. Этот параметр конфигурации применяется только к графикам статуса, таблицам и графикам с измерениями.                                   |

#### Специальные параметры для панелей

| Тип панели    | Параметр                | Описание                                                                                                                                                                                                                                                                                                                                                           |
| --------------| ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **График тренда** | **Стиль графика**       | Вы можете выбрать между линейным графиком или графиком области в качестве стиля отображения; линейные графики больше сосредоточены на отражении изменений тенденции индикаторов, в то время как графики области привлекают больше внимания к изменениям в общих и частичных долях. Выбирайте в зависимости от ваших фактических потребностей.                                                                                     |
| **График с измерениями**| **Настройки графика с измерениями** | <br /> **Направление отображения**: Когда вам нужно просмотреть несколько метрик в одной диаграмме, вы можете установить, расположены ли эти метрики горизонтально или вертикально.<br /> **Переопределение единицы**: Вы можете задать независимые единицы для каждой метрики; если не установлено, платформа будет отображать единицы из **Стандартных настроек**.                                                   |
| **Круговая диаграмма**| **Настройки круговой диаграммы**   | <br /> **Максимальное количество сегментов**: Вы можете установить этот параметр, чтобы сократить количество сегментов в круговой диаграмме, чтобы уменьшить влияние категорий с относительно низкими пропорциями, но высоким количеством. Лишние сегменты будут объединены и отображены как **Прочие**.<br /> **Поля отображения меток**: Вы можете установить поля, отображаемые в метках круговой диаграммы. |
| **Круговая диаграмма**| **Стиль графика**            | Вы можете выбрать либо круг, либо пончик в качестве стиля отображения.                                                                                                                                                                                                                                                                                              |
| **Таблица**       | **Настройки таблицы**         | <br /> **Скрыть столбцы**: Вы можете уменьшить количество столбцов в таблице с помощью этого параметра, чтобы сосредоточиться на некоторых основных столбцах информации.<br /> **Выравнивание столбца**: Вы можете изменить выравнивание данных в пределах столбца с помощью этого параметра.<br /> **Отображаемое имя и единица**: Вы можете изменить названия столбцов и единицы, используемые через этот параметр.         |
| **Текстовая карта** | **Стиль графика**            | <br /> **Стиль**: Вы можете выбрать редактор содержимого, который хотите отобразить в текстовой карте, в котором будет использован либо редактор с расширенными функциями, либо HTML.                                                                                                                                                                       |

## Создание панелей мониторинга с помощью CLI

1. Создайте новый файл конфигурации YAML с именем `example-dashboard.yaml`.
2. Добавьте ресурс MonitorDashboard в файл YAML и отправьте его. Следующий пример создает панель мониторинга с именем demo-v2-dashborad1:

```yaml
kind: MonitorDashboard
apiVersion: ait.alauda.io/v1alpha2
metadata:
  annotations:
    cpaas.io/dashboard.version: "3"
    cpaas.io/description: '{"zh":"描述信息","en":""}' # Поле описания
    cpaas.io/operator: admin
  labels:
    cpaas.io/dashboard.folder: demo-v2-folder1 # Папка
    cpaas.io/dashboard.is.home.dashboard: "False" # Является ли это основной панелью?
  name: demo-v2-dashborad1 # Имя
  namespace: cpaas-system  # Пространство имен (все создания представлений управления будут происходить в этом ns)
spec:
  body: # Все поля информации
    titleZh: 更新显示名称 # Встроенное поле для китайского отображаемого названия (это поле создается на китайском языке)
    title: english_display_name # Встроенное поле для английского отображаемого названия (это поле создается на английском языке) Встроенные панели могут установить двуязычные переводы.
    templating: # Пользовательские переменные
      list:
        - hide: 0 # 0 означает, что не скрыто; 1 означает, что скрыто только название; 2 означает, что скрыты как название, так и значение
          label: 集群 # Встроенное отображаемое имя переменной (метка установлена на соответствующее имя на основе языка, например, cluster на английском)
          name: cluster # Встроенное имя переменной (уникальное)
          options: # Определите варианты для выпадающего списка; если запрос получает данные, он будет использовать запрашиваемые данные; в противном случае он будет использовать варианты. Можно установить значение по умолчанию (обычно используется только для установки значений по умолчанию)
            - selected: false # Нужно ли по умолчанию выбирать
              text: global
              value: global
          type: custom # Тип пользовательской переменной; в настоящее время поддерживаются только встроенные (пользовательские) и запросы (Импорт Grafana поддерживает постоянный пользовательский интервал (после импорта изменится на пользовательскую переменную и не будет поддерживать авто))
 
        - allValue: "" # Выбрать все, передав варианты в формате xxx|xxx|xxx; можно установить allValue для преобразования (Grafana получает все данные для текущей переменной как xxx|xxx|xxx, коррекции будут обеспечивать согласованность)
          current: null # Текщее значение переменной; если не установлено, по умолчанию используется первое в списке
          definition: query_result(kube_namespace_labels) # Выражение запроса для получения данных
          hide: 0 # 0 означает, что не скрыто; 1 означает, что скрыто только название; 2 означает, что скрыты как название, так и значение
          includeAll: true # Нужно ли выбрать все
          label: ns # Встроенное отображаемое имя переменной
          multi: true # Разрешено ли множественный выбор
          name: ns # Имя переменной (уникальное)
          options: [] 
          query: ""
          regex: /.*namespace=\"(.*?)\".*/ # Регулярное выражение для извлечения значений переменной
          sort: 2 # Сортировка: 1 - по возрастанию в алфавитном порядке; 2 - по убыванию в алфавитном порядке (только эти два поддерживаются временно); 3 - по возрастанию в числовом порядке; 4 - по убыванию в числовом порядке
          type: query # Тип пользовательской переменной
    time: # Время панели мониторинга
      from: now-30m # Время начала
      to: now # Время окончания
    repeat: '' # Конфигурация повторения ряда; выбирает пользовательскую переменную
    collapsed: 'false' # Конфигурация сворачивания или развертывания ряда
    description: "123" # Описание (всплывающая подсказка после названия)
    targets: # Источники данных
      - indicator: cluster.node.ready # Метрика
        expr: sum (cpaas_pod_number{cluster=\"\"}>0) # Выражение PromQL
        instant: false # Режим запроса true получает данные в определенный момент времени
        legendFormat: "" # Легенда
        range: true # Значение по умолчанию запрашиваемого диапазона при получении данных
        refId: 指标1 # Уникальный идентификатор для отображаемого имени источника данных
    gridPos: # Информация о позиционной компоновке панели
        h: 8 # Высота
        w: 12 # Ширина (ширина соответствует 24 единицам сетки)
        x: 0 # Горизонтальная позиция
        y: 0 # Вертикальная позиция
    panels: # Данные панели
      title: 图表标题tab # Имя панели
      type: table # Тип панели; в настоящее время поддерживает временные ряды, столбчатые диаграммы, статусы, графики, таблицы, графики с показом столбцов, строк, текста, круговые диаграммы (ступенчатая диаграмма, диаграмма рассеяния, столбчатая диаграмма, конфигурируются через атрибут drawStyle)
      id: a2239830-492f-4d27-98f3-cb7ecb77c56f # Уникальный идентификатор
      links: # Ссылки
        - targetBlank: true # Открыть в новой вкладке
          title: "1" # Имя
          url: "1" # URL адрес
      transformations: # Преобразования данных
        - id: "organize" # Тип организовать; используется для сортировки, изменения порядка, отображения полей, отображать ли
          options:
            excludeByName: # Скрытые поля
              cluster_cpu_utilization: true
            indexByName: # Сортировка
                cluster_cpu_utilization: 0,
                Time: 1
            renameByName: # Переименовать
              Time: ""
              cluster_cpu_utilization: "222"
        - id: "merge" # Объединение данных
          options:
      fieldConfig: # Для определения свойств и внешнего вида панели
        defaults: # В зависимости от конфигурации
          custom: # Настраиваемые графические атрибуты
            align: "left" # Выравнивание таблицы: влево, по центру, вправо
            cellOptions: # Конфигурация порога таблицы
              type: color-text # Поддерживает только текст для настройки порогового цвета
            spanNulls: false # true соединяет нулевые значения; false не соединяет; number == 0 соединяет нулевые значения согласно 0
            drawStyle: line # Типы панелей: линия, бары для столбчатых диаграмм, точки для точечных графиков
            fillOpacity: 20 # Существует, когда настройка style drawStyle area (в настоящее время не поддерживает конфигурацию, область по умолчанию равна 20)
            thresholdsStyle: # Настраивает, как отображать пороги (в настоящее время поддерживает только линию)
              mode: line # Формат отображения порога (область в настоящее время не поддерживается)
            lineInterpolation: 'stepBefore' # Конфигурация ступенчатой диаграммы; по умолчанию, поддерживается только stepBefore (будет поддерживаться stepAfter позже)
          decimals: 3 # Десятичные знаки
          min: 0 # Минимальное значение (в настоящее время не поддерживается для конфигурации страницы, поддерживается только адаптивный импорт)
          max: 1 # Максимальное значение (конфигурация страницы применяется только к статическим графикам, графикам с колонками)
          unit: "%" # Единица
          mappings: # Конфигурация сопоставления значений (в настоящее время поддерживаются только значения и диапазоны значений; специальные типы, поддерживаемые на данных)
            - options: # Правила сопоставления значений
                "1": # Соответствующее значение
                  index: 0
                  text: "Запуск" # Отображается как Запуск, когда значение равно 1
              type: value # Тип сопоставления значений
            - options: # Правила сопоставления диапазонов
                from: 2 # Начальное значение диапазона
                to: 3 # Конечное значение диапазона
                result: # Результат сопоставления
                  index: 1
                  text: "Ошибка" # Значения от 2 до 3 будут отображаться как Ошибка
              type: range # Тип сопоставления для диапазона
            - type: special # Тип сопоставления для специальных сценариев
              options:
                match: null # nan null null+nan пустые true false
                result:
                  text: xxx
                  index: 2
          thresholds: # Конфигурация порога
            mode: absolute # Режим конфигурации порога, режим абсолютных значений (в настоящее время поддерживает только абсолютный и процентный режим; процентный режим пока не поддерживается)
            steps: # Шаги порога
              - color: "#a7772f" # Цвет порога
                value: "2" # Значение порога
              - color: "#007AF5" # Значение по умолчанию без значения является Основой
        overrides: # Конфигурация переопределения
          - matcher:
              id: byName # Соответствие по имени поля
              options: node # Соответствующее имя
            properties: # Конфигурация переопределения; id в настоящее время поддерживает только displayName unit
              - id: displayName # Переопределение имени отображения
                value: "1" # Переопределенное имя отображения
              - id: unit # Переопределение единицы
                value: GB/s # Значение единицы
              - id: noValue # Нет значения отображается
                value: Отображается без значения
      options:
        orientation: horizontal # Управляет направлением компоновки панелей; применяется к графикам с измерениями и барграфам (статус будет поддерживаться позже)
        legend: # Конфигурация легенды
          calcs: # Метод вычисления (отображается только когда позиция легенды справа)
            - latest # В настоящее время поддерживается только наиболее недавнее значение
          placement: right # Позиция легенды (справа или внизу; по умолчанию внизу)
          placementRightTop: "" # Конфигурация для верхнего правого угла
          showLegend: true # Нужно ли отображать легенду
        tooltip: # Всплывающие подсказки
          mode: multi # Режим двойного выбора (поддерживается только многомодальный режим) Все данные отображаются, когда мышь наведена
          sort: asc # Сортировка: asc или desc
        reduceOptions: # Метод вычисления значения (используется для агрегации данных)
          calcs: # Метод вычисления (последний, минимальный, максимальный, средний, сумма)
            - latest
          limit: 3 # Круговая диаграмма ограничивает количество сегментов
        textMode: 'value' # Конфигурация статуса; определяет стиль для отображения значения метрики; варианты auto, value, value_and_name, name, none (в настоящее время не поддерживается в конфигурации страницы, но поддерживается в импортах)
        colorMode: 'value' # Конфигурация статуса; определяет цветовой режим для отображения значений метрик; варианты none, value, background (по умолчанию значение; не поддерживается в конфигурации, но адаптировано в импорте)
        displayLabels: ['name','value', 'percent'] # Поля, отображаемые в метках круговой диаграммы
        pieType: "pie" # Тип круговой диаграммы; варианты круг и пончик
        mode: 'html' # Режим типа текстовой диаграммы; варианты html и richText
        content: '<div>xxx</div>' # Содержимое для текстового типа графика
        footer:
          enablePagination: true # Постраничный вывод таблицы включен
```

## Общие функции и переменные \{#variable}

### Общие функции

При определении параметров запроса, помимо использования PromQL для задания запросов, платформа предоставляет несколько общих функций для вашего справки в настройке параметров запросов.

| Функция                        | Цель                                                                                                                   |
| ------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| **label\_names()**             | Возвращает все метки в Prometheus, например, label\_names().                                                          |
| **label\_values(label)**       | Возвращает все выбираемые значения для имени метки во всех мониторируемых метриках в Prometheus, например, label\_values(job). |
| **label\_values(metric, label)**| Возвращает все выбираемые значения для имени метки в указанной метрике в Prometheus, например, label\_values(up{}, job). |
| **metrics(metric)**             | Возвращает все имена метрик, которые соответствуют определенному регулярному шаблону в поле метрики, например, metrics(cpaas\_active).   |
| **query\_result(query)**        | Возвращает результат запроса для указанного запроса Prometheus, например, query\_result(up{}).                      |

### Общие переменные

При определении параметров запроса вы можете комбинировать общие функции в переменные для быстрой настройки пользовательских переменных. Вот некоторые определения общих переменных, доступные для вашего справки:

| Имя переменной | Запросная функция                                                                               | Регулярное выражение  |
| --------------- | ---------------------------------------------------------------------------------------------- | ---------------------- |
| **cluster**     | `label_values(cpaas_cluster_info,cluster)`                                                    | -                      |
| **node**        | `label_values(node_load1, instance)`                                                          | `/(.*?):.*/`           |
| **namespace**   | `query_result(kube_namespace_labels)`                                                         | `/.*namespace=\"(.*?)\".*/`|
| **deployment**  | `label_values(kube_deployment_spec_replicas{namespace="$namespace"}, deployment)`             | -                      |
| **daemonset**   | `label_values(kube_daemonset_status_number_ready{namespace="$namespace"}, daemonset)`        | -                      |
| **statefulset** | `label_values(kube_statefulset_replicas{namespace="$namespace"}, statefulset)`                | -                      |
| **pod**         | `label_values(kube_pod_info{namespace=~"$namespace"}, pod)`                                   | -                      |
| **vmcluster**   | `label_values(up, vmcluster)`                                                                 | -                      |
| **daemonset**   | `label_values(kube_daemonset_status_number_ready{namespace="$namespace"}, daemonset)`        | -                      |

### Пример использования переменной один

Используя функцию **query\_result(query)** для запроса значения: `node_load5`, и извлечения IP.

1. В **Настройках запроса** заполните `query_result(node_load5)`.

2. В области **Предварительный просмотр значения переменной** пример предварительного просмотра: `node_load5{container="node-exporter",endpoint="metrics",host_ip="192.168.178.182",instance="192.168.178.182:9100"}`.

3. В **Регулярном выражении** заполните `/.*instance="(.*?):.*/`, чтобы отфильтровать значение.

4. В области **Предварительный просмотр значения переменной** пример предварительного просмотра: `192.168.176.163`.

### Пример использования переменной два

1. Добавьте первую переменную: namespace, используя функцию **query\_result(query)** для запроса значения: `kube_namespace_labels`, и извлечения пространства имен.

   - **Настройки запроса**: `query_result(kube_namespace_labels)`.

   - **Предварительный просмотр значения переменной**: `kube_namespace_labels{container="exporter-kube-state", endpoint="kube-state-metrics", instance="12.3.188.121:8080", job="kube-state", label_cpaas_io_project="cpaas-system", namespace="cert-manager", pod="kube-prometheus-exporter-kube-state-55bb6bc67f-lpgtx", project="cpaas-system", service="kube-prometheus-exporter-kube-state"}`.

   - **Регулярное выражение**: `/.+namespace=\"(.*?)\".*/`.

   - В области **Предварительный просмотр значения переменной** требуется пример, который включает несколько пространств имен, таких как `argocd`, `cpaas-system и др.`

2. Добавьте вторую переменную: deployment и сослитесь на ранее созданную переменную:

   - **Настройки запроса**: `kube_deployment_spec_replicas{namespace=~"$namespace"}`.

   - **Регулярное выражение**: `/.+deployment="(.*?)",.*/`.

3. Добавьте панель на текущую панель мониторинга и сослитесь на ранее добавленные переменные, например:

   - Название метрики: **Использование памяти пода под вычислительными компонентами**.

   - Пара ключ-значение: `kind`: `Deployment`, `name`: `$deployment`, `namespace`: `$namespace`.

4. После добавления панелей и их сохранения вы сможете просматривать соответствующую информацию о панели на главной странице панели мониторинга.

### Примечания при использовании встроенных метрик

:::warning

Следующие метрики используют пользовательские переменные `namespace`, `name` и `kind`, которые не поддерживают **множественный выбор** или выбор **всех**.

- `namespace` поддерживает только выбор одного конкретного пространства имен;
- `name` поддерживает выбор только трех типов вычислительных компонентов: `deployment`, `daemonset`, `statefulset`;
- `kind` поддерживает выбор одного из типов: `Deployment`, `DaemonSet`, `StatefulSet`.

:::

- `workload.cpu.utilization`

- `workload.memory.utilization`

- `workload.network.receive.bytes.rate`

- `workload.network.transmit.bytes.rate`

- `workload.gpu.utilization`

- `workload.gpu.memory.utilization`

- `workload.vgpu.utilization`

- `workload.vgpu.memory.utilization`
