---
weight: 40
i18n:
  disableAutoTranslation: false
  title:
    en: Manage Dashboards
    ru: Управление Пультами
  additionalPrompts: 'Пожалуйста, переведите ''图表'' как pannel и ''面板'' как dashboard'
title: Управление Пультами
sourceSHA: 08df5a407e6cd222a774b95b8b1586c131a81dccb518094fbca63f05148b8315
---

# Управление Мониторинговыми Панелями

## Обзор Функций

Платформа предоставляет мощные функции управления панелями, предназначенные для замены традиционных инструментов Grafana, предлагая пользователям более комплексный и гибкий опыт мониторинга. Эта функция агрегирует различные данные мониторинга с платформы, предоставляя единый мониторинговый вид, который значительно улучшает вашу эффективность конфигурации.

### Основные Особенности

- Поддерживает настройку пользовательских мониторинговых панелей как для бизнес-визуализаций, так и для визуализаций платформы.
- Позволяет просматривать публичноShared панели, настроенные в визуализациях платформы из бизнес-визуализаций, с изоляцией данных на основе пространства имен, к которому относится бизнес.
- Поддерживает управление панелями в рамках дашборда, что позволяет пользователям добавлять, удалять, изменять панели, увеличивать/уменьшать их размер и перемещать панели с помощью перетаскивания.
- Позволяет устанавливать пользовательские переменные на панели для фильтрации данных запросов.
- Поддерживает конфигурацию групп на панелях для управления пannel. Группы могут отображаться многократно на основе пользовательских переменных.
- Поддерживаемые типы панелей включают: трендовый, шаговый линейчатый график, столбчатый график, горизонтальный столбчатый график, график с барометрическим отображением, график, таблицу, статусный график, XY график, круговой график, текст.
- Функция импорта панелей с одним кликом для дашбордов Grafana.

### Преимущества

- Поддерживает пользовательские сценарии мониторинга, не ограничиваясь заранее определенными шаблонами, что позволяет достичь действительно персонализированного опыта мониторинга.
- Предоставляет широкий спектр вариантов визуализации, включая линейные графики, столбчатые графики, круговые графики и гибкие параметры компоновки и стилизации.
- Бесшовная интеграция с разрешениями на платформе, позволяя бизнес-визуализациям определять свои собственные мониторинговые панели, обеспечивая при этом изоляцию данных.
- Глубокая интеграция с различными функциями контейнерной платформы, обеспечивая мгновенный доступ к данным мониторинга для контейнеров, сетей, хранения и т.д., предоставляя пользователям комплексное наблюдение за производительностью и диагностику неисправностей.
- Полная совместимость с JSON-доводами Grafana, позволяя легко迁移 из Grafana для продолжения использования.

### Сценарии Использования

- **Управление IT Операциями**: Как часть команды IT операций, вы можете использовать мониторинговые панели для унификации отображения и управления различными показателями производительности контейнерной платформы, такими как CPU, память, сетевой трафик и т.д. Настраивая мониторинговые отчеты и правила уведомлений, вы можете оперативно обнаруживать и определять проблемы в системе, повышая операционную эффективность.
- **Анализ Производительности Приложений**: Для разработчиков и тестировщиков приложений мониторинговые панели предлагают различные богатые варианты визуализации для интуитивного отображения состояния выполнения приложений и потребления ресурсов. Вы можете настраивать специальные мониторинговые виды, адаптированные к различным сценариям приложений, чтобы глубже анализировать узкие места в производительности приложений и предоставить базу для оптимизации.
- **Управление Мультикластерами**: Для пользователей, управляющих несколькими контейнерными кластерами, мониторинговые панели могут объединять данные мониторинга из различных кластеров, позволяя вам быстро охватить общее состояние системы.
- **Диагностика Неисправностей**: Когда возникает проблема в системе, мониторинговые панели предоставляют вам обширные данные по производительности и аналитические инструменты для быстрой локализации коренной причины проблемы. Вы можете быстро просмотреть колебания в соответствующих показателях мониторинга на основании информации об уведомлениях для глубокого анализа неисправностей.

### Предварительные Условия

В настоящее время мониторинговые панели поддерживают только просмотр данных мониторинга, собранных компонентами мониторинга, установленными на платформе. Поэтому перед конфигурацией мониторинговой панели необходимо подготовить следующее:

- Убедитесь, что кластер, для которого вы хотите настроить мониторинговую панель, имеет установленные компоненты мониторинга, в частности, **ACP Monitor с Prometheus** или **ACP Monitor с VictoriaMetrics** плагином.
- Убедитесь, что данные, которые вы хотите отобразить на панели, были собраны компонентами мониторинга.

### Взаимосвязь Между Мониторинговыми Панелями и Компонентами Мониторинга

- Ресурсы мониторинговых панелей хранятся в кластере Kubernetes. Вы можете переключать представления между различными кластерами с помощью вкладки **Кластер** в верхней части.
- Мониторинговые панели зависят от компонентов мониторинга в кластере для запроса источников данных. Поэтому перед использованием мониторинговых панелей убедитесь, что текущий кластер успешно установил компоненты мониторинга и что они функционируют нормально.
- Мониторинговая панель по умолчанию будет запрашивать данные мониторинга из соответствующего кластера. Если вы установите плагин **VictoriaMetrics** в режим прокси в кластере, мы запросим у хранилища кластера необходимые данные без необходимости специальной конфигурации.

## Управление Панелями \{#manage\_dashboard}

Панель является коллекцией, состоящей из одной или нескольких панелей, организованных и расположенных в одном или нескольких рядах для предоставления четкого представления о соответствующей информации. Эти панели могут запрашивать необработанные данные из источников данных и преобразовывать их в ряд визуальных эффектов, поддерживаемых платформой.

### Создание Панели \{#create\_dashboard}

1. Нажмите **Создать Панель**, обратитесь к следующим инструкциям для настройки соответствующих параметров.

| Параметр                | Описание                                                                                                                                                                                              |
| ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Папка**                | Папка, в которой находится панель; вы можете ввести или выбрать существующую папку.                                                                                                                      |
| **Ярлык**                 | Ярлык для мониторинговой панели; вы можете быстро найти существующие панели, фильтруя через основные ярлыки во время переключения.                                                                      |
| **Установить как Основную Панель** | Если включено, это установит текущую панель как основную панель после успешного создания; при повторном входе в функцию мониторинговых панелей данные основной панели будут отображаться по умолчанию. |
| **Переменные**             | Добавьте переменные при создании панели, чтобы ссылаться на них в параметрах метрики добавляемых панелей, которые также могут использоваться как фильтры на домашней странице панели.                                           |

2. После добавления нажмите **Создать**, чтобы завершить создание панели. Далее вам необходимо **добавить переменные**, **добавить панели** и **добавить группы**, чтобы завершить общий макет.

### Импорт Панели

Платформа поддерживает прямой импорт JSON Grafana для преобразования его в мониторинговую панель для отображения.

- В настоящее время поддерживается только JSON Grafana версии V8+; более низкие версии будут запрещены для импорта.
- Если какие-либо панели в импортированной панели не находятся в пределах поддерживаемого объема платформы, они могут отображаться как **неподдерживаемые типы пannel**, но вы можете изменить настройки панели для достижения нормального отображения.
- После импорта панели вы можете выполнять любые действия по управлению, как обычно, которые не будут отличаться от панелей, созданных на платформе.

### Добавление Переменных

1. В области формы переменных нажмите **Добавить**.

   | Параметр              | Описание                                                                                                                                                                                                                                                                                                                                                                                                   |
   | ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Тип**               | В настоящее время поддерживаются только переменные типа Запрос, которые позволяют фильтровать данные на основе измерений времени. Выражение запроса может быть задано для динамического вычисления и генерации результатов запроса.                                                                                                                                                                                       |
   | **Фильтр Отображения**     | Значение по умолчанию для отображения параметров раскрывающего фильтра на домашней странице панели; поддерживает отображение имени и значения, только значения или отсутствие отображения (скрытие поля фильтра).                                                                                                                                                                                                                                      |
   | **Настройки Запроса**     | Использование переменных типа Запрос позволяет вам фильтровать данные на основе измерений времени. При определении настроек запроса, помимо использования PromQL для запроса временных рядов, платформа также предоставляет некоторые общие переменные и функции. Обратитесь к [Общим Функциям и Переменным](#ref-function).                                                                                                      |
   | **Регулярное Выражение** | Используя регулярные выражения, вы можете отфильтровать желаемые значения из контента, возвращаемого запросами переменных. Это делает название каждого параметра более ожидаемым. Вы можете просмотреть, соответствуют ли отфильтрованные значения ожиданиям в **Предварительном Просмотре Значений Переменных**.                                                                                                                                     |
   | **Настройки Выбора** | - **Несколько Выбор**: При выборе из верхних фильтров на домашней странице панели позволяет одновременно выбрать несколько параметров. Вам нужно ссылаться на эту переменную в выражении запроса панелей, чтобы просмотреть соответствующие данные для значения переменной.<br />- **Все**: Если установлен, параметр, содержащий **Все**, будет включен в параметры фильтра для выбора всех данных переменной. |

2. Нажмите **OK**, чтобы добавить одну или несколько переменных.

### Добавление Панелей \{#add\_pannel}

Добавьте несколько панелей к текущей созданной мониторинговой панели для отображения информации о данных для различных ресурсов.

**Совет**: Вы можете настроить размер панели, щелкнув по правому нижнему углу; щелкните в любом месте панели, чтобы изменить порядок панелей.

1. Нажмите **Добавить Панель**, обратитесь к следующим инструкциям для настройки соответствующих параметров.

- **Предпросмотр Панели**: В этой области динамически отображается информация о данных, соответствующая добавленным метрикам.

- **Добавить Метрику**: Настройте заголовок панели и мониторинговые метрики в этой области.

- **Способ Добавления**: Поддерживает использование встроенных метрик или использование самостоятельно разработанных метрик. Оба метода будут объединены и будут действовать одновременно.
  - **Встроенные Метрики**: Выберите часто используемые метрики и параметры легенды, встроенные в платформу, чтобы отобразить информацию о данных в текущей панели.
    - **Примечание**: Все метрики, добавленные на панель, должны иметь единый размер; невозможно добавить метрики с разными единицами на одну панель.
  - **Нативные**: Настройте единицу метрики, выражение метрики и параметры легенды. Выражение метрики следует синтаксису PromQL; для получения подробной информации обратитесь к [Официальной Документации PromQL](https://prometheus.io/docs/prometheus/latest/querying/basics/).

- **Параметры Легенды**: Управляйте именами, соответствующими кривым в панелях. Можно использовать текст или шаблоны:
  - Правило: Вводимое значение должно быть в формате `{{.xxxx}}`; например, `{{.hostname}}` будет заменено на значение, соответствующее метке hostname, возвращенной выражением.
  - **Совет**: Если вы введете неправильно отформатированный параметр легенды, имена, соответствующие кривым в панели, будут отображаться в оригинальном формате.

- **Мгновенный Переключатель**: Когда переключатель **Мгновенный** включен, он будет запрашивать мгновенные значения через интерфейс Запроса Prometheus и сортировать их, как в статистических таблицах и графиках. Если выключен, он использует метод `query_range` для вычисления, запрашивая серию данных за конкретный период времени.

- **Настройки Панелей**: Поддерживает выбор различных типов панелей для визуализации данных метрики. Обратитесь к [Управлению Панелями](#pannel).

2. Нажмите **Сохранить**, чтобы завершить добавление панелей.

3. Вы можете добавить одну или несколько панелей внутри дашборда.

4. После добавления панелей вы можете использовать следующие операции, чтобы убедиться, что отображение и размер панелей соответствуют вашим ожиданиям.

   - Щелкните по правому нижнему углу панели, чтобы настроить ее размер.
   - Щелкните в любом месте панели, чтобы изменить порядок панелей.

5. После настройки нажмите кнопку **Сохранить** на странице дашборда, чтобы сохранить ваши изменения.

### Добавление Групп

Группы - это логические разделители в панели, которые могут группировать панели вместе.

1. Нажмите выпадающее меню **Добавить Панель** > **Добавить Группу**, и обратитесь к следующим инструкциям для настройки соответствующих параметров.

- **Группа**: Имя группы.
- **Повторить**: Поддерживает отключение повторов или выбор переменных для текущих панелей.
  - **Отключить Повтор**: Не выбирайте переменную и используйте по умолчанию созданную группу.
  - **Параметры Переменных**: Выберите переменные, созданные в текущих панелях, и мониторинговая панель сгенерирует ряд идентичных подгрупп для каждого соответствующего значения переменной. Подгруппы не поддерживают изменения, удаления или перемещения панелей.

2. После добавления группы вы можете выполнять следующие операции по управлению отображением панелей внутри дашборда.

   - Группы могут быть свернуты или развернуты, чтобы скрыть часть содержимого в дашборде. Панели внутри свернутых групп не отправят запросы.

   - Переместите панель в группу, чтобы позволить этой панели управляться этой группой. Группа будет управлять всеми панелями между ней и следующей группой.

   - Когда группа свернута, вы также можете перемещать все панели, управляемые этой группой, вместе.

   - Сгибание и раскладывание групп также составляют изменение дашборда. Если вы хотите сохранить это состояние при повторном открытии этого дашборда в следующий раз, пожалуйста, нажмите кнопку **Сохранить**.

### Переключение Панелей

Установите созданную пользовательскую мониторинговую панель как основную панель. При повторном входе в функцию мониторинговых панелей данные основной панели будут отображаться по умолчанию.

1. В левой навигационной панели нажмите **Центр Операций** > **Мониторинг** > **Мониторинговые Панели**.

2. По умолчанию вводится основная мониторинговая панель. Нажмите **Переключить Панель**.

3. Вы можете находить панели, фильтруя по ярлыкам или ища по имени, и переключать основные панели через переключатель **Основная Панель**.

### Другие Операции

Вы можете нажать кнопку управления на правой стороне страницы панели, чтобы выполнить действия на панели по мере необходимости.

| Операция             | Описание                                                                                                                                                         |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **YMAL**              | Открывает фактический код ресурса CR панели, хранящегося в кластере Kubernetes. Вы можете изменить все содержимое в панели, редактируя параметры в YAML. |
| **Экспорт Выражения** | Вы можете экспортировать метрики и соответствующие выражения запросов, используемые в текущей панели, в формате CSV.                                                         |
| **Копировать**              | Копирует текущую панель; вы можете редактировать панели по мере необходимости и сохранить ее как новую панель.                                                                    |
| **Настройки**          | Изменяет основную информацию о текущей панели, такую как изменение ярлыков и добавление дополнительных переменных.                                                         |
| **Удалить**            | Удаляет текущую мониторинговую панель.                                                                                                                           |

## Управление Панелями \{#pannel}

Платформа предоставляет различные методы визуализации для поддержки различных случаев использования. Эта глава будет в основном вводить эти типы панелей, параметры конфигурации и методы использования.

### Описание Панели

| №     | Название Панели          | Описание                                                                                                             | Рекомендуемые Сценарии Использования                                                                                                                                                                                                                                        |
| ------ | ---------------------- | ----------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1**  | График Тренда          | Отображает тренд данных со временем через одну или несколько линий.                                                     | Показывает тренды со временем, такие как изменения в использовании CPU, памяти и т.д.                                                                                                                                                                             |
| **2**  | Ступенчатый Линейный График      | Основываясь на линейном графике, соединяет контрольные точки горизонтальными и вертикальными сегментами, создавая структуру в форме ступеней. | Подходящ для отображения временных меток дискретных событий, таких как количество уведомлений.                                                                                                                                                                   |
| **3**  | Стовбчатый График            | Использует вертикальные прямоугольные столбы для представления величины данных, где высота столбцов представляет значение.       | Стовбчатые графики интуитивно понятны для сравнения различий в значениях, полезны для обнаружения шаблонов и аномалий, подходят для сценариев с акцентом на изменения значений, таких как количество подов, количество нод и т.д.                                           |
| **4**  | Горизонтальный Стовбчатый График | Похожие на столбчатый график, но используют горизонтальные прямоугольные столбы для представления данных.                                        | Когда есть много измерений данных, горизонтальные стовбчатые графики могут лучше использовать пространственное расположение и улучшить читаемость.                                                                                                                                      |
| **5**  | График Измерения          | Использует половину или кольцо форм для представления текущего значения индикатора и его доли от общего.                | Интуитивно отражает текущее состояние ключевых мониторинговых индикаторов, таких как использование CPU системы и использование памяти. Рекомендуется использовать пороговые значения с изменением цвета для указания на ненормальные условия.                                       |
| **6**  | График Измерения со Стовбцами      | Использует вертикальные прямоугольные столбы для отображения текущего значения индикаторов и их доли.                         | Интуитивно отражает текущее состояние ключевых индикаторов, таких как прогресс выполнения целевых задач и нагрузка на систему. Когда существует несколько категорий одного и того же индикатора, график измерения со стовбцами более рекомендован, например, свободное место на диске или использование. |
| **7**  | Пироговый График            | Использует сектора для отображения пропорциональной взаимосвязи частей к целому.                                            | Подходит для демонстрации состава общих данных по различным измерениям, таким как пропорции кодов ответа 4XX, 3XX и 2XX за период.                                                                                         |
| **8**  | Таблица                | Организует данные в формате строк и столбцов, что облегчает просмотр и сравнение конкретных значений.                              | Подходит для отображения структурированных многомерных данных, таких как подробная информация о нодах, подробная информация о подах и т.д.                                                                                                                       |
| **9**  | Статусный График           | Отображает текущее значение одного ключевого индикатора, обычно требуя текстового объяснения.                          | Подходит для отображения значений в реальном времени важных мониторинговых индикаторов, таких как количество подов, количество нод, текущее количество уведомлений и т.д.                                                                                                              |
| **10** | Диаграмма Рассеяния         | Использует декартовы координаты для представления ряда точек данных, отражая взаимосвязь между двумя переменными.           | Подходит для анализа взаимосвязей между двумя индикаторами, открывая паттерны, такие как линейная корреляция и кластеризация через распределение точек данных, помогающих выявить взаимосвязи между метриками.                                        |
| **11** | Текстовая Карта            | Отображает ключевую текстовую информацию в формате карты, обычно containing a title and a brief description.                  | Подходит для представления текстовой информации, такой как описания панели и объяснения по устранению неисправностей.                                                                                                                                                 |

### Описание Конфигурации Панелей

#### Общие Параметры

| Параметр                | Описание                                                                                                                                                                                                                    |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Основная Информация**    | Выберите соответствующий тип панели в зависимости от выбранных метрик данных и добавьте заголовки и описания; вы можете добавить одну или несколько ссылок, к которым можно быстро получить доступ, выбрав соответствующее имя ссылки рядом с заголовком. |
| **Стандартные Настройки**    | Единицы, используемые для нативных метрик. Кроме того, графики измерений и микс-графики также поддерживают конфигурацию поля **Общая Стоимость**, которая будет отображаться как процент от **Текущая Стоимость / Общая Стоимость** в графике.           |
| **Подсказки**             | Подсказки - это переключатель отображения для реальных данных при наведении курсора на панели и поддерживают выбранную сортировку.                                                                                                  |
| **Параметры Порога** | Настройка переключателя порога для панелей; когда включено, порог будет отображаться в выбранных цветах на панелях, что позволяет установить размеры порога.                                                                 |
| **Значение**                | Настройте метод вычисления значений, например, наиболее недавнее значение или минимальное значение. Эта конфигурационная опция применяется только к статусным графикам и графикам измерений.                                                            |
| **Отображение Значений**        | Переопределите определенные значения или диапазоны значений, такие как определение 100 как полной нагрузки. Эта конфигурационная опция применима только к статусным графикам, таблицам и графикам измерений.                                                           |

#### Специальные Параметры для Панелей

| Тип Панели     | Параметр                | Описание                                                                                                                                                                                                                                                                                                                                                          |
| --------------- | ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **График Тренда** | **Стиль Графика**          | Вы можете выбрать между линейным графиком или областным графиком в качестве стиля отображения; линейные графики больше сосредоточены на отражении изменений трендов индикаторов, тогда как областные графики больше акцентируют внимание на изменениях в общих и частных пропорциях. Выберите в зависимости от ваших реальных потребностей.                                                                                               |
| **График Измерений** | **Настройки Графика Измерений** | <br /> **Направление Отображения**: Когда вам нужно просмотреть несколько метрик в одном графике, вы можете установить, будут ли эти метрики располагаться горизонтально или вертикально.<br /> **Переопределение Единицы**: Вы можете установить независимые единицы для каждой метрики; если не установлено, платформа отобразит единицы из **Стандартных Настроек**.                                           |
| **Пироговый График**   | **Настройки Пирогового Графика**   | <br /> **Максимальное Количество Секторов**: Вы можете установить этот параметр для уменьшения количества секторов в пироговом графике, чтобы уменьшить влияние категорий с сравнительно низкими пропорциями, но высоким количеством. Лишние сектора будут объединены и отображаться как **Другие**.<br /> **Поля Отображения Ярлыков**: Вы можете установить поля, отображаемые в ярлыках пирогового графика. |
| **Пироговый График**   | **Стиль Графика**          | Вы можете выбрать либо пирог, либо пончик в качестве стиля отображения.                                                                                                                                                                                                                                                                                                             |
| **Таблица**       | **Настройки Таблицы**       | <br /> **Скрыть Столбцы**: Вы можете уменьшить количество столбцов в таблице благодаря этому параметру, чтобы сосредоточиться на некоторой основной информации столбца.<br /> **Выравнивание Столбцов**: Вы можете изменить выравнивание данных внутри столбца с помощью этого параметра.<br /> **Имя Отображения и Единица**: Вы можете изменить названия столбцов и единицы, используемые через этот параметр.         |
| **Текстовая Карта**   | **Стиль Графика**          | <br /> **Стиль**: Вы можете отредактировать содержимое, которое хотите отобразить в текстовой карте, либо в текстовом поле с расширенным форматом, либо в HTML.                                                                                                                                                                                                                                 |

## Создание Мониторинговых Панелей через CLI

1. Создайте новый файл конфигурации YAML с именем `example-dashboard.yaml`.
2. Добавьте ресурс MonitorDashboard в файл YAML и отправьте его. Следующий пример создает мониторинговую панель с именем demo-v2-dashborad1:

```yaml
kind: MonitorDashboard
apiVersion: ait.alauda.io/v1alpha2
metadata:
  annotations:
    cpaas.io/dashboard.version: "3"
    cpaas.io/description: '{"zh":"描述信息","en":""}' # Поле Описания
    cpaas.io/operator: администратор
  labels:
    cpaas.io/dashboard.folder: demo-v2-folder1 # Папка
    cpaas.io/dashboard.is.home.dashboard: "False" # Является ли это основной панелью?
  name: demo-v2-dashborad1 # Имя
  namespace: cpaas-system  # Пространство имен (все создания представлений управления будут происходить в этом ns)
spec:
  body: # Все информационные поля
    titleZh: обновление имени отображения # Встроенное поле для китайского имени отображения (это поле создается под китайским языком)
    title: английское имя отображения # Встроенное поле для английского имени отображения (это поле создается под английским языком) Встроенные панели могут устанавливать двуязычные переводы.
    templating: # Пользовательские переменные
      list:
        - hide: 0 # 0 означает, что не скрыто; 1 означает, что скрыто только имя; 2 означает, что скрыты как имя, так и значение
          label: 集群 # Встроенное имя переменной (ярлык устанавливается на соответствующее имя на основе языка, например, кластер на английском)
          name: cluster # Встроенное имя переменной (уникально)
          options: # Определить выпадающие параметры; если запрос извлекает данные, он будет использовать запрашиваемые данные; в противном случае будут использованы параметры. Можно установить значение по умолчанию (обычно только для установки значений по умолчанию)
            - selected: false # Будет ли установлено по умолчанию
              text: global
              value: global
          type: custom # Тип пользовательской переменной; в настоящее время поддерживаются только встроенные (пользовательские) и запросы (импорт Grafana будет поддерживать постоянный пользовательский интервал (после импорта он изменится на пользовательскую переменную и не будет поддерживать автозаполнение))
 
        - allValue: "" # Выберите все, передавая параметры в формате xxx|xxx|xxx; можно установить allValue для преобразования (Grafana извлекает все данные для текущей переменной как xxx|xxx|xxx, корректировки обеспечат согласованность)
          current: null # Текущее значение переменной; если не задано, по умолчанию будет первое в списке
          definition: query_result(kube_namespace_labels) # Запросное выражение для извлечения данных
          hide: 0 # 0 означает, что не скрыто; 1 означает, что скрыто только имя; 2 означает, что скрыты как имя, так и значение
          includeAll: true # Нужно ли выбрать все
          label: ns # Встроенное имя переменной
          multi: true # Разрешены ли множественные выборы
          name: ns # Имя переменной (уникально)
          options: [] 
          query: ""
          regex: /.*namespace=\"(.*?)\".*/ # Регулярное выражение для извлечения значений переменной
          sort: 2 # Сортировка: 1 - по возрастанию; 2 - по убыванию (только эти два поддерживают временное использование); 3 - по возрастанию числового значения; 4 - по убыванию числового значения
          type: query # Тип пользовательской переменной
    time: # Время панели
      from: now-30m # Время начала
      to: now # Время окончания
    repeat: '' # Настройка повторов строк; выбирает пользовательскую переменную
    collapsed: 'false' # Настройка сворачивания или разворачивания строки
    description: "123" # Описание (подсказка после заголовка)
    targets: # Источники данных
      - indicator: cluster.node.ready # Метрика
        expr: sum (cpaas_pod_number{cluster=\"\"}>0) # Выражение PromQL
        instant: false # Режим запроса true извлекает данные в определенное время
        legendFormat: "" # Легенда
        range: true # Запрашивание диапазона по умолчанию при извлечении данных
        refId: 指标1 # Уникальный идентификатор для отображаемого имени источника данных
    gridPos: # Информация о позиционном макете панели дашборда
        h: 8 # Высота
        w: 12 # Ширина (ширина соответствует 24 единицам сетки)
        x: 0 # Горизонтальная позиция
        y: 0 # Вертикальная позиция
    panels: # Данные панели
      title: график заголовка # Название панели
      type: table # Тип панели; в настоящее время поддерживает временные ряды, струдчатый график, статус, измеритель, таблицу, показатели, строку, текст, круг (степенный график, график рассеяния, струдчатый график, настраиваемый через атрибут drawStyle)
      id: a2239830-492f-4d27-98f3-cb7ecb77c56f # Уникальный идентификатор
      links: # Ссылки
        - targetBlank: true # Открыть в новой вкладке
          title: "1" # Имя
          url: "1" # URL-адрес
      transformations: # Преобразования данных
        - id: "organize" # Тип организации; используется для сортировки, изменения порядка, отображения полей, нужно ли отображать 
          options:
            excludeByName: # Скрытые поля
              cluster_cpu_utilization: true
            indexByName: # Сортировка
                cluster_cpu_utilization: 0,
                Time: 1
            renameByName: # Переименование
              Time: ""
              cluster_cpu_utilization: "222"
        - id: "merge" # Слияние данных
          options:
      fieldConfig: # Для определения свойств и внешнего вида панели
        defaults: # Конфигурация по умолчанию
          custom: # Пользовательские графические атрибуты
            align: "left" # Выравнивание таблицы: слева, по центру, справа
            cellOptions: # Настройка порога таблицы
              type: color-text # Поддерживает текст только для настройки цветов порогов
            spanNulls: false # true соединяет пустые значения; false не соединяет; число == 0 соединяет пустые значения при 0
            drawStyle: line # Типы панелей: линия, столбцы для столбчатых графиков, точки для точечных графиков
            fillOpacity: 20 # Существует, когда drawStyle - область (в настоящее время не поддерживает настройку, область по умолчанию 20)
            thresholdsStyle: # Настройка отображения порогов (в настоящее время поддерживает только линию)
              mode: line # Формат отображения порога (область в настоящее время не поддерживается)
            lineInterpolation: 'stepBefore' # Настройка ступенчатого графика; по умолчанию поддерживает только stepBefore (stepAfter будет поддерживаться позже)
          decimals: 3 # Количество десятичных знаков
          min: 0 # Минимальное значение (в настоящее время не поддерживается для настройки страницы, поддерживается только импорты, которые были адаптированы)
          max: 1 # Максимальное значение (настройка страницы применяется только к статусу, графику, barGauge, pie)
          unit: "%" # Единица
          mappings: # Конфигурация отображения значений (в настоящее время поддерживает только типы значений и диапазонов; специальные типы поддерживаются по данным)
            - options: # Правила отображения значений
                "1": # Соответствующее значение
                  index: 0
                  text: "Работающий" # Отображается как Работающий, когда значение 1
              type: value # Тип отображения значений
            - options: # Правила отображения диапазонов
                from: 2 # Начальное значение диапазона
                to: 3 # Конечное значение диапазона
                result: # Результат отображения
                  index: 1
                  text: "Ошибка" # Значения с 2 по 3 будут отображаться как Ошибка
              type: range # Тип отображения для диапазона
            - type: special # Тип отображения для специальных сценариев
              options:
                match: null # nan null null+nan empty true false
                result:
                  text: xxx
                  index: 2
          thresholds: # Конфигурация порогов
            mode: absolute # Режим конфигурации порога, режим абсолютных значений (в настоящее время поддерживает только абсолютный и процентный режим; процентный режим еще не поддерживается)
            steps: # Шаги порога
              - color: "#a7772f" # Цвет порога
                value: "2" # Значение порога
              - color: "#007AF5" # Значение по умолчанию, когда значение отсутствует, это База
        overrides: # Перекрывающая конфигурация
          - matcher:
              id: byName # Соответствие по имени поля
              options: node # Соответствующее имя
            properties: # Конфигурация переопределения; id в настоящее время поддерживает только displayName unit
              - id: displayName # Переопределение имени отображения
                value: "1" # Переопределенное имя отображения
              - id: unit # Переопределение единицы
                value: GB/s # Значение единицы
              - id: noValue # Образец отсутствия значения
                value: Отсутствие значения
      options:
        orientation: horizontal # Контроль направления макета панелей; применяется к графикам и barGauge (stat будет поддерживаться позже)
        legend: # Конфигурация легенды
          calcs: # Методы вычислений (отображаются только когда позиция легенды справа)
            - latest # На данный момент поддерживается только самое последнее значение
          placement: right # Позиция легенды (справа или снизу; по умолчанию снизу)
          placementRightTop: "" # Конфигурация для верхнего правого
          showLegend: true # Нужно ли отображать легенду
        tooltip: # Подсказки
          mode: multi # Режим двойного выбора (поддерживается только мульти-режим) Все данные отображаются при наведении мыши
          sort: asc # Сортировка: asc или desc
        reduceOptions: # Метод вычисления значений (используется для агрегации данных)
          calcs: # Методы вычислений (последние, минимальные, максимальные, средние, суммы)
            - latest
          limit: 3 # Пирог ограничивает количество секторов
        textMode: 'value' # Конфигурация stat; определяет стиль отображения значения метрики; параметры auto, value, value_and_name, name, none (в настоящее время не поддерживается в настройках страницы, но поддерживается в импортах)
        colorMode: 'value' # Конфигурация stat; определяет цветовую схему для отображения значений метрик; параметры none, value, background (по умолчанию значение; не поддерживается в настройках, но адаптировано в импорте)
        displayLabels: ['name','value', 'percent'] # Поля, отображаемые в ярлыках пирогового графика
        pieType: "pie" # Тип пирогового графика; параметры пирог и пончик
        mode: 'html' # Тип текстового графика; параметры html и richText
        content: '<div>xxx</div>' # Содержимое для текстового графика
        footer:
          enablePagination: true # Включена постраничная навигация таблицы
```

## Общие Функции и Переменные \{#variable}

### Общие Функции

При определении настроек запроса, помимо использования PromQL для настроек запросов, платформа предоставляет некоторые общие функции для вашего справочника.

| Функция                         | Цель                                                                                                                 |
| -------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| **label\_names()**               | Возвращает все метки в Prometheus, например, label\_names().                                                                 |
| **label\_values(label)**         | Возвращает все выбираемые значения для имени метки во всех отслеживаемых метриках в Prometheus, например, label\_values(job).      |
| **label\_values(metric, label)** | Возвращает все выбираемые значения для имени метки в заданной метрике в Prometheus, например, label\_values(up{}, job). |
| **metrics(metric)**              | Возвращает все имена метрик, которые соответствуют заданному образцу regex в поле метрики, например, metrics(cpaas\_active).      |
| **query\_result(query)**         | Возвращает результат запроса для заданного запроса Prometheus, например, query\_result(up{}).                                 |

### Общие Переменные

При определении параметров запроса вы можете комбинировать общие функции в переменные, чтобы быстро определить пользовательские переменные. Вот некоторые общие определения переменных, доступные для вашего справочника:

| Имя Переменной   | Запросная Функция                                                                        | Регулярное Выражение          |
| --------------- | ------------------------------------------------------------------------------------- | ----------------------------- |
| **cluster**     | `label_values(cpaas_cluster_info,cluster)`                                            | -                           |
| **node**        | `label_values(node_load1, instance)`                                                  | `/(.*?):.*/`                |
| **namespace**   | `query_result(kube_namespace_labels)`                                                 | `/.*namespace=\"(.*?)\".*/` |
| **deployment**  | `label_values(kube_deployment_spec_replicas{namespace="$namespace"}, deployment)`     | -                           |
| **daemonset**   | `label_values(kube_daemonset_status_number_ready{namespace="$namespace"}, daemonset)` | -                           |
| **statefulset** | `label_values(kube_statefulset_replicas{namespace="$namespace"}, statefulset)`        | -                           |
| **pod**         | `label_values(kube_pod_info{namespace=~"$namespace"}, pod)`                           | -                           |
| **vmcluster**   | `label_values(up, vmcluster)`                                                         | -                           |
| **daemonset**   | `label_values(kube_daemonset_status_number_ready{namespace="$namespace"}, daemonset)` | -                           |

### Сценарий Использования Переменной Один

Использование функции **query\_result(query)** для запроса значения: `node_load5`, и извлечение IP.

1. В **Настройках Запроса** заполните `query_result(node_load5)`.

2. В области **Предварительный Просмотр Значений Переменных** пример предварительного просмотра - это `node_load5{container="node-exporter",endpoint="metrics",host_ip="192.168.178.182",instance="192.168.178.182:9100"}`.

3. В **Регулярном Выражении** заполните `/.*instance="(.*?):.*/`, чтобы отфильтровать значение.

4. В области **Предварительного Просмотра Значений Переменных** пример предварительного просмотра - это `192.168.176.163`.

### Сценарий Использования Переменной Два

1. Добавьте первую переменную: namespace, используя функцию **query\_result(query)** для запроса значения: `kube_namespace_labels`, и извлечение пространства имен.

   - **Настройки Запроса**: `query_result(kube_namespace_labels)`.

   - **Предварительный Просмотр Значений Переменных**: `kube_namespace_labels{container="exporter-kube-state", endpoint="kube-state-metrics", instance="12.3.188.121:8080", job="kube-state", label_cpaas_io_project="cpaas-system", namespace="cert-manager", pod="kube-prometheus-exporter-kube-state-55bb6bc67f-lpgtx", project="cpaas-system", service="kube-prometheus-exporter-kube-state"}`.

   - **Регулярное Выражение**: `/.+namespace=\"(.*?)\".*/`.

   - В области **Предварительного Просмотра Значений Переменных** пример предварительного просмотра включает несколько пространств имен, таких как `argocd`, `cpaas-system` и другие.

2. Добавьте вторую переменную: deployment, и обратитесь к ранее созданной переменной:

   - **Настройки Запроса**: `kube_deployment_spec_replicas{namespace=~"$namespace"}`.

   - **Регулярное Выражение**: `/.+deployment="(.*?)",.*/`.

3. Добавьте панель к текущему дашборду и обратитесь к ранее добавленным переменным, например:

   - Имя Метрики: **использование памяти пода под вычислительными компонентами**.

   - Ключ-Значение: `kind`: `Deployment`, `name`: `$deployment`, `namespace`: `$namespace`.

4. После добавления панелей и их сохранения вы сможете просмотреть соответствующую информацию о панелях на домашней странице дашборда.

### Примечания При Использовании Встроенных Метрик

:::warning

Следующие метрики используют пользовательские переменные `namespace`, `name`, и `kind`, которые не поддерживают **множественные выборы** или выбор **всех**.

- `namespace` поддерживает только выбор конкретного пространства имен;
- `name` поддерживает только три типа вычислительных компонентов: `deployment`, `daemonset`, `statefulset`;
- `kind` поддерживает только указание одного из типов: `Deployment`, `DaemonSet`, `StatefulSet`.

:::

- `workload.cpu.utilization`

- `workload.memory.utilization`

- `workload.network.receive.bytes.rate`

- `workload.network.transmit.bytes.rate`

- `workload.gpu.utilization`

- `workload.gpu.memory.utilization`

- `workload.vgpu.utilization`

- `workload.vgpu.memory.utilization`
