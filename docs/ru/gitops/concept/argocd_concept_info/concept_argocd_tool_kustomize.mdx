---
weight: 60
i18n:
  title:
    en: Kustomize
    zh: Kustomize 概念
title: Kustomize
sourceSHA: 2ebff81a3d02ba820205710fbcd01f5ae6f4c4d70d82d66b0f2e91aff6c898d7
---

# Kustomize

## Введение

Kustomize — это инструмент управления конфигурациями, родной для Kubernetes, который позволяет пользователям настраивать определения ресурсов Kubernetes (файлы YAML) с помощью наложений и композиции без непосредственного изменения оригинальных файлов.

## Основные понятия Kustomize

- **Base**: Базовые конфигурации, содержащие общие определения ресурсов Kubernetes.
- **Overlay**: Уровни настройки, которые изменяют базовые конфигурации.
- **kustomization.yaml**: Файл конфигурации, определяющий, как ресурсы составляются и модифицируются.

Интеграция Argo CD с Kustomize улучшает практики GitOps, позволяя декларативную непрерывную доставку. Пример:

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kustomize-example
spec:
  project: default
  source:
    path: examples/helloWorld
    repoURL: 'https://github.com/kubernetes-sigs/kustomize'
    targetRevision: HEAD
  destination:
    namespace: default
    server: 'https://kubernetes.default.svc'
```

Если файл `kustomization.yaml` существует по адресу `repoURL` и `path`, Argo CD будет генерировать манифесты с использованием Kustomize.

Kustomize поддерживает следующие параметры конфигурации:

- `namePrefix`: Префикс, добавляемый к именам ресурсов, сгенерированным Kustomize.
- `nameSuffix`: Суффикс, добавляемый к именам ресурсов, сгенерированным Kustomize.
- `images`: Список переопределений образов Kustomize.
- `replicas`: Список переопределений реплик Kustomize.
- `commonLabels`: Отображение меток, добавляемых ко всем ресурсам.
- `labelWithoutSelector`: Логическое значение, определяющее, должны ли общие метки применяться к селекторам ресурсов и шаблонам.
- `forceCommonLabels`: Логическое значение, разрешающее переопределение существующих меток.
- `commonAnnotations`: Отображение аннотаций, добавляемых ко всем ресурсам.
- `namespace`: Пространство имен ресурса Kubernetes.
- `forceCommonAnnotations`: Логическое значение, разрешающее переопределение существующих аннотаций.
- `commonAnnotationsEnvsubst`: Логическое значение, позволяющее подстановку переменных среды в значениях аннотаций.
- `patches`: Список патчей Kustomize, поддерживающих встроенные обновления.
- `components`: Список компонентов Kustomize.

Чтобы использовать Kustomize с наложениями, укажите путь к каталогу наложения.

## Преимущества

- Декларативная конфигурация: Использует файлы YAML (через kustomization.yaml) для определения композиции и модификаций ресурсов.

- Без шаблонов: Настройка конфигураций через патчи и наложения без использования шаблонных движков.

- Интеграция с Kubernetes: Kustomize встроен в kubectl, не требуя дополнительных инструментов.

## Сценарии использования

- Распределение в нескольких окружениях: Достигайте конфигураций, специфичных для окружений (например, приложения, кластеры), с помощью Base и Overlay.

- Повторное использование конфигураций: Идеально подходит для повторного использования базовых конфигураций в разных проектах.

- Прогрессивная доставка: Постепенно регулируйте конфигурации ресурсов с помощью патчей.

# Ссылки

Для более детальной информации, пожалуйста, обратитесь к: [Kustomize](https://argo-cd.readthedocs.io/en/stable/user-guide/kustomize/)
