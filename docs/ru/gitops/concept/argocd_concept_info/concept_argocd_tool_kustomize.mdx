---
weight: 60
i18n:
  title:
    en: Kustomize
    zh: Kustomize 概念
title: Kustomize
sourceSHA: fffcc2c1befd69d7e80ae70d545918ebc8abaed9ad3360a8d9540873618a67cc
---

# Kustomize

## Введение

Kustomize — это инструмент управления конфигурацией, родной для Kubernetes, который позволяет пользователям настраивать определения ресурсов Kubernetes (файлы YAML) через наложения и композицию без прямого изменения оригинальных файлов.

## Основные понятия Kustomize

- **Base**: Основные конфигурации, содержащие общие определения ресурсов Kubernetes.
- **Overlay**: Слои настройки, которые изменяют основные конфигурации.
- **kustomization.yaml**: Файл конфигурации, определяющий, как ресурсы компонуются и модифицируются.

Интеграция Argo CD с Kustomize улучшает практики GitOps, обеспечивая декларативную непрерывную доставку. Пример:

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kustomize-example
spec:
  project: default
  source:
    path: examples/helloWorld
    repoURL: 'https://github.com/kubernetes-sigs/kustomize'
    targetRevision: HEAD
  destination:
    namespace: default
    server: 'https://kubernetes.default.svc'
```

Если файл `kustomization.yaml` существует по адресу `repoURL` и `path`, Argo CD будет генерировать манифесты, используя Kustomize.

Kustomize поддерживает следующие параметры конфигурации:

- `namePrefix`: Префикс, добавляемый к именам ресурсов, сгенерированным Kustomize.
- `nameSuffix`: Суффикс, добавляемый к именам ресурсов, сгенерированным Kustomize.
- `images`: Список переопределений изображений Kustomize.
- `replicas`: Список переопределений реплик Kustomize.
- `commonLabels`: Словарь меток, добавляемых ко всем ресурсам.
- `labelWithoutSelector`: Булевый параметр, определяющий, должны ли общие метки применяться к селектам ресурсов и шаблонам.
- `forceCommonLabels`: Булевый параметр, позволяющий переопределять существующие метки.
- `commonAnnotations`: Словарь аннотаций, добавляемых ко всем ресурсам.
- `namespace`: Пространство имен ресурсов Kubernetes.
- `forceCommonAnnotations`: Булевый параметр, позволяющий переопределять существующие аннотации.
- `commonAnnotationsEnvsubst`: Булевый параметр, позволяющий подстановку переменных окружения в значениях аннотаций.
- `patches`: Список патчей Kustomize, поддерживающих инлайн-обновления.
- `components`: Список компонентов Kustomize.

Чтобы использовать Kustomize с наложениями, укажите путь к директории наложения.

## Преимущества

- Декларативная конфигурация: Использует YAML-файлы (через kustomization.yaml) для определения компоновки и модификации ресурсов.

- Без шаблонов: Настраивает конфигурации через патчи и наложения без движков шаблонов.

- Интеграция, родная для Kubernetes: Kustomize встроен в kubectl, не требуя дополнительных инструментов.

## Примеры использования

- Многофункциональное распределение: Достигайте конфигураций, специфичных для среды (например, приложений, кластеров), через Base и Overlay.

- Переиспользование конфигураций: Идеально подходит для повторного использования базовых конфигураций в разных проектах.

- Прогрессивная доставка: Постепенно настраивайте ресурсные конфигурации через патчи.

# Ссылки

Для получения более подробной информации, пожалуйста, обратитесь к: [Kustomize](https://argo-cd.readthedocs.io/en/stable/user-guide/kustomize/)
