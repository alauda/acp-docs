---
weight: 20
i18n:
  title:
    en: Argo CD Troubleshooting
    zh: Argo CD 故障排查
title: Argo CD Устранение неполадок
sourceSHA: f540c9881cee23d077c230cbd3a03d85ddcbff9726745cb4e4b959fb078806d3
---

# Argo CD Устранение неполадок

## Я удалил/повредил свой репозиторий и не могу удалить свое приложение?

Argo CD не может удалить приложение, если оно не может сгенерировать манифесты. Вам нужно:

1. Восстановить/исправить свой репозиторий.
2. Удалить приложение с помощью `--cascade=false`, а затем вручную удалить ресурсы.

## Почему моё приложение всё еще `OutOfSync` сразу после успешного синхронизирования??

Смотрите [Документацию по сравнению](https://argo-cd.readthedocs.io/en/stable/user-guide/diff-strategies/) для причин, по которым ресурсы могут быть OutOfSync, и способов настройки Argo CD для игнорирования полей, когда ожидаются различия.

## Почему моё приложение застряло в состоянии `Progressing`?

Argo CD предоставляет информацию о состоянии для нескольких стандартных типов Kubernetes. Типы `Ingress`, `StatefulSet` и `SealedSecret` имеют известные проблемы, которые могут вызвать возврат состояния `Progressing` вместо `Healthy`.

- `Ingress` считается здоровым, если список status.loadBalancer.ingress не пустой, с как минимум одним значением для `hostname` или `IP`. Некоторые контроллеры входа (contour, traefik) не обновляют поле `status.loadBalancer.ingress`, что приводит к тому, что `Ingress` застревает в состоянии `Progressing` навсегда.

- `StatefulSet` считается здоровым, если значение поля `status.updatedReplicas` соответствует полю `spec.replicas`. Из-за ошибки Kubernetes [kubernetes#68573](https://github.com/kubernetes/kubernetes/issues/68573) поле status.updatedReplicas не заполняется. Поэтому, если вы не работаете с версией Kubernetes, которая включает исправление [kubernetes#67570](https://github.com/kubernetes/kubernetes/pull/67570), StatefulSet может оставаться в состоянии Progressing.

- Ваш `StatefulSet` или `DaemonSet` использует стратегию `OnDelete` вместо `RollingUpdate`.

- Для `SealedSecret` смотрите [Почему ресурсы типа `SealedSecret` застряли в состоянии `Progressing`?](#sealedsecret)

В качестве обходного пути Argo CD позволяет предоставлять [проверку состояния](https://argo-cd.readthedocs.io/en/stable/operator-manual/health/) для настройки, которая переопределяет поведение по умолчанию.

Если вы используете Traefik для вашего Ingress, вы можете обновить конфигурацию Traefik, чтобы обнародовать IP-адрес loadBalancer, используя [publishedservice](https://doc.traefik.io/traefik/providers/kubernetes-ingress/#publishedservice), что поможет решить эту проблему.

```yaml
providers:
  kubernetesIngress:
    publishedService:
      enabled: true
```

## Как отключить пользователя admin?

Добавьте `admin.enabled: "false"` в ConfigMap `argocd-cm`.

## Argo CD не может развернуть приложения на основе Helm Chart без доступа к Интернету. Как я могу это решить?

Argo CD может не удастся сгенерировать манифесты Helm chart, если у чарт есть зависимости, расположенные во внешних репозиториях. Чтобы решить проблему, вам нужно убедиться, что `requirements.yaml` использует только внутренние доступные репозитории Helm. Даже если чарт использует только зависимости из внутренних репозиториев, Helm может попытаться обновить репозиторий `stable`. Как обходной путь, переопределите URL-адрес репозитория stable в ConfigMap `argocd-cm`:

```yaml
data:
  repositories: |
    - type: helm
      url: http://<internal-helm-repo-host>:8080
      name: stable
```

## После создания моего приложения Helm с Argo CD я не вижу его с помощью helm ls и других команд Helm?

Когда Argo CD развертывает приложение Helm, он использует Helm только как механизм шаблонов. Он выполняет `helm template`, а затем разворачивает результирующие манифесты на кластере, вместо выполнения `helm install`. Это значит, что вы не можете использовать какие-либо команды Helm для просмотра/проверки приложения. Оно полностью управляется Argo CD. Учтите, что Argo CD нативно поддерживает некоторые возможности, которые могут отсутствовать в Helm (например, команды истории и отката).

Это решение было принято для того, чтобы Argo CD был нейтральным ко всем генераторам манифестов.

## Я настроил секрет кластера, но он не отображается в CLI/UI. Как я могу это исправить?

Проверьте, есть ли у секрета кластера метка `argocd.argoproj.io/secret-type: cluster`. Если у секрета есть метка, но кластер всё ещё не виден, это может быть связано с проблемами с правами доступа. Попробуйте перечислить кластеры, используя пользователя `admin` (например: `argocd login --username admin && argocd cluster list`).

Проверьте, есть ли у секрета кластера метка `argocd.argoproj.io/secret-type: cluster`. Если у секрета есть метка, но кластер все равно не виден, убедитесь, что проблема может быть связана с правами доступа. Попробуйте перечислить кластеры, используя пользователя `admin` (например `argocd login --username admin && argocd cluster list`).

## Почему мое приложение не в синхронизации, даже после синхронизации?

В некоторых случаях инструмент, который вы используете, может конфликтовать с Argo CD, добавляя метку `app.kubernetes.io/instance`. Например, при использовании Common Labels в Kustomize.

Argo CD автоматически устанавливает метку `app.kubernetes.io/instance` и использует её для определения, какие ресурсы составляют приложение. Если инструмент делает это тоже, это приводит к путанице. Вы можете изменить эту метку, установив значение application.instanceLabelKey в `argocd-cm`. Мы рекомендуем вам использовать `argocd.argoproj.io/instance`.

:::info
Когда вы внесете это изменение, ваши приложения выйдут из синхронизации и потребуют повторной синхронизации.
:::

## Как часто Argo CD проверяет изменения в моем Git или Helm репозитории?

Интервал опроса по умолчанию составляет 3 минуты (180 секунд) с настраиваемым джиттером. Вы можете изменить настройки, обновив значения `timeout.reconciliation` и `timeout.reconciliation.jitter` в конфигурационной карте `argocd-cm`. Если есть изменения в Git, Argo CD обновит только приложения с включенной настройкой `auto-sync`. Если вы установите значение 0, тогда Argo CD прекратит автоматически опрашивать Git репозитории, и вы сможете использовать только альтернативные методы, такие как `webhooks` и/или `ручные синхронизации` для создания приложений.

## Как я могу исправить ошибку генерации манифестов (кэшированную)?

Ошибка генерации манифестов (кэшированная) означает, что при генерации манифестов произошла ошибка и сообщение об ошибке было кэшировано, чтобы избежать бесконечных повторов.

Сделав жесткое обновление (игнорируя кэшированную ошибку), можно преодолеть временные проблемы. Но если есть постоянная причина, по которой генерация манифестов проваливается, жесткое обновление не поможет.

Вместо этого попробуйте просмотреть логи репо-сервера для имени приложения, чтобы выявить ошибку, которую приводит к сбою при генерации манифестов.
