---
weight: 10
sourceSHA: 8b765eefca618d7cfba8d9544b7e5dcee3eb4cd4350bc5e50ef31bf39377024d
---

# Высокая загрузка ЦП в Kafka

## Управление параллелизмом

Kafka использует пул потоков для управления параллелизмом при обработке сообщений. Правильная настройка размера пула потоков может полностью использовать ресурсы ЦП и избежать перегрузки ЦП.

| Параметр               | Описание                                                                                                                                                     |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **num.network.threads** | Количество потоков для обработки сетевых запросов, значение по умолчанию - 3. Правильная настройка этого параметра может регулировать способность Kafka обрабатывать сетевые запросы. |
| **num.io.threads**      | Количество потоков для обработки дискового ввода-вывода, значение по умолчанию - 8. Правильная настройка этого параметра может регулировать способность Kafka обрабатывать дисковый ввод-вывод.                 |

## Пакетная обработка сообщений

Kafka поддерживает пакетную обработку сообщений, которая объединяет несколько сообщений в пакеты, чтобы уменьшить накладные расходы на сетевой и дисковый ввод-вывод. Пакетирование значительно улучшает производительность Kafka и снижает загрузку ЦП.

| Параметр      | Описание                                                                                                                                               |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **batch.size** | Размер пакета сообщений, установленный на стороне производителя, в байтах, со значением по умолчанию 16384. Правильная настройка этого параметра может улучшить пропускную способность Kafka. |
| **linger.ms**  | Время ожидания сообщений, установленное на стороне производителя, в миллисекундах, со значением по умолчанию 0. Сообщения в это время будут объединены в пакет.        |

## Стратегия извлечения для потребителей

Правильная настройка стратегии извлечения для потребителей может уменьшить нагрузку на ЦП.

| Параметр             | Описание                                                                                                  |
| --------------------- | ------------------------------------------------------------------------------------------------------------ |
| **fetch.min.bytes**   | Минимальное количество данных, требуемое, когда потребитель извлекает данные у брокера, со значением по умолчанию 1. |
| **fetch.max.wait.ms** | Максимальное время ожидания, когда потребитель извлекает данные у брокера, со значением по умолчанию 500.             |

## Отключение сжатия сообщений

Сжатие сообщений может уменьшить занимаемое пространство сообщениями для хранения и сетевой передачи, а также потребление пропускной способности, но оно также увеличивает нагрузку на ЦП. Если ресурсы ЦП ограничены, рассмотрите возможность отключения сжатия сообщений для освобождения дополнительных ресурсов ЦП.

| Параметр            | Описание                                                                              |
| -------------------- | ---------------------------------------------------------------------------------------- |
| **compression.type** | Допустимые значения включают `uncompressed`, `zstd`, `lz4`, `snappy`, `gzip` и `producer`. |

## Избежать частого сборщика мусора

Чтобы обеспечить производительность и стабильность Kafka, необходимо уделить внимание производительности сборщика мусора (GC) JVM. Частый GC может увеличивать нагрузку на ЦП. Поэтому рекомендуется правильно настраивать параметры JVM брокера Kafka для оптимизации стратегии сборки мусора, повышения производительности и снижения частоты работы GC.

```yaml
spec:
   kafka:
     ...
     jvmOptions:
      '-Xms': 512m
      '-Xmx': 512m
     ...
```

## Масштабирование брокера

Чтобы улучшить пропускную способность и доступность кластера, рекомендуется распределять вновь созданные темы между новыми брокерами, чтобы снизить количество подключений к одному брокеру.
