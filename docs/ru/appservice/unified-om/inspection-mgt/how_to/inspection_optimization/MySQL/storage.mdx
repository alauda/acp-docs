---
weight: 30
sourceSHA: 5bcc49e8e8c375b33ba0abaa723581532f18d501ea6e05051c47907603af51f2
---

# Оптимизация пространства хранения MySQL

Пользователи MySQL должны внимательно следить за использованием пространства своих экземпляров, так как это один из ключевых показателей ежедневного мониторинга. Если использование пространства хранения экземпляра достигает своего предела, это может серьезно повлиять на нормальное функционирование экземпляра, приводя к таким проблемам, как сбои записи в базу данных, неполное завершение резервного копирования и увеличенное время выполнения задач по расширению хранилища. Обычно, когда использование пространства хранилища экземпляра MySQL достигает 80-85%, следует своевременно предпринять меры, либо сократив фактическое использование пространства базы данных, либо расширив пространство хранения, чтобы избежать риска достижения предела.

## Рекомендации по оптимизации проблем с пространством хранения

### Избыточные файлы binlog

Включение функции binlog в MySQL позволяет записывать все операции изменения в базе данных, что имеет решающее значение для таких сценариев, как восстановление после аварии и репликация «мастер-ведомый». Однако, если файлы binlog не очищаются своевременно, это может привести к чрезмерному использованию пространства. Чтобы уменьшить неэффективное использование пространства, рекомендуется регулярно создавать резервные копии данных и корректировать срок хранения файлов binlog на основе бизнес-требований. Это обеспечивает безопасность базы данных, минимизируя риск занятости пространства.

### Избыточные индексы

Слишком большое количество индексов может увеличить пропускную способность ввода-вывода во время записи. Чтобы снизить ненужные потери пространства, важно правильно настраивать вторичные индексы.

### Большие поля

Если определение структуры таблицы включает большие поля, такие как BLOB, TEXT или очень длинные VARCHAR, это приведет к большему использованию пространства таблицы. Рекомендуется отключить типы BLOB и TEXT в пользу использования типа JSON или других документоориентированных баз данных для хранения этих данных. При необходимости данные могут быть сжаты перед вставкой.

### Избыточное свободное пространство таблицы (высокая фрагментация таблиц InnoDB)

InnoDB управляет пространством таблицы с помощью страниц (16КБ). Если страница заполнена записями, а затем некоторые записи удаляются с помощью SQL-запроса DELETE, последующие удаления могут привести к фрагментации пространства таблицы, если не вставляются новые записи в позиции удаленных записей. Это заставляет InnoDB выполнять дополнительные операции ввода-вывода для доступа к рассеянным фрагментированным страницам, что негативно сказывается на производительности базы данных.

Чтобы проверить свободное пространство в таблице, вы можете использовать следующий SQL-запрос:

```
show table status like '<table_name>'
```

Если свободного пространства особенно много, вы можете выполнить следующий запрос, чтобы реорганизовать пространство таблицы.

```
optimize table <table_name>
```

### Избыточное временное пространство таблицы

Некоторые операции создают временные таблицы, такие как полусоединения, операции DISTINCT и сортировка без использования индексов. Если вовлечено большое количество данных, это может привести к избыточному временно́му пространству таблицы. Проверяя план выполнения, вы можете определить, включает ли он использование временного хранилища.

Кроме того, когда DDL-операции перестраивают пространство таблицы, если таблица особенно велика, временные файлы, создаваемые при создании индексов, также могут быть довольно большими. Если пространства недостаточно, его следует расширить заранее.
