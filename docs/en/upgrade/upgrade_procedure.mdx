---
weight: 30
---
# Upgrade Procedure

<Steps>
### Backup

Before proceeding with the upgrade, you **must back up etcd on every control plane node** of all clusters (including the primary global cluster, secondary global cluster, and all workload clusters):

```bash
mkdir -p /cpaas/backup_$(date +%Y%m%d%H) && \
cp -r /etc/kubernetes/ /cpaas/backup_$(date +%Y%m%d%H)/ && \
cp -r /var/lib/etcd/ /cpaas/backup_$(date +%Y%m%d%H)/
```

<Directive type="warning" title="WARNING">
This backup command must be executed on **every control plane node** of **all clusters** before the upgrade begins.
</Directive>

If your IaaS provider supports it, we recommend taking **snapshot backups of all nodes**.

For third-party components such as Harbor, Jenkins, GitLab, or Nexus that use external storage, we strongly recommend snapshotting their storage. If snapshots are not possible, at minimum back up their data directories (e.g., for GitLab, SonarQube, etc.) using `cp -r`.

### Trigger the Upgrade

Once preparations are complete, trigger the upgrade with the following command:

```bash
bash upgrade.sh --skip-sync-image
```

<Directive type="tip" title="TIP">
**Ensure** that the [Upload Images](./pre-upgrade.mdx#upload-images) step from *Pre-Upgrade Preparations* has been successfully completed before running this command.
</Directive>

Wait for the script to finish execution before proceeding.

### Upgrade the global cluster

1. Log into the Web Console and switch to **Administrator** view.
2. Go to **Clusters > Clusters** in the left navigation panel.
3. Select the `global` cluster to open its detail view.
4. Navigate to the **Functional Components** tab.
5. Click the **Upgrade** button.

A dialog will appear showing available component updates. Read the information carefully and confirm to proceed.

<Directive type="info" title="INFO">
Kubernetes version upgrade is optional. However, since service disruption may still occur regardless, and to avoid multiple maintenance windows, we recommend upgrading Kubernetes as part of this process.
</Directive>

### Upgrade workload clusters

<Directive type="info" title="INFO">
* If your platform uses the **global disaster recovery (DR)** solution, you **must complete the upgrade of both the primary and secondary global clusters** before proceeding with the upgrade of any workload clusters.For detailed instructions, refer to [**Upgrade for global DR**](./upgrade_dr.mdx).
* PostgreSQL instances will be **automatically restarted** during the upgrade.
* For MySQL-PXC, MySQL-MGR, Redis, Kafka, and RabbitMQ instances configured with **automatic update strategy**, a restart and upgrade will also occur, resulting in temporary service interruptions.
* A maximum of **20 workload clusters** can be upgraded concurrently.
</Directive>

1. Log into the Web Console and switch to **Administrator** view.
2. Go to **Clusters > Clusters**.
3. Select the **target cluster to be upgraded** and open its detail view.
4. Navigate to the **Functional Components** tab.
5. Click the **Upgrade** button.

If your environment contains custom configuration overrides, a prompt will appear requesting confirmation of these settings. Please contact your operations team to confirm they are safe for upgrade.

After confirmation, the component upgrade dialog will appear. Review the information and proceed with the upgrade.

<Directive type="info" title="INFO">
Kubernetes version upgrade is optional. However, since service disruption may still occur regardless, and to avoid multiple maintenance windows, we recommend upgrading Kubernetes as part of this process.
</Directive>

### Upgrade DevOps Toolchain (if installed)

If DevOps tools are installed in your clusters, you can upgrade them **after the cluster upgrade is complete**.

1. In the Web Console, switch to **Administrator** view.
2. Navigate to **DevOps Toolchain** from the left menu.
3. This will open a new **DevOps Web Console**.
4. In the left navigation, go to **DevOps Toolchain > Instances**.
5. Use the breadcrumb to switch between clusters.
6. If any tool instances show an available upgrade, click the **Upgrade** icon under the "Actions" column.

## Upgrade Service Mesh (if installed)

If a service mesh is installed in any cluster, refer to the <ExternalSiteLink name="servicemesh" href="/main/upgrade.html" children="Service Mesh Upgrade Guide" /> for detailed steps.

</Steps>
