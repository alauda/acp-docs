---
weight: 20
---
# Pre-Upgrade Preparation

The upgrade process for <Term name="productShort" /> from **3.x to 4.x** differs significantly from the upgrade process within the **4.x series**. The following sections describe these two upgrade paths separately:

* [Upgrade from 4.x](#upgrade_from_4.x)
* [Upgrade from 3.x](#upgrade_from_3.x)

**Supported upgrade paths:**

* **From `4.0` → `4.1`**
* **From `3.18` → `4.1`**
* **From `3.18` → `4.0`**
* **From `3.16` → `4.0`**

Before starting, ensure your current platform version is within the supported upgrade range.

## Important Notes

Starting from <Term name="productShort" /> **4.0**:

* The **Disaster Recovery (DR) environment** upgrade procedure has changed. See [Global DR Procedure](./upgrade_global_cluster.mdx#global_dr) for details.
* All custom periodic ETCD backup tasks will be deprecated. Before upgrading:

  * Back up and delete all ETCD backup tasks **except** `etcd-backup-default`.
  * Deleting a backup task will not remove any existing ETCD snapshots; only the task itself will be deleted.
  * After the upgrade, you can reconfigure the `etcd-backup-default` task as needed.
* **CostManager** and **Kubecost** are deprecated. If installed, they must be uninstalled before upgrading.

When upgrading the cluster **Kubernetes version to 1.31 or higher**, all running Pods will be **restarted**. This behavior is required due to changes in PodSpec fields introduced in Kubernetes 1.31 and cannot be avoided. For details, see Kubernetes issue [#129385](https://github.com/kubernetes/kubernetes/issues/129385).

The directory `/cpaas/minio` (global cluster control plane) must have at least **120 GB** of available disk space.

## Upgrade from 4.x \{#upgrade_from_4.x}

### Prerequisites

Ensure the following requirements are met for your current version:

<Tabs>
<Tab label="Upgrading from 4.1">
- Kubernetes version of all clusters must be **1.32**. If not, upgrade Kubernetes first.
</Tab>

<Tab label="Upgrading from 4.0">
- Kubernetes version of all clusters must be **1.31**. If not, upgrade Kubernetes first.
</Tab>
</Tabs>

### Run the Checklist

Contact technical support to obtain the **checklist script** and run it against the target platform to verify upgrade readiness.

### Download the Packages

From the **<Term name="company" /> Customer Portal**, download the **<Term name="productShort" /> Core Package**.

If you want to upgrade cluster **Extensions** during the upgrade, follow these steps:
1. Navigate to the following path: [Marketplace - Batch Download - Upgrade - Post-ACP v4.0 Upgrades]
2. Download the `ac-get-app.sh` .
3. Upload the script to the control node of **Global** cluster in your environment.
4. Run the script with `bash ac-get-app.sh`.
5. After it finishes, import the generated `apps.yaml` back into the <Term name="company" /> Customer Portal to align the extensions list.

In addition, navigate to the **CLI Tools** section in the **<Term name="company" /> Customer Portal** and download the `violet` tool. This tool is required for uploading Extensions. For more information about `violet`, see [Upload Packages](../extend/upload_package.mdx).

## Upgrade from 3.x \{#upgrade_from_3.x}

### Prerequisites

Ensure the following requirements are met for your current version:

<Tabs>
<Tab label="Upgrading from 3.18">
- Kubernetes version of all clusters must be **1.30**. If not, upgrade Kubernetes first.
- If Istio is installed, **all clusters with Istio must be upgraded to version 1.22** before proceeding. Note that Istio versions must comply with Kubernetes compatibility requirements; see the Service Mesh upgrade documentation for details. 
- If Elasticsearch log storage is installed, you must apply the solution **"How to Correct the Issue of Node Role Settings in Big Cluster Elasticsearch"** before upgrading. The solution is available in **<Term name="company" /> Customer Portal > Knowledge**.  
</Tab>

<Tab label="Upgrading from 3.16">
- Kubernetes version of all clusters must be **1.28**. If not, upgrade Kubernetes first.
- If Istio is installed, **all clusters with Istio must be upgraded to version 1.20** before proceeding. Note that Istio versions must comply with Kubernetes compatibility requirements; see the Service Mesh upgrade documentation for details. 
- If ClickHouse log storage is installed, it must be uninstalled before the upgrade and reinstalled afterward.  
</Tab>
</Tabs>

### Run the Checklist

Contact technical support to obtain the **checklist script** and run it against the target platform to verify upgrade readiness.

### Download the Packages

From the **<Term name="company" /> Customer Portal**, download the **<Term name="productShort" /> Core Package**.

If you want to upgrade cluster **Extensions** during the upgrade, download the **Extensions Package** as follows:

<Tabs>
<Tab label="From 3.18.x to 4.1.x">
From the **<Term name="company" /> Customer Portal**, click **Extensions** and select the scenario: **`For upgrading ACP from 3.18.x to 4.1.x(Non Service Mesh v1)`**.

If **Service Mesh v1** is installed in your environment, you must also download **`For upgrading Service Mesh v1 from 3.18.x to 4.1.x`**.
</Tab>

<Tab label="From 3.16.x/3.18.x to 4.0.x">
From the **<Term name="company" /> Customer Portal**, click **Extensions** and select the scenario: **`For upgrading ACP from 3.16.x/3.18.x to 4.0.x(Non Service Mesh v1)`**.

If **Service Mesh v1** is installed in your environment, you must also download **`For upgrading Service Mesh v1 from 3.16.x/3.18.x to 4.1.x`**.
</Tab>
</Tabs>

In addition, navigate to the **CLI Tools** section in the **<Term name="company" /> Customer Portal** and download the `violet` tool. This tool is required for uploading Extensions. For more information about `violet`, see [Upload Packages](../extend/upload_package.mdx).

:::note
If the extraction packages and extraction path are located on the same disk, ensure the disk has at least **250 GB** of available space.
:::
