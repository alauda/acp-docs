---
weight: 20
---
# Pre-Upgrade Preparations

## Important Notes Before Upgrade

* Supported platform versions for upgrade: `3.16.0`, `3.16.1`, `3.16.2`, `3.18.0`, `3.18.1`.
  Ensure your current platform version is within this supported range before upgrading.

* The **Kubernetes version** of all clusters in the platform must be **at least 1.28**.
  If any cluster is below this version, upgrade its Kubernetes version first.

* If the platform has a cluster with a **service mesh** provided by the platform, ensure that its **Istio version is 1.20 or higher**. Otherwise, upgrade the service mesh before proceeding.

* Check whether any cluster in the platform has the **CostManager** or **Kubecost** plugins installed. These plugins are **deprecated in version 4.0** and must be uninstalled prior to upgrading.

* If your platform version is `3.16` and any cluster has the **ClickHouse log storage plugin** installed, uninstall it **before the upgrade**. After the upgrade is complete, reinstall the plugin.

* Ensure that the `/cpaas/minio` directory on the **master nodes of the global cluster** has at least **120 GB** of available space.
  If not, expand the storage before proceeding.

* During the upgrade, the upgrade package must be **copied to any master node** in the global cluster and extracted.
  If the upgrade package and extraction path are on the same disk, ensure the disk has **at least 250 GB** of free space.

* When upgrading the cluster's **Kubernetes version to 1.31 or higher**, all running Pods will be **restarted**. This behavior is due to changes in the PodSpec fields introduced in Kubernetes 1.31 and cannot be avoided. For more details, refer to the Kubernetes issue report: [#129385](https://github.com/kubernetes/kubernetes/issues/129385).

* Starting from version **4.0**, the upgrade process for clusters using the **global DR (Disaster Recovery)** solution has changed. Please refer to [Upgrade for global DR](./upgrade_dr.mdx) for the new procedure.

## Preparation Steps

<Steps>

### Run the Checklist

Contact technical support to obtain the **checklist script** and run it against the target platform to verify readiness.

### Download the Upgrade Package

For platforms upgrading from version `3.16` or `3.18` to `4.0`, the **upgrade package is the same as the installation package**.
Refer to [Download Installation Package](../install/prepare/download.mdx) for instructions.

### Upload Images \{#upload_images}

Copy the upgrade package to **any master node** of the global cluster. Extract the package and `cd` into the extracted directory.

* If the image registry used by the global cluster is the **built-in registry**, run:

  ```bash
  bash upgrade.sh --only-sync-image=true
  ```

* If the registry is **externally managed**, run:

  ```bash
  bash upgrade.sh --registry <registry-address> --username <username> --password <password> --only-sync-image=true

  # Example:
  # bash upgrade.sh --registry example.com --username admin --password password --only-sync-image=true
  ```

Uploading images typically takes about 2 hours, depending on network and disk performance.
</Steps>

<Directive type="info" title="INFO">
If your platform uses the **global DR** solution, ensure that the above steps are completed on **both** the primary and secondary global clusters.
</Directive>
