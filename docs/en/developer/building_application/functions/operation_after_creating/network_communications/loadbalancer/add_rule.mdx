---
weight: 30
sourceSHA: b823bbcfd2fc42bb0e119f3d15b1e57812ce98f91143d4679b1e8aa05dee41f9
---

# Add Rules

Add forwarding rules for the listener ports of HTTPS, HTTP, and gRPC protocols. The load balancer will match the backend services based on these rules.

**Note**: Forwarding rules cannot be added for TCP and UDP protocols.

## Steps to Operate

1. Go to **Container Platform**.

2. Click on **Network** > **Load Balancing** in the left navigation bar.

3. Click on the name of the load balancer.

4. Click on the name of the listener port.

5. Click **Add Rule**.

6. Refer to the following descriptions to configure the relevant parameters.

   | Parameter           | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Internal Route Group**    | - When the load balancing algorithm selects **Round Robin (RR)**, the access traffic will be distributed to the ports of the internal routes in the order of the internal route group.<br />- When the load balancing algorithm selects **Weighted Round Robin (WRR)**, the higher the weight value of the internal route, the higher the probability it will be polled, and the access traffic will be distributed to the ports of the internal routes according to the probability calculated based on the configured **weight**.<br />**Tip**: The calculation method for probability is the ratio of the current weight value to the sum of all weight values.                                                                                                                                                                                                                                                                                                                                                                                                                             |
   | **Rule**             | Refers to the criteria for the load balancer to match backend services, including rule indicators and their values. The relationship between different rule indicators is 'and'.<br /><ul><li>Domain Name: Supports adding **wildcard domains** and **exact domain names**. In cases of equal priority for the same rule, if both wildcard and exact domain name rule configurations exist, the exact domain name forwarding rule will take effect first.</li><li>URL: **RegEx** corresponds to URL regular expressions starting with `/`; **StartsWith** corresponds to URL prefixes starting with `/`.</li><li>IP: **Equal** corresponds to a specific IP address; **Range** corresponds to an IP address range.</li><li>Header: In addition to entering the key of the header, matching rules must also be set. **Equal** corresponds to the specific value of the header; **Range** corresponds to the range of the header value; **RegEx** corresponds to the header's regular expression.</li><li>Cookie: In addition to entering the key of the cookie, matching rules must also be set. **Equal** corresponds to the specific value of the cookie.</li><li>URL Param: In matching rules, **Equal** corresponds to a specific URL parameter; **Range** corresponds to the URL parameter range.</li><li>Service Name: The Service Name refers to the name of the service that uses the gRPC protocol. When using the gRPC protocol, this item can be configured, enabling traffic to be forwarded to the corresponding service based on the provided Service Name, for example: `/helloworld.Greeter`.</li></ul> |
   | **Session Persistence**     | Always forwards specific access requests to the backend services corresponding to the aforementioned internal route group.<br />Specific access requests refer to (choose one):<ul><li>Source Address Hash: All access requests originating from the same IP address.</li><li>Cookie Key: Access requests carrying the specified cookie.</li><li>Header Name: Access requests carrying the specified header.</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   | **URL Rewrite**        | Rewrites the accessed address to the address of the platform's backend service. This feature requires the **StartsWith** rule indicator of the URL to be configured, and the rewrite address (rewrite-target) must start with */*. <br /><br />For example: After setting the domain name to *bar.example.com* and the starting path of the URL to `/`, enabling the **URL Rewrite** functionality and setting the rewrite address to */test*. The access to *bar.example.com* will rewrite the URL to *bar.example.com/test*.                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   | **Backend Protocol**     | The protocol used to forward access traffic to the backend service. For example: If forwarding to the backend's Kubernetes or dex service, choose HTTPS protocol.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   | **Redirection**          | Forwards access traffic to a new redirected address rather than the backend services corresponding to the internal route group.<br />For example: When a page at the original access address is upgraded or updated, to avoid users receiving a 404 or 503 error page, the traffic can be redirected to the new address by configuration.<ul><li>HTTP Status Code: The status code presented to the user by the browser before redirecting to the new address.</li><li>Redirect Address: When entering a relative address (for example, */index.html*), the purpose of the forwarded traffic will be *load balancer address/index.html*; when entering an absolute address (for example, *[https://www.example.com](https://www.example.com)*), the purpose of the forwarded traffic will be the entered address.</li></ul>                                                                                                                                                                                                                                                                                    |
   | **Rule Priority**        | The priority of rule matching: there are 10 levels from 1 to 10, with 1 being the highest priority, and the default priority is 5.<br />When two or more rules are satisfied at the same time, the higher priority rule is selected and applied; if the priority is the same, the system uses the default matching rule.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   | **Cross-Origin Resource Sharing (CORS)** | CORS (Cross-origin resource sharing) is a mechanism that utilizes additional HTTP headers to instruct the browser that a web application running on one origin (domain) is permitted to access specified resources from a different origin server. When a resource requests another resource that is from a server with a different domain, protocol, or port than its own, it initiates a cross-origin HTTP request.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   | **Allowed Origins**       | Used to specify the origins that are allowed to access. <ul><li>**\***: Allows requests from any origin.</li><li>**Domain Name**: Allows requests from the current domain.</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   | **Allowed Headers**       | Used to specify the HTTP request headers allowed in CORS (Cross-Origin Resource Sharing) to avoid unnecessary preflight requests and improve request efficiency. Example entries are as follows:<br /><br />**Note**: Other commonly used or custom request headers will not be listed one by one here; please fill in according to actual conditions.<br /><br /><ul><li>**Origin**: Indicates the origin of the request, i.e., the domain that sends the request.</li><li>**Authorization**: Used to specify the authorization information for the request, usually for identification, such as Basic Authentication or Token.</li><li>**Content-Type**: Used to specify the content type of the request/response, such as application/json, application/x-www-form-urlencoded, etc.</li><li>**Accept**: Used to specify the content types that the client can accept, typically used when the client hopes to receive a specific type of response.</li></ul><br />**Supplementary Note on Preflight Requests**: A preflight request is a request that the browser automatically sends to confirm the security and feasibility of the actual request. When the actual request does not meet the criteria for a [simple request](#request), the browser first sends an OPTIONS request to the server to ask whether the actual request is allowed; only after the server confirms the allowance does the browser send the actual request, and this OPTIONS request is the preflight request.                                                                                           |

7. Click **Add**.

## Related Instructions

### Simple Requests \{#request}

If the request meets all the following conditions, it can be considered a simple request:

- Uses one of the following methods:
  - HEAD
  - GET
  - POST

- In addition to the header fields automatically set by the user agent, such as Connection, User-Agent, and the header names defined as disabled in the Fetch specification, the other allowed manually set headers that are CORS-safe include:
  - Accept
  - Accept-Language
  - Content-Language
  - Content-Type (note additional restrictions)
  - Range (only simple range header values are allowed, such as bytes=256- or bytes=127-255)

- The value of Content-Type is limited to one of the following:
  - text/plain
  - multipart/form-data
  - application/x-www-form-urlencoded

- No XMLHttpRequest objects in the request have any event listeners registered.

- The ReadableStream object has not been used in the request.
