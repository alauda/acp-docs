---
weight: 17
---

# Configure GatewayAPI Route \{#configure_gatewayapi_route}

## Prerequisites

Please ensure that you have read the [Installation](../../../networking/operators/envoy_gateway_operator.mdx#install_envoy_gateway_operator) documentation before proceeding.

## Configuration Via Web Console

1. Navigate to `Alauda Container Platform -> Networking -> Routes`
2. Click on `Create Route` button

### Create HTTPRoute

| Field               | Description                                 | YAML Path                          |
| ------------------- | ------------------------------------------- | ---------------------------------- |
| Publish to Listener | [publish to listener](#publish_to_listener) | `.spec.parentRefs`                 |
| Hostnames           | [hostnames](#hostnames)                     | `.spec.hostnames`                  |
| Matches             | [matches](#rule_matches)                    | `.spec.rules[].matches`            |
| Filters             | [filters](#rule_filters)                    | `.spec.rules[].filters`            |
| Backend Instance    | [backend](#rule_backend)                    | `.spec.rules[].backendRefs`        |
| Session Affinity    | [session affinity](#rule_session)           | `.spec.rules[].sessionPersistence` |

### Create TCP/UDP Route

| Field               | Description                                 | YAML Path                   |
| ------------------- | ------------------------------------------- | --------------------------- |
| Publish to Listener | [publish to listener](#publish_to_listener) | `.spec.parentRefs`          |
| Backend Instance    | [backend](#rule_backend)                    | `.spec.rules[].backendRefs` |

## Configuration Via YAML

```yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: demo-443
  namespace: demo
spec:
  hostnames: # [!code callout]
    - example.com
  parentRefs: # [!code callout]
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: demo
      sectionName: https
  rules: # [!code callout]
    - backendRefs: # [!code callout]
        - group: ''
          kind: Service
          name: echo-resty
          namespace: demo-space
          port: 80
          weight: 100
      filters: [] # [!code callout]
      matches: # [!code callout]
        - path:
            type: Exact
            value: /a
      sessionPersistence: # [!code callout]
        type: Cookie
        sessionName: a
---
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: TCPRoute
metadata:
  name: tcp
  namespace: demo-space
spec:
  parentRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: demo
      sectionName: tcp
  rules:
    - backendRefs:
        - group: ''
          kind: Service
          name: echo-resty
          port: 80
          weight: 100
---
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: UDPRoute
metadata:
  name: udp
  namespace: demo
spec:
  parentRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: demo
      namespace: demo
      sectionName: udp
  rules:
    - backendRefs:
        - group: ''
          kind: Service
          name: echo-resty
          namespace: demo
          port: 53
          weight: 100
```

<Callouts>

1. [Hostnames](#hostnames)
2. [Publish to listener](#publish_to_listener)
3. [Rules](#rules)
4. [Backend](#rule_backend)
5. [Filters](#rule_filters)
6. [Matches](#rule_matches)
7. [Session](#rule_session)

</Callouts>

## Introduction

Each route is a CR defined by the `GatewayAPI` specification. For detailed information about the fields and configuration options for each route type, please refer to the official documentation: - [HTTPRoute specification](https://gateway-api.sigs.k8s.io/reference/spec/#httproute) - [TCPRoute specification](https://gateway-api.sigs.k8s.io/reference/spec/#tcproute) - [UDPRoute specification](https://gateway-api.sigs.k8s.io/reference/spec/#udproute) - [GRPCRoute specification](https://gateway-api.sigs.k8s.io/reference/spec/#grpcroute) - [TLSRoute specification](https://gateway-api.sigs.k8s.io/reference/spec/#tlsroute)

### Hostnames \{#hostnames}

The `hostnames` field in a Route is a string array.
It follows the [Hostname Intersection Rules](#intersection_rule).

### Publish to Listener \{#publish_to_listener}

- The `sectionName` is the listener name.
- Routes can only be attached to [listeners that support their specific kind](./configure_gatewayapi_gateway.mdx/#listener_support_kind).
- By default, routes can only be attached to listeners where the `Gateway` is in the same namespace. For cross-namespace attachment, please refer to [attaching to a gateway created in another namespace](../how_to/tasks_for_envoy_gateway.mdx#attach_to_gateway_create_on_other_ns).

### Rules \{#rules}

Each route can contain multiple rules. Each rule consists of the following components:

#### Matches \{#rule_matches}

Defines the conditions that must be met for a request to be routed by this rule.

A rule can have multiple matches:

- Each match consists of multiple conditions (e.g., path, headers, query parameters, method)
- Conditions **within** a match use **AND** logic (all must be satisfied)
- Matches **between** each other use **OR** logic (any match can satisfy the rule)

**Example**: If Match-1 requires `path=/api` AND `header=v1`, and Match-2 requires `query=test`, then a request is routed if it matches either `(path=/api AND header=v1)` OR `(query=test)`.

##### Match Condition Types

| Object         | Method              | Value Types               | Description                                                                                                                                                                                                                                | Value Requirements                                                             |
| -------------- | ------------------- | ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------ |
| **Path**       |                     |                           |                                                                                                                                                                                                                                            |                                                                                |
|                | `Exact`             | path (string)             | Matches the URL path exactly and with case sensitivity. This means that an exact path match on /abc will only match requests to /abc, **NOT** /abc/, /Abc, or /abcd.                                                                       | Must start with `/`, no consecutive `//`.                                      |
|                | `PathPrefix`        | path (string)             | Matches based on a URL path prefix split by /. Matching is case-sensitive and done on **a path element by element basis**. For example, the paths /abc, /abc/, and /abc/def would all match the prefix /abc, but the path /abcd would not. | Must start with `/`, no consecutive `//`.                                      |
|                | `RegularExpression` | path (string)             | Regex Engine: RE2.                                                                                                                                                                                                                         | for example, `/api/v1/.*`.                                                     |
| **Header**     |                     |                           |                                                                                                                                                                                                                                            |                                                                                |
|                | `Exact`             | name (header key) + value | Exact header value match.                                                                                                                                                                                                                  |                                                                                |
|                | `RegularExpression` | name (header key) + value | Regex Engine: RE2.                                                                                                                                                                                                                         |                                                                                |
| **QueryParam** |                     |                           |                                                                                                                                                                                                                                            |                                                                                |
|                | `Exact`             | name (param key) + value  | Exact query parameter value match.                                                                                                                                                                                                         | Parameter value: 1-1024 characters                                             |
|                | `RegularExpression` | name (param key) + value  | Regex Engine: RE2.                                                                                                                                                                                                                         |                                                                                |
| **Method**     | -                   | method name               | HTTP method match.                                                                                                                                                                                                                         | `GET`, `HEAD`, `POST`, `PUT`, `DELETE`, `CONNECT`, `OPTIONS`, `TRACE`, `PATCH` |

##### Match Condition References

| Condition Type | Official Documentation                                                                     |
| -------------- | ------------------------------------------------------------------------------------------ |
| Path           | [HTTPPathMatch](https://gateway-api.sigs.k8s.io/reference/spec/#httppathmatch)             |
| Headers        | [HTTPHeaderMatch](https://gateway-api.sigs.k8s.io/reference/spec/#httpheadermatch)         |
| QueryParams    | [HTTPQueryParamMatch](https://gateway-api.sigs.k8s.io/reference/spec/#httpqueryparammatch) |
| Method         | [HTTPMethod](https://gateway-api.sigs.k8s.io/reference/spec/#httpmethod)                   |

#### Filters \{#rule_filters}

Specifies transformations or modifications to apply to requests/responses.

##### Filter Types

| Type                       | Method               | Value Types                    | Description                                                | Value Requirements                                     |
| -------------------------- | -------------------- | ------------------------------ | ---------------------------------------------------------- | ------------------------------------------------------ |
| **RequestHeaderModifier**  | `Set`                | name (string) + value (string) | Overwrites request header with given name and value        | Max 16 items, value: 1-4096 chars                      |
|                            | `Add`                | name (string) + value (string) | Adds header to request, appending to existing values       | Max 16 items, value: 1-4096 chars                      |
|                            | `Remove`             | []string                       | Removes specified headers from request (case-insensitive)  | Max 16 items                                           |
| **ResponseHeaderModifier** | `Set`                | name (string) + value (string) | Overwrites response header with given name and value       | Max 16 items, value: 1-4096 chars                      |
|                            | `Add`                | name (string) + value (string) | Adds header to response, appending to existing values      | Max 16 items, value: 1-4096 chars                      |
|                            | `Remove`             | []string                       | Removes specified headers from response (case-insensitive) | Max 16 items                                           |
| **RequestRedirect**        | `Scheme`             | string                         | Scheme for Location header (http/https)                    | Optional, enum: `http`\|`https`                        |
|                            | `Hostname`           | PreciseHostname                | Hostname for Location header                               | Optional                                               |
|                            | `ReplaceFullPath`    | string                         | Replace entire request path                                | Optional, max 1024 chars                               |
|                            | `ReplacePrefixMatch` | string                         | Replace matched path prefix                                | Optional, max 1024 chars, only with `PathPrefix` match |
|                            | `Port`               | PortNumber                     | Port for Location header                                   | Optional, range: 1-65535                               |
|                            | `StatusCode`         | int                            | HTTP redirect status code                                  | Optional, default: 302, enum: `301`\|`302`             |
| **URLRewrite**             | `Hostname`           | PreciseHostname                | Hostname to rewrite in request                             | Optional                                               |
|                            | `ReplaceFullPath`    | string                         | Replace entire request path                                | Optional, max 1024 chars                               |
|                            | `ReplacePrefixMatch` | string                         | Replace matched path prefix                                | Optional, max 1024 chars, only with `PathPrefix` match |
| **CORS**                   | `AllowOrigins`       | []string                       | List of allowed origins for CORS requests                  | Optional                                               |
|                            | `AllowMethods`       | []HTTPMethod                   | List of allowed HTTP methods                               | Optional, e.g., GET, POST, PUT                         |
|                            | `AllowHeaders`       | []string                       | List of allowed headers in CORS requests                   | Optional                                               |
|                            | `ExposeHeaders`      | []string                       | List of headers exposed to client in response              | Optional                                               |
|                            | `MaxAge`             | Duration                       | Cache duration for CORS preflight response                 | Optional                                               |
|                            | `AllowCredentials`   | bool                           | Whether credentials are allowed in CORS requests           | Optional                                               |

**Notes**:

- `RequestRedirect` and `URLRewrite` cannot be used together on the same rule
- `ReplacePrefixMatch` is only compatible with a `PathPrefix` HTTPRouteMatch
- Header names are case-insensitive per RFC 7230
- Multiple values for same header must use RFC 7230 comma-separated format

##### Filter References

| Filter Type            | Official Documentation                                                                                 |
| ---------------------- | ------------------------------------------------------------------------------------------------------ |
| RequestHeaderModifier  | [HTTPHeaderFilter](https://gateway-api.sigs.k8s.io/reference/spec/#httpheaderfilter)                   |
| ResponseHeaderModifier | [HTTPHeaderFilter](https://gateway-api.sigs.k8s.io/reference/spec/#httpheaderfilter)                   |
| RequestRedirect        | [HTTPRequestRedirectFilter](https://gateway-api.sigs.k8s.io/reference/spec/#httprequestredirectfilter) |
| URLRewrite             | [HTTPURLRewriteFilter](https://gateway-api.sigs.k8s.io/reference/spec/#httpurlrewritefilter)           |
| CORS                   | [HTTPCORSFilter](https://gateway-api.sigs.k8s.io/reference/spec/#httpcorsfilter)                       |
| RequestMirror          | [HTTPRequestMirrorFilter](https://gateway-api.sigs.k8s.io/reference/spec/#httprequestmirrorfilter)     |
| HTTPExternalAuthFilter | [HTTPExternalAuthFilter](https://gateway-api.sigs.k8s.io/reference/spec/#httpexternalauthfilter)       |

#### Backend \{#rule_backend}

Defines the target service(s) where matching requests should be forwarded.

Each service can have a `weight` field to specify the proportion of traffic to be routed to that service.

#### Advanced HTTPRoute Rule Settings

HTTPRoute rules support additional configuration fields, such as retry policies, timeouts, and other traffic management parameters.

##### Timeouts \{#rule_timeout}

| Field                    | Specification                                                                          |
| ------------------------ | -------------------------------------------------------------------------------------- |
| `.spec.rules[].timeouts` | [HTTPRouteTimeouts](https://gateway-api.sigs.k8s.io/reference/spec/#httproutetimeouts) |

##### Retry \{#rule_retry}

| Field                 | Specification                                                                    |
| --------------------- | -------------------------------------------------------------------------------- |
| `.spec.rules[].retry` | [HTTPRouteRetry](https://gateway-api.sigs.k8s.io/reference/spec/#httprouteretry) |

##### Session Persistence \{#rule_session}

Configures session affinity settings to ensure requests from the same client are routed to the same backend.

| Field                              | Specification                                                                            |
| ---------------------------------- | ---------------------------------------------------------------------------------------- |
| `.spec.rules[].sessionPersistence` | [SessionPersistence](https://gateway-api.sigs.k8s.io/reference/spec/#sessionpersistence) |

## Next Step

[Tasks for Envoy Gateway](../how_to/tasks_for_envoy_gateway.mdx)

## Related Tasks

- [How to attach to listener created in other namespace](../how_to/tasks_for_envoy_gateway.mdx#attach_to_gateway_create_on_other_ns)
