# Configure GatewayAPI Policy \{#configure_gatewayapi_policy}

Policies are Kubernetes Custom Resources that extend Gateway and Route resources with advanced capabilities. They use the **Policy Attachment** pattern via `.spec.targetRefs` to attach to Gateway API resources (Gateway, HTTPRoute, GRPCRoute), enabling flexible configuration and policy inheritance.

Envoy Gateway currently provides three policy types:

| Policy Name | Purpose | Can Attach To | Web Console Support |
|-------------|---------|---------------|---------------------|
| [SecurityPolicy](https://gateway.envoyproxy.io/v1.5/api/extension_types/#securitypolicy) | Authentication, authorization, and security features including API Key auth, JWT auth, OIDC auth, CORS configuration, and Basic auth | Gateway, HTTPRoute, GRPCRoute | API Key Auth only |
| [BackendTrafficPolicy](https://gateway.envoyproxy.io/v1.5/api/extension_types/#backendtrafficpolicy) | Backend traffic configuration including load balancing strategies, circuit breaking, health checks, retry policies, and timeout settings | Gateway, HTTPRoute, GRPCRoute | Not supported |
| [ClientTrafficPolicy](https://gateway.envoyproxy.io/v1.5/api/extension_types/#clienttrafficpolicy) | Client-facing traffic configuration including rate limiting, connection limits, TCP keepalive, HTTP/2 settings, and client IP detection | Gateway | Not supported |

Only SecurityPolicy is supported through the Web console.

## Prerequisites

Please ensure that you have:

1. [Installed Envoy Gateway Operator](../../../networking/operators/envoy_gateway_operator.mdx)
2. [Created a Gateway](./configure_gatewayapi_gateway.mdx)
3. [Created a Route](./configure_gatewayapi_route.mdx)

## SecurityPolicy
###  Configuration Via Web Console

1. Navigate to `Alauda Container Platform -> Networking -> Gateway -> Policies`
2. Select `SecurityPolicy` in the `Policy Type` dropdown
3. Click the `Create Policy` button

**Common Fields (shared for all policies)**:

| Field                 | Description                       | YAML Path                      |
| --------------------- | --------------------------------- | ------------------------------ |
| Policy Type           | The type of policy to create |`.kind`|
| Publish To            | The Gateway API resources this policy applies to (only for HTTPRoute now) | `.spec.targetRefs` |

**SecurityPolicy Specific Fields**:

| Field                 | Description                       | YAML Path                      |
| --------------------- | --------------------------------- | ------------------------------ |
| Authorization Type    | The authentication method to use (currently supports API Key Authentication) | `.spec.apiKeyAuth` |
| Secrets               | Kubernetes secrets containing the API keys for authentication | `.spec.apiKeyAuth.credentialRefs` |
| Extract From          | Specifies where to extract the API key from (HTTP headers or query parameters) | `.spec.apiKeyAuth.extractFrom` |


### Configuration Via YAML

```yaml
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: SecurityPolicy
metadata:
  name: demo-security-policy
  namespace: demo
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: demo
  apiKeyAuth:
    credentialRefs:
      - group: ""
        kind: Secret
        name: demo
        namespace: demo
    extractFrom:
      - headers:
          - authorization
```

### Introduction

SecurityPolicy is used to configure authentication, authorization, and other security-related features for your Gateway and Routes. It provides a declarative way to protect your services by validating incoming requests before they reach your backend applications.
#### Features
- **Authentication**: Verify the identity of clients using various methods (API Key, JWT, OIDC, Basic Auth)
- **Authorization**: Control access to resources based on validated credentials
- **CORS Configuration**: Manage Cross-Origin Resource Sharing policies

#### How It Works:

1. Create a SecurityPolicy with your desired authentication/authorization rules
2. Attach it to a specific HTTPRoute/GRPCRoute
3. Envoy Gateway validates incoming requests according to the policy
4. Valid requests are forwarded to backend services; invalid requests are rejected with appropriate HTTP status codes

#### Notes
1. The web console currently supports configuring **API Key Authentication** only. For other authentication methods and advanced security features, you need to use YAML configuration.
2. Each Route can only be associated with one SecurityPolicy.
3. If a SecurityPolicy references a secret with no values, all requests to the attached route will be rejected with `401 Unauthorized`.
4. In the web console, by default, the `Extract From` field is set to `header` and the `Header Name` field is set to `authorization`.
5. You can view which policies are attached to a route by navigating to the [Route's topology tab](./configure_gatewayapi_route.mdx#topology) in the web console.

#### Official Documentation:
- [SecurityPolicy specification](https://gateway.envoyproxy.io/v1.5/api/extension_types/#securitypolicy)
- [API Key Authentication](https://gateway.envoyproxy.io/v1.5/api/extension_types/#apikeyauth)

## Related Tasks
- [Configure GatewayAPI Gateway](./configure_gatewayapi_gateway.mdx)
- [Configure GatewayAPI Route](./configure_gatewayapi_route.mdx)
- [Tasks for Envoy Gateway](../how_to/tasks_for_envoy_gateway.mdx)