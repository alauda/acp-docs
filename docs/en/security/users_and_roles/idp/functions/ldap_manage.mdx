---
weight: 10
---

:::tip

Supports Platform Manager to add LDAP to the platform, and at the same time, supports Platform Manager to update and delete the docked LDAP services.

:::

# LDAP Management

## Overview of LDAP

LDAP (Lightweight Directory Access Protocol) is a mature, flexible, and well-supported standard mechanism for interacting with directory servers. LDAP organizes data in a hierarchical tree structure to store enterprise user and organization information. It is primarily used for implementing single sign-on, allowing users to log in successfully on a company's computer once and gain trust in other internal systems.

At the same time, LDAP allows clients to perform various operations in the LDAP server, including storing and retrieving data, searching for data matching a given set of criteria, and authenticating clients. This facilitates integration with other clients for user authentication via LDAP. For more information, please refer to the [LDAP official documentation](https://ldap.com/?spm=a2c4g.11186623.2.12.38e87d4cjSb0uh).

The platform supports integration with two LDAP types: **OpenLDAP** and **Active Directory**.

* **OpenLDAP**: OpenLDAP is an open-source implementation of LDAP. If your organization uses open-source LDAP for user authentication, you can configure the platform to communicate with the LDAP service by adding LDAP to the platform and configuring relevant parameters. This allows the platform to authenticate LDAP users when they log in to the platform. For more information about OpenLDAP, please refer to the [OpenLDAP official documentation](https://www.openldap.org/doc).



* **Active Directory**: Active Directory is software developed by Microsoft based on the LDAP protocol, used to provide directory storage services for Windows systems. If your organization stores user information using Microsoft Active Directory, you can configure the platform to communicate with the Active Directory service by adding LDAP and configuring relevant parameters. This enables the platform to authenticate Active Directory users when they log in to the platform.



Refer to the table below for key LDAP terminology.

OpenLDAP Common terms

| Term | Description | Example |
| :-- | :-- | :-- |
| **dc (Domain Component)** | Domain component | `dc=example,dc=com` |
| **ou (Organizational Unit)** | Organizational unit | `ou=People,dc=example,dc=com` |
| **cn (Common Name)** | Common name | `cn=admin,dc=example,dc=com` |
| **uid (User ID)** | User ID | `uid=example` |
| **objectClass (Object Class)** | Object class | `objectClass=inetOrgPerson` |
| **mail (Mail)** | Mail | `mail=example@126.com` |
| **givenName (Given Name)** | Given name | `givenName=xq` |
| **sn (Surname)** | Surname | `sn=ren` |
| **objectClass: groupOfNames** | User group | `objectClass: groupOfNames` |
| **member (Member)** | Group member attribute | `member=cn=admin,dc=example,dc=com` |
| **memberOf** | User group membership attribute | `memberOf=cn=users,dc=example,dc=com` |


Active Directory Common Terms

| Term | Description | Example |
| :-- | :-- | :-- |
| **dc (Domain Component)** | Domain component | `dc=example,dc=com` |
| **ou (Organizational Unit)** | Organizational unit | `ou=People,dc=example,dc=com` |
| **cn (Common Name)** | Common name | `cn=admin,dc=example,dc=com` |
| **sAMAccountName or userPrincipalName** | User identifier | `userPrincipalName=example` or `sAMAccountName=example` |
| **objectClass: user** | AD user object class | `objectClass=user` |
| **mail (Mail)** | Mail | `mail=example@126.com` |
| **displayName** | Display name | `displayName=example` |
| **givenName (Given Name)** | Given name | `givenName=xq` |
| **sn (Surname)** | Surname | `sn=ren` |
| **objectClass: group** | User group | `objectClass: group` |
| **member (Member)** | Group member attribute | `member=CN=Admin,DC=example,DC=com` |
| **memberOf** | User group membership attribute | `memberOf=CN=Users,DC=example,DC=com` |



## Add LDAP

When your organization manages users (accounts) through **OpenLDAP** or **Active Directory**, you can integrate your enterprise's LDAP service with the platform by adding LDAP on the platform. This allows the platform to communicate with the LDAP server, enabling enterprise users to log in to the platform and verifying their identity when logging in.

**Tips**:

- After successful addition, users synchronized from LDAP to the platform can use their enterprise accounts to log in to the platform.

- If the same LDAP is added multiple times, the LDAP synchronization will overwrite previously synchronized users.

**Prerequisites**

Before adding LDAP, prepare the access information for your LDAP server, including the server address, username, password, and so on.

### Procedure of operation

1. In the left navigation bar, click **Users** > **IDPs**.

3. Click **Add LDAP**.

4. Configure the **Basic Information** and **LDAP Server Settings** parameters following the instructions below.

    | Parameter Name | Description |
    | -------------- | ----------- |
    | **Server Address** | The access address of the LDAP server, e.g., `192.168.156.141:31758`. |
    | **Username** | The DN (Distinguished Name), a unique identifier, of the LDAP administrator account. This username corresponds to a user with binding, searching, and retrieving LDAP entry permissions, e.g., `cn=admin,dc=example,dc=com`. |
    | **Password** | The login password of the LDAP administrator's account. |
    | **Login Box Username Prompt** | The prompt message displayed in the **Username** input box on the platform login page, e.g., `Please enter your username`. |

6. Choose the **LDAP Type** and configure the **Search Settings** parameters following the instructions below.

    **Instructions**:

    * When integrating with LDAP, the platform will match LDAP user entries (Entries) based on the conditions and entry attributes specified in **Search Settings** to determine which users are granted access to the platform. Key attributes of users and groups will be extracted from LDAP, matched one-to-one with common attributes of platform users, making it convenient for Platform Management personnel to view, search for users, or grant user access.

    * Group search settings are used to match group attributes for users already matched by search settings. For example, if the matched users based on search settings include User1, User2, and User3, and the matched groups are G1 and G2, where User1 and User2 belong to G1, and User3 belongs to G3, then when User1, User2, and User3 are synchronized to the platform, User1 and User2 belong to the G1 user group, and User3 is not assigned to a group.

    | Parameter Name | Description |
    | -------------- | ----------- |
    | **Object Type** | Also known as **ObjectClass**, enter the ObjectClass used when creating your users. For users:- OpenLDAP default is `inetOrgPerson`.- Active Directory default is `organizationalPerson`. For groups, the default is `posixGroup`. |
    | **Login Field** | The attribute in the entry that will be used as the **Username** when users log in to the platform.- For OpenLDAP, the default is `mail`, requiring users to log in using their email address (e.g., `test@example.com`).- For Active Directory, the default is `userPrincipalName`, requiring users to log in using their user principal name (e.g., `example@azureyun.com`). |
    | **Filter Conditions** | Used for further filtering users or groups with [LDAP filter conditions](https://ldap.com/ldap-filters/).For example:(&(cn=John\*)(givenName=\*xq\*)) will match entries that include cn and givenName attributes, with cn starting with John and givenName containing the xq character.(\|(givenName=John)(givenName=Jon)(givenName=Johnathan)(givenName=Jonathan)) will match all entries that contain one or more givenName values from this filter condition. |
    | **Search Starting Point** | The starting point for searching users or user groups.LDAP data is structured as a tree structure, and setting a search starting point restricts the search to data below that starting point.If matched user groups include users who have already been matched, information about their associated user groups is synchronized to the platform.For example, `dc=example,dc=org`. |
    | **Search Scope** | The scope for searching users or user groups after the search starting point. Optional values are `sub` (search the entire directory subtree) and `one` (search only one level below the starting point), with the default being `sub`. |
    | **Login Attribute** | The attribute in the entry used to uniquely identify users.- For OpenLDAP, the default is `uid`.- For Active Directory, the default is `distinguishedName`. |
    | **Name Attribute** | The attribute in the entry used to specify the object's name. The default is `cn`. |
    | **Email Attribute** | The attribute in the entry used to specify the object's email. For OpenLDAP, the default is `mail`. For Active Directory, the default is `userPrincipalName`. |
    | **Group Member Attribute** | The attribute in the entry used to uniquely identify group members. The default is `uid`. |
    | **Group Attribute** | The attribute in the entry used to specify the relationship between user groups and group members. The default is `memberuid`. |
1. In the **IDP Service Configuration Validation** section, enter a **Username** and **Password** for an LDAP account that can be matched by the search settings above to verify that the configuration is correct.

    **Tips**:

    * The entered account must exist in LDAP and have a username and password that can be matched by the **Search Settings**.

    * The **Username** must be the value of the attribute set as the `Login Field` in the **Search Settings**. For example, if the **Login Field** is set to `mail`, you need to enter the user's email address (e.g., `mail1@example.com`).

3. (Optional) Click **Advanced Settings** and follow the instructions below to configure the **LDAP Auto-Sync Policy**.

    **Tips**: After configuring an automatic synchronization policy for LDAP, the platform will automatically trigger synchronization operations at fixed times based on the synchronization rules. This will synchronize LDAP users matched by the search settings to the platform. Once user synchronization is successful, you can view the synchronized users in the user list. If you haven't configured an automatic synchronization policy, you will need to manually synchronize users by performing the manual synchronization operation.

    1. (Required for the initial configuration) Slide the **Auto-Sync Users** slider switch to enable automatic synchronization.

synchronization rule.

        **Tips**: After setting up the automatic synchronization policy, user synchronization will not occur immediately but will be automatically triggered at fixed times based on the rule's time interval. You can use an [online tool](https://tool.lu/crontab/) to input a CRON expression and check the next 7 automatic synchronization times.

2. Click **Add**.

    **Tips**: After successfully adding LDAP, users matched by the search settings can use their LDAP accounts to log in to the platform before LDAP users are synchronized to the platform. Once a user successfully logs in to the platform, their information will be automatically synchronized to the platform.

### Configure LDAP Connector

The following example shows how to configure an LDAP connector.

```yaml
apiVersion: dex.coreos.com/v1
kind: Connector
id: ldap        # Connector ID
name: ldap      # Connector display name
type: ldap      # Connector type is LDAP
metadata:
  name: ldap
  namespace: cpaas-system
spec:
  config:
    # LDAP server address and port
    host: ldap.example.com:636                         
    # DN and password for the service account used by the connector.
    # This DN is used to search for users and groups.
    bindDN: uid=serviceaccount,cn=users,dc=example,dc=com 
    # Service account password, required when creating a connector.
    bindPW: password                         

    # Login account prompt. For example, username
    usernamePrompt: SSO Username
    
    # User search configuration
    userSearch:
      # Start searching from the base DN
      baseDN: cn=users,dc=example,dc=com
      # LDAP query statement, used to search for users.
      # For example: "(&(objectClass=person)(uid=<username>))"
      filter: (&(objectClass=organizationalPerson))

      # The following fields are direct mappings of user entry attributes.
      # User ID attribute
      idAttr: uid
      # Required. Attribute to map to email                     
      emailAttr: mail
      # Required. Attribute to map to username
      nameAttr: cn
      # Login username attribute
      # Filter condition will be converted to "(<attr>=<username>)", such as (uid=example).
      username: uid

      # Extended attributes
      # phoneAttr: phone

    # Group search configuration  
    groupSearch:
      # Start searching from the base DN
      baseDN: cn=groups,dc=freeipa,dc=example,dc=com
      # Group filter condition
      # "(&(objectClass=group)(member=<user uid>))".
      filter: "(objectClass=group)"
      # User group matching field
      # Group attribute
      groupAttr: member
      # User group member attribute
      userAttr: uid
      # 组显示名称
      nameAttr: cn
```

### User Filter Examples

```yaml
    # 1. Basic filter: Find all users
    (&(objectClass=person))

    # 2. Multiple conditions combination: Find users in a specific department
    (&(objectClass=person)(departmentNumber=1000))

    # 3. Find enabled users (Active Directory)
    (&(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))

    # 4. Find users with a specific email domain
    (&(objectClass=person)(mail=*@example.com))

    # 5. Find members of specific group
    (&(objectClass=person)(memberOf=cn=developers,ou=groups,dc=example,dc=com))

    # 6. Find recently logged in users (Active Directory)
    (&(objectClass=user)(lastLogon>=20240101000000.0Z))

    # 7. Exclude system accounts
    (&(objectClass=person)(!(uid=admin))(!(uid=system)))

    # 8. Find users with a specific attribute
    (&(objectClass=person)(mobile=*))

    # 9. Find users in multiple departments
    (&(objectClass=person)(|(ou=IT)(ou=HR)(ou=Finance)))

    # 10. Complex condition combination example
    (&
      (objectClass=person)
      (|(department=IT)(department=Engineering))
      (!(title=Intern))
      (manager=cn=John Doe,ou=People,dc=example,dc=com)
    )
```



### Group Search Configuration
```yaml
    # 1. Basic filter: Find all groups

    # 2. Find groups with a specific prefix
    (&(objectClass=groupOfNames)(cn=dev-*))

    # 3. Find non-empty groups
    (&(objectClass=groupOfNames)(member=*))

    # 4. Find groups with a specific member
    (&(objectClass=groupOfNames)(member=uid=john,ou=People,dc=example,dc=com))

    # 5. Find nested groups (Active Directory)
    (&(objectClass=group)(|(groupType=-2147483646)(groupType=-2147483644)))

    # 6. Find groups with a specific description
    (&(objectClass=groupOfNames)(description=*admin*))

    # 7. Exclude system groups
    (&(objectClass=groupOfNames)(!(cn=system*)))

    # 8. Find groups with specific members
    (&(objectClass=groupOfNames)(|(cn=admins)(cn=developers)(cn=operators)))

    # 9. Find groups in a specific OU
    (&(objectClass=groupOfNames)(ou=IT))

    # 10. Complex condition combination example
    (&
      (objectClass=groupOfNames)
      (|(cn=prod-*)(cn=dev-*))
      (!(cn=deprecated-*))
      (owner=cn=admin,dc=example,dc=com)
    )
```

### Examples of AND(&) and OR(|) Operators in LDAP Filters
```yaml
    # AND operator (&) - All conditions must be met
    # Syntax: (&(condition1)(condition2)(condition3)...)

    # Multiple attribute AND example
    (&
      (objectClass=person)
      (mail=*@example.com)
      (title=Engineer)
      (manager=*)
    )

    # OR operator (|) - At least one condition must be met
    # Syntax: (|(condition1)(condition2)(condition3)...)

    # Multiple attribute OR example
    (|
      (department=IT)
      (department=HR)
      (department=Finance)
    )

    # Combining AND and OR
    (&
      (objectClass=person)
      (|
        (department=IT)
        (department=R&D)
      )
      (employeeType=FullTime)
    )

    # Complex condition combination
    (&
      (objectClass=person)
      (|
        (&
          (department=IT)
          (title=*Engineer*)
        )
        (&
          (department=R&D)
          (title=*Developer*)
        )
      )
      (!(status=Inactive))
      (|(manager=*)(isManager=TRUE))
    )
```

## Synchronize LDAP Users

After successfully synchronizing LDAP users to the platform, you can view the synchronized users in the user list.

You can configure an automatic synchronization policy when [adding LDAP](#addldap) (which can be updated later) or manually trigger synchronization after adding LDAP successfully. Here's how to manually trigger a synchronization operation.

**Notes**:

* Newly added users in the LDAP integrated with the platform can log in to the platform before performing the user synchronization operation. Once they successfully log in to the platform, their information will be automatically synchronized to the platform.

* Users deleted from LDAP will have an `Invalid` status after synchronization.

* The default validity period for newly synchronized users is **Permanent**.

* Synchronized users with the same name as existing users (local users, IDP users) are automatically associated. Their permissions and validity period will be consistent with existing users. They can log in to the platform using the login method corresponding to their respective sources.

### Procedure of Operation

1. In the left navigation bar, click **Users** > **IDPs**.

3. Click the ***LDAP name*** that you want to manually synchronize.

4. Click **Actions** > **Sync user** in the upper-right corner.

5. Click **Sync**.

    **Notes**: If you manually close the synchronization prompt dialog, a confirmation dialog will appear to confirm the closure. After closing the synchronization prompt dialog, the system will continue to synchronize users. If you remain on the user list page, you will receive synchronization result feedback. If you leave the user list page, you will not receive synchronization results.

## Relevant Operations

You can click the ![](/en/img/113point.png) on the right in the list page or click **Actions** in the upper-right corner on the details page to update or delete LDAP as needed.

| Operation | Description |
| --------------------- | ------------------------------------------------------------ |
| **Update LDAP** | Update the configuration information of the added LDAP or the **LDAP Auto-Sync Policy**.**Note**: After updating LDAP, users currently synchronized to the platform through this LDAP will also be updated. Users removed from LDAP will become invalid in the platform user list. You can clean up junk data by executing the operation to clean up invalid users. |
| **Delete LDAP** | After deleting LDAP, all users synchronized to the platform through this LDAP will have an **Invalid** status (the binding relationship between users and roles remains unchanged), and they cannot log in to the platform. After re-integrating, synchronization needs to be re-executed to activate users. **Tips**: After deleting IDP, if you need to delete users and user groups synchronized to the platform through LDAP, check the checkbox **Clean IDP Users and User Groups** below the prompt box. |

