---
weight: 12
sourceSHA: 1487e6d2072dc62905b42395e09fea9ddf0b398b5bd41e25c23cf20d178520f6
---

# Install

## Overview

The monitoring component serves as the infrastructure for monitoring, alerting, inspection, and health checking functions within the observability module. This document describes how to install the ACP Monitoring with Prometheus plugin or the ACP Monitoring with VictoriaMetrics plugin within a cluster.

## Installation Preparation

:::info
Some components of the Monitoring are resource-intensive. We recommend running them on infra nodes and setting nodeSelector and tolerations to ensure they run only on those nodes. If you are evaluating the product and have not provisioned infra nodes, you can remove these settings so the components run on all nodes.

For guidance on planning infra nodes, see [Cluster Node Planning](../../configure/clusters/acp-node-planning.mdx).
:::

Before install the monitoring components, please ensure the following conditions are met:

- The appropriate monitoring component has been selected by referring to the [Monitoring Component Selection Guide](./architecture/component_selection_suggestion.mdx).
- When install in a workload cluster, ensure that the `global` cluster can access port 11780 of the workload cluster.
- If you need to use storage classes or persistent volume storage for monitoring data, please create the corresponding resources in the **Storage** section in advance.

## Install the ACP Monitoring with Prometheus Plugin via console

### Installation Procedures

1. Navigate to **App Store Management** > **Cluster Plugins** and select the target cluster.

2. Locate the **ACP Monitoring with Prometheus** plugin and click **Install**.

3. Configure the following parameters:

   | Parameter       | Description                                                                                                                |
   | --------------- | -------------------------------------------------------------------------------------------------------------------------- |
   | **Scale Configuration** | Supports three configurations: **Small Scale**, **Medium Scale**, and **Large Scale**:<br />- Default values are set based on the recommended load test values of the platform<br />- You can choose or customize quotas based on the actual cluster scale<br />- Default values will be updated with platform versions; for fixed configurations, custom settings are recommended   |
   | **Storage Type**       | - **LocalVolume**: Local storage with data stored on specified nodes<br />- **StorageClass**: Automatically generates persistent volumes using a storage class<br />- **PV**: Utilizes existing persistent volumes<br />**Note**: Storage configuration cannot be modified after Installation |
   | **Replica Count**      | Sets the number of monitoring component pods<br />**Note**: Prometheus supports only single-node installation                                            |
   | **Parameter Configuration** | Data parameters for the monitoring component can be adjusted as needed                                                                                     |

4. Click **Install** to complete the installation.

### Access Method

Once installation is complete, the components can be accessed at the following addresses (replace `<>` with actual values):

| Component           | Access Address                                   |
| ------------------ | ----------------------------------------------- |
| **Thanos**         | `<platform_access_address>/clusters/<cluster>/prometheus`   |
| **Prometheus**     | `<platform_access_address>/clusters/<cluster>/prometheus-0` |
| **Alertmanager**   | `<platform_access_address>/clusters/<cluster>/alertmanager` |

## Install the ACP Monitoring with Prometheus Plugin via YAML

### 1. Check available versions

Ensure the plugin has been published by checking for ModulePlugin and ModuleConfig resources, in the `global`cluster:

```shell

# kubectl get moduleplugin | grep prometheus
prometheus                       30h
# kubectl get moduleconfig | grep prometheus
prometheus-v4.1.0                30h

```

This indicates that the ModulePlugin `prometheus` exists in the cluster and version `v4.1.0` is published.

### 2. Create a ModuleInfo

Create a ModuleInfo resource to install the plugin without any configuration parameters:

```yaml
kind: ModuleInfo
apiVersion: cluster.alauda.io/v1alpha1
metadata:
  name: global-prometheus
  labels:
    cpaas.io/cluster-name: global
    cpaas.io/module-name: prometheus
    cpaas.io/module-type: plugin
spec:
  version: v4.1.0
  config:
    storage:
      type: LocalVolume
      capacity: 40
      nodes:
        - xxx.xxx.xxx.xx
      path: /cpaas/monitoring
      storageClass: ""
      pvSelectorK: ""
      pvSelectorV: ""
    replicas: 1
    components:
      prometheus:
        retention: 7
        scrapeInterval: 60
        scrapeTimeout: 45
        resources: null
      nodeExporter:
        port: 9100
        resources: null
      alertmanager:
        resources: null
      kubeStateExporter:
        resources: null
      prometheusAdapter:
        resources: null
      thanosQuery:
        resources: null
    size: Small
  valuesOverride:
    ait/chart-kube-prometheus:
      global:
        nodeSelector:
          node-role.kubernetes.io/infra: "true"
        tolerations:
        - effect: NoSchedule
          key: node-role.kubernetes.io/infra
          value: reserved
          operator: Equal
```
Reference for resources settings, example prometheus:

```yaml
spec:
  config:
    components:
      prometheus:
        resources:
          limits:
            cpu: 2000m
            memory: 2000Mi
          requests:
            cpu: 1000m
            memory: 1000Mi
```

For more details, please refer to the [Monitor Component Capacity Planning](./architecture/capacity_planning.mdx)

YAML field reference (Prometheus):

| Field path | Description |
| --- | --- |
| `metadata.labels.cpaas.io/cluster-name` | Target cluster name where the plugin is installed. |
| `metadata.labels.cpaas.io/module-name` | Must be `prometheus`. |
| `metadata.labels.cpaas.io/module-type` | Must be `plugin`. |
| `metadata.name` | ModuleInfo name (e.g., `<cluster>-prometheus`). |
| `spec.version` | Plugin version to install. |
| `spec.config.storage.type` | Storage type: `LocalVolume`, `StorageClass`, or `PV`. |
| `spec.config.storage.capacity` | Storage size for Prometheus (Gi). Minimum 30 Gi recommended. |
| `spec.config.storage.nodes` | Node list when `storage.type=LocalVolume`. Up to 1 node supported. |
| `spec.config.storage.path` | LocalVolume path when `storage.type=LocalVolume`. |
| `spec.config.storage.storageClass` | StorageClass name when `storage.type=StorageClass`. |
| `spec.config.storage.pvSelectorK` | PV selector key when `storage.type=PV`. |
| `spec.config.storage.pvSelectorV` | PV selector value when `storage.type=PV`. |
| `spec.replicas` | Replica count; only applicable to `StorageClass`/`PV` types. |
| `spec.config.components.prometheus.retention` | Data retention days. |
| `spec.config.components.prometheus.scrapeInterval` | Scrape interval seconds; applies to ServiceMonitors without `interval`. |
| `spec.config.components.prometheus.scrapeTimeout` | Scrape timeout seconds; must be less than `scrapeInterval`. |
| `spec.config.components.prometheus.resources` | Resource settings for Prometheus. |
| `spec.config.components.nodeExporter.port` | Node Exporter port (default 9100). |
| `spec.config.components.nodeExporter.resources` | Resource settings for Node Exporter. |
| `spec.config.components.alertmanager.resources` | Resource settings for Alertmanager. |
| `spec.config.components.kubeStateExporter.resources` | Resource settings for Kube State Exporter. |
| `spec.config.components.prometheusAdapter.resources` | Resource settings for Prometheus Adapter. |
| `spec.config.components.thanosQuery.resources` | Resource settings for Thanos Query. |
| `spec.config.size` | Monitoring scale: `Small`, `Medium`, or `Large`. |
| `spec.valuesOverride.ait/chart-kube-prometheus.global.nodeSelector` | Optional. The nodeselector for the Monitoring component. Use this parameter to select nodes for the monitoring component. This parameter is mainly used for infrastructure nodes. |
| `spec.valuesOverride.ait/chart-kube-prometheus.global.tolerations` | Optional. The tolerations for the Monitoring component. If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect. This parameter is mainly used for infrastructure nodes. |

### 3. Verify installation

Since the ModuleInfo name changes upon creation, locate the resource via label to check the plugin status and version:

```shell
kubectl get moduleinfo -l cpaas.io/module-name=prometheus
NAME                                             CLUSTER         MODULE        DISPLAY_NAME   STATUS    TARGET_VERSION   CURRENT_VERSION   NEW_VERSION
global-e671599464a5b1717732c5ba36079795          global          prometheus    prometheus     Running   v4.1.0           v4.1.0            v4.1.0
```

Field explanations:

* `NAME`: ModuleInfo resource name
* `CLUSTER`: Cluster where the plugin is installed
* `MODULE`: Plugin name
* `DISPLAY_NAME`: Display name of the plugin
* `STATUS`: Installation status; `Running` means successfully installed and running
* `TARGET_VERSION`: Intended installation version
* `CURRENT_VERSION`: Version before installation
* `NEW_VERSION`: Latest available version for installation


## Install the ACP Monitoring with VictoriaMetrics Plugin via console

### Prerequisites

- If only install the VictoriaMetrics agent, ensure that the VictoriaMetrics Center has been installed in another cluster.

### Installation Procedures

1. Navigate to **App Store Management** > **Cluster Plugins** and select the target cluster.

2. Locate the **ACP Monitoring with VictoriaMetrics** plugin and click **Install**.

3. Configure the following parameters:

   | Parameter                         | Description                                                                                                       |
   | --------------------------------- | ----------------------------------------------------------------------------------------------------------------- |
   | **Scale Configuration**           | Supports three configurations: **Small Scale**, **Medium Scale**, and **Large Scale**:<br />- Default values are set based on the recommended load test values of the platform<br />- You can choose or customize quotas based on the actual cluster scale<br />- Default values will be updated with platform versions; for fixed configurations, custom settings are recommended |
   | **Install Agent Only**            | - Off: Install the complete VictoriaMetrics component suite<br />- On: Install only the VMAgent collection component, which relies on the VictoriaMetrics Center                         |
   | **VictoriaMetrics Center**       | Select the cluster where the complete VictoriaMetrics component has been installed                                               |
   | **Storage Type**                 | - **LocalVolume**: Local storage with data stored on specified nodes<br />- **StorageClass**: Automatically generates persistent volumes using a storage class<br />- **PV**: Utilizes existing persistent volumes                |
   | **Replica Count**                | Sets the number of monitoring component pods:<br />- LocalVolume storage type does not support multiple replicas<br />- For other storage types, please refer to on-screen prompts for configuration                                            |
   | **Parameter Configuration**      | Data parameters for the monitoring component can be adjusted<br />**Note**: Data may temporarily exceed the retention period before being deleted                          |

4. Click **Install** to complete the installation.

## Install the ACP Monitoring with VictoriaMetrics Plugin via YAML

### 1. Check available versions

Ensure the plugin has been published by checking for ModulePlugin and ModuleConfig resources, in the `global`cluster:

```shell

# kubectl get moduleplugin | grep victoriametrics
victoriametrics                       30h
# kubectl get moduleconfig | grep victoriametrics
victoriametrics-v4.1.0                30h

```

This indicates that the ModulePlugin `victoriametrics` exists in the cluster and version `v4.1.0` is published.

### 2. Create a ModuleInfo

Create a ModuleInfo resource to install the plugin without any configuration parameters:

```yaml
kind: ModuleInfo
apiVersion: cluster.alauda.io/v1alpha1
metadata:
  name: business-1-victoriametrics
  labels:
    cpaas.io/cluster-name: business-1
    cpaas.io/module-name: victoriametrics
    cpaas.io/module-type: plugin
spec:
  version: v4.1.0
  config:
    storage:
      type: LocalVolume
      capacity: 40
      nodes:
        - xxx.xxx.xxx.xx
      path: /cpaas/monitoring
      storageClass: ""
      pvSelectorK: ""
      pvSelectorV: ""
    replicas: 1
    agentOnly: false
    agentReplicas: 1
    crossClusterDependency:
      victoriametrics: ""
    components:
      nodeExporter:
        port: 9100
        resources: null
      vmstorage:
        retention: 7
        resources: null
      kubeStateExporter:
        resources: null
      vmalert:
        resources: null
      prometheusAdapter:
        resources: null
      vmagent:
        scrapeInterval: 60
        scrapeTimeout: 45
        resources: null
      vminsert:
        resources: null
      alertmanager:
        resources: null
      vmselect:
        resources: null
    size: Small
  valuesOverride:
    ait/chart-victoriametrics:
      global:
        nodeSelector:
          node-role.kubernetes.io/infra: "true"
        tolerations:
        - effect: NoSchedule
          key: node-role.kubernetes.io/infra
          value: reserved
          operator: Equal
```
Reference for resources settings, example prometheus:

```yaml
spec:
  config:
    components:
      vmagent:
        resources:
          limits:
            cpu: 2000m
            memory: 2000Mi
          requests:
            cpu: 1000m
            memory: 1000Mi
```

For more details, please refer to the [Monitor Component Capacity Planning](./architecture/capacity_planning.mdx)

YAML field reference (VictoriaMetrics):

| Field path | Description |
| --- | --- |
| `metadata.labels.cpaas.io/cluster-name` | Target cluster name where the plugin is installed. |
| `metadata.labels.cpaas.io/module-name` | Must be `victoriametrics`. |
| `metadata.labels.cpaas.io/module-type` | Must be `plugin`. |
| `metadata.name` | ModuleInfo name (e.g., `<cluster>-victoriametrics`). |
| `spec.version` | Plugin version to install. |
| `spec.config.storage.type` | Storage type: `LocalVolume`, `StorageClass`, or `PV`. |
| `spec.config.storage.capacity` | Storage size for VictoriaMetrics (Gi). Minimum 30 Gi recommended. |
| `spec.config.storage.nodes` | Node list when `storage.type=LocalVolume`. Up to 1 node supported. |
| `spec.config.storage.path` | LocalVolume path when `storage.type=LocalVolume`. |
| `spec.config.storage.storageClass` | StorageClass name when `storage.type=StorageClass`. |
| `spec.config.storage.pvSelectorK` | PV selector key when `storage.type=PV`. |
| `spec.config.storage.pvSelectorV` | PV selector value when `storage.type=PV`. |
| `spec.replicas` | Replica count; LV does not support multiple replicas. |
| `spec.config.components.vmstorage.retention` | Data retention days for vmstorage. |
| `spec.config.components.vmagent.scrapeInterval` | Scrape interval seconds; applies to ServiceMonitors without `interval`. |
| `spec.config.components.vmagent.scrapeTimeout` | Scrape timeout seconds; must be less than `scrapeInterval`. |
| `spec.config.components.vmstorage.resources` | Resource settings for vmstorage. |
| `spec.config.components.nodeExporter.port` | Node Exporter port (default 9100). |
| `spec.config.components.nodeExporter.resources` | Resource settings for Node Exporter. |
| `spec.config.components.alertmanager.resources` | Resource settings for Alertmanager. |
| `spec.config.components.kubeStateExporter.resources` | Resource settings for Kube State Exporter. |
| `spec.config.components.prometheusAdapter.resources` | Resource settings for Prometheus Adapter (used for HPA/custom metrics). |
| `spec.config.components.vmagent.resources` | Resource settings for vmagent. |
| `spec.config.size` | Monitoring scale: `Small`, `Medium`, or `Large`. |
| `spec.valuesOverride.ait/chart-victoriametrics.global.nodeSelector` | Optional. The nodeselector for the Monitoring component. Use this parameter to select nodes for the monitoring component. This parameter is mainly used for infrastructure nodes. |
| `spec.valuesOverride.ait/chart-victoriametrics.global.tolerations` | Optional. The tolerations for the Monitoring component. If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect. This parameter is mainly used for infrastructure nodes. |

### 3. Verify installation

Since the ModuleInfo name changes upon creation, locate the resource via label to check the plugin status and version:

```shell
kubectl get moduleinfo -l cpaas.io/module-name=victoriametrics
NAME                                             CLUSTER         MODULE            DISPLAY_NAME     STATUS    TARGET_VERSION   CURRENT_VERSION   NEW_VERSION
global-e671599464a5b1717732c5ba36079795          global          victoriametrics   victoriametrics  Running   v4.1.0           v4.1.0            v4.1.0
```

Field explanations:

* `NAME`: ModuleInfo resource name
* `CLUSTER`: Cluster where the plugin is installed
* `MODULE`: Plugin name
* `DISPLAY_NAME`: Display name of the plugin
* `STATUS`: Installation status; `Running` means successfully installed and running
* `TARGET_VERSION`: Intended installation version
* `CURRENT_VERSION`: Version before installation
* `NEW_VERSION`: Latest available version for installation
