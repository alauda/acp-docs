---
weight: 20
i18n:
  title:
    en: Alauda GitOps Sync and Health Status
---

# Alauda GitOps 同步和健康状态

Alauda Container Platform (ACP) GitOps (简称：Alauda GitOps) 结合 Kubernetes 资源的状态封装了 Application 类型应用的状态；Application 类型应用的状态决定了 ApplicationSet 类型应用的状态。

## 同步状态

资源和应用共有 **同步失败**、**待同步**、**同步中** 及 **已同步** 四种状态。

| **同步状态**   | **说明**                               |
| :----- | :--------------------------------- |
| **同步失败** | 可能由于网络等原因导致资源同步失败，可查看失败原因。 |
| **待同步** | 集群中资源的当前状态与仓库中期望的状态不一致，需要同步。 |
| **同步中** | 集群中资源的当前状态与仓库中期望的状态不一致，正在同步中。 |
| **已同步** | 集群中资源的当前状态与仓库中期望的状态一致。|

:::info
**同步状态显示优先级**：**同步失败** > **待同步** > **同步中** > **已同步**，示例如下：
- 通过 GitOps 应用创建的 Application 类型应用 中存在两个 Kubernetes 资源，同步状态分别为 **同步中** 和 **已同步**，根据显示优先级可知，**同步中** 的显示优先级高于 **已同步**，则此 Application 类型应用的同步状态为 **同步中**。
- 通过 GitOps 应用创建的 ApplicationSet 类型应用，并将配置分发至两个不同的命名空间中，此时会自动创建两个来源相同的 Application 类型应用，这两个应用的同步状态分别为 **同步失败** 和 **已同步**，根据显示优先级可知，**同步失败** 的显示优先级高于 **已同步**，则此 ApplicationSet 类型应用的同步状态为 **同步失败**。
:::

## 健康状态

资源和应用共有 **未知**、**丢失**、**降级**、**暂停**、**处理中** 及 **健康** 六种状态。

| **健康状态**   | **说明**                               | **参考解决方案** |
| :----- | :--------------------------------- | :--------------------------------- |
| **未知** | 无法判断当前资源的健康状态，大概率是由于发生异常导致的。 | 切换至资源对应的 YAML 文件，查看 status.condition 字段中的异常信息，可结合异常信息以及 Workload 的实时日志分析定位解决问题。 |
| **丢失** | 资源未创建。 | **场景一**：当首次创建资源时，需稍等一段时间，状态即可由丢失转为健康。若在此过程中资源的同步状态为同步失败，则需检查仓库配置是否正确。<br/> **场景二**：由于目标环境的资源被删除而导致资源丢失，需手动同步相关资源。 |
| **降级** | 用于 Workload 资源，表示在给定时间范围内，Workload 的 Pod 还未从 **处理中** 状态到达 **健康** 状态，此时间范围默认为 10 分钟。 | 查看 Pod 实时日志、事件分析定位解决问题。 |
| **暂停** | 用于 Workload 资源，表示滚动更新暂停。 | 查看 Workload 实时日志、事件分析定位解决问题。  |
| **处理中** | 资源已创建成功，但 Pod 暂未达到 Ready 状态，预计很快会到达健康状态。 | - |
| **健康** | 资源运行正常，状态健康。 | - |

:::info
健康状态显示优先级为：未知 > 丢失 > 降级 > 暂停 > 处理中 > 健康，示例如下：
- 通过 GitOps 应用创建的 Application 类型应用 中存在两个 Kubernetes 资源，健康状态分别为 **健康** 和 **未知**，根据显示优先级可知，**未知** 的显示优先级高于 **健康**，则此 Application 类型应用的健康状态为 **未知**。
- 通过 GitOps 应用创建的 ApplicationSet 类型应用，并将配置分发至两个不同的命名空间中，此时会自动创建两个来源相同的 Application 类型应用，这两个应用的健康状态分别为 **丢失** 和 **处理中**，根据显示优先级可知，**丢失** 的显示优先级高于 **处理中**，则此 ApplicationSet 类型应用的健康状态为 **丢失**。
:::

## 识别规则

Kubernetes 资源 达到如下状态即显示为 健康状态，具体识别规则如下：

| **资源类型**   | **状态**                               |
| :----- | :--------------------------------- |
| **Deployment（部署）** | 部署完成滚动更新且所有实例均处于健康状态。 |
| **StatefulSet（有状态副本集）** | 有状态副本集完成更新且所有实例均处于健康状态。 |
| **ReplicaSet** | ReplicaSet 的所有 Pod 均处于健康状态。 |
| **DaemonSet（守护进程集）** | 守护进程集的 Pod 实例数达到期望实例数，且所有 Pod 实例处于健康状态。 |
| **Ingress（入站规则）** | 入站规则的状态中 LoadBalancer 信息不为空。 |
| **Service（内部路由）** | 内部路由的状态中 LoadBalancer 信息不为空。 |
| **PVC（持久卷声明）** | 持久卷声明状态为 绑定状态。 |
| **Pod（容器组）** | 容器组的容器状态都是健康状态。 |
| **Job（任务）** | 任务正常运行完成。 |
| **HPA（Pod 水平自动伸缩）** | HPA 正常完成扩缩容。 |

