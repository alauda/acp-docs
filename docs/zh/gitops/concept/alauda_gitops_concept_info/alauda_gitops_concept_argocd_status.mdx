---
weight: 20
i18n:
  title:
    en: Alauda Container Platform GitOps Sync and Health Status
    zh: Alauda Container Platform GitOps 的同步及健康检查
sourceSHA: 58f25602ddd7c4d74818480156f27a204693f08af5bd3306aa2c6b5576d17092
title: Alauda Container Platform GitOps 的同步及健康检查
---

# Alauda Container Platform GitOps 的同步及健康检查

Alauda Container Platform GitOps 通过利用底层 Kubernetes 资源的状态，封装了 `Application` 资源的状态。`Application` 资源的状态直接决定了关联的 `ApplicationSet` 资源的状态。

## 同步状态说明

Kubernetes 资源和应用有四种同步状态：**同步失败**、**待同步**、**同步中**和**已同步**。

| **同步状态**   | **说明**                                                                                                                |
| :----- | :------------------------------------------------------------------------------------------------------------------- |
| **同步失败** | 由于网络错误、配置问题或权限问题导致同步失败。请查看日志以确定根本原因。                              |
| **待同步**   | 集群资源状态与 Git 定义的期望状态不一致。需要手动或自动同步。                                              |
| **同步中**   | 集群状态与 Git 定义的状态之间正在进行活动协调。                                                             |
| **已同步**   | 集群资源状态与 Git 定义的期望状态一致。                                                              |

:::info
**同步状态显示优先级**：优先级顺序为 **同步失败** > **待同步** > **同步中** > **已同步**。

**示例**：

- 如果一个 Application 拥有两个资源，其状态分别为 **同步中** 和 **已同步**，则其整体状态为 **同步中**。
- 如果一个 ApplicationSet 管理两个 Application，其状态分别为 **同步失败** 和 **已同步**，则其整体状态为 **同步失败**。
:::

## 健康状态说明

Kubernetes 资源和应用有六种健康状态：**未知**、**丢失**、**降级**、**暂停**、**处理中**和**健康**。

| **健康状态**   | **说明**                                                                                                   | **参考解决方案**                                                                     |
| :----- | :-------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------- |
| **未知** | 无法确定健康状态，通常由于控制器错误或缺失状态数据。                                                      | 检查资源 YAML 的 `status.conditions` 获取诊断细节。                                       |
| **丢失** | 集群中未找到资源。                                                                                          | 初始创建：等待协调 <br /> 意外删除：触发手动同步。                                       |
| **降级** | Workload 资源（例如 Deployment）在超时（默认：10 分钟）内未能达到健康状态。                     | 检查 Pod 错误（例如，崩溃、资源限制）。                                              |
| **暂停** | Workload 资源的滚动更新被故意暂停（例如，通过 <code>kubectl rollout pause</code>）。 | 如适用，恢复滚动更新。                                                              |
| **处理中** | 资源成功创建但尚未完全就绪（例如，Pods 初始化中）。                                                 | 监视，直到过渡到健康/降级状态。                                                     |
| **健康** | 资源正常运行。                                                                                           | -                                                                                      |

:::info
**健康状态优先级**：优先级顺序为 **未知** > **丢失** > **降级** > **暂停** > **处理中** > **健康**。

**示例**：

- 如果一个 Application 的健康状态为 **健康** 和 **未知**，则其整体健康状态为 **未知**。
- 如果一个 ApplicationSet 管理的 Applications 的状态为 **丢失** 和 **处理中**，则其整体健康状态为 **丢失**。
:::

## 识别规则

对于 Kubernetes 资源，达到以下健康状态的规则如下：

| **资源类型**   | **状态**                                                                      |
| :----- | :--------------------------------------------------------------------------- |
| **Deployment**    | 滚动更新已完成，且所有副本可用。                                           |
| **StatefulSet**   | 更新完成，且所有 Pods 就绪。                                               |
| **ReplicaSet**    | 所有 Pods 健康。                                                             |
| **DaemonSet**     | 已调度且健康的 Pods 数量达到所需数量。                                       |
| **Ingress**       | LoadBalancer IP/主机名已填充至状态中。                                        |
| **Service**       | LoadBalancer IP/主机名已填充（如果适用）。                                  |
| **PVC**           | 状态为 **已绑定**。                                                           |
| **Pod**           | 所有容器均就绪且重启次数未超过阈值。                                        |
| **Job**           | Job 成功完成 (`.status.succeeded >= 1`)。                                     |
| **HPA**           | 当前副本数与期望副本数匹配的成功扩缩容操作。                                     |
