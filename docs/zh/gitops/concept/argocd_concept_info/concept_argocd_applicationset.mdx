---
weight: 30
---

# 深入理解 ApplicationSet

## ApplicationSet 介绍
ApplicationSet 是一个 Kubernetes 控制器，它添加了对 ApplicationSet CustomResourceDefinition (CRD) 的支持。它允许您使用一个模板来生成多个 Application。ApplicationSet 可以看作是一个 Application 的工厂，它可以根据不同的参数生成多个 Application 实例。它可实现自动化和更大的灵活性，从而实现跨大量集群和 monorepos 管理 Argo CD 应用程序（Application），此外，它还使在多租户 Kubernetes 集群上实现自助服务成为可能。

## ApplicationSet 适用场景
- 多个相似应用程序部署： 当您需要部署多个具有相似配置的应用程序时，可以使用 ApplicationSet 来减少重复配置。例如，您可以使用 ApplicationSet 来部署多个微服务，它们都使用相同的模板，但具有不同的服务名称和端口号。
- 多集群部署： 当您需要在多个 Kubernetes 集群中部署相同的应用程序时，可以使用 ApplicationSet 来简化配置。例如，您可以使用 ApplicationSet 来定义一个应用程序，并将其部署到多个集群中，每个集群使用不同的参数。
- 动态生成应用程序： 当您需要根据某些条件动态生成应用程序时，可以使用 ApplicationSet。例如，您可以根据 Git 仓库中的分支或标签来动态生成不同的应用程序实例。

## ApplicationSet 示例

```
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: guestbook
spec:
  goTemplate: true
  goTemplateOptions: ["missingkey=error"]
  generators:
  - list:
      elements:
      - cluster: engineering-dev
        url: https://1.2.3.4
      - cluster: engineering-prod
        url: https://2.4.6.8
      - cluster: finance-preprod
        url: https://9.8.7.6
  template:
    metadata:
      name: '{{.cluster}}-guestbook'
    spec:
      project: my-project
      source:
        repoURL: https://github.com/infra-team/cluster-deployments.git
        targetRevision: HEAD
        path: guestbook/{{.cluster}}
      destination:
        server: '{{.url}}'
        namespace: guestbook
``` 

## 总结 Application 和 ApplicationSet 的区别

| **属性** | **Application** | **ApplicationSet** |
| :----- | :--------------------------------- | :--------------------------------- |
| 定义 | 单个应用程序的部署和配置 | 一组相似应用程序的模板，用于生成多个 Application 实例 |
| 配置 | 静态配置 | 动态配置，通过生成器生成参数，填充 Application 模板 |
| 部署 | 部署单个应用程序 | 生成并部署多个 Application 实例 |
| 适用场景 | 单个应用程序部署，配置简单，部署到单一环境 | 多个相似应用程序部署，配置复杂，需要部署到多个环境或集群，需要根据不同参数动态生成应用程序实例 |
| 核心概念 | Git 仓库、目标集群、部署策略等 | 生成器、模板、参数、占位符 |
| 与 Argo CD 关系 | Argo CD 的基本部署单元 | Argo CD 的高级特性，用于批量管理 Application |

## 状态说明
| **同步状态**   | **说明**                               |
| :----- | :--------------------------------- |
| **同步失败** | 可能由于网络等原因导致资源同步失败，可查看失败原因。 |
| **待同步** | 集群中资源的当前状态与仓库中期望的状态不一致，需要同步。 |
| **同步中** | 集群中资源的当前状态与仓库中期望的状态不一致，正在同步中。 |
| **已同步** | 集群中资源的当前状态与仓库中期望的状态一致。|


## 参考资料
- [Argo CD 官方文档](https://argo-cd.readthedocs.io/en/stable/)

