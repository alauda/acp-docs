---
weight: 40
---

# 使用快照

虚拟机快照中保存了虚拟机当下的状态，一旦发生意外故障，可用于将虚拟机恢复到该时间点的状态。

## 前提条件

* 管理员已在平台管理中部署了 **卷快照**。

* 虚拟机快照基于卷快照实现，请确保至少有一个磁盘绑定了支持卷快照功能的存储类，例如 CephFS 内置存储。

* 仅支持虚拟机离线快照，创建快照或回滚快照前，请先 [停止虚拟机](./batch_actions.mdx)。

## 注意事项

如果集群中存在多个同种类型的存储，例如接入多个不同来源 Ceph RBD 存储，虚拟机在使用这类存储时，磁盘快照功能可能无法正常工作。

## 创建快照

虚拟机快照中包含的内容：虚拟机设置、支持卷快照的磁盘状况。

### 操作步骤

1. 进入 **Container Platform**。

1. 在左侧导航栏中，单击 **虚拟化** > **虚拟机**。

2. 找到虚拟机，单击 ⋮ > **创建快照**。

4. 填写快照描述。描述可帮助您记录虚拟机的当前状态，例如 `初始安装`、`应用升级前`。

5. 单击 **创建**。快照耗时与网络状况和业务量有关，请耐心等待。
   
6. 检查快照状态。

    * 当快照变为 `就绪` 状态时，说明创建成功。

    * 如果快照长时间处于 `未就绪` 状态，请单击 <span style={{ display: 'inline-flex', alignItems: 'center', gap: '4px', verticalAlign: 'middle' }}><img src="./assets/icon_overview.png" alt="expand" style={{ verticalAlign: 'middle' }} /> <span> >  查看原因并解决问题，随后重新创建快照。</span></span>

## 回滚快照

将虚拟机设置、支持卷快照的磁盘回滚到创建快照时的状态。例如，在创建快照后添加的磁盘将被移除；更改的磁盘数据将被恢复。

### 注意事项

如果有磁盘绑定了支持 LVM 机制的存储类（例如 TopoLVM），请与管理员确认该存储类的回收策略为 **保留**（`reclaimPolicy: Retain`）以正常使用快照回滚功能。

### 操作步骤

1. 进入 **Container Platform**。

1. 在左侧导航栏中，单击 **虚拟化** > **虚拟机**。

2. 单击 ***虚拟机的名称***。

3. 在进入 **快照** 页签中，找到快照，单击 ⋮ > **回滚**。

4. 阅读界面提示信息，确认无误后单击 **回滚**。

    **注意**：无法中止或撤销回滚操作，请谨慎进行。

5. 单击快照名称，在“快照回滚记录”中查看是否已完成回滚。回滚耗时与网络状况和业务量有关，请耐心等待。
   

**说明**

* 如果回滚失败，虚拟机状态将保持不变。您可正常启动虚拟机，或重新尝试回滚快照。

* 如果在回滚过程中启动虚拟机，虚拟机将恢复停止前的状态，且在再次停止虚拟机时，继续回滚至创建快照时的状态。

* 为避免操作冲突，请确保已完成最近一条回滚记录，再对该虚拟机执行其他操作。

## 删除快照

删除不再需要的虚拟机快照，释放磁盘资源。

### 注意事项

删除已回滚的虚拟机快照时，如果虚拟机磁盘需要基于快照进行数据拷贝（例如 TopoLVM），需要等待基于回滚版本启动过虚拟机后再删除，否则虚拟机将无法启动。

### 操作步骤

1. 进入 **Container Platform**。

1. 在左侧导航栏中，单击 **虚拟化** > **虚拟机**。

2. 单击 ***虚拟机的名称***。

3. 在进入 **快照** 页签中，找到目标快照，单击 ⋮ > **删除**。

4. 阅读提示信息，确认无误后单击 **删除**。   

