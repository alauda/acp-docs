---
weight: 40
sourceSHA: 6a5468022ccd2bc1a91439f91058e79c494019edce3c4b4d8446d27bfae5c830
---

# 使用快照

虚拟机快照保存了虚拟机的当前状态，可在发生意外故障时将虚拟机恢复到该状态。

## 前提条件

- 管理员已在平台管理中部署了 **卷快照**。

- 虚拟机快照基于卷快照。请确保至少有一个磁盘绑定到支持卷快照的存储类，例如 CephFS 内置存储。

- 仅支持虚拟机的离线快照。请在创建或回滚快照前，先 [停止虚拟机](../../virtual_machine/functions/batch_actions.mdx)。

## 注意事项

如果集群中存在多个相同类型的存储，例如多个不同来源的 Ceph RBD 存储，在虚拟机使用此类存储时，磁盘快照功能可能无法正常工作。

## 创建快照

虚拟机快照包含以下内容：虚拟机设置以及支持卷快照的磁盘状态。

### 操作步骤

1. 访问 **Container Platform**。

2. 在左侧导航栏，点击 **虚拟化** > **虚拟机**。

3. 找到虚拟机，点击 ⋮ > **创建快照**。

4. 填写快照描述。描述可以帮助您记录虚拟机当前的状态，例如 `初始安装`、`应用升级前`。

5. 点击 **创建**。快照所需时间取决于网络状况和工作负载，请耐心等待。

6. 检查快照状态。

   - 当快照变为 `就绪`，表示创建成功。

   - 如果快照长时间处于 `未就绪` 状态，请点击 <span style={{ display: 'inline-flex', alignItems: 'center', gap: '4px', verticalAlign: 'middle' }}><img src="./assets/icon_overview.png" alt="expand" style={{ verticalAlign: 'middle' }} /> <span> > 查看原因并进行故障排除，然后重新创建快照。</span></span>

## 回滚快照

将虚拟机的设置和支持卷快照的磁盘回滚到创建快照时的状态。例如，在创建快照后添加的磁盘将被移除；修改过的磁盘数据将被恢复。

### 注意事项

如果有磁盘绑定到支持 LVM 机制的存储类（例如 TopoLVM），请与管理员确认该存储类的回收策略已设置为 **保留**（`reclaimPolicy: Retain`），以便正确使用快照回滚功能。

### 操作步骤

1. 访问 **Container Platform**。

2. 在左侧导航栏中，点击 **虚拟化** > **虚拟机**。

3. 点击 ***虚拟机名称***。

4. 在 **快照** 标签页中，找到快照并点击 ⋮ > **回滚**。

5. 阅读界面上的提示信息，确认无误后点击 **回滚**。

   **注意**：回滚操作无法中止或撤销，请谨慎进行。

6. 点击快照名称，在“快照回滚记录”中查看回滚是否已完成。回滚所需时间取决于网络状况和工作负载，请耐心等待。

**说明**

- 如果回滚失败，虚拟机状态保持不变。您可以正常启动虚拟机，或再次尝试回滚快照。

- 如果在回滚过程中启动虚拟机，虚拟机将恢复至停止前的状态，在再次停止虚拟机后将继续回滚至快照创建时的状态。

- 为避免操作冲突，请确保最近的回滚记录已完成后，再对该虚拟机执行其他操作。

## 删除快照

删除不再需要的虚拟机快照，以释放磁盘资源。

### 注意事项

删除已回滚的虚拟机快照时，如果虚拟机磁盘需要基于快照进行数据复制（例如 TopoLVM），必须等待基于回滚版本的虚拟机启动后再进行删除，否则虚拟机将无法启动。

### 操作步骤

1. 访问 **Container Platform**。

2. 在左侧导航栏中，点击 **虚拟化** > **虚拟机**。

3. 点击 ***虚拟机名称***。

4. 在 **快照** 标签页中，找到目标快照并点击 ⋮ > **删除**。

5. 阅读提示信息，确认无误后点击 **删除**。
