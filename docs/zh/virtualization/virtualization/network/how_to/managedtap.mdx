---
sourceSHA: 669a42d7aca004b3a05a4c2834d055dfdb4e49e03b00c3abbaaf2f5a96bd8006
---

# 配置虚拟机使用网络绑定模式以支持 IPv6

网络绑定模式是虚拟机网络的一种插件扩展机制。平台默认使用一个名为 ManagedTap 的插件来启用虚拟机的 IPv6 支持。该插件允许虚拟机通过 CNI 的 DHCP Server 获取 IP 地址。因此，只要 CNI 的 DHCP Server 支持 IPv6，虚拟机也将获得 IPv6 功能。

目前，我们使用 Kube-OVN 作为 CNI。由于 Kube-OVN 的 DHCP Server 完全支持 IPv6，虚拟机可以通过 ManagedTap 和 Kube-OVN 的组合实现强大的 IPv6 功能。

## 前提条件

- ACP 版本必须是 v4.0.0 或更高版本。
- CNI 使用 Kube-OVN，且虚拟机子网配置为 Underlay。

## 操作步骤

<Steps>
  ### 为虚拟机子网添加 IPv6 配置

  ```bash
  kubectl edit subnet <subnet-name>
  ```

  在 `spec` 下添加以下参数：

  ```yaml
  spec:
    enableDHCP: true
    enableIPv6RA: true
    u2oInterconnection: true
  ```

  ### 在网页控制台使用网络绑定模式创建虚拟机

  创建虚拟机时，选择 **网络绑定** 作为网络模式。

  ### 通过 VNC 访问虚拟机并配置网络接口

  对于 CentOS 系统，编辑 `/etc/sysconfig/network-scripts/ifcfg-enp1s0` 文件，并添加以下配置：

  ```bash
  IPV6INIT=yes
  DHCPV6C=yes
  IPV6_AUTOCONF=yes
  ```

  重启网络

  ```bash
  systemctl restart network
  ```

  ### 配置 IPv6 默认路由

  如果交换机配置为发送路由公告（RA）消息，则不需要手动配置路由。可以通过交换机的 RA 消息自动学习到默认路由。

  ```bash
  ip r r default via <subnet-v6-gateway>
  ```
</Steps>
