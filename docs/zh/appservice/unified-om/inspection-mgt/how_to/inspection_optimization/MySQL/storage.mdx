---
weight: 30
sourceSHA: 5bcc49e8e8c375b33ba0abaa723581532f18d501ea6e05051c47907603af51f2
---

# MySQL 存储空间优化

MySQL 用户需要密切监控其实例的空间利用率，因为这是日常监控的关键指标之一。如果实例的存储空间使用达到上限，将会严重影响实例的正常运行，可能导致数据库写入失败、备份无法正常完成以及存储扩展任务的执行时间延长。通常，当 MySQL 实例的存储空间利用率达到 80-85% 时，应及时采取措施，要么减少实际的数据库空间使用，要么扩展存储空间，以避免达到上限的风险。

## 存储空间问题优化建议

### binlog 文件过多

在 MySQL 中启用 binlog 功能可以记录数据库的所有修改操作，这在灾难恢复和主从复制等场景中至关重要。然而，如果 binlog 文件未能及时清理，可能会导致空间使用过多。为了减少空间浪费，建议定期备份数据，并根据业务需求调整 binlog 文件的保留期限。这能确保数据库的安全，同时最大限度地降低空间占用的风险。

### 索引过多

索引过多会在写入时放大 I/O 吞吐量。为了减少不必要的空间浪费，重要的是谨慎配置二级索引。

### 字段过大

如果表结构定义中包含 BLOB、TEXT 或非常长的 VARCHAR 等大字段，将导致表空间使用增加。建议禁用 BLOB 和 TEXT 类型，改为使用 JSON 类型或其他文档数据库来存储这些数据。如有必要，可以在插入之前对数据进行压缩。

### 空闲表空间过多（InnoDB 表的高碎片率）

InnoDB 通过页（16KB）来管理表空间。如果一个页充满了记录，然后通过 DELETE SQL 删除了一些记录，后续的删除在未插入新记录到删除位置的情况下可能会导致表空间的碎片化。这会导致 InnoDB 进行额外的 I/O 操作，以访问分散的碎片页，从而对数据库性能产生负面影响。

要检查某个表上的空闲空间，可以使用以下 SQL 语句：

```
show table status like '<table_name>'
```

如果空闲空间特别大，可以执行以下语句来重组表空间。

```
optimize table <table_name>
```

### 临时表空间过多

某些操作会生成临时表，例如半连接、DISTINCT 操作以及不使用索引的排序。如果涉及的数据量很大，可能会导致临时表空间过多。通过检查执行计划，可以判断是否包含 Using Temporary。

此外，当 DDL 语句重建表空间时，如果表特别大，在创建索引时生成的临时文件也可能会相当大。如果空间不足，应该提前扩展存储。
