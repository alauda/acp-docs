---
weight: 10
---

# Redis BigKey

## BigKey 介绍

在 Redis 中，BigKey 占用了过多的内存资源，导致 Redis 的性能和可用性受到影响。

一般来说，以下情况可能会导致一个 key 被认为是 BigKey：

* 字符串类型的 key，占用的内存空间超过 5 MB。
* 列表类型的 key，包含的元素数量超过 2 万个，或者占用的内存空间超过 1 MB。
* 集合类型的 key，包含的元素数量超过 5 千个，或者占用的内存空间超过 1 MB。
* 有序集合类型的 key，包含的元素数量超过 1 万个，或者占用的内存空间超过 1 MB。
* 哈希表类型的 key，包含的字段数量超过 1 千个，或者占用的内存空间超过 1 MB。

**注意**：这些阈值并不是硬性规定，需要根据您的实际情况来判断一个 key 是否属于 BigKey。

## 如何判断 Redis 实例中，出现了 BigKey？

使用以下命令对 Redis 中的 key 进行采样检查，找出其中占用内存较大的 key，以及对应的类型和大小。

```bash
redis-cli --bigkeys
```

更多更详细的 BigKey 检测方法参考[BigKey 的发现与处理](../../../../../redis/trouble_shooting/20-bigkeycheck.mdx)。

## 如何修复 Redis 实例中的 BigKey？

| BigKey 类型 | 修复方法 |
| --- | --- |
|**字符串**| 可以考虑将 BigKey 分成多个小的字符串进行存储。使用 `GETRANGE` 和 `SETRANGE` 命令读取和修改字符串的一部分，从而实现将一个大的字符串分割成多个小的字符串。 |
|**哈希表**|将 BigKey 拆分成多个小的哈希表。先将大哈希表的 key 集合进行拆分，然后将每个 key 对应的哈希表中的 field 集合拆分，最后将每个 field 对应的 value 进行拆分。这样可以将一个大的哈希表拆分成多个小的哈希表。|
|**列表**|可以考虑将 BigKey 分成多个小的列表进行存储。使用 `LRANGE` 和 `RPUSH` 命令读取和修改列表的一部分，从而实现将一个大的列表分割成多个小的列表。|
|**集合**|可以考虑将 BigKey 分成多个小的集合进行存储。使用 `SMEMBERS` 和 `SADD` 命令读取和修改集合中的元素，从而实现将一个大的集合分割成多个小的集合。|
|**有序集合**|可以将 BigKey 拆分成多个小的有序集合。先将大有序集合的 key 集合进行拆分，然后将每个 key 对应的有序集合中的元素进行拆分。使用`ZRANGE` 和 `ZADD` 命令读取和修改有序集合中的元素，从而实现将一个大的有序集合拆分成多个小的有序集合。|


