---
weight: 10
---

# 创建巡检任务

## 功能简介

巡检任务代表着对特定组件实例的巡检规划和管理。您可以在创建巡检任务时，指定需要执行巡检的组件实例以及巡检的周期和策略。您还可以指定巡检记录保留的最大份数，超过份数的巡检结果会被自动覆盖。

## 主要功能

在创建巡检任务时，您可以通过下列命令来创建巡检任务:
```bash
kubectl -n <namespace> apply -f - <<EOF
{
  "apiVersion": "middleware.alauda.io/v1",
  "kind": "Inspection",
  "metadata": {
    "name": "insp-task",
    "namespace": "tongrds-1"
  },
  "spec": {
    "component": "mysqlcluster",
    "instances": [
      {
        "name": "mgr1"
      }
    ],
    "jobsHistoryLimit": 3,
    "trigger": "Manual"
  }
}
EOF
```

::: info

- `<name>` 是巡检任务的资源名称，设置一个便于记忆的名称即可
- `<namespace>` 是巡检任务所属的命名空间，也是巡检的目标命名空间。例如，如果您要对命名空间 `tongrds-1` 中的组件实例 `mgr1` 进行巡检，那么您需要将 `<namespace>` 设置为 `tongrds-1`。
- `<spec.component>` 是用来指定巡检任务的目标组件类型，例如 `mysqlcluster`
- `<spec.instances.name>` 用来指定巡检任务的目标实例名称，这里可以指定同一个命名空间下的多个实例，或者使用通配符 `*` 来匹配所有实例
- `<spec.jobsHistoryLimit>` 用来指定当前巡检任务保存的最大巡检记录数，超过该值的巡检记录会被自动覆盖
- `<spec.trigger>` 用来指定当前巡检任务的触发方式，目前支持 `Manual` 和 `Schedule`，分别表示手动触发和定时触发。如果设置为 `Schedule`，则还需要设置以下参数：
  - `<spec.schedule>` 用来指定当前巡检任务的触发时间，例如 `0 0 1 * *` 表示每天凌晨 1 点触发。更多关于定时任务的设置，请参阅[巡检定时策略](./inspection_policy.mdx)。

:::

当巡检任务创建成功后，后端服务就会按照巡检任务的设定去执行对应的巡检操作。更多关于巡检的执行，请参阅[巡检任务执行](./run_inspection_task.mdx)。
