---
weight: 10
sourceSHA: 3bc2f33176efb6b2528cea4d198bc359c003f4d2236a9a5b91334fd1908a1125
---

# 创建子网（Calico 网络）

在 Calico 网络中创建子网，以实现集群内资源网络隔离的更细粒度控制。

## 限制与限制条件

在 IPv6 集群环境中，默认情况下，在 Calico 网络中创建的子网使用 VXLAN 封装。VXLAN 封装所需的端口与 IPIP 封装的端口不同。您需要确保 UDP 端口 4789 是开放的。

## IP 分配规则

**注意**：如果项目或命名空间分配了多个子网，则会从其中一个子网随机选择一个 IP 地址。

- 项目分配：

  - 如果项目未绑定到子网，则该项目下所有命名空间中的 Pods 只能使用默认子网中的 IP 地址。如果默认子网中的 IP 地址不足，Pods 将无法启动。
  - 如果项目绑定到子网，则该项目下所有命名空间中的 Pods 只能使用该特定子网中的 IP 地址。

- 命名空间分配：

  - 如果命名空间未绑定到子网，则该命名空间中的 Pods 只能使用默认子网中的 IP 地址。如果默认子网中的 IP 地址不足，Pods 将无法启动。
  - 如果命名空间绑定到子网，则该命名空间中的 Pods 只能使用该特定子网中的 IP 地址。

## 创建子网及分配项目或命名空间

1. 进入 **平台管理**。

2. 在左侧导航栏中，单击 **网络管理** > **子网**。

3. 单击 **创建子网**。

4. 根据以下说明配置相关参数。

   | 参数                      | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   | ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **CIDR**                 | 在将子网分配给项目或命名空间后，命名空间内的容器组会随机使用此 CIDR 范围内的 IP 地址进行通信。<br />**注意**：有关 CIDR 和 BlockSize 之间的对应关系，请参见 [参考内容](#1)。                                                                                                                                                                                                                                                                                                      |
   | **封装协议**             | 选择封装协议。 **IPIP** 不支持双栈模式。<ul><li>**IPIP**: 使用 IPIP 协议实现跨段通信。</li><li>**VXLAN (Alpha)**: 使用 VXLAN 协议实现跨段通信。</li><li>**无封装**: 通过路由转发直接连接。</li></ul>                                                                                                                                                                                                                          |
   | **封装模式**             | 当封装协议为 **IPIP** 或 **VXLAN** 时，必须设置封装模式，默认为 **始终**。<br /><ul><li>**始终**: 始终启用 IPIP / VXLAN 隧道。</li><li>**跨子网**: 仅在主机处于不同子网时启用 IPIP / VXLAN 隧道；主机在同一子网时通过路由转发直接连接。</li></ul>                                                                                                                                                                     |
   | **出站流量 NAT**         | 选择是否启用出站流量 NAT（网络地址转换），默认启用。<br />主要用于设置子网容器组访问外部网络时暴露给外部网络的访问地址。<br />当启用出站流量 NAT 时，主机 IP 将作为当前子网容器组的访问地址；当未启用时，子网中的容器组 IP 将直接暴露给外部网络。 |

5. 单击 **确认**。

6. 在子网详情页面，选择 **操作** > **分配项目** / **分配命名空间**。

7. 完成配置并单击 **分配**。

## 参考内容 \{#1}

CIDR 与 blockSize 之间的动态匹配关系如下表所示。

| CIDR            | blockSize 大小 | 主机数量        | 单个 IP 池的大小 |
| --------------- | -------------- | --------------- | ----------------- |
| `prefix<=16`    | 26             | 1024+           | 64                |
| `16<prefix<=19` | 27             | 256\~1024       | 32                |
| `prefix=20`     | 28             | 256             | 16                |
| `prefix=21`     | 29             | 256             | 8                 |
| `prefix=22`     | 30             | 256             | 4                 |
| `prefix=23`     | 30             | 128             | 4                 |
| `prefix=24`     | 30             | 64              | 4                 |
| `prefix=25`     | 30             | 32              | 4                 |
| `prefix=26`     | 31             | 32              | 2                 |
| `prefix=27`     | 31             | 16              | 2                 |
| `prefix=28`     | 31             | 8               | 2                 |
| `prefix=29`     | 31             | 4               | 2                 |
| `prefix=30`     | 31             | 2               | 2                 |
| `prefix=31`     | 31             | 1               | 2                 |

**注意**：不支持前缀大于 31 的子网配置。
