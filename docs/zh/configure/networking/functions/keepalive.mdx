---
weight: 10
sourceSHA: d6f7d2f3cf37683e68456da8ead8333e824fa326b9995d5dcce58b11e34cba40
---

# tcp/http 保持连接

## 基本概念

1. alb 支持在端口级别进行保持连接配置。该配置可以在前端进行。

2. 保持连接只在 **客户端与 alb 之间， 而不是 alb 与后端之间** 实现。

3. 该功能通过 nginx 配置实现，并且当配置发生变化时，nginx **需要并会自动重载**。

4. tcp 保持连接和 http 保持连接是两个不同的概念。
   1. tcp 保持连接是 TCP 协议的一个特性，在没有数据传输时定期发送探测数据包，以检查连接是否仍然存活。它有助于检测并清理死连接。
   2. http 保持连接（也称为持久连接）允许多个 HTTP 请求复用同一 TCP 连接，从而避免建立新连接的开销。这通过减少延迟和资源使用提高了性能。

## crd

```yaml
keepalive:
  properties:
    http:
      description: 下游 l7 保持连接
      properties:
        header_timeout:
          description: keepalive_header_timeout. 默认未设置
          type: string
        requests:
          description: keepalive_requests. 默认值为 1000
          type: integer
        timeout:
          description: keepalive_timeout. 默认值为 75s
          type: string
      type: object
    tcp:
      description: TCPKeepAlive 定义 TCP 保持连接参数
        (so_keepalive)
      properties:
        count:
          description: TCP_KEEPCNT 套接字选项
          type: integer
        idle:
          description: TCP_KEEPIDLE 套接字选项
          type: string
        interval:
          description: TCP_KEEPINTVL 套接字选项
          type: string
      type: object
  type: object
```

只能在前端配置。
