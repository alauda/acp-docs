---
weight: 10
sourceSHA: 103bf0b1d4b8ed06276a3f27ab83ca2277539261dd38fd89b205ceaee04c876d
---

# l4/l7 超时设置

## 基本概念

l4/l7 超时设置是由 ALB 提供的一项功能。它用于配置 l4/l7 代理的超时时间。

超时以 lua 脚本的形式实现，更改时 **不需要重载** nginx。

## CRD

```yaml
timeout:
  properties:
    proxy_connect_timeout_ms:
      type: integer
    proxy_read_timeout_ms:
      type: integer
    proxy_send_timeout_ms:
      type: integer
  type: object
```

配置可以在以下位置进行设置：

- frontend: `.spec.config.timeout`
- rule: `.spec.config.timeout`

## 超时的含义

超时时间分为三种类型：

1. proxy\_connect\_timeout\_ms: 定义与上游服务器建立连接的超时时间。如果在此时间内无法建立连接，请求将会失败。

2. proxy\_read\_timeout\_ms: 定义从上游服务器读取响应的超时时间。超时是在两次连续读取操作之间设置的，而不是针对整个响应。如果在此时间内未收到数据，则连接将被关闭。

3. proxy\_send\_timeout\_ms: 定义向上游服务器发送请求的超时时间。与读取超时类似，此超时是在两次连续写入操作之间设置的。如果在此时间内无法发送数据，则连接将被关闭。

## Ingress 注解

| 注解                                               | 描述                                            |
| ------------------------------------------------- | ------------------------------------------------ |
| nginx.ingress.kubernetes.io/proxy-connect-timeout | 对应 CR 中的 proxy\_connect\_timeout\_ms      |
| nginx.ingress.kubernetes.io/proxy-read-timeout    | 对应 CR 中的 proxy\_read\_timeout\_ms         |
| nginx.ingress.kubernetes.io/proxy-send-timeout    | 对应 CR 中的 proxy\_send\_timeout\_ms         |

## 端口级超时

您可以直接在端口上配置超时，用作 l4 超时。
