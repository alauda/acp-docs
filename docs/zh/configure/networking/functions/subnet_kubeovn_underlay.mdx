---
weight: 30
sourceSHA: e899e8840a783d7c43b4c8ff4f56748b617935a61fbc8edb7b73d55335e2ad87
---

# 创建子网 (Kube-OVN 下层网络)

在 Kube-OVN 下层网络中创建子网，不仅能够实现对资源的更精细的网络隔离，还能够提供更好的性能体验。

**注意**：Kube-OVN 下层中的容器网络需要物理网络的支持。请参阅最佳实践 [准备 Kube-OVN 下层物理网络](../how_to/kubeovn_underlay_py.mdx)，以确保网络连通性。

## IP 分配规则

**注意**：如果一个项目或命名空间被分配了多个子网，将随机使用对应子网中的一个 IP 地址。

- 项目分配：

  - 如果项目没有绑定到子网，则该项目下所有命名空间中的 Pods 只能使用默认子网中的 IP 地址。如果默认子网中没有足够的 IP 地址，Pods 将无法启动。
  - 如果项目绑定了子网，则该项目下所有命名空间中的 Pods 只能使用该子网中的 IP 地址。

- 命名空间分配：

  - 如果命名空间没有绑定到子网，则该命名空间中的 Pods 只能使用默认子网中的 IP 地址。如果默认子网中没有足够的 IP 地址，Pods 将无法启动。
  - 如果命名空间绑定了子网，则该命名空间中的 Pods 只能使用该子网中的 IP 地址。

## 使用说明

在 Kube-OVN 下层网络中创建子网的一般流程为：添加桥接网络 > 添加 VLAN > 创建子网。

## （可选）添加桥接网络 {#kube-ovn_underlay_bridge_network}

桥接网络是指一个桥接网络，在将网络卡绑定到桥接后，可以转发容器网络流量，实现与物理网络的互通。

### 步骤

1. 导航到 **平台管理**。

2. 在左侧导航栏中，点击 **网络管理** > **桥接网络**。

3. 点击 **添加桥接网络**。

4. 根据以下说明配置相关参数。

   **注意**：

   - *目标容器组* 指的是在当前节点上调度的所有容器组或绑定到特定子网的命名空间中调度到当前节点的容器组。这取决于桥接网络下子网的作用范围。

   - 下层子网中的节点必须具有多个网络卡，且桥接网络使用的网络卡必须专门分配给下层，不能承载其他流量，如 SSH。例如，如果桥接网络有三个节点计划使用 eth0、eth0、eth1 专用于下层，则默认网络卡可以设置为 eth0，节点三的网络卡可以设置为 eth1。

   | 参数                                | 描述                                                                                                                                                                                                                                                                                                                                                                      |
   | ------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **默认网络卡名称**                    | 默认情况下，目标容器组将使用该网络卡作为桥接网络卡以实现与物理网络的互通。                                                                                                                                                                                                                                                                                                |
   | **按节点配置网络卡**                 | 配置节点上的目标容器组将桥接到指定的网络卡，而不是默认网络卡。                                                                                                                                                                                                                                                                                                          |
   | **排除节点**                          | 当排除节点时，所有调度到这些节点的容器组将不会与这些节点上的任何网络卡进行桥接。<br /><br />**注意**：在排除节点上的容器组将无法与物理网络或跨节点容器网络进行通信，应避免将相关容器组调度到这些节点。                                                                                                   |

5. 点击 **添加**。

## （可选）添加 VLAN

平台预配置了 **ovn-vlan** 虚拟局域网，它将连接到 **provider** 桥接网络。您还可以配置新的 VLAN 以连接到其他桥接网络，从而实现 VLAN 之间的网络隔离。

### 步骤

1. 导航到 **平台管理**。

2. 在左侧导航栏中，点击 **网络管理** > **VLAN**。

3. 点击 **添加 VLAN**。

4. 根据以下说明配置相关参数。

   | 参数                | 描述                                                                                      |
   | ------------------- | ----------------------------------------------------------------------------------------- |
   | **VLAN ID**         | 此 VLAN 的唯一标识符，用于区分不同的虚拟局域网。                                          |
   | **桥接网络**       | VLAN 将连接到此桥接网络以与物理网络进行互通。                                            |

5. 点击 **添加**。

## 创建子网并分配项目或命名空间

**注意**：该平台同样预配置了一个 **join** 子网，用于节点和容器组之间在 Overlay 传输模式下的通信。此子网在下层传输模式下不会使用，因此避免 **join** 和其他子网之间的 IP 段冲突至关重要。

### 步骤

1. 导航到 **平台管理**。

2. 在左侧导航栏中，点击 **网络管理** > **子网**。

3. 点击 **创建子网**。

4. 根据以下说明配置相关参数。

   | 参数           | 描述                                                                                                                                                                  |
   | -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **VLAN**       | 子网所属的 VLAN。                                                                                                                                                     |
   | **子网**       | 将子网分配给项目或命名空间后，物理子网中的 IP 将随机分配用于容器组。                                                                                                |
   | **网关**       | 上述子网中的物理网关。                                                                                                                                              |
   | **保留的 IP**  | 指定的保留 IP 不会被自动分配。例如，可以将其用作计算组件的 **固定 IP**。                                                                                          |

5. 点击 **确认**。

6. 在子网详细信息页面，选择 **操作** > **分配项目** / **命名空间**。

7. 完成配置后，点击 **分配**。

## 相关操作

当集群中同时存在下层和上层子网时，可以根据需要配置 [下层与上层子网之间的自动互通](../how_to/underlay_overlay_st.mdx)。
