---
weight: 10
sourceSHA: 9d2c1909d083171ab600ba48f7ff0457e5d9b43affea2efd042d5ebad28beaf7
---

# TCP/HTTP 保持连接

## 基本概念

1. ALB 支持在端口级别进行保持连接配置。该配置可以在前端进行。

2. 保持连接只在 **客户端与 ALB 之间，而不是 ALB 与后端之间** 实现。

3. 该功能通过 Nginx 配置实现，并且当配置发生变化时，Nginx **需要并会自动重载**。

4. TCP 保持连接和 HTTP 保持连接是两个不同的概念：
   1. **TCP 保持连接** 是 TCP 协议的一个特性，在没有数据传输时定期发送探测数据包，以检查连接是否仍然存活。它有助于检测并清理死连接。
   2. **HTTP 保持连接**（也称为持久连接）允许多个 HTTP 请求复用同一 TCP 连接，从而避免建立新连接的开销。这通过减少延迟和资源使用提高了性能。

## CRD

```yaml
keepalive:
  properties:
    http:
      description: 下游 L7 保持连接
      properties:
        header_timeout:
          description: 保持连接头超时。默认未设置。
          type: string
        requests:
          description: 保持连接请求。默认值为 1000。
          type: integer
        timeout:
          description: 保持连接超时。默认值为 75s。
          type: string
      type: object
    tcp:
      description: TCPKeepAlive 定义 TCP 保持连接参数（SO_KEEPALIVE）
      properties:
        count:
          description: TCP_KEEPCNT 套接字选项。
          type: integer
        idle:
          description: TCP_KEEPIDLE 套接字选项。
          type: string
        interval:
          description: TCP_KEEPINTVL 套接字选项。
          type: string
      type: object
  type: object
```

只能在 Frontend `.spec.config.keepalive` 配置。
