# 如何标注第三方存储能力

随着公有云和私有云使用场景的不断增加，第三方存储的需求也日益增长。通过对第三方存储能力进行标注，平台能够自动识别并展示存储类支持的能力，方便用户选择和使用。

---

### 步骤一：进入存储类配置页面

1. 打开平台管理界面。
2. 在左侧导航栏选择 **存储管理** > **存储类**。
3. 点击 **创建存储类** 开始配置新的存储类。

---

### 步骤二：填写存储类信息

| 参数名            | 描述                                 |
|------------------|--------------------------------------|
| **名称**         | 存储类的名称。                      |
| **存储类**       | 选择或定义存储类的标识。            |
| **Provisioner**  | 填写所使用存储插件的 Provisioner 名。|

---

### 步骤三：通过 ConfigMap 标注存储能力

为了让平台识别并展示存储能力，需要在 `kube-public` 命名空间中创建一个 ConfigMap，格式如下：

#### 示例 YAML：

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: sd-built-in
  namespace: kube-public
  labels:
    features.alauda.io/type: StorageDescription
data:
  storage.type1.com: |-
    type: Filesystem
    volumeMode:
    - Filesystem
    accessModes:
    - ReadWriteOnce
    - ReadWriteMany
    - ReadWriteOncePod
  storage.type2.com: |-
    type: Filesystem
    snapshot: true
    volumeMode:
    - Filesystem
    - Block
    accessModes:
    - ReadWriteOnce
    - ReadOnlyMany
    - ReadWriteOncePod
```

#### 注意事项：

- **metadata.name**：必须以 `sd-` 开头，例如：`sd-configmap1`。
- **metadata.namespace**：必须为 `kube-public`。
- **metadata.labels**：必须包含标签 `features.alauda.io/type = StorageDescription`。
- **data**：
  - 每个键（key）对应一个 Provisioner。
  - 每个值（value）为 YAML 字符串，描述该 Provisioner 支持的存储能力。

---

### 步骤四：支持的存储能力字段说明

| 能力类别     | 字段名        | 可选值                                                                                          | 默认值       | 说明                                                                                   |
|--------------|---------------|--------------------------------------------------------------------------------------------------|--------------|----------------------------------------------------------------------------------------|
| 类型         | `type`        | `Filesystem`、`Block`                                                                          | —            | 未配置或配置值不合法时，类型将显示为未知。                                           |
| 快照支持     | `snapshot`    | `true`、`false`                                                                                 | `false`      | 如果为 `false` 或值不合法，则无法通过表单创建卷快照。                                 |
| 卷模式       | `volumeMode`  | `Filesystem`、`Block`                                                                          | `Filesystem` | 使用 `Block` 模式时，PVC 不支持挂载为目录。                                            |
| 访问模式     | `accessModes` | `ReadWriteOnce`、`ReadOnlyMany`、`ReadWriteMany`、`ReadWriteOncePod`                          | —            | 未配置或值非法时，表单中将无法选择访问模式。`ReadWriteOncePod` 当前不支持表单选择。 |

---

### 步骤五：完成存储类创建

配置完成后，点击 **创建** 保存存储类。平台将根据 `Provisioner` 字段，自动匹配对应 ConfigMap 并添加存储能力标注。

---

### 可选操作：创建 PVC（持久卷声明）

当使用 **表单方式** 创建 PVC 且选择了已被标注的存储类时，表单中只能选择 ConfigMap 中已定义的能力，不支持的选项将不会显示。

