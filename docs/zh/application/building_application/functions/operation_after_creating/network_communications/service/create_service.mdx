---
weight: 10
---

# 创建 Service



内部路由（Kubernetes Service）可用于计算组件的服务发现，即提供了统一的 IP 地址或主机端口用于访问计算组件。

## 操作步骤

1. 进入 **Container Platform**。

1. 在左侧导航栏中，单击 **网络** > **内部路由**。

4.  单击 **创建内部路由**。

5. 参考以下说明，配置相关参数。

    |参数| 说明                                                         |
    | ------------ | ------------------------------------------------------------ |
    | **虚拟 IP**  | 若开启，将为内部路由分配一个集群内部的 IP 地址（ClusterIP），可用于集群内部的服务发现。<br/>若关闭，将创建 Headless Service（无头服务），在通常情况下 **有状态副本集**（StatefulSet）可使用该功能。 |
    | **外网访问** | 若 **虚拟 IP** 开启：<ul><li>**不启用**：不对外暴露端口，使用 ClusterIP 模式在仅集群内部提供 IP 地址。</li><li>**NodePort**：在各个计算节点主机上开放一个固定端口（NodePort），通过该端口对外暴露内部路由，集群外部可通过 `<NodeIP>:<NodePort>` 访问该 Service 指向的后端服务。同时分配一个集群内部 IP 地址，提供内部服务发现。</li><li>**LoadBalancer**：使用负载均衡器为后端服务转发流量。LoadBalancer 类型的路由流量仅支持使用同一传输层协议，例如传输层使用 TCP 协议，则支持的流量协议有 HTTP、HTTPS、gRPC 等。当使用公有云集群时，可参考 [LoadBalancer 类型内部路由注解说明](./annotation.mdx) 按需增加注解。</li></ul><br/>若 **虚拟 IP** 关闭：默认选择不启用且不支持修改，平台将创建 Headless Service（无头服务），在通常情况下 **有状态副本集**（StatefulSet）可使用该功能。|
    | **目标组件** | <ul><li>**计算组件**：内部路由会将请求转发到**某个**指定的计算组件，也即通过类似 `project.cpaas.io/name: projectname` 和 `service.cpaas.io/name: deployment-name` 标签匹配计算组件</li><br/><li>**虚拟化**：内部路由会将请求转发到**某个**指定的虚拟机或虚拟机组。</li><br/><li>**标签选择器**：内部路由会将请求转发到**某类**具有指定标签的计算组件，例如 `environment: release`。</li></ul>|
    | **端口**     | 用于配置内部路由的访问策略。以下示例中，集群内的其他容器组可通过虚拟 IP （如果开启）和 TCP 端口 *80* 来调用此内部路由；访问请求将被转发到目标组件中容器组对外暴露的 TCP 端口 *6379* 或 *redis* 。<ul><li>**协议**：内部路由使用的协议，支持的协议有：`TCP`、`UDP`、`HTTP`、`HTTP2`、`HTTPS`、`gRPC`。</li><li>**服务端口**：内部路由在集群内部暴露的服务端口号， 即 Port。例如 *80* 。</li><li>**容器端口**：服务端口映射的目标端口号（或名称），即 targetPort。例如 *6379* 或 *redis* 。</li><li>**服务端口名称**：将自动生成。格式为 `<协议>-<服务端口>-<容器端口>`，例如：*tcp-80-6379* 或 *tcp-80-redis* 。</li></ul> |
    | **会话保持** | 基于源 IP 地址（ClientIP）的会话保持。若开启，同一 IP 地址的所有访问请求在做负载均衡时都会被保持到同一服务端上，保证来自相同客户端的请求会被转发至相同的服务端进行处理。 |  

8. 单击 **创建**。


## 相关操作

您可以在列表页面单击右侧的 ⋮ 或在详情页面单击右上角的 **操作**，按需更新或删除内部路由。

* 名称旁边带有 **灰度发布** 标签的内部路由，是结合 Service Mesh 平台为应用创建灰度发布后自动在 Container Platform 生成的用于灰度发布的内部路由。该类内部路由仅支持查看，不支持更新或删除。

* 删除内部路由后，将导致关联该内部路由的入站规则不可用，最终导致无法实现计算组件的服务发现和访问。
