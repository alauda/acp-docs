---
weight: 20
sourceSHA: 07f87ebe8037f6f01a1c423055f194355b76e1c4d60ef780ded23e6d6639cea0
---

# 升级前准备

## 升级前的重要说明

- 支持升级的平台版本：`3.16.0`、`3.16.1`、`3.16.2`、`3.18.0`、`3.18.1`。
  在升级之前，请确保您当前的平台版本在此支持范围内。

- 所有集群的 **Kubernetes 版本** 必须至少为 **1.28**。
  如果任何集群低于此版本，请先升级其 Kubernetes 版本。

- 如果平台中有集群使用平台提供的 **服务网格**，请确保其 **Istio 版本为 1.20 或更高**。否则，请在继续之前升级服务网格。

- 检查平台中是否有集群安装了 **CostManager** 或 **Kubecost** 插件。这些插件在 **4.0 版本中已被弃用**，必须在升级之前卸载。

- 如果您的平台版本为 `3.16`，并且任何集群安装了 **ClickHouse 日志存储插件**，请在 **升级之前** 卸载它。升级完成后，再重新安装该插件。

- 确保 **全球集群的控制平面节点** 上的 `/cpaas/minio` 目录至少有 **120 GB** 的可用空间。
  如果没有，请在继续之前扩展存储。

- 在升级过程中，升级包必须 **复制到全球集群的任何控制平面节点** 并进行解压。
  如果升级包和解压路径在同一磁盘上，请确保该磁盘有 **至少 250 GB** 的可用空间。

- 当将集群的 **Kubernetes 版本升级到 1.31 或更高** 时，所有运行中的 Pods 将会 **重启**。这种行为是由于 Kubernetes 1.31 中引入的 PodSpec 字段的变化，无法避免。有关更多详细信息，请参阅 Kubernetes 问题报告：[#129385](https://github.com/kubernetes/kubernetes/issues/129385)。

- 从 **4.0 版本** 开始，使用 **全球 DR（灾难恢复）** 解决方案的集群的升级过程已发生变化。请参阅 [全球 DR 操作步骤](./upgrade_global_cluster.mdx#global_dr) 以获取新操作步骤。

## 准备操作步骤

<Steps>
  ### 运行检查清单

  联系技术支持以获取 **检查清单脚本**，并在目标平台上运行该脚本以验证准备情况。

  ### 下载升级包

  对于从版本 `3.16` 或 `3.18` 升级到 `4.0` 的平台，**升级包与安装包相同**。
  请参阅 [下载安装包](../install/prepare/download.mdx) 获取说明。
</Steps>
