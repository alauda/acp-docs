---
weight: 30
sourceSHA: 0a01c9b5a80e4bac698e98bd6964cfea8ee59cca61bfe7e8df201bc0fb21414d
---

# 接入存储服务

接入存储服务支持两种接入方式：首先，接入平台内其他业务集群的分布式存储资源，以确保存储与业务的隔离，从而便于管理和维护；其次，连接外部 Ceph 存储资源以进行分布式存储使用。

## 前提条件

### 准备存储

请选择以下任意一种方式：

- 已在其他业务集群中部署分布式存储并创建了存储池。请记录存储池的名称，以便后续接入使用。

- 已创建外部 Ceph 存储（版本 ≥ 14.2.3），并建立了存储池。请记录存储池的名称，以便后续接入使用。

### 开放端口

| 目的 IP          | 目的端口                  | 源 IP                          | 源端口  |
| :--------------- | :------------------------ | :----------------------------- | :------: |
| Ceph 节点的 IP  | 3300, 6789, 6800-7300, 7480 | 业务集群中所有节点的 IP      | any     |

### 获取认证信息（外部 Ceph）

如果准备的存储是外部 Ceph 存储，需要通过以下命令获取认证信息。

| 参数                     | 获取方式                                                                                                                                                       |
| :---------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **FSID**                | `ceph fsid`                                                                                                                                                 |
| **MON 组件信息**       | `ceph mon dump`<br />需为 \{name= IP\} 格式，例如 *a=192.168.100.100:6789* 。                                                                              |
| **Admin Key**           | `ceph auth get-key client.admin`                                                                                                                            |
| **存储池**              | <ul><li>文件存储：使用 `ceph fs ls` 命令获得的 `name` 值。</li><li>块存储：`ceph osd dump` \| `grep "application rbd"` \| `awk '{print $3}'` </li></ul> |
| ***数据存储池***       | （仅文件存储需要）使用 `ceph fs ls` 命令获得的 `data pools` 值。                                                                                          |

## 操作步骤

**说明**：以下步骤以 **接入外部 Ceph 存储** 为例，接入分布式存储的操作类似。

<Steps>
  1. 在左侧导航栏中，单击 **存储管理** > **分布式存储**。

  2. 单击 **接入存储**。

  3. 在 **接入配置** 向导页面中，选择 **外部 Ceph**。

     | 参数                     | 说明                                                                                                                                                                                                                                                       |
     | :------------------------ | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
     | **快照**                 | 开启后，支持创建 PVC 快照并使用快照快速配置新 PVC 以备份和恢复业务数据。<br />如果在接入存储时未开启快照，您仍可以在存储集群详细信息页面的 **操作** 部分根据需要后续开启。<br />**注意**：使用前请确保已为当前集群 [部署了卷快照插件](/configure/storage/functions/snapshot_con.mdx)。               |
     | **网络配置**             | <ul><li>**主机网络**：本集群中的计算组件将使用 **主机网络** 访问 **存储集群**。</li><li>**容器网络**：本集群中的计算组件将使用 **容器网络** 访问 **存储集群**。您可以在网络管理中创建子网并将其分配到 `rook-ceph` 命名空间。如果不指定，则使用默认子网。</li></ul>                        |
     | **其他参数**             | 请填写在前提条件中获取的外置 Ceph 认证参数。                                                                                                                                                                                                          |

  4. 在 **创建存储类** 向导页面中，完成配置并单击 **接入**。

     | 参数                     | 说明                                                                                                                                                     |
     | :------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------- |
     | **类型**                 | 根据前述创建的存储池类型，将默认对应存储类： <ul><li>文件存储：CephFS 文件存储</li><li>块存储：CephRBD 块存储</li></ul>                                                                               |
     | **回收策略**             | 持久卷的回收策略。 <ul><li>删除：当持久卷声明被删除时，绑定的持久卷也将被删除。</li><li>保留：即使持久卷声明被删除，被绑定的持久卷仍将被保留。</li></ul>                           |
     | **分配项目**              | 可以使用此类型存储的项目。 <br />如果当前没有项目需要此类存储，您可以暂时不分配项目，并在后续更新时进行分配。                                                                                                     |

  5. 等待大约 1-5 分钟以完成接入。
</Steps>

## 后续操作

- 创建存储类：[CephFS 文件存储](/configure/storage/functions/cephfs_storageclass.mdx), [CephRBD 块存储](/configure/storage/functions/cephrbd_storageclass.mdx)

- 使用上述存储类创建持久卷声明的开发人员可以通过卷快照和扩容功能进行扩展使用。

**说明**：如果需要维护外部存储的存储池、存储设备配置等，操作必须在存储集群的管理平台进行。
