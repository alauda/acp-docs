---
weight: 30
---


# 接入存储服务


接入存储服务支持两种接入方式：一是接入平台内其他业务集群的分布式存储资源，确保存储和业务隔离便于管理和维护；二是将外置 Ceph 存储资源接入为分布式存储使用。


## 前提条件

### 准备存储

任选其一：

* 已在其他业务集群中部署了 [分布式存储](../installation/create_service_stand.mdx) ，并创建存储池。请记录存储池的名称，以便后续对接使用。

* 已有平台以外的 [外置 Ceph 存储](https://docs.ceph.com/en/pacific/rados/)（版本 ≥ 14.2.3），并创建存储池。请记录存储池的名称，以便后续对接使用。


### 开放端口



|目的 IP| 目的端口 | 源 IP | 源端口 |
|:---  | :---    | :---  | :---: |
|Ceph 节点的 IP| 3300, 6789, 6800-7300, 7480 | 业务集群所有节点的 IP | any |


### 获取认证信息（外置 Ceph）

如果准备的是外置 Ceph 存储，还需要通过以下命令获取认证信息。


|参数| 获取方式                                                     |
|:--------------- | :------------------------------------------------------------ |
|**FSID**| `ceph fsid`                                                  |
|**MON 组件信息**| `ceph mon dump`<br/>需为 \{名称= IP\} 格式，例如 *a=192.168.100.100:6789* 。                      |
|**admin 的 key 值**| `ceph auth get-key client.admin`                             |
|**存储池**| <ul><li> 文件存储：使用 `ceph fs ls` 命令得到的 `name` 取值。</li><li> 块存储：`ceph osd dump` \| `grep "application rbd"` \| `awk '{print $3}'`  </li></ul>|
|***数据存储池***| （仅文件存储需要）使用 `ceph fs ls` 命令得到的 `data pools` 取值。 |


## 操作步骤

**说明**：以下步骤以 **接入外置 Ceph 存储** 为例，接入分布式存储的操作类似。

<Steps>

1. 在左侧导航栏中，单击 **存储管理** > **分布式存储**。

3. 单击 **接入存储**。

3.  在 **接入配置** 向导页中，选择 **外置 Ceph**。

    |参数| 说明                                                         |
    |:-------- |:------------------------------------------------------------ |
    | **快照** | 开启后，支持创建 PVC 快照并使用快照配置新的 PVC，以快速备份恢复业务数据。<br/>若接入存储时未开启快照，您仍可以在存储集群详情页面的 **操作** 中按需开启。<br/>**注意**：使用前请确保已为当前集群 [部署卷快照插件](/configure/storage/functions/snapshot_con.mdx)。| 
    | **网络配置** | <ul><li>**主机网络**：本集群中的计算组件将使用 **主机网络** 访问 **存储集群**。</li><li>**容器网络**：本集群中的计算组件将使用 **容器网络** 访问 **存储集群**，您可在网络管理中创建子网并将子网分配至 `rook-ceph` 命名空间。若为空，则使用默认子网。</li></ul> |
    |**其他参数**| 请填写前提条件中获取的外置 Ceph 认证参数信息。|
    
3.  在 **创建存储类** 向导页中，完成配置，单击 **接入**。

    |参数| 说明                                                         |
    | :-------- | :------------------------------------------------------------ |
    | **类型** | 根据前述创建的存储池类型，将默认对应存储类：<ul><li>文件存储：CephFS 文件存储</li><li> 块存储：CephRBD 块存储 </li></ul>|
    | **回收策略**   | 持久卷的回收策略。<ul><li> 删除：删除持久卷声明的同时，也会删除绑定的持久卷。</li><li> 保留：即使删除持久卷声明，其绑定的持久卷仍会被保留。</li></ul>|
    | **分配项目**   | 可使用此类型存储的项目。<br/>如果暂时没有项目需要使用此类型存储，您也可先不分配项目，后续再更新项目。 |

4. 等待大约 1-5 分钟，接入成功。

</Steps>

## 后续操作

* 创建存储类：[CephFS 文件存储](/configure/storage/functions/cephfs_storageclass.mdx) 、[CephRBD 块存储](/configure/storage/functions/cephrbd_storageclass.mdx) 

* 开发人员在使用以上存储类创建持久卷声明时，可扩展使用卷快照及扩容等功能。

**说明**：如果需要维护外部存储的存储池、存储设备等配置，需在存储集群的管理平台操作。


