---
weight: 30
---

# 创建子网（Kube-OVN Underlay 网络）


在 Kube-OVN Underlay 网络中创建子网，不仅能实现资源更细粒度的网络隔离，还可获得更佳性能体验。

**说明**：Kube-OVN Underlay 传输方式下容器网络需要依赖物理网络支持，请参考最佳实践 [准备 Kube-OVN Underlay 物理网络](/networking/subnet/how_to/kubeovn_underlay_py.mdx)，确保网络连通性。

## IP 分配规则
 
**说明**：若一个项目或命名空间被分配了多个子网，则会随机使用其中一个子网中的 IP 地址。

* 分配项目：

    - 若项目未绑定子网，则该项目下所有命名空间中的 Pod 只能使用默认子网中的 IP 地址。若默认子网中的 IP 地址不足，Pod 将无法启动。
    - 若项目已绑定子网，则该项目下所有命名空间中的 Pod 只能使用该子网中的 IP 地址。

* 分配命名空间：

    - 若命名空间未绑定子网，则该命名空间下的 Pod 只能使用默认子网中的 IP 地址。若默认子网中的 IP 地址不足，Pod 将无法启动。
    - 若命名空间已绑定子网，则该命名空间下的 Pod 只能使用该子网中的 IP 地址。


## 使用须知

在 Kube-OVN Underlay 网络中创建子网的一般流程为：添加桥接网络 > 添加 VLAN > 创建子网。

## （可选）添加桥接网络

桥接网络即网桥，将网卡绑定到网桥后，即可转发容器网络流量，实现与物理网络的互通。


### 操作步骤

1. 进入 **平台管理**。

1. 在左侧导航栏中，单击 **网络管理** > **桥接网络**。

2. 单击 **添加桥接网络**。

3. 参考以下说明配置相关参数。

    **说明**：
    
    * *目标容器组* 指调度到当前节点上所有容器组，或调度到当前节点且绑定了特定子网的命名空间下的容器组。具体视桥接网络下属子网的作用范围而定。

    * Underlay 子网的节点必须为多网卡，且桥接网络使用的网卡需被 Underlay 独占，不可再承载其他流量，如 SSH。例如：桥接网络有三个节点，分别规划 eth0、eth0、eth1 供 Underlay 子网独占使用，则可以设置默认网卡为 eth0，节点三网卡为 eth1。

    |参数| 说明                                                         |
    | -------------- | ------------------------------------------------------------ |
    |**默认网卡名称**| 默认情况下，目标容器组将以此作为桥接网卡，实现与物理网络互通。 |
    |**按节点配置网卡**| 所配置节点上的目标容器组将会桥接到指定网卡，而非默认网卡。 |
    |**排除节点**| 排除节点后，调度到此节点上的所有容器组都不会桥接到此节点上的任何网卡。<br/><br/>**注意**：排除节点上的容器组将无法与物理网络或跨节点容器网络通信，应避免有相关需求的容器组被调度到此节点。 |

    

2. 单击 **添加**。


## （可选）添加 VLAN

平台预置了一个 **ovn-vlan** 虚拟局域网，此 VLAN 将连接到 **provider** 桥接网络。您也可配置新的 VLAN 连接其他桥接网络，各 VLAN 间将实现网络隔离。

### 操作步骤

1. 进入 **平台管理**。

1. 在左侧导航栏中，单击 **网络管理** > **VLAN**。

2. 单击 **添加 VLAN**。

3. 参考以下说明配置相关参数。

    |参数| 说明                                                         |
    | -------------- | ------------------------------------------------------------ |
    |**VLAN ID**| 此 VLAN 的唯一标识，将用于划分不同的虚拟局域网。 |
    |**桥接网络**| VLAN 将连接到此桥接网络，实现与物理网络互通。 |

2. 单击 **添加**。


## 创建子网并分配项目或命名空间

**说明**：平台还预置了一个 **join** 子网用于 Overlay 传输模式的节点与容器组间通信。Underlay 传输模式下将不会用到此子网，只需避免 **join** 与其他子网的网段冲突。

### 操作步骤

1. 进入 **平台管理**。

1. 在左侧导航栏中，单击 **网络管理** > **子网**。
    
2. 单击 **创建子网**。

3. 参考以下说明配置相关参数。


    |参数|    说明      |
    | ---   |  ---  |
    |**VLAN**| 子网所属的 VLAN。 |
    |**网段**| 将子网分配给项目或命名空间后，此物理网段内 IP 将被随机分配给容器组使用。|
    |**网关**| 上述网段内的物理网关。 |
    |**保留 IP**| 设置的保留 IP 将不会被自动分配。例如可将其用做计算组件 **固定 IP** 的 IP。|
    
1. 单击 **确定** 。
2.  在子网详细信息页，选择 **操作** > **分配项目** / **命名空间**。
3. 完成配置并单击 **分配**。


## 相关操作

当一个集群同时存在 Underlay 和 Overlay 子网时，您可以按需配置 [Underlay 和 Overlay 子网自动互通](/networking/subnet/how_to/underlay_overlay_st.mdx)。







