---
weight: 10
---

# 创建子网（Calico 网络）

在 Calico 网络中创建子网，实现集群下资源更细粒度的网络隔离。

## 约束与限制

在 IPv6 集群环境中，Calico 网络中创建子网默认采用 VXLAN 封装方式，VXLAN 封装需要开放的端口与 IPIP 封装不同，您需要确保 UDP 4789 端口已开放。

## IP 分配规则

**说明**：若一个项目或命名空间被分配了多个子网，则会随机使用其中一个子网中的 IP 地址。

* 分配项目：

    - 若项目未绑定子网，则该项目下所有命名空间中的 Pod 只能使用默认子网中的 IP 地址。若默认子网中的 IP 地址不足，Pod 将无法启动。
    - 若项目已绑定子网，则该项目下所有命名空间中的 Pod 只能使用该子网中的 IP 地址。

* 分配命名空间：

    - 若命名空间未绑定子网，则该命名空间下的 Pod 只能使用默认子网中的 IP 地址。若默认子网中的 IP 地址不足，Pod 将无法启动。
    - 若命名空间已绑定子网，则该命名空间下的 Pod 只能使用该子网中的 IP 地址。


## 创建子网并分配项目或命名空间

1. 进入 **平台管理**。

1. 在左侧导航栏中，单击 **网络管理** > **子网**。
    
2. 单击 **创建子网**。

3. 参考以下说明配置相关参数。
    
    |参数|    说明      |
    | ---   |  ---  |
    | **网段** |  将子网分配给项目或命名空间后，命名空间中的容器组将随机使用此网段内 IP 地址进行通信。<br/>**说明**：CIDR 和 BlockSize 的对应关系请参考 [参考内容](#1)。|
    | **封装协议** | 选择封装协议，双栈模式下不支持 **IPIP**。<ul><li>**IPIP**：使用 IPIP 协议实现跨网段通信。</li><li>**VXLAN (Alpha)**：使用 VXLAN 协议实现跨网段通信。</li><li>**不封装**：仅通过路由转发直连。</li></ul>|
    | **封装模式** | 封装协议为 **IPIP** 或 **VXLAN** 时需设置封装模式，默认为 **Always**。<br/><ul><li>**Always**：总是启用 IPIP / VXLAN 隧道。</li><li>**Cross Subnet**：当宿主机处于不同子网时，才启用 IPIP / VXLAN 隧道；宿主机处于相同子网时，仅通过路由转发直连。</li></ul>|
    | **外出流量 NAT** |  选择是否开启外出流量 NAT（Network Address Translation，网络地址转换），默认为开启。<br/>主要用于设置子网内容器组访问外网时，向外网暴露的访问地址。<br/>开启外出流量 NAT 后，将会使用主机 IP 作为当前子网内容器组的访问地址；不开启时，将会直接将子网内的容器组IP 暴露给外网。 |

1. 单击 **确定** 。
2.  在子网详细信息页，选择 **操作** > **分配项目** / **分配命名空间**。
3. 完成配置并单击 **分配**。


## 参考内容\{#1}

CIDR 和 blockSize 的动态匹配关系参见下表。

|CIDR| blockSize 大小 | 主机个数 | 单个 IP 池大小 |
| ---------- | ------------ | ------- | ----------- |
|`前缀<=16`| 26            | 1024+    | 64           |
|`16<前缀<=19`| 27            | 256~1024 | 32           |
|`前缀=20`| 28            | 256      | 16           |
|`前缀=21`| 29            | 256      | 8            |
|`前缀=22`| 30            | 256      | 4            |
|`前缀=23`| 30            | 128      | 4            |
|`前缀=24`| 30            | 64       | 4            |
|`前缀=25`| 30            | 32       | 4            |
|`前缀=26`| 31            | 32       | 2            |
|`前缀=27`| 31            | 16       | 2            |
|`前缀=28`| 31            | 8        | 2            |
|`前缀=29`| 31            | 4        | 2            |
|`前缀=30`| 31            | 2        | 2            |
|`前缀=31`| 31            | 1        | 2            |

**说明**：不支持前缀超过 31 的子网配置。
