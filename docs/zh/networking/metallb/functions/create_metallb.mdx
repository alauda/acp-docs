---
weight: 10
---

# 创建外部地址池
外部地址池是一组 IP 的集合，MetalLB 从外部地址池中获取 IP 为 LoadBalancer 类型内部路由提供外网访问 IP。

## 前提条件

若需使用 BGP 类型的外部地址池，请联系管理员开启相关功能。

## 约束与限制

外部地址的 IP 资源需要满足以下条件：

* 外部地址池 L2 模式下与可用节点是二层互通的。

* 可直接被平台使用，不能包含已被物理网络使用的 IP，如网关 IP。

* 不能与集群使用的网络重叠，包含 Cluster CIDR、Service CIDR、子网等。

* 双栈环境下，请确保同一外部地址池内同时存在 IPv4 及 IPv6 地址且数量均大于 0，否则双栈的 LoadBalancer 类型内部路由将无法获取外部访问地址。

* 在 IPv6 环境中，节点的 DNS 必须支持 IPv6，否则 MetalLB 插件无法部署成功。


## 部署 MetalLB 插件

使用外部地址池依赖于 MetalLB 插件。

### 操作步骤

1. 进入 **平台管理**。

1. 在左侧导航栏中，单击 **集群管理** > **集群**。

2. 单击待部署插件的 ***集群名称***。

3. 在 **插件** 页签下，单击 **MetalLB** 右侧的 ⋮ > **部署**。

5. 等待部署状态为 **部署成功** 后完成部署。

## 创建外部地址池

 1. 进入 **平台管理**。

1. 在左侧导航栏中，单击 **网络管理** > **外部地址池**。

3. 单击 **创建外部地址池**。
    
4. 参考以下说明，配置部分参数。

    |参数| 说明                                                         |
    | -------- | ------------------------------------------------------------ |
    |**类型**|<ul><li>L2：基于 MAC 地址进行通信和转发，适用于需要简单、快速二层交换的小规模或局域网络，优势在于配置简单、低延迟。</li><li>BGP（Alpha）：基于 IP 地址进行路由和转发，使用 BGP 协议交换路由信息，适用于需要复杂路由、跨多自治系统的大规模网络，优势在于高扩展性和高可靠性。</li></ul>|
    | **IP 资源** | 支持以 CIDR 和 IP 段的形式输入，单击 **添加** 支持输入多个，示例如下：<br/>**CIDR**：`192.168.1.1/24`。<br/>**IP 段**：`192.168.2.1` ~ `192.168.2.255`。  |
    | **可用节点**    | 在 L2 模式中，可用节点是用于承载所有 VIP 流量的节点；在 BGP 模式中，可用节点是用于承载 VIP、与 BGP 对等体建立 BGP 连接、对外宣告路由的节点。<ul><li><b>节点名称</b>：根据节点名称选择可用节点。</li><li><b>标签选择器</b>：根据标签选择可用节点。</li><li><b>显示节点详情</b>：通过列表的形式查看最终的可用节点。</li></ul><b>注意</b>：<ul><li>当使用 BGP 类型时，可用节点即为下一跳节点，需确保选择的可用节点是 [BGP 连接节点](./create_bgppeer.mdx) 的子集。</li><li>可单独配置标签选择器或节点名称来选择可用节点；若同时配置这两者，则最终可用节点为二者的交集。</li></ul>|
    |**BGP 对等体**|选择 BGP 对等体，具体配置请参考 [BGP 对等体](./create_bgppeer.mdx)。|

5. 单击 **创建**。

## 查看告警策略

1. 进入 **平台管理**。

1. 在左侧导航栏中，单击 **网络管理** > **外部地址池**。

3. 单击页面右上角 **查看告警策略**，可查看 MetalLB 通用告警策略。
