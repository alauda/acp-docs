---
weight: 10
i18n:
  title:
    en: Prerequisites
    zh: 前置条件
sourceSHA: b32e641939704baf8afc6959d53d72a85106f89505f425e38ad6e4513048157a
---

# 前置条件

在安装 `global` 集群之前，您需要准备满足要求的硬件、网络和操作系统。

:::info
该平台目前不支持在现有 Kubernetes 环境中直接安装 `global` 集群。如果您的环境中已经有 Kubernetes 集群，请在安装前备份数据并清理环境。
:::

## 容量规划 \{#scale}

在安装之前，您必须根据目标和实际需求选择合适的安装场景。不同的场景在基础设施资源配置和架构设计要求上有显著差异。以下是针对三种典型场景的规划建议：

<Tabs>
  <Tab label="功能验证">
    **应用范围**
    适用于平台功能验证、演示或技术可行性测试。该场景仅用于验证平台的核心功能，不承载生产级应用流量。资源配置处于最低水平。

    **资源配置要求**

    | 维度            | 规格要求                                   |
    | --------------- | ------------------------------------------- |
    | 节点数量        | 1（物理机或虚拟机）                        |
    | CPU             | ≥16 核                                     |
    | 内存            | ≥32GB                                      |

    **架构描述**

    - **一体化**：集群仅有一个节点，所有控制平面组件和应用都运行在该节点上。
    - **轻量负载**：最多仅支持 10 个 Pods 的演示应用。
    - **非生产用途**：不支持水平扩展，不满足应用连续性和高可用性要求。
  </Tab>

  <Tab label="ISV 集成交付">
    **应用范围**
    适用于 ISV（独立软件供应商）的标准化交付需求，`global` 集群同时处理平台管理和直接运行的 ISV 应用，无需额外创建工作负载集群。

    **资源配置要求**

    <table>
      <tr>
        <th style={{ whiteSpace: 'nowrap' }}>部署方案</th>
        <th style={{ whiteSpace: 'nowrap' }}>节点类型</th>
        <th style={{ whiteSpace: 'nowrap' }}>数量</th>
        <th style={{ whiteSpace: 'nowrap' }}>最低规格</th>
        <th style={{ whiteSpace: 'nowrap' }}>推荐规格</th>
        <th style={{ whiteSpace: 'nowrap' }}>备注</th>
      </tr>

      <tr>
        <td rowSpan={2}><b>最低配置</b></td>
        <td>控制平面节点</td>
        <td>3</td>
        <td>8 核 16GB + ISV 要求</td>
        <td>12 核 24GB + ISV 要求</td>
        <td>建议保留约 30% 冗余资源</td>
      </tr>

      <tr>
        <td>工作节点</td>
        <td>0</td>
        <td>—</td>
        <td>—</td>
        <td>ISV 应用共享运行在控制平面节点上</td>
      </tr>

      <tr>
        <td rowSpan={2}><b>推荐配置</b></td>
        <td>控制平面节点</td>
        <td>3</td>
        <td>8 核 16GB</td>
        <td>12 核 24GB</td>
        <td>运行 Kubernetes 组件和平台控制平面</td>
      </tr>

      <tr>
        <td>工作节点</td>
        <td>≥2</td>
        <td>根据 ISV 应用负载要求</td>
        <td>—</td>
        <td>独立运行 ISV 应用，建议实现 HA 部署</td>
      </tr>
    </table>

    **架构描述**

    - **生产就绪**：`global` 集群同时运行控制平面组件和 ISV 应用。
    - **平台与应用隔离**：建议 ISV 应用运行在专用工作节点上，以避免与控制平面的资源争用。
    - **扩展性**：每增加 50 个新应用 Pods，按照 ISV 应用资源要求增加 1 个工作节点。
  </Tab>

  <Tab label="多集群管理（数据中心级别）">
    **应用范围**
    适用于需要统一管理跨云和跨区域的多个工作负载集群的大型企业数据中心环境。随着工作负载集群数量的增加，`global` 集群必须动态扩展工作节点和资源配置，以确保高可用性和高性能。

    **核心功能**

    - **混合控制**：支持对跨云和跨区域工作负载集群的统一管理。
    - **弹性扩展**：`global` 集群资源随访问的工作负载集群数量线性扩展。
    - **物理隔离**：建议控制平面和计算平面物理隔离，以确保系统稳定性。

    **基线资源配置**

    <table>
      <thead>
        <tr>
          <th style={{ whiteSpace: 'nowrap' }}>节点类型</th>
          <th style={{ whiteSpace: 'nowrap' }}>数量</th>
          <th style={{ whiteSpace: 'nowrap' }}>最低规格</th>
          <th style={{ whiteSpace: 'nowrap' }}>推荐规格</th>
          <th style={{ whiteSpace: 'nowrap' }}>备注</th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>控制平面节点</td>
          <td>3 或 5</td>
          <td>8 核 16GB</td>
          <td>16 核 32GB</td>
          <td>启用防亲和性策略</td>
        </tr>

        <tr>
          <td>工作节点</td>
          <td>≥2</td>
          <td>12 核 24GB</td>
          <td>24 核 48GB</td>
          <td>建议保留 30% 资源冗余</td>
        </tr>
      </tbody>
    </table>

    **动态扩展规则**

    1. **垂直扩展**：单个节点可以按梯度升级（例如，12 核 24GB → 24 核 48GB → 48 核 96GB）。
    2. **水平扩展**：每 10 个访问的工作负载集群，建议将计算资源扩展 20%（增加节点数或升级节点规格）。
    3. **监控触发**：当 CPU/内存利用率持续超过 70%，则启动扩展措施。

    **架构描述**

    - 控制平面由 3 个节点组成，形成 ETCD 集群。建议启用 TLS 加密和定期快照。
    - 建议将平台关键组件部署在独立的工作节点上，以避免资源争用。
    - 灾难恢复建议：跨多个可用区部署，以确保工作节点分布在至少 2 个物理故障域。
  </Tab>
</Tabs>

<Directive type="tip" title="提示">
  1. **资源冗余**：建议生产环境保留至少 30% 的资源余量以应对突发负载。
  2. **网络规划**：`global` 集群应部署在独立的 VPC 或 VLAN 中，以确保带宽 ≥1Gbps。
  3. **存储隔离**：建议 ETCD 存储使用 NVMe SSD，并与应用存储物理隔离。
</Directive>

## 机器

:::info
本节描述构建高可用 `global` 集群的最低硬件要求。如果您已完成容量规划，请根据 [容量规划](#scale) 准备相应资源，或在安装后根据需要扩展。
:::

### 基本要求

必须提供至少 **3** 台物理机器或虚拟机作为集群的控制平面节点。每个节点的最低配置如下：

| **类别**       | **最低要求**                                                                                |
| -------------- | ------------------------------------------------------------------------------------------- |
| **CPU**        | ≥ 8 核，主频 ≥ 2.5GHz<br />禁止超配；禁用省电模式                                             |
| **内存**       | ≥ 16GB<br />禁止超配；建议使用至少六通道 DDR4                                               |
| **硬盘**       | 单设备 IOPS ≥ 2000<br />吞吐量 ≥ 200MB/s<br />必须使用 SSD                                   |

### ARM 架构要求

对于 ARM 架构（如 Kunpeng 920），建议将配置提升到 x86 最低配置的 **2 倍**，但不低于 **1.5 倍**。

例如：如果 x86 需要 8 核 16GB，则 ARM 至少应达到 12 核 24GB，推荐配置为 16 核 32GB。

## 支持的操作系统和内核

:::info

1. **内核版本要求：**
   这些内核版本已由我们的平台测试正式发布并验证。在实际部署中，请严格遵循 **A.B.C 主版本号**，而后续的小版本号可以有所不同。
2. **不支持的环境：**
   如果操作系统、内核版本或 CPU 架构不符合要求，请联系技术支持。
   :::

<Tabs>
  <Tab label="Red Hat Enterprise Linux (RHEL)">
    - RHEL 7.8: `3.10.0-1127.el7.x86_64`
    - RHEL 8.0 至 8.6: `4.18.0-80.el8.x86_64` 至 `4.18.0-372.9.1.el8.x86_64`

    <Directive type="warning" title="警告">
      RHEL 7.8 不支持 **Calico Vxlan IPv6**。
    </Directive>
  </Tab>

  <Tab label="CentOS">
    - CentOS 7.6 至 7.9: `3.10.0-1127` 至 `3.11`

    <Directive type="warning" title="警告">
      CentOS 不支持 **Calico Vxlan IPv6**。
    </Directive>
  </Tab>

  <Tab label="Ubuntu">
    - Ubuntu 20.04 LTS: `5.4.0-124-generic`
    - Ubuntu 22.04 LTS: `5.15.0-56-generic`

    <Directive type="warning" title="警告">
      不支持 Ubuntu HWE（硬件增强）版本。
    </Directive>
  </Tab>

  <Tab label="麒麟 Linux 高级服务器">
    - 麒麟 V10 SP3: `4.19.90-52.22.v2207.ky10.x86_64`

    <Directive type="warning" title="警告">
      - 麒麟 V10、V10-SP1 和 V10-SP2 存在已知内核问题，可能导致 **NodePort 网络访问失败**；建议升级到 **麒麟 V10-SP3**。
      - ARM 架构仅支持 `Kunpeng 920`。其他型号请联系技术支持。
    </Directive>
  </Tab>
</Tabs>

## 网络

在安装之前，必须预先配置以下网络资源。如果无法提供硬件负载均衡器，安装程序支持配置 **haproxy + keepalived** 作为软件负载均衡器，但您需要了解：

- **性能较差**：软件负载均衡的性能低于硬件负载均衡器。
- **复杂性较高**：如果您对 keepalived 不熟悉，可能会导致 `global` 集群无法使用，问题排查将耗费大量时间，并严重影响平台的可靠性。

### 网络资源 \{#network-resources}

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>资源</th>
      <th style={{ whiteSpace: 'nowrap' }}>必需</th>
      <th style={{ whiteSpace: 'nowrap' }}>数量</th>
      <th style={{ whiteSpace: 'nowrap' }}>描述</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>`global` VIP</td>
      <td>必需</td>
      <td>1</td>
      <td>用于集群中的节点访问 kube-apiserver，配置在负载均衡设备中以确保高可用性。<br />该 IP 也可以用作平台 Web UI 的访问地址。<br />与 `global` 集群在同一网络中的工作负载集群也可以通过该 IP 访问 `global` 集群。</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>外部 IP</td>
      <td>可选</td>
      <td>按需</td>
      <td>当存在不在 `global` 集群相同网络中的工作负载集群时，如混合云场景，必须提供。其他网络中的工作负载集群通过此 IP 访问 `global` 集群。<br />该 IP 需要在负载均衡设备中配置以确保高可用性。<br />该 IP 也可以用作平台 Web UI 的访问地址。</td>
    </tr>

    <tr>
      <td>域名</td>
      <td>可选</td>
      <td>按需</td>
      <td>如果您需要通过域名访问 `global` 集群或平台 Web UI，请提前提供，并确保域名解析正确。</td>
    </tr>

    <tr>
      <td>证书</td>
      <td>可选</td>
      <td>按需</td>
      <td>建议使用受信任的证书以避免浏览器安全警告；如果未提供，安装程序将生成自签名证书，但使用 HTTPS 时可能存在安全风险。</td>
    </tr>
  </tbody>
</table>

<Directive type="info" title="信息">
  在以下情况下必须提供域名：

  1. `global` 集群需要支持 IPv6 访问。
  2. 计划为 `global` 集群实施灾难恢复计划。
</Directive>

<Directive type="note" title="注意">
  如果平台需要配置多个访问地址（例如，内部和外部网络地址），请根据上表提前准备相应的 IP 地址或域名。您可以稍后在安装参数中配置它们，或根据产品文档在安装后添加。
</Directive>

### 网络配置

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>类型</th>
      <th style={{ whiteSpace: 'nowrap' }}>要求描述</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>网络速度</td>
      <td>`global` 集群与同网络工作负载集群的速度 ≥1Gbps（推荐 10Gbps）；跨网络速度 ≥100Mbps（推荐 1Gbps）。<br />速度不足会显著降低数据查询性能。</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>网络延迟</td>
      <td>同网络延迟 ≤2ms；跨网络延迟 ≤100ms（推荐 ≤30ms）。</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>网络策略</td>
      <td>请参考 [负载均衡器转发规则](#port-forward) 确保必要的端口开放；在使用 Calico CNI 时，请确保启用 **IP-in-IP** 协议。</td>
    </tr>

    <tr>
      <td style={{ whiteSpace: 'nowrap' }}>IP 地址范围</td>
      <td>`global` 集群节点应避免使用 172.16-32 网络段。如果已使用，请调整 Docker 配置（增加 bip 参数）以避免冲突。</td>
    </tr>
  </tbody>
</table>

### 负载均衡器转发规则 \{#port-forward}

此规则旨在确保 `global` 集群能够正常接收来自负载均衡器的流量。请根据以下表格检查网络策略，以确保相关端口开放。

<table>
  <thead>
    <tr>
      <th style={{ whiteSpace: 'nowrap' }}>源 IP</th>
      <th style={{ whiteSpace: 'nowrap' }}>协议</th>
      <th style={{ whiteSpace: 'nowrap' }}>目标 IP</th>
      <th style={{ whiteSpace: 'nowrap' }}>目标端口</th>
      <th style={{ whiteSpace: 'nowrap' }}>描述</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>`global` VIP，外部 IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>所有控制平面节点 IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>443</td>

      <td>
        通过 HTTPS 协议为平台 Web UI、镜像库和 Kubernetes API Server 提供访问服务。默认端口为 `443`。如果需要使用自定义 HTTPS 端口，请执行以下操作：<br />

        - 将转发规则中的目标端口替换为您的自定义端口号。<br />
        - 暂时在 Web UI 安装参数中填写自定义端口号。
      </td>
    </tr>

    <tr>
      <td>`global` VIP，外部 IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>所有控制平面节点 IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>6443</td>

      <td>
        此端口为集群内节点访问 Kubernetes API Server 提供服务。
      </td>
    </tr>

    <tr>
      <td>`global` VIP，外部 IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
      <td>所有控制平面节点 IP</td>
      <td style={{ whiteSpace: 'nowrap' }}>11443</td>

      <td>
        此端口为集群内节点访问镜像库提供服务。<br />
        <b>注意：</b>如果您计划使用外部镜像库而非 `global` 集群提供的默认镜像库，则无需配置此端口。
      </td>
    </tr>
  </tbody>
</table>

<Directive type="tip" title="提示">
  - 建议在负载均衡器上配置健康检查以监控端口状态。
  - 如果您计划为 `global` 集群实施灾难恢复计划，则需要为所有控制平面节点开放端口 `2379` 以进行主集群与灾难恢复集群之间的 ETCD 数据同步。
  - 平台默认仅支持 HTTPS。如果需要 HTTP 支持，则需要为所有控制平面节点开放 HTTP 端口。
</Directive>
