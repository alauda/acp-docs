---
weight: 10
i18n:
  title:
    en: Prerequisites
---

# 先决条件

在安装 `global` 集群前，您需要准备符合要求的硬件、网络和操作系统。

:::danger
平台目前不支持在已有 Kubernetes 环境中直接安装 `global` 集群。若您的环境已存在 Kubernetes 集群，请先备份数据并清理环境后再进行安装。
:::

## 容量规划 \{#scale}

在安装前，必须依目标和实际需求选择适配的安装场景。不同场景对基础设施资源配置及架构设计要求存在明显差异，提供以下三种典型场景的规划建议：

<Tabs>
  <Tab label="功能验证">
  **适用范围**
  适用于平台功能验证、演示环境搭建或技术可行性测试。该场景仅用于验证平台核心功能，不承载生产级应用流量，资源配置为最低水平。

  **资源配置要求**
  | 维度       | 规格要求                       |
  |------------|--------------------------------|
  | 节点数量   | 1 台（物理机或虚拟机）         |
  | CPU        | ≥16核                        |
  | 内存       | ≥32GB                         |

  **架构说明**
  - **单节点部署**：集群仅有一个节点，所有控制平面组件和应用均在节点上运行。
  - **轻量负载**：仅能负载不超过 10 个 Pod 的 Demo 应用。
  - **非生产用途**：不支持横向扩展，不满足应用连续性和高可用性要求。
  </Tab>

  <Tab label="ISV 集成交付">
  **适用范围**
  针对 ISV（独立软件供应商）的标准化交付需求，`global` 集群既负责平台管理，又直接运行 ISV 应用，无需额外创建业务集群。

  **资源配置要求**
  <table>
      <tr>
          <th style={{ whiteSpace: 'nowrap' }}>部署方案</th>
          <th style={{ whiteSpace: 'nowrap' }}>节点类型</th>
          <th style={{ whiteSpace: 'nowrap' }}>数量</th>
          <th style={{ whiteSpace: 'nowrap' }}>最小规格</th>
          <th style={{ whiteSpace: 'nowrap' }}>推荐规格</th>
          <th style={{ whiteSpace: 'nowrap' }}>备注</th>
      </tr>
      <tr>
          <td rowSpan={2}><b>最低配置</b></td>
          <td>控制节点</td>
          <td>3</td>
          <td>8核16GB + ISV 需求</td>
          <td>12核24GB + ISV 需求</td>
          <td>建议预留约 30% 冗余资源</td>
      </tr>
      <tr>
          <td>计算节点</td>
          <td>0</td>
          <td>—</td>
          <td>—</td>
          <td>控制节点上共享运行 ISV 应用</td>
      </tr>
      <tr>
          <td rowSpan={2}><b>推荐配置</b></td>
          <td>控制节点</td>
          <td>3</td>
          <td>8核16GB</td>
          <td>12核24GB</td>
          <td>运行 Kubernetes 组件及平台控制平面</td>
      </tr>
      <tr>
          <td>计算节点</td>
          <td>≥2</td>
          <td>根据 ISV 应用负载需求</td>
          <td>—</td>
          <td>独立运行 ISV 应用，建议实现 HA 部署</td>
      </tr>
  </table>

  **架构说明**
  - **生产可用**：`global` 集群时同时运行控制平面组件和 ISV 应用。
  - **平台与业务隔离**：ISV 应用建议在专用计算节点上运行，避免与控制平面资源竞争。
  - **扩容**：每新增 50 个应用 Pod，按 ISV 应用资源需求增加 1 个计算节点。

  </Tab>
  <Tab label="多集群管理（数据中心级）">
  **适用范围**
  适用于大型企业数据中心环境，需统一管理跨云、跨地域的多个业务集群。随着业务集群数量增加，`global` 集群须动态扩展计算节点和资源配置，以确保高可用性和高性能。

  **核心特性**
  - **混合管控**：支持跨云、跨地域业务集群统一管理。
  - **弹性扩展**：`global` 集群资源与接入业务集群数量呈线性扩展。
  - **物理隔离**：控制平面与计算平面建议物理隔离，确保系统稳定性。

  **基准资源配置**
  <table>
      <thead>
          <tr>
              <th style={{ whiteSpace: 'nowrap' }}>节点类型</th>
              <th style={{ whiteSpace: 'nowrap' }}>数量</th>
              <th style={{ whiteSpace: 'nowrap' }}>最小规格</th>
              <th style={{ whiteSpace: 'nowrap' }}>推荐规格</th>
              <th style={{ whiteSpace: 'nowrap' }}>备注</th>
          </tr>
      </thead>
      <tbody>
          <tr>
              <td>控制节点</td>
              <td>3或5</td>
              <td>8核16GB</td>
              <td>16核32GB</td>
              <td>启用反亲和策略</td>
          </tr>
          <tr>
              <td>计算节点</td>
              <td>≥2</td>
              <td>12核24GB</td>
              <td>24核48GB</td>
              <td>建议预留 30% 资源冗余</td>
          </tr>
      </tbody>
  </table>

  **动态扩展规则**
  1. **纵向扩容**：单节点可按梯度升级（如 12核24GB → 24核48GB → 48核96GB）
  2. **横向扩容**：每接入 10 个业务集群，建议扩充 20% 的计算资源（增加节点数量或提升节点规格）
  3. **监控触发**：当 CPU/内存使用率持续超过 70% 时，启动扩容措施

  **架构说明**
  - 控制平面由 3 个节点构成 ETCD 集群，建议启用 TLS 加密与定期快照
  - 平台关键组件建议部署于独立计算节点上，避免资源竞争
  - 灾备建议：跨多个可用区部署，确保计算节点至少分布于 2 个物理故障域中
  </Tab>
</Tabs>

<Directive type="tip" title="全局规划建议">
1. **资源冗余**：生产环境建议预留至少 30% 的资源余量，以应对突发负载
2. **网络规划**：`global` 集群应部署在独立 VPC 或 VLAN 内，确保带宽 ≥1Gbps
3. **存储隔离**：ETCD 存储建议采用 NVMe SSD，并与应用存储物理隔离
</Directive>

## 机器

:::info
本节描述构建高可用 `global` 集群的最低硬件要求。若您已完成容量规划，请参照 [容量规划](#scale) 准备相应资源，或在安装后根据需要进行扩容。
:::

### 基本要求

至少需提供 **3 台** 物理机或虚拟机作为集群的控制节点，各节点最低配置如下：

| **类别** | **最低要求** |
|----------|--------------|
| **CPU**  | ≥ 8 核，主频 ≥ 2.5GHz<br />不得超售；关闭节能模式 |
| **内存** | ≥ 16GB<br />不得超售；建议采用至少六通道 DDR4 |
| **硬盘** | 单块设备 IOPS ≥ 2000<br />吞吐量 ≥ 200MB/s<br />必须采用 SSD |

### ARM 架构要求

对于 ARM 架构（如鲲鹏 920），建议配置相对于 x86 最低配置提高至 **2 倍**，但不得低于 **1.5 倍**。

例如：若 x86 要求为 8 核 16GB，则 ARM 最低应达到 12 核 24GB，推荐配置为 16 核 32GB。

## 支持的操作系统与内核

:::warning
1. **内核版本要求：**
   以上内核版本为官方发布且经过平台测试验证。实际环境时，确保 **A.B.C 主版本号** 一致即可，后续部分允许存在差异。
2. **不支持的环境：**
   若操作系统、内核版本或 CPU 架构不符合要求，请联系技术支持。
:::

<Tabs>
  <Tab label="Red Hat Enterprise Linux (RHEL)">
  - RHEL 7.8：`3.10.0-1127.el7.x86_64`
  - RHEL 8.0 至 8.6：`4.18.0-80.el8.x86_64` 至 `4.18.0-372.9.1.el8.x86_64`
  <Directive type="info" title="INFO">
  RHEL 7.8 不支持 **Calico Vxlan IPv6**。
  </Directive>
  </Tab>

  <Tab label="CentOS">
  - CentOS 7.6 至 7.9：`3.10.0-1127` 至 `3.11`
  <Directive type="info" title="INFO">
  CentOS 均不支持 **Calico Vxlan IPv6**。
  </Directive>
  </Tab>

  <Tab label="Ubuntu">
  - Ubuntu 20.04 LTS：`5.4.0-124-generic`
  - Ubuntu 22.04 LTS：`5.15.0-56-generic`
  <Directive type="info" title="INFO">
  不支持 Ubuntu HWE（Hardware Enablement）版本。
  </Directive>
  </Tab>

  <Tab label="Kylin Linux Advanced Server">
  - Kylin V10：`4.19.90-11.ky10.x86_64`
  - Kylin V10 SP1：`4.19.90-23.8.v2101.ky10.x86_64`
  - Kylin V10 SP2：`4.19.90-24.4.v2101.ky10.x86_64`
  - Kylin V10 SP3：`4.19.90-52.22.v2207.ky10.x86_64`
  <Directive type="danger" title="DANGER">
  - Kylin V10、V10-SP1、V10-SP2 存在已知内核问题，可能导致 **NodePort 网络访问失败**；建议升级至 **Kylin V10-SP3**。
  - ARM 架构仅支持 `鲲鹏 920` 。其他型号请联系技术支持。
  </Directive>
  </Tab>
</Tabs>

## 网络

在安装前，以下网络资源必须提前配置。若无法提供硬件 LoadBalancer ，安装器支持配置 **haproxy + keepalived** 作为软负载均衡，但需要了解：

- **性能较差**：软负载的性能低于硬件 LoadBalancer 。
- **复杂性高**：若对 keepalived 不熟悉，可能导致 `global` 集群不可用，问题排查耗时较长，严重影响平台可靠性。

### 网络资源  \{#network-resources}

<table>
    <thead>
        <tr>
            <th style={{ whiteSpace: 'nowrap' }}>资源</th>
            <th style={{ whiteSpace: 'nowrap' }}>是否必须</th>
            <th style={{ whiteSpace: 'nowrap' }}>数量</th>
            <th style={{ whiteSpace: 'nowrap' }}>说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style={{ whiteSpace: 'nowrap' }}>global VIP</td>
            <td>必须</td>
            <td>1</td>
            <td>用于集群内各节点访问 kube-apiserver，配置于负载均衡设备中以确保高可用性。<br />此 IP 也可作为平台 Web UI 的访问地址。<br />与 `global` 集群处于同一网络的业务集群也可通过此 IP 访问 `global` 集群。</td>
        </tr>
        <tr>
            <td style={{ whiteSpace: 'nowrap' }}>External IP</td>
            <td>可选</td>
            <td>按需</td>
            <td>当存在与 `global` 集群不在同一网络的业务集群时，如混合云场景，则必须提供，其他网络下的业务集群通过此 IP 访问 `global` 集群。<br />需将该 IP 配置于负载均衡设备以确保高可用。<br />此 IP 也可作为平台 Web UI 的访问地址。</td>
        </tr>
        <tr>
            <td>域名</td>
            <td>可选</td>
            <td>按需</td>
            <td>若需通过域名访问 `global` 集群或平台 Web UI，请提前提供，并确保域名解析正确。</td>
        </tr>
        <tr>
            <td>证书</td>
            <td>可选</td>
            <td>按需</td>
            <td>推荐使用受信任证书以避免浏览器安全警告；如未提供，安装器会生成自签名证书，但使用 HTTPS 时可能提示安全风险。</td>
        </tr>
    </tbody>
</table>

<Directive type="warning" title="注意">
以下情况必须提供域名：
1. `global` 集群需要支持 IPv6 访问；
2. 计划实施 `global` 集群的容灾方案。
</Directive>

<Directive type="tip" title="TIP">
若平台需要配置多个访问地址（例如分别用于内网和外网的地址），请参考上表提前准备相应的 IP 地址或域名。后续可在安装参数中进行配置，或在安装完成后根据产品文档进行补充。
</Directive>

### 网络配置

<table>
    <thead>
        <tr>
            <th style={{ whiteSpace: 'nowrap' }}>类型</th>
            <th style={{ whiteSpace: 'nowrap' }}>要求说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style={{ whiteSpace: 'nowrap' }}>网络速率</td>
            <td>同一网络内 `global` 集群与业务集群速率 ≥1Gbps（建议10Gbps）；跨网络速率 ≥100Mbps（建议1Gbps）。<br />速率不足将显著降低数据查询性能。</td>
        </tr>
        <tr>
            <td style={{ whiteSpace: 'nowrap' }}>网络时延</td>
            <td>同一网络时延 ≤2ms；跨网络时延 ≤100ms（建议 ≤30ms）。</td>
        </tr>
        <tr>
            <td style={{ whiteSpace: 'nowrap' }}>网络策略</td>
            <td>请参照 [LoadBalancer 转发规则](#port-forward) 确保必要端口开放；使用 Calico CNI 时，确保已启用 **IP-in-IP** 协议。</td>
        </tr>
        <tr>
            <td style={{ whiteSpace: 'nowrap' }}>IP 地址范围</td>
            <td>`global` 集群节点应避免使用 172.16-32 网段，如已使用，请调整 Docker 配置（添加 bip 参数）以避免冲突。</td>
        </tr>
    </tbody>
</table>

### LoadBalancer 转发规则  \{#port-forward}

本规则旨在确保 `global` 集群正常接收来自 LoadBalancer 的流量。请根据下表检查网络策略，确保相关端口已开放。

<table>
    <thead>
        <tr>
            <th style={{ whiteSpace: 'nowrap' }}>源IP</th>
            <th style={{ whiteSpace: 'nowrap' }}>协议</th>
            <th style={{ whiteSpace: 'nowrap' }}>目的IP</th>
            <th style={{ whiteSpace: 'nowrap' }}>目的端口</th>
            <th style={{ whiteSpace: 'nowrap' }}>说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style={{ whiteSpace: 'nowrap' }}>global VIP、External IP</td>
            <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
            <td style={{ whiteSpace: 'nowrap' }}>所有控制节点 IP</td>
            <td style={{ whiteSpace: 'nowrap' }}>443</td>
            <td>
              通过 HTTPS 协议对外提供平台 Web UI、镜像仓库和 Kubernetes API Server 的访问服务。默认端口为 `443`。若您需要使用自定义 HTTPS 端口，请执行以下操作：<br />
              - 将端口转发规则中的目标端口替换为您自定义的端口号。<br />
              - 后续在 Web UI 安装参数中，填写您自定义的端口号。
            </td>
        </tr>
        <tr>
            <td style={{ whiteSpace: 'nowrap' }}>global VIP、External IP</td>
            <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
            <td style={{ whiteSpace: 'nowrap' }}>所有控制节点 IP</td>
            <td style={{ whiteSpace: 'nowrap' }}>6443</td>
            <td>
              通过此端口为集群内的节点提供 Kubernetes API Server 的访问服务。
            </td>
        </tr>
        <tr>
            <td style={{ whiteSpace: 'nowrap' }}>global VIP、External IP</td>
            <td style={{ whiteSpace: 'nowrap' }}>TCP</td>
            <td style={{ whiteSpace: 'nowrap' }}>所有控制节点 IP</td>
            <td style={{ whiteSpace: 'nowrap' }}>11443</td>
            <td>
              通过此端口为集群内的节点提供镜像仓库的访问服务。<br />
              <b>注意：</b> 如果您计划使用外部镜像仓库，而非 `global` 集群默认提供的镜像仓库，则无需配置此端口。<br />
            </td>
        </tr>
    </tbody>
</table>

<Directive type="info" title="INFO">
- LoadBalancer 上建议配置健康检查以监控端口状态。
- 若计划实施 `global` 集群容灾方案，需要为所有控制节点开放端口 `2379`，用于主集群与灾备集群间 ETCD 数据同步。
- 平台默认仅支持 HTTPS，若需支持 HTTP ，需要为所有控制节点开放 HTTP 端口。
</Directive>
