---
weight: 30
sourceSHA: ee1c80bc57a3860fe55d5f6529283bfb43e1c040427bb19711d20f41a68dacfe
---

# 安装

本节描述了安装 `global` 集群的具体步骤。

在开始安装之前，请确保您已完成先决条件检查、安装包下载与验证、节点预处理及其他准备工作。

## 过程

<Steps>
  ### 上传并解压安装包

  将安装包上传到 `global` 集群控制平面节点的任意机器上，并根据以下命令解压安装包：

  ```shell
  # 假设机器上已经存在 /root/cpaas-install 文件夹
  tar -xvf {Installation Package File} 的路径/{Installation Package File Name} -C /root/cpaas-install
  cd /root/cpaas-install/installer || exit 1
  ```

  <Directive type="info" title="信息">
    - 此机器将在 `global` 集群安装完成后成为第一个控制平面节点。
    - 解压安装包后，至少需要 **100GB** 的磁盘空间，请确保存储资源充足。
  </Directive>

  ### 启动安装程序

  执行以下安装脚本以启动安装程序。安装程序成功启动后，命令行终端将输出 UI 访问地址。

  等待大约 5 分钟后，您可以在 PC 上使用浏览器访问安装程序提供的 Web UI。

  ```bash
  bash setup.sh
  ```

  安装程序默认使用 Kube-OVN 网络插件。如果您需要使用 Calico 网络插件，请执行：

  ```bash
  bash setup.sh --network-mode calico
  ```

  <Directive type="info" title="信息">
    - 使用 IPv6 地址访问：在命令中添加 `--ip-family ipv6` 参数。
    - 同时支持 IPv4 和 IPv6：在命令中添加 `--ip-family dual` 参数。
  </Directive>

  <Directive type="warning" title="警告">
    确保安装程序所在节点的 IP 地址和 8080 端口可以正常访问，以便安装程序成功启动后能够顺利访问提供的 Web UI。
  </Directive>

  ### 参数配置

  根据页面指引完成安装参数配置后，确认安装。

  [参数说明](#parameters) 提供了关键参数的详细说明。请仔细阅读并根据实际需求进行配置。

  ### 验证安装成功

  安装完成后，平台访问地址将显示在页面上。点击 **访问** 按钮跳转到平台 Web UI。

  在 **平台管理** 视图中，依次点击 **集群管理 > 集群**，找到名为 `global` 的集群。

  从右侧下拉菜单选择 `CLI 工具`，执行以下命令以验证安装状态：

  ```shell
  # 检查是否有失败的 Charts
  kubectl get apprelease --all-namespaces
  # 检查是否有失败的 Pods
  kubectl get pod --all-namespaces | awk '{if ($4 != "Running" && $4 != "Completed")print}' | awk -F'[/ ]+' '{if ($3 != $4)print}'
  ```

  ### 安装产品文档插件

  :::info
  产品文档插件用于在平台中提供产品文档的访问功能，平台中功能的帮助链接会指向这个文档。如果未安装此插件，点击平台中的帮助链接将会遇到 404 访问错误。
  :::

  1. 导航至 **Administrator**。

  2. 在左侧边栏中，点击 **应用市场管理** > **集群插件** 并选择 `global` 集群。

  3. 找到 **产品文档** 插件并点击 **安装**。

</Steps>

## 参数说明 \{#parameters}

<table>
  <tr>
    <th style={{ whiteSpace: 'nowrap' }}>参数</th>
    <th style={{ whiteSpace: 'nowrap' }}>说明</th>
  </tr>

  <tr>
    <td><b>Kubernetes 版本</b></td>

    <td>
      所有可选版本都经过严格的稳定性和兼容性测试。<br />
      <b>建议：</b>选择最新版本以获得最佳功能和支持。
    </td>
  </tr>

  <tr>
    <td><b>集群网络协议</b></td>

    <td>
      支持三种模式：IPv4 单栈、IPv6 单栈、IPv4/IPv6 双栈。<br />
      <b>注意：</b>如果选择双栈模式，请确保所有节点已正确配置 IPv6 地址；设置后无法更改网络协议。
    </td>
  </tr>

  <tr>
    <td><b>集群地址</b></td>

    <td>
      <ul>
        输入预先准备好的域名。如果没有可用的域名，请输入预先准备好的 <code>`global` VIP</code>。<br />
        <code>自建 VIP</code> 默认情况下是禁用的，仅在未提供 LoadBalancer 时启用。启用后，安装程序将自动部署 <code>keepalived</code> 以提供软件负载均衡支持。<br />
        <b>注意：</b>使用 <code>自建 VIP</code> 时必须满足以下条件，<br />

        - 有可用的 VRID；<br />
        - 主机网络支持 VRRP 协议；<br />
        - 所有控制平面节点和 VIP 必须位于同一子网内。<br />
      </ul>

      <ul>
        <b>提示：</b>对于功能体验场景的单节点部署，您可以直接输入节点 IP。无须启用 <code>自建 VIP</code> 或准备 <code>`global` VIP</code> 等网络资源。
      </ul>
    </td>
  </tr>

  <tr>
    <td><b>平台访问地址</b></td>

    <td>
      <ul>
        如果您不需要区分 <b>集群地址</b> 和 <b>平台访问地址</b>，请输入与 <b>集群地址</b> 相同的地址。<br />
        如果需要区分，例如，`global` 集群仅供内部网络访问，而平台需要提供外部网络访问，请输入预先准备好的域名或 <code>外部 IP</code>。<br />
        平台默认使用 HTTPS 访问，不启用 HTTP。如果需要启用 HTTP 访问，请在 <b>高级设置</b> 中启用（不建议）。<br />
        <b>注意：</b>在以下情况下必须输入域名，<br />

        - 如果规划了 `global` 集群的灾备方案；<br />
        - 如果平台需要支持 IPv6 访问。<br />
      </ul>

      <ul>
        <b>提示：</b>如果需要配置更多平台访问地址，可以在下一步的 <b>其他设置 > 其他平台访问地址</b> 中添加。或者，在安装后根据用户手册在平台管理中添加。<br />
      </ul>
    </td>
  </tr>

  <tr>
    <td><b>证书</b></td>

    <td>
      平台提供自签名证书，默认支持 HTTPS 访问。<br />
      如果需要使用自定义证书，可以上传现有证书。
    </td>
  </tr>

  <tr>
    <td><b>镜像仓库</b></td>

    <td>
      默认情况下，使用 <code>平台部署</code> 镜像仓库，其中包含所有组件的镜像。<br />
      如果需要使用 <code>外部</code> 镜像仓库，请联系技术支持以获取镜像同步方案后再进行配置。
    </td>
  </tr>

  <tr>
    <td><b>容器网络</b></td>

    <td>
      集群的默认子网和服务网络段不能重叠。<br />
      使用 Kube-OVN Overlay 网络时，确保容器网络与主机网络不在同一网络段，否则可能会导致网络异常。
    </td>
  </tr>

  <tr>
    <td><b>节点名称</b></td>

    <td>
      如果选择 <code>主机名作为节点名称</code>，请确保所有节点的主机名唯一。
    </td>
  </tr>

  <tr>
    <td><b>`global` 集群平台节点隔离</b></td>

    <td>
      仅在规划在 `global` 集群中运行应用工作负载时启用。<br />
      <b>启用后：</b><br />

      - 可以将节点设置为 <code>平台独占</code>，即仅运行平台组件，从而确保平台和应用工作负载隔离；<br />
      - 排除 DaemonSet 类型的工作负载。
    </td>
  </tr>

  <tr>
    <td><b>添加节点</b></td>

    <td>
      <b>控制平面节点：</b>

      <ul>
        - 支持添加 1 或 3 个控制平面节点（3 个用于高可用性配置）；<br />
        - 如果启用 <code>平台独占</code>，则强制禁用 <code>可部署应用</code>，控制平面节点仅运行平台组件；<br />
        - 如果禁用 <code>平台独占</code>，可以选择是否启用 <code>可部署应用</code>，允许控制平面节点运行应用工作负载。<br />
      </ul>

      <b>工作节点：</b>

      <ul>
        - 如果启用 <code>平台独占</code>，则强制禁用 <code>可部署应用</code>；<br />
        - 如果禁用 <code>平台独占</code>，则强制启用 <code>可部署应用</code>。<br />
      </ul>

      <p>使用 Kube-OVN 时，您可以通过输入网关名称来指定节点网络卡。</p>
      <p>如果节点可用性检查失败，请根据页面提示进行调整，并重新添加。</p>
    </td>
  </tr>
</table>

## 安装程序清理

安装后，安装程序通常会自动删除。如果安装后 30 分钟内安装程序未自动删除，请在安装程序所在节点上执行以下命令以强制删除安装程序容器：

```bash
docker rm -f minialauda-control-plane
```
