---
weight: 40
i18n:
  title:
    en: Installing
---

# 安装

本节介绍安装管理集群的具体步骤。下列操作采用“准备 → 执行 → 验证”模式，关键参数说明已在 UI 配置中详细标注。

### Step 1：下载安装包

**准备**
- 登录 **Customer Portal** 获取最新安装包及签名文件。
- 若尚未注册账号，请联系技术支持。

**执行**
- 下载完成后，使用 GPG 工具验证安装包完整性。
- 根据操作系统安装 GPG 工具（参考下方命令）。

```bash
# Ubuntu
sudo apt-get install gnupg
# CentOS
yum install gnupg
# Mac
brew install gpg
```

**验证**
按照以下步骤进行验证：

#### 1.1 下载并验证公钥

```bash
curl -O https://www.alauda.cn/download/verify-key.pub
md5sum verify-key.pub
```

- 输出 MD5 值应为：`2eaddfab97d2951a8915f327acb53562`。

#### 1.2 导入公钥并验证指纹

```bash
gpg --import verify-key.pub
gpg --fingerprint BB097AE6
```

- 指纹应完全匹配：
  ```
  09EE E7B9 A30C F4B3 5E31 A91B 2704 1C16 BB09 7AE6
  ```

#### 1.3 验证安装包签名

```bash
gpg --verify <签名文件> <安装包>
```

例如：

```bash
gpg --verify cpaas-devops-2.14.0.tgz.sig cpaas-devops-2.14.0.tgz
```

- 正常输出应显示 “Good signature” 信息。

---

### Step 2：上传安装包至控制节点

**准备**
- 确保目标控制节点网络连通，并具备足够存储（解压后至少 100GB）。

**执行**
- 将安装包上传至控制节点建议目录 `/root/cpaas-install` 下，并解压：

```shell
tar -xvf {安装包文件路径}/{安装包文件名} -C /root/cpaas-install
cd /root/cpaas-install/installer || exit 1
```

**验证**
- 检查解压目录结构是否完整。

---

### Step 3：启动安装器

**准备**
- 确保控制节点网络连通，且 PC 可访问该节点 IP。
- 检查依赖服务是否按先决条件配置完成。

**执行**
- 默认启动安装器（使用 Kube-OVN 网络插件）：

```bash
bash setup.sh
```

- 如需使用 Calico 网络插件，请执行：

```bash
bash setup.sh --network-mode calico
```

- 如需指定 IPv6 或双栈模式，可添加参数 `--ip-family ipv6` 或 `--ip-family dual`。

**验证**
- 安装器启动后，命令行终端将输出 Web UI 访问地址；等待约 5 分钟后，在 PC 上访问，确认页面正常加载。

---

### Step 4：安装管理集群（配置 UI 参数）

**准备**
在 Web UI 中，按提示配置安装管理集群的关键参数，具体说明如下：

- **Kubernetes 版本**
  - 可选版本均经过严格测试。
  - 建议选择最新版本以获取最佳功能和支持。

- **集群网络协议**
  - 支持 IPv4 单栈、IPv6 单栈、以及 IPv4/IPv6 双栈。
  - 注意：选择双栈模式时，所有节点必须正确配置 IPv6 地址；网络协议设置后不可更改。

- **集群地址**
  - 输入预先准备好的 `global VIP`，用于外部访问 kube-apiserver。
  - 若已配置 LoadBalancer，请填写其 VIP 地址并关闭“自建 VIP”；否则开启“自建 VIP”并输入申请的 VIP，安装器会自动部署 keepalived。

- **平台访问地址**
  - 输入预先准备好的 `External IP` 或域名。
  - 默认启用 HTTPS 访问；如需 HTTP，请在高级设置中开启。
  - 支持多地址配置：可填写内网地址，并在“其他设置 > 平台其他访问地址”中添加外网地址。

- **证书**
  - 默认使用自签证书支持 HTTPS。
  - 如需自定义证书，请上传已有证书。

- **镜像仓库**
  - 默认使用平台部署的镜像仓库，包含所有组件镜像。
  - 若需使用外部镜像仓库，请联系技术支持获取镜像同步方案后配置。

- **容器网络**
  - 管理集群默认子网和 Service 网段不得重叠。
  - 使用 Kube-OVN Overlay 网络时，确保容器网络与宿主机网络不在同一网段，防止网络异常。

- **节点名称**
  - 若选择“主机名称作为节点名称”，请确保所有节点主机名称唯一。

- **global 集群平台节点隔离**
  - 当计划在管理集群运行业务负载时启用。
  - 启用后，节点可设置为“平台独占”，即仅运行平台组件；DaemonSet 类型除外。

- **添加节点**
  - **控制节点**：
    - 可添加 1 个或 3 个控制节点（3 个为高可用配置）。
    - 若启用“平台独占”，则关闭“可部署应用”，控制节点仅运行平台组件；否则可选择是否启用“可部署应用”。
  - **计算节点**：
    - 若启用“平台独占”，则关闭“可部署应用”；否则必须启用“可部署应用”。
  - 使用 Kube-OVN 时，可通过输入网关名称指定节点网卡。
  - 如节点可用性检查未通过，请根据页面提示调整后重新添加。

**执行**
- 按照 Web UI 指引逐项填写配置参数后，启动安装向导进行安装。

**验证**
- 安装完成后，页面将显示平台访问地址及安装状态；如有错误，请根据提示进行调整。

---

### Step 5：验证安装成功

**准备**
- 登录平台 Web UI，确认管理集群状态。

**执行**
- 在“平台管理”视图中，依次点击 “集群管理 > 集群”，找到名称为 `global` 的集群；
- 通过右侧下拉菜单选择 “CLI 工具”，执行以下命令检查状态：

```shell
# 查看是否有失败的 Chart
kubectl get apprelease --all-namespaces
# 查看是否有失败的 Pod
kubectl get pod --all-namespaces | awk '{if ($4 != "Running" && $4 != "Completed")print}' | awk -F'[/ ]+' '{if ($3 != $4)print}'
```

**验证**
- 确认输出结果无异常或失败项。
- 如有异常，请参考故障排查指南进行处理。

**浏览器兼容性提示**
建议使用以下浏览器访问平台：
- **Google Chrome**：93 及以上版本
- **Firefox**：92 及以上版本
