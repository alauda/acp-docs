---
weight: 10
---

# 查询调用链

## 功能简介

分布式调用链查询功能为微服务架构提供全链路追踪能力，通过采集服务间调用的元数据信息，帮助用户快速定位跨服务调用问题。该功能主要解决以下问题：

- **请求链路追踪**：在复杂分布式系统中还原完整请求路径。
- **性能瓶颈分析**：识别链路中耗时异常的调用节点。
- **故障根因定位**：通过错误标记快速定位问题发生点。

适用于以下场景：
- 生产环境故障排查时快速定位异常服务。
- 性能调优时识别高延迟调用环节。
- 新版本发布后验证服务间调用关系。

核心价值：
- 提升分布式系统可观测性。
- 缩短故障平均恢复时间（MTTR）。
- 优化服务间调用性能。

## 主要功能

* 多维度查询：支持 TraceID、服务名称、标签等 6 种查询条件组合。
* 可视化分析：通过时序瀑布图直观展示调用层级与耗时分布。
* 精准定位：支持错误 Span 过滤与标签二次检索。

## 功能优势

- **快速定位问题**：通过多维度查询条件，缩小排查范围，加速问题定位。
- **可视化呈现**：采用时序瀑布图直观展示调用关系，降低复杂性，提升故障分析效率。
- **灵活多样**：既支持简单查询，也支持复杂组合查询，适应各种运维和开发场景。

## 调用链查询

<Steps>

### 步骤 1：组合查询条件

**提示**：查询条件可组合使用，您可通过添加多个查询条件进行精细化查询。

| 查询条件           | 说明                                                                                                                                             |
|----------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| **TraceID**    | 完整链路的唯一标识，可用于查询指定的调用链。                                                                                                                         |
| **所属服务**       | 发起/接收调用请求的服务（需选择或输入）。                                                     |
| **标签**         | 可通过输入标签（Tag）对查询结果进行过滤，支持的 Tag 包括 Span 详情中的 Tag。     |
| **Span 耗时大于**  | 耗时大于或等于 *输入值*（ms）的 Span。                                                                                                                       |
| **仅搜索错误 Span** | 错误 Span 是指 Span 的 Tag 中，**error** 的值为 `true` 的 Span。                                                     |
| **Span 类型**    | **根 Span**：搜索由已配置的 **服务** 发起请求的根 Span。通常情况下，当已配置的服务是整个调用请求的发起方时使用该搜索模式。<br/>**服务入口 Span**：搜索已配置的 **服务** 作为服务端被调用时，生成的第一个 Span。 |
| **最大查询条数**     | 最多可查询的 Span 个数，默认为 200。<br/>**提示**：出于性能考虑，平台一次最多可展示 1000 个 Span。若符合查询条件的 Span 个数超过了 **最大查询条数**，您可细化查询条件或缩小时间范围进行分阶段查询。                          |

### 步骤 2：执行查询

- 当您选择查询条件，并输入相应值后，单击 **添加到查询条件** 按钮，当前条件会在 **查询条件** 结果区域中显示，并触发查询。
- 您还可展开**常用查询条件**，快速添加近期使用过的搜索条件。

</Steps>

## 查询结果分析

当您输入查询条件并搜索后，将在页面生成查询结果区域。

### Span 列表

查询结果区域左侧展示了符合条件的 Span 列表及 Span 的基本信息，包括：服务名称、调用的接口或处理请求的方法、耗时和开始时间。

### 时序瀑布图

查询结果区域右侧的时序瀑布图为您清晰展示了一次调用链路中，Span 间调用关系。以下是在调用链分析中使用时序瀑布图的主要特征：
1. 自上而下的展开方式：在时序瀑布图中，各个调用事件（Span）通常从图的上方向下展开，每一个水平条代表一个服务调用或过程，位置的先后一般反映调用的先后逻辑关系。
2. 时间轴对齐：时序瀑布图的水平轴表示时间，每个条形的长度表示该调用的持续时间，从而可以直观地看出不同调用之间的时间对比关系。
3. 缩进描述：缩进表示调用的层级关系，更深的缩进表示在该链路中调用深度更大。
4. 交互性和详细数据显示：通过点击时序瀑布图中的条形，可以显示更多关于该调用的详细信息。

### Span 详情

通过单击时序瀑布图中 Span 所在行，可展开并查看 Span 的详细信息，内容包括：
* Service：Span 中的服务。
* Span 耗时（ms）：Span 持续时间。
* URL：服务访问的 URL，同 Span Tags 中 **http.url**。
* Tag：由键值组成的 Span 的标签信息，可用于高级搜索的标签查询条件，通过点击标签旁按钮，可将当前 Tag 条件加入查询条件，进一步精确查询结果。
* JSON：Span 的原始 JSON 结构，可进一步查看其内部信息。
