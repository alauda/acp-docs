---
weight: 10
sourceSHA: 4c27cb43631fcea956fb1344f79936891877cd666224cdc1e6ba37af08b0b017
---

# 查询追踪

## 功能概述

分布式追踪查询功能为微服务架构提供完整的链路追踪能力，通过收集服务间调用的元数据，帮助用户快速定位跨服务调用问题。此功能主要解决以下问题：

- **请求链路追踪**：在复杂分布式系统中还原完整的请求路径。
- **性能瓶颈分析**：识别链路中时间消耗异常的调用节点。
- **故障根因定位**：通过错误标记快速定位问题发生的点。

适用场景包括：

- 在生产环境故障排查时快速定位异常服务。
- 在性能调优时识别高延迟调用链。
- 在新版本发布后验证服务间的调用关系。

核心价值：

- 提升分布式系统的可观测性。
- 缩短平均恢复时间（MTTR）。
- 优化服务间的调用性能。

## 主要特性

- 多维度查询：支持 TraceID、服务名称、标签等六种查询条件组合。
- 可视化分析：通过时序瀑布图直观地展示调用层级及时间分布。
- 精准定位：支持错误 Span 过滤和标签二次检索。

## 功能优势

- **快速识别问题**：通过多维度查询条件缩小排查范围，加快问题定位速度。
- **可视化呈现**：使用时序瀑布图直观展现调用关系，降低复杂性并提升故障分析的效率。
- **灵活多样**：同时支持简单查询和复杂组合查询，适应各种运维和开发场景。

## 追踪查询

<Steps>
  ### 步骤 1：组合查询条件

  **提示**：查询条件可组合使用，您可以通过添加多个查询条件来精细化查询。

  | 查询条件                | 说明                                                                                                                                                                  |
  | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | **TraceID**          | 完整链路的唯一标识，可用于查询指定的追踪。                                                                                                                                |
  | **服务**              | 发起/接收调用请求的服务（需要选择或输入）。                                                                                                                       |
  | **标签**              | 您可以通过输入标签（Tag）过滤查询结果，支持的标签包括 Span 详情中的标签。                                                                                               |
  | **Span 耗时大于**      | 耗时大于或等于 *输入值*（毫秒）的 Span。                                                                                                                                 |
  | **仅搜索错误 Spans**    | 错误 Span 是指 Tag 值 **error** 为 `true` 的 Spans。                                                                                                               |
  | **Span 类型**         | **根 Span**：搜索由已配置的 **服务** 发起的根 Span。当配置的服务是整个调用请求的发起者时使用此搜索模式。<br />**服务入口 Span**：搜索配置的 **服务** 被调用时生成的第一个 Span。 |
  | **最大查询条数**        | 可查询的最大 Span 数量，默认为 200。<br />**提示**：出于性能考虑，平台一次最多展示 1000 个 Span。如果符合查询条件的 Span 数量超过 **最大查询条数**，您可以细化查询条件或缩小时间范围进行阶段性查询。        |

  ### 步骤 2：执行查询

  - 选择查询条件并输入相应值后，单击 **添加到查询条件** 按钮，当前条件将显示在 **查询条件** 结果区域，并触发查询。
  - 您还可以展开 **常用查询条件**，快速添加近期使用过的搜索条件。
</Steps>

## 查询结果分析

输入查询条件并搜索后，页面将生成查询结果区域。

### Span 列表

查询结果区域左侧显示符合条件的 Span 列表及其基本信息，包括：服务名称、调用的接口或处理请求的方法、耗时及开始时间。

### 时序瀑布图

查询结果区域右侧的时序瀑布图清晰展示了一次追踪中的 Span 之间的调用关系。在追踪分析中使用时序瀑布图的主要特点如下：

1. 自上而下的展开：时序瀑布图中的各个调用事件（Spans）通常自图表上方向下展开，每个水平条形代表一个服务调用或处理过程，位置反映了调用的逻辑顺序。
2. 时间轴对齐：时序瀑布图的横轴代表时间。每个条形的长度表示该调用的持续时间，允许直观比较不同调用间的时间关系。
3. 缩进描述：缩进表示调用的层级关系，缩进越深表示在该链路中调用的深度越大。
4. 交互性和详细数据展示：点击时序瀑布图中的条形可以显示该调用的更多详细信息。

### Span 详情

通过单击时序瀑布图中 Span 所在行，可以展开并查看 Span 的详细信息，其中包含：

- 服务：Span 中的服务。
- Span 耗时（毫秒）：Span 持续时间。
- URL：服务访问的 URL，对应于 Span 标签中的 **http.url**。
- 标签：Span 的标签信息，由键值对组成，可用于高级搜索的标签查询条件。通过点击标签旁的按钮，可以将当前标签条件加入查询条件，以进一步精确查询结果。
- JSON：Span 的原始 JSON 结构，允许进一步检查其内部信息。
