---
weight: 30
i18n:
  title:
    en: Configuring Secrets
    zh: 配置 Secrets
sourceSHA: c58e71ed2d8ab5b8b799f82b5d29e8d059da572db4da07439e43b8921d486dd0
title: 配置 Secrets
---

# 配置 Secrets

在 Kubernetes (k8s) 中，Secret 是用于存储敏感数据的对象，例如：

- 密码

- OAuth 令牌

- SSH 密钥

- TLS 证书

- API 密钥

Secret 的目的是避免将敏感信息直接放入 Pod 规格或容器镜像中。Secrets 是经过 base64 编码的，可以作为卷挂载或作为环境变量暴露。

根据您的需求创建一个 Secret，选择合适的 Secret 类型，并配置参数。

## 创建 Opaque 类型 Secret

```shell
kubectl create secret generic my-secret \
  --from-literal=username=admin \
  --from-literal=password=Pa$$w0rd
```

YAML

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
data:
  username: YWRtaW4= # base64 编码的 "admin"
  password: UGEkJHcwcmQ= # base64 编码的 "Pa$$w0rd"
```

您可以通过以下方式解码：

```shell
echo YWRtaW4= | base64 --decode  # 输出: admin
```

## 创建 Docker 注册表类型 Secret

```shell
kubectl create secret docker-registry my-docker-creds \
  --docker-username=myuser \
  --docker-password=mypass \
  --docker-server=https://index.docker.io/v1/ \
  --docker-email=my@example.com
```

YAML

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-docker-creds
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJteXVzZXIiLCJwYXNzd29yZCI6Im15cGFzcyIsImVtYWlsIjoibXlAZXhhbXBsZS5jb20iLCJhdXRoIjoiYlhsMWMyVnlPbTE1Y0dGemN3PT0ifX19
```

K8s 会自动将您的用户名、密码、电子邮件和服务器信息转换为 Docker 标准登录格式：

```json
{
  "auths": {
    "https://index.docker.io/v1/": {
      "username": "myuser",
      "password": "mypass",
      "email": "my@example.com",
      "auth": "bXl1c2VyOm15cGFzcw=="  # base64(username:password)
    }
  }
}
```

此 JSON 随后被 base64 编码并用作 Secret 的数据字段值。

在 Pod 中使用它：

```yaml
imagePullSecrets:
  - name: my-docker-creds
```

## 创建 Basic Auth 类型 Secret

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: basic-auth-secret
type: kubernetes.io/basic-auth
stringData:
  username: myuser
  password: mypass
```

## 创建 SSH-Auth 类型 Secret

用例：存储 SSH 私钥（例如，用于 Git 访问）。

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: ssh-key-secret
type: kubernetes.io/ssh-auth
stringData:
  ssh-privatekey: |
    -----BEGIN OPENSSH PRIVATE KEY-----
    ...
    -----END OPENSSH PRIVATE KEY-----
```

## 创建 TLS 类型 Secret

用例：TLS 证书（用于 Ingress、webhooks 等）

```shell
kubectl create secret tls tls-secret \
--cert=path/to/tls.crt \
--key=path/to/tls.key
```

YAML

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: tls-secret
type: kubernetes.io/tls
data:
  tls.crt: <base64>
  tls.key: <base64>
```

## 通过 Web 控制台创建 Secret

1. 进入 **Container Platform**。

2. 在左侧导航栏中，单击 **配置** > **Secrets**。

3. 单击 **创建 Secret**。

4. 配置参数。

   **提示**：在表单视图中，对于输入的用户名、密码等敏感数据，将自动经过 Base64 编码格式转换后储存到 Secret 中，转换后的数据可在 YAML 视图中预览。

5. 单击 **创建**。

## 如何在 Pod 中使用 Secret

### 作为环境变量

```yaml
env:
  - name: DB_USERNAME
    valueFrom:
      secretKeyRef:
        name: my-secret
        key: username
```

从名为 `my-secret` 的 Secret 中获取键为 `username` 的值，并将其分配给环境变量 `DB_USERNAME`。

### 作为挂载文件（卷）

```yaml
volumes:
  - name: secret-volume
    secret:
      secretName: my-secret

volumeMounts:
  - name: secret-volume
    mountPath: "/etc/secret"
```

## 后续操作

在同一命名空间中，为原生应用创建工作负载时，可以引用已经创建的 Secrets。

## 相关操作

您可以在列表页面单击右侧的 (⋮) 或在详情页面单击右上角的 **操作**，按需更新或删除 Secret。

| 操作      | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **更新**  | 添加或更新一个 Secret 后，已经通过环境变量引用该 Secret（或其配置项）的工作负载需要重建 Pods，新的配置才能生效。                                                                                                                                                                                                                                                                                                                                                                                      |
| **删除**  | <ul><li>删除 Secret 后，已经通过环境变量引用该 Secret（或其配置项）的工作负载，重建 Pods 时可能会因找不到引用源而受到影响。</li><li>请不要删除平台自动生成的 Secrets，否则可能导致平台功能无法正常使用。例如：类型为 service-account-token 且包含命名空间资源的认证信息的 Secrets，以及系统命名空间（如 kube-system）中的 Secrets。</li></ul> |
