---
weight: 20
i18n:
  title:
    en: Configuring ConfigMap
    zh: 配置 ConfigMap
sourceSHA: 5bc77da900bebe4e36205d1fa84e4160004e04d489be50d529422207934eeafa
title: 配置 ConfigMap
---

# 配置 ConfigMap

在配置字典（ConfigMap）中用键值对保存配置数据，包括单个属性或整个配置文件。配置字典可通过环境变量、配置引用等方式被引用至工作负载中。

:::note
一个 Pod 只能使用同一个命名空间内的配置字典。
:::

## 示例 ConfigMap

您现在可以在 `Pod` 中使用 app-config。

```yaml
# app-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: k-1
data:
  APP_ENV: "production"
  LOG_LEVEL: "debug"
```

## 通过 Web 控制台创建 ConfigMap

1. 进入 **Container Platform**。

2. 在左侧导航栏中，单击 **配置** > **配置字典**。

3. 单击 **创建配置字典**。

4. 参考以下说明配置相关参数。

   | 参数               | 说明                                                                                                                                                                                                                                                                                                                                                           |
   | ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **配置项**         | 指 `key:value` 键值对，支持 **添加** 和 **导入** 两种方式。<br /><ul><li>**添加**：您可以逐条添加配置项，也可以通过在键（Key）输入栏中粘贴一行或多行 key=value 形式的键值对来批量添加配置项。</li><li>**导入**：导入不大于 1M 的文本文件。文件名将作为键，文件内容作为值，被填写在一个配置项中。</li></ul>           |
   | **二进制配置项**   | 指不大于 1M 的二进制文件。文件名将作为键，文件内容作为值，被填写在配置项中。<br />**注意**：在创建配置字典后，无法修改导入的文件。                                                                                                                                                                                                                             |

   **批量添加格式示例**：

   ```
   # 每行一个 key=value 键值对，多个键值对需要换行，否则粘贴后将无法正确识别。
   key1=value1
   key2=value2
   key3=value3
   ```

5. 单击 **创建**。

## 通过 CLI 创建 ConfigMap

```shell
kubectl create configmap app-config \
  --from-literal=APP_ENV=production \
  --from-literal=LOG_LEVEL=debug
```

或者从文件中创建：

```shell
kubectl apply -f app-config.yaml -n k-1
```

## 操作

您可以在列表页面单击右侧的 (⋮) 或在详情页面单击右上角的 **操作**，按需更新或删除配置字典。

配置字典的变化会影响引用该配置的工作负载，请务必提前阅读操作说明。

| 操作       | 说明                                                                                                                                                                                                                                                                                                                                                  |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **更新**   | <ul><li>添加或更新配置字典后，对于已经通过环境变量引用这个配置字典（或其中配置项）的工作负载，需要重建其 Pods 才会应用新配置。</li><li>对于导入的二进制配置项，仅支持更新键，不支持更新值。</li></ul>                                                                                                          |
| **删除**   | 删除配置字典后，对于已经通过环境变量引用这个配置字典（或其中配置项）的工作负载，如果重建 Pods，可能会因找不到引用源而影响 Pods 正常创建。                                                                                                                                                                                                                 |

## 通过 CLI 查看、编辑和删除

```shell
kubectl get configmap app-config -n k-1 -o yaml
kubectl edit configmap app-config -n k-1
kubectl delete configmap app-config -n k-1
```

## 在 Pod 中使用 ConfigMap 的方式

### 作为环境变量

```yaml
envFrom:
  - configMapRef:
      name: app-config
```

每个键都会成为容器中的一个环境变量。

### 作为卷中的文件

```yaml
volumes:
  - name: config-volume
    configMap:
      name: app-config

volumeMounts:
  - name: config-volume
    mountPath: /etc/config
```

每个键都是 `/etc/config` 下的一个文件，文件内容为值。

### 作为单独的环境变量

```yaml
env:
  - name: APP_ENV
    valueFrom:
      configMapKeyRef:
        name: app-config
        key: APP_ENV
```

## ConfigMap 与 Secret 的对比

| 特性       | ConfigMap      | Secret                      |
| ---------- | -------------- | --------------------------- |
| 数据类型   | 非敏感        | 敏感（例如，密码）         |
| 编码       | 明文          | Base64 编码                 |
| 使用场景   | 配置、标志    | 密码、令牌                  |
