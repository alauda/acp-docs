---
weight: 20
i18n:
  title:
    en: Configuring ConfigMap
    zh: 配置 ConfigMap
sourceSHA: f1bf6912599da8d9aee57e20820774b2fc91442ac83db4595aa057eeef207649
title: 配置 ConfigMap
---

# 配置 ConfigMap

配置映射允许您将配置工件与镜像内容解耦，以保持容器化应用程序的可移植性。以下部分定义了配置映射以及如何创建和使用它们。

## 理解配置映射

许多应用程序需要通过某种组合的配置文件、命令行参数和环境变量进行配置。在 OpenShift 容器平台中，这些配置工件与镜像内容解耦，以保持容器化应用程序的可移植性。

`ConfigMap` 对象提供了将配置数据注入容器的机制，同时使容器与 OpenShift 容器平台无关。配置映射可以用于存储细粒度的信息，如单个属性，或粗粒度的信息，如整个配置文件或 JSON 数据块。

`ConfigMap` 对象保存可以在 Pod 中使用的键值对配置数据，或用于存储系统组件（如控制器）的配置数据。例如：

```yaml
# my-app-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-app-config
  namespace: default
data:
  app_mode: "development"
  feature_flags: "true"
  database.properties: |-
    jdbc.url=jdbc:mysql://localhost:3306/mydb
    jdbc.username=user
    jdbc.password=password
  log_settings.json: |-
    {
      "level": "INFO",
      "format": "json"
    }
```

**注意**：您可以在从二进制文件（如图像）创建配置映射时使用 `binaryData` 字段。

配置数据可以通过多种方式在 Pod 中使用。配置映射可以用于：

- 在容器中填充环境变量值
- 在容器中设置命令行参数
- 在卷中填充配置文件

用户和系统组件可以将配置数据存储在配置映射中。配置映射类似于秘密，但旨在更方便地支持处理不包含敏感信息的字符串。

## 配置映射限制

- 必须在 Pod 中使用其内容之前创建配置映射。
- 可以编写控制器以容忍缺失的配置数据。请根据具体情况咨询使用配置映射配置的各个组件。
- `ConfigMap` 对象驻留在一个项目中。
- 只能被同一项目中的 Pod 引用。
- Kubectl 仅支持对从 API 服务器获取的 Pod 使用配置映射。这包括通过 CLI 创建的任何 Pod，或通过复制控制器间接创建的 Pod。它不包括通过 OpenShift 容器平台节点的 `--manifest-url` 标志、`--config` 标志或其 REST API 创建的 Pod，因为这些不是创建 Pod 的常见方式。

## ConfigMap 与 Secret 的对比

| 特性       | ConfigMap      | Secret                      |
| ---------- | -------------- | --------------------------- |
| 数据类型   | 非敏感        | 敏感（例如，密码）         |
| 编码       | 明文          | Base64 编码                 |
| 使用场景   | 配置、标志    | 密码、令牌                  |

## 通过 Web 控制台创建 ConfigMap

1. 进入 **Container Platform**。

2. 在左侧导航栏中，单击 **配置** > **配置映射**。

3. 单击 **创建配置映射**。

4. 参考以下说明配置相关参数。

   | 参数               | 说明                                                                                                                                                                                                                                                                                                                                                           |
   | ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **条目**           | 指 `key:value` 键值对，支持 **添加** 和 **导入** 两种方式。<br /><ul><li>**添加**：您可以逐条添加配置项，也可以通过在键（Key）输入栏中粘贴一行或多行 key=value 形式的键值对来批量添加配置项。</li><li>**导入**：导入不大于 1M 的文本文件。文件名将作为键，文件内容将作为值，填写在一个配置项中。</li></ul>           |
   | **二进制条目**     | 指不大于 1M 的二进制文件。文件名将作为键，文件内容将作为值，填写在配置项中。<br />**注意**：在创建配置映射后，导入的文件无法修改。                                                                                                                                                                                                                             |

   **批量添加格式示例**：

   ```
   # 每行一个 key=value 键值对，多个键值对需要换行，否则粘贴后将无法正确识别。
   key1=value1
   key2=value2
   key3=value3
   ```

5. 单击 **创建**。

## 通过 CLI 创建 ConfigMap

```shell
kubectl create configmap app-config \
  --from-literal=APP_ENV=production \
  --from-literal=LOG_LEVEL=debug
```

或者从文件中创建：

```shell
kubectl apply -f app-config.yaml -n k-1
```

## 操作

您可以在列表页面单击右侧的 (⋮) 或在详情页面单击右上角的 **操作**，按需更新或删除配置映射。

配置映射的变化会影响引用该配置的工作负载，请务必提前阅读操作说明。

| 操作       | 说明                                                                                                                                                                                                                                                                                                                                                  |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **更新**   | <ul><li>添加或更新配置映射后，任何通过环境变量引用此配置映射（或其配置项）的工作负载需要重建其 Pods，以使新配置生效。</li><li>对于导入的二进制配置项，仅支持更新键，不支持更新值。</li></ul>                                                                                                          |
| **删除**   | 删除配置映射后，任何通过环境变量引用此配置映射（或其配置项）的工作负载在重建 Pods 时，可能会因找不到引用源而影响 Pods 的正常创建。                                                                                                                                                                                                                 |

## 通过 CLI 查看、编辑和删除

```shell
kubectl get configmap app-config -n k-1 -o yaml
kubectl edit configmap app-config -n k-1
kubectl delete configmap app-config -n k-1
```

## 在 Pod 中使用 ConfigMap 的方式

### 作为环境变量

```yaml
envFrom:
  - configMapRef:
      name: app-config
```

每个键都会成为容器中的一个环境变量。

### 作为卷中的文件

```yaml
volumes:
  - name: config-volume
    configMap:
      name: app-config

volumeMounts:
  - name: config-volume
    mountPath: /etc/config
```

每个键都是 `/etc/config` 下的一个文件，文件内容为值。

### 作为单独的环境变量

```yaml
env:
  - name: APP_ENV
    valueFrom:
      configMapKeyRef:
        name: app-config
        key: APP_ENV
```

## ConfigMap 与 Secret 的对比

| 特性       | ConfigMap      | Secret                      |
| ---------- | -------------- | --------------------------- |
| 数据类型   | 非敏感        | 敏感（例如，密码）         |
| 编码       | 明文          | Base64 编码                 |
| 使用场景   | 配置、标志    | 密码、令牌                  |
