---
weight: 30
sourceSHA: b5a06d8bacde2809e9e5be173ddb7547c324bf6f48e6b8aa29a78654cb8f3ba8
---

# 资源配额

请参考官方 Kubernetes 文档：[资源配额](https://kubernetes.io/docs/concepts/policy/resource-quotas/)

## 理解资源请求与限制

用于限制特定命名空间可用的资源。命名空间中所有 Pod 的总资源使用量（不包括处于 `Terminating` 状态的 Pod）不得超过配额。

**资源请求**：定义容器所需的最小资源（例如，CPU、内存），指导 Kubernetes 调度器将 Pod 放置在具有足够容量的节点上。

**资源限制**：定义容器可以消耗的最大资源，防止资源耗尽并确保集群稳定性。

## 配额

### 资源配额

> 如果某个资源标记为 `Unlimited`，则不强制执行明确的配额，但使用量不能超过集群的可用容量。

资源配额跟踪命名空间内的累积资源消耗（例如，容器限制、新 Pod 或 PVC）。

**支持的配额类型**

| 字段                   | 描述                                                                                      |
| --------------------- | ---------------------------------------------------------------------------------------- |
| **资源请求**         | 命名空间中所有 Pod 的总请求资源：<ul><li>CPU</li><li>内存</li></ul>                     |
| **资源限制**         | 命名空间中所有 Pod 的总限制资源：<ul><li>CPU</li><li>内存</li></ul>                   |
| **Pod 数量**          | 命名空间中允许的最大 Pod 数量。                                                          |

注意：

- 命名空间配额源自项目分配的集群资源。如果任何资源的可用配额为 0，则命名空间创建将失败。请联系管理员。
- `Unlimited` 意味着命名空间可以消耗项目剩余的集群资源。

#### YAML 文件示例

```yaml
# example-resourcequota.yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: example-resourcequota
  namespace: <example>
spec:
  hard:
    limits.cpu: "20"
    limits.memory: 20Gi
    pods: "500"
    requests.cpu: "2"
    requests.memory: 2Gi

```

#### 使用 CLI 创建资源配额

**通过 YAML 文件创建**

```bash
kubectl apply -f example-resourcequota.yaml
```

**直接通过命令行创建**

```bash
kubectl create resourcequota example-resourcequota --namespace=<example> --hard=limits.cpu=20,limits.memory=20Gi,pods=500 
```

### 存储配额

**配额类型**：

- **全部**：命名空间中 PVC 的总存储容量。
- **存储类**：特定存储类的 PVC 总存储容量。

**注意**：确保存储类已预先分配给包含该命名空间的项目。

<a id="extended-resources-quotas" />

### 扩展资源配额

扩展资源配额通过 **ConfigMap** 定义。如果缺少 ConfigMap，则该资源类别将不会出现。

**ConfigMap 字段描述**

| 字段                         | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ----------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **data.dataType**             | 数据类型（例如，`vGPU`）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **data.defaultValue**         | 默认值（空 = 无默认值）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **data.descriptionEn**        | 英文提示文本（在悬停字段时显示）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **data.descriptionZh**        | 中文提示文本（在悬停字段时显示）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **data.excludeResources**     | 互斥资源（以逗号分隔）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **data.group**                | 资源组（例如，`MPS`）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **data.groupI18n**            | UI 下拉菜单中资源组的英文/中文名称。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **data.key**                  | 指定键的值。配置字典只能描述一个键。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **data.labelEn/data.labelZh** | 资源的英文/中文名称，可以在与配额类型对应的下拉选项中查看和选择。该字段与 data.groupI18n 字段具有相同的功能，但仅适用于同一资源具有单一值的情况，以确保与旧版本配置字典（ConfigMap）的兼容性。                                                                                                                                                                                                                                                                                                                                                                           |
| **data.limits**               | 指示是否为资源配置限制。有效值包括：disabled 表示无法为该资源配置限制，required 表示必须输入，optional 表示可选输入。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **data.requests**             | 指示是否为资源配置请求。有效值包括：disabled 表示无法为该资源配置请求，required 表示必须输入，optional 表示可选输入，fromLimits 表示将使用与限制相同的配置。                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **data.relatedResources**     | 关联资源。该字段保留，当前无法使用。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **data.resourceUnit**         | 资源单位（例如，`cores`，`GiB`）。不支持中文输入。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **data.runtimeClassName**     | 运行时类（默认：`nvidia` 用于 GPU）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **metadata.labels**           | 必须的标签：<ul><li>`features.cpaas.io/type: CustomResourceLimitation`</li><li> `features.cpaas.io/group: <groupName>`</li><li>`features.cpaas.io/enabled`: `true` 或 `false`，该标签是强制性的，指示是否启用，默认值为 true。</li></ul>                                                                                                                                                                                                                                                                                                                                                                                       |
| **metadata.name**             | 格式为 `cf-crl-<*groupName*>-<*name*>`，其中 <ul><li>cf-crl 是固定字段，不能更改。</li><li>groupName 是相应资源组的名称，例如 gpu-manager、galaxy 等。</li><li>name 是资源名称： <ul><li>资源名称可以是标准资源类型名称，例如 cpu、memory、pods 等。标准资源名称必须符合 Kubernetes 的合格名称规则，并且必须存在于 Kubernetes 定义的标准资源类型中。</li><li>资源名称也可以是以特定前缀开头的特殊资源类型，例如：`hugepages-` 或 `requests.hugepages-.`</li></ul></li></ul> |
| **metadata.namespace**        | 必须为 `kube-public`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

<a id="other-quotas" />

### 其他配额

自定义配额名称的格式必须符合以下规范：

- 如果自定义配额名称不包含斜杠（/）：它必须以字母或数字开头和结尾，并且可以包含字母、数字、连字符（-）、下划线（_）或句点（.），形成一个最大长度为 63 个字符的合格名称。
- 如果自定义配额名称包含斜杠（/）：名称分为两部分：前缀和名称，形式为：prefix/name。前缀必须是有效的 DNS 子域，而名称必须符合合格名称的规则。
- DNS 子域：
  - 标签：必须以小写字母或数字开头和结尾，可以包含连字符（-），但不能仅由连字符组成，最大长度为 63 个字符。
  - 子域：扩展标签的规则，允许多个标签通过句点（.）连接形成子域，最大长度为 253 个字符。
