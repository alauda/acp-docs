---
weight: 30
i18n:
  title:
    en: Creating applications from Image
    zh: 通过镜像创建应用
title: 通过镜像创建应用
sourceSHA: 49d6a480dca9806f2abb485be2c32ede07a3b84254a22066f2fc5145d688422e
---

# 通过镜像创建应用

## 前提条件

获取镜像地址。镜像来源可以是通过工具链由平台管理员集成的镜像仓库，或者来自于第三方平台的镜像仓库。

- 对于前者，管理员通常会将镜像仓库分配给您的项目，您可以在其中使用镜像。如果找不到所需的镜像仓库，请联系管理员进行分配。

- 如果是第三方平台的镜像仓库，请确保在当前集群中能够直接从中拉取镜像。

## 操作步骤

1. 在 **Container Platform** 中，导航至 **应用管理** > **应用**。

2. 单击 **创建**。

3. 选择 **通过镜像创建** 作为创建方式。

4. **选择** 或 **输入** 一个镜像，然后单击 **确定**。

:::info
**说明**：当使用来自集成的镜像仓库的镜像时，您可以通过 **已集成** 来筛选镜像。**集成项目名称**，例如 images (docker-registry-projectname)，是指在本平台中的项目名 projectname 与镜像仓库中的项目名 containers。
:::

6. 根据以下说明配置相关参数。

<a id="updatepolicy" />

### 工作负载 1 - 配置基本信息

在 **工作负载** > **基本信息** 部分，配置工作负载的声明性参数。

| **参数**                     | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| :--------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **模型**                     | 按需选择工作负载： <ul><li>**Deployment**: 详细的参数说明，请参考 [创建部署](../application_workloads/deployment_create.mdx)。</li><li>**DaemonSet**: 详细的参数说明，请参考 [创建DaemonSet](../application_workloads/deamonset_create.mdx)。</li><li>**StatefulSet**: 详细的参数说明，请参考 [创建StatefulSet](../application_workloads/statefulset_create.mdx)。</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **副本数**                   | 定义所需的 Pod 副本数（默认：`1`）。根据工作负载要求进行调整。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **更多** > **更新策略**      | 配置零停机时间更新的 `rollingUpdate` 策略： <br />  **最大涌入** (`maxSurge`):  <ul><li>更新过程中可以超过所需副本数的最大 Pod 数。 </li><li>接受绝对值（例如，`2`）或百分比（例如，`20%`）。 </li><li>百分比计算：`ceil(current_replicas × percentage)`。 </li><li>示例：计算 10 个副本时，4.1 → `5`。 </li></ul> **最大不可用** (`maxUnavailable`): <ul><li>更新过程中可以暂时不可用的最大 Pod 数。  </li><li>百分比值不能超过 `100%`。 </li><li>百分比计算：`floor(current_replicas × percentage)`。   </li><li>示例：计算 10 个副本时，4.9 → `4`。 </li></ul> **注意**： <br /> 1. **默认值**：若未明确设置，`maxSurge=1`, `maxUnavailable=1`。  <br /> 2. **非运行中的 Pod**（例如，处于 `Pending`/`CrashLoopBackOff` 状态）被视为不可用。  <br /> 3. **同时约束**： <ul><li> `maxSurge` 和 `maxUnavailable` 不能同时为 `0` 或 `0%`。 </li><li>如果两个参数的百分比值均计算为 `0`，Kubernetes 将强制设定 `maxUnavailable=1` 以确保更新进度。  </li></ul> **示例**： <br /> 对于拥有 10 个副本的 Deployment： <br /><ul><li> `maxSurge=2` → 更新期间的总 Pod 数：`10 + 2 = 12`。 </li><li>`maxUnavailable=3` → 最小可用 Pod 数：`10 - 3 = 7`。 </li><li> 这样可以确保可用性并允许有序发布。 </li></ul> |

### 工作负载 2 - 配置 Pod

**说明**：在混合体系结构集群中部署单一架构镜像时，请确保为 Pod 调度配置正确的 [节点亲和性规则](#schuconf)。

1. 在 **Pod** 部分，配置容器运行时参数和生命周期管理：

   | **参数**                        | **说明**                                                                                                                                                                                                                                                                                         |
   | :------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | **卷**                          | 将持久卷挂载到容器中。支持的卷类型包括 `PVC`、`ConfigMap`、`Secret`、`emptyDir`、`hostPath` 等。有关实现详细信息，请参见 [存储卷挂载说明](#pvmount)。                                                                                                                                    |
   | **镜像凭据**                    | 仅在从第三方注册中心拉取镜像时（通过手动镜像 URL 输入）需要。 <br /> **说明**：从平台集成注册中心的镜像会自动继承相关秘密。                                                                                                                                                 |
   | **更多** > **关闭宽限期**      | 允许 Pod 在收到终止信号后完成平滑关闭的持续时间（默认：`30s`）。 <br /> - 在此期间，Pod 完成飞行中的请求并释放资源。 <br /> - 设置为 `0` 强制立即删除（SIGKILL），可能会导致请求中断。 |

<a id="schuconf" />

2. **节点亲和性规则**
   | **参数**              | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   | :-------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **更多** > **节点选择器**  | 限制 Pods 只能调度到具有特定标签的节点（例如，`kubernetes.io/os: linux`）。 <br /> ![节点 OS 选择器](../application_workloads/assets/nodeselector_os.png)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   | **更多** > **亲和性**      | 根据现有 Pods 定义细粒度的调度规则： <br /> **Pod 亲和性类型**： <ul><li> **Pod 间亲和性**：将新 Pods 调度到托管特定 Pods 的节点上（同一拓扑域）。 </li><li> **Pod 间反亲和性**：防止新 Pods 与特定 Pods 共存。 </li></ul> **实施模式**：  <ul><li> **RequiredDuringSchedulingIgnoredDuringExecution**：仅当规则得到满足时调度 Pods。  </li><li> **PreferredDuringSchedulingIgnoredDuringExecution**：优先调度满足规则的节点，但允许例外。 </li></ul>**配置字段**：  <br /> <ul><li>`topologyKey`：定义拓扑域的节点标签（默认值：`kubernetes.io/hostname`）。  </li><li>`labelSelector`：使用标签查询过滤目标 Pods。  </li></ul> |

3. **网络配置**
   - Kube-OVN
     | **参数**           | **说明**                                                                                                                                                                                                                   |
     | :----------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
     | **带宽限制**       | 为 Pod 网络流量强制执行 QoS：  <ul><li>**出口速率限制**：最大出站流量速率（例如，`10Mbps`）。 </li><li>**入口速率限制**：最大入站流量速率。</li></ul>                                                                         |
     | **子网**           | 从预定义的子网池中分配 IP。如果未指定，则使用命名空间的默认子网。                                                                                                                                                       |
     | **静态 IP 地址**   | 将持久 IP 地址绑定到 Pods：  <ul><li>跨部署的多个 Pods 可以声明相同的 IP，但是同一时间只能有一个 Pod 使用它。  </li><li>**重要**：静态 IP 的数量必须 ≥ Pod 副本数。 </li></ul> |
   - Calico
     | **参数**           | **说明**                                                                                                                                                                                  |
     | :----------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
     | **静态 IP 地址**   | 分配具有严格唯一性的固定 IP：  <ul><li>每个 IP 只能绑定到集群中的 **一个 Pod**。  </li><li> **重要**：静态 IP 的数量必须 ≥ Pod 副本数。</li></ul>                                       |

### 工作负载 3 - 配置容器

1. 在 **容器** 部分，参考以下说明配置相关信息。
   | **参数**                           | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   | :--------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **资源请求和限制**                | <ul><li>**请求**：容器运行所需的最小 CPU/内存。</li><li>**限制**：容器执行期间允许的最大 CPU/内存。有关单位定义，请参见 [资源单位](/developer/overview/unit.mdx)。</li></ul>**命名空间超配比**：<ul><li>**没有超配比**：<br />如果存在命名空间资源配额：容器请求/限制继承命名空间默认值（可修改）。<br />没有命名空间配额：没有默认值；自定义请求。</li><li>**有超配比**：<br />请求自动计算为 `Limits / Overcommit ratio`（不可修改）。</li></ul> **约束条件**：<ul><li>请求 ≤ 限制 ≤ 命名空间配额的最大值。</li><li>超配比的更改需要重新创建 pod 以生效。</li><li>超配比禁用手动请求配置。</li><li>没有命名空间配额 → 没有容器资源约束。</li></ul> |
   | **扩展资源**                       | 配置集群中可用的扩展资源（例如，vGPU、pGPU）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   | **卷挂载**                         | 持久存储配置。请参见 [存储卷挂载说明](#pvmount)。<br />**操作**：<ul><li>现有 Pod 卷：单击 **添加**</li><li>没有 Pod 卷：单击 **添加并挂载**</li></ul>**参数**：<ul><li>`mountPath`：容器文件系统路径（例如，`/data`）</li><li>`subPath`：卷内的相对文件/目录路径。<br />对于 `ConfigMap`/`Secret`：选择特定键</li><li>`readOnly`：以只读方式挂载（默认：读写）</li></ul>有关 [Kubernetes 卷](https://kubernetes.io/docs/concepts/storage/volumes/) 的详细信息。                                                                                                                                                                                                                                                              |
   | **端口**                           | 暴露容器端口。<br />**示例**：暴露 TCP 端口 `6379`，名称为 `redis`。<br />**字段**：<ul><li>`protocol`：TCP/UDP</li><li>`Port`：暴露端口（例如，`6379`）</li><li>`name`：符合 DNS 的标识符（例如，`redis`）</li></ul>                                                                                                                                                                                        |
   | **启动命令和参数**                | 覆盖默认的 ENTRYPOINT/CMD：<br />**示例 1**：执行 `top -b`<br />- **命令**： `["top", "-b"]`<br />- **或** 命令： `["top"]`，参数： `["-b"]`<br />**示例 2**：输出 `$MESSAGE`：<br />`/bin/sh -c "while true; do echo $(MESSAGE); sleep 10; done"`<br />有关 [定义命令](https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/) 的详细信息。                                                                                                                                                                                     |
   | **更多** > **环境变量**           | <ul><li>静态值：直接的键值对</li><li>动态值：引用 ConfigMap/Secret 键、Pod 字段（`fieldRef`）、资源指标（`resourceFieldRef`）</li></ul>**说明**：环境变量会覆盖镜像/配置文件设置。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   | **更多** > **引用的 ConfigMap**    | 将整个 ConfigMap/Secret 注入为环境变量。支持的 Secret 类型包括：`Opaque`、`kubernetes.io/basic-auth`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   | **更多** > **健康检查**           | <ul><li>**存活探针**：检测容器健康（如果失败则重启）</li><li>**就绪探针**：检测服务可用性（如果失败则从端点中移除）</li></ul>有关 [健康检查参数](#healthcheck) 的详细信息。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   | **更多** > **日志文件**           | 配置日志路径：<br />- 默认：收集 `stdout`<br />- 文件模式：例如，`/var/log/*.log`<br />**要求**：<ul><li>存储驱动 `overlay2`：默认支持</li><li>`devicemapper`：手动挂载 EmptyDir 到日志目录</li><li>Windows 节点：确保父目录已挂载（例如，`c:/a` 用于 `c:/a/b/c/*.log`）</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   | **更多** > **排除日志文件**       | 从收集中排除特定日志（例如，`/var/log/aaa.log`）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   | **更多** > **在停止前执行**       | 在容器终止前执行命令。<br />**示例**： `echo "stop"`<br />**说明**：命令执行时间必须短于 pod 的 `terminationGracePeriodSeconds`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

2. 单击 **添加容器**（右上角）或 **添加初始化容器**。

   请参见 [初始化容器](https://kubernetes.io/docs/concepts/workloads/pods/init-containers/)。
   初始化容器：

   1. 在应用容器之前启动（顺序执行）。
   2. 完成后释放资源。
   3. 在以下情况下允许删除：
      - Pod 有超过 1 个应用容器和 1 个以上的初始化容器。
      - 对于只有单个应用容器的 Pods，不允许删除。

3. 单击 **创建**。

## 操作步骤 2 - 服务

| **参数**   | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| :--------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **服务**   | Kubernetes **服务**，将运行在集群中的应用暴露在一个单一的外部可访问端点后，即使工作负载分布在多个后端之间。有关具体参数的说明，请参见 [创建服务](/developer/building_application/functions/operation_after_creating/network_communications/service/create_service.mdx)。<br /><br />**说明**：应用下创建的内部路由的默认名称前缀为计算组件的名称。如果计算组件的类型（部署模式）为 StatefulSet，建议您不要更改内部路由的默认名称（计算组件的名称），否则可能会导致工作负载无法被访问。 |

## 操作步骤 3 - 入口

| **参数**   | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| :--------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **入口**   | Kubernetes **Ingress**，通过具有协议感知配置机制的方式使您的 HTTP（或 HTTPS）网络服务可用，理解 URI、主机名、路径等 Web 概念。Ingress 概念允许您根据通过 Kubernetes API 定义的规则将流量映射到不同的后端。有关具体参数的说明，请参见 [创建入口](/developer/building_application/functions/operation_after_creating/network_communications/ingress/create_ingress.mdx)。<br /><br />**说明**：在应用下创建 **Ingress** 时使用的 **服务** 必须是当前应用下创建的资源。但请确保 **服务** 与应用下的工作负载关联，否则，工作负载的服务发现和访问将失败。 |

7. 单击 **创建**。

## 应用管理操作

要修改应用配置，可以使用以下方法之一：

1. 单击应用列表右侧的省略号（⋮）。
2. 从应用详情页面右上角选择 **操作**。

| **操作** | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| :-------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **更新**  | <ul><li>**更新**：仅修改目标工作负载，按照其定义的 [更新策略](#updatepolicy)（以部署策略为例）进行更新。保留现有副本数和发布配置。</li><li>**强制更新**：触发全应用 rollout，使用各个组件的更新策略。 <br />1. **用例**： <ul><li>批量配置更改需要立即在集群中传播（例如，更新作为环境变量引用的 ConfigMap/Secret）。 </li><li>为重要安全修复协调组件重启。 </li></ul> 2. **警告**： <ul><li>可能导致在大规模重启期间短暂服务降级。 </li><li>在没有业务连续性验证的情况下不推荐用于生产环境。</li></ul></li><li>**网络影响**： <ul><li>删除 Ingress 规则：外部访问仍然可以通过 `LB_IP:NodePort` 访问，前提是： <br /> 1) LoadBalancer 服务使用默认端口。 <br /> 2) 存活的路由规则引用应用组件。 <br />完全外部访问终止需要删除服务。</li><li>删除服务：对应用组件的网络连接不可逆转地丧失。关联的 Ingress 规则在 API 对象持久性下仍然会失效。</li></ul></li></ul> |
| **删除**  | <ul><li>**层叠删除**： <br /> 1. 删除所有子资源，包括 Deployments、Services 和 Ingress 规则。 <br /> 2. 持久卷声明（PVC）根据 StorageClass 中定义的保留政策进行处理。</li><li>**删除前检查清单**： <br /> 1. 验证通过关联服务没有活跃流量。 <br /> 2. 确认状态组件的数据备份已完成。 <br /> 3. 使用 `kubectl describe ownerReferences` 检查依赖资源的关系。</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

## 参考信息

<a id="pvmount" />

### 存储卷挂载说明

| **类型**                    | **用途**                                                                                                                                                                                                                                                                                           |
| :-------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **持久卷声明**              | 绑定现有的 [PVC](/developer/building_application/functions/preparation_before_creating/add_pvc.mdx)，请求持久存储。<br />**说明**：仅绑定的 PVC（具有关联的 PV）可以被选择。未绑定的 PVC 将导致 Pod 创建失败。                                          |
| **ConfigMap**               | 将完整/部分 [ConfigMap](/developer/building_application/functions/preparation_before_creating/add_configmap.mdx) 数据挂载为文件：<ul><li>完整 ConfigMap：在挂载路径下创建以键命名的文件</li><li>子路径选择：挂载特定键（例如，`my.cnf`）</li></ul>               |
| **Secret**                  | 将完整/部分 [Secret](/developer/building_application/functions/preparation_before_creating/add_secret.mdx) 数据挂载为文件：<ul><li>完整 Secret：在挂载路径下创建以键命名的文件</li><li>子路径选择：挂载特定键（例如，`tls.crt`）</li></ul>                       |
| **临时卷**                  | 集群提供的临时卷，具备以下特点：<ul><li> 动态预配置</li><li>生命周期与 Pod 绑定</li><li>支持声明式配置</li></ul>**用例**：临时数据存储。请参见 [PVC](/developer/building_application/functions/preparation_before_creating/add_pvc.mdx)。 |
| **空目录**                  | 在同一 Pod 内实现容器间的临时存储共享：<br />- Pod 启动时在节点上创建<br />- Pod 删除时删除<br />**用例**：容器间文件共享、临时数据存储。                                                                                              |
| **主机路径**                | 挂载主机机器目录（必须以 `/` 开头，例如，`/volumepath`）。                                                                                                                                                                                                                             |

<a id="healthcheck" />

### 健康检查参数

#### 通用参数

| **参数**          | **说明**                                                                                                                              |
| :---------------- | :------------------------------------------------------------------------------------------------------------------------------------------- |
| **初始延迟**      | 启动探测前的宽限期（秒数）。默认值：`300`。                                                                                                   |
| **周期**          | 探测间隔（1-120秒）。默认值：`60`。                                                                                                      |
| **超时**          | 探测超时持续时间（1-300秒）。默认值：`30`。                                                                                              |
| **成功阈值**      | 标记为健康所需的最小连续成功次数。默认值：`0`。                                                                                 |
| **失败阈值**      | 触发动作的最大连续失败次数：<br />- `0`：禁用基于失败的动作<br />- 默认值：`5` 次失败 → 重新启动容器。 |

#### 协议特定参数

| **参数**        | **适用协议**          | **说明**                                                                                                                                              |
| :--------------- | :------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **协议**        | HTTP/HTTPS           | 健康检查协议                                                                                                                                            |
| **端口**        | HTTP/HTTPS/TCP       | 用于探测的目标容器端口。                                                                                                                           |
| **路径**        | HTTP/HTTPS           | 端点路径（例如，`/healthz`）。                                                                                                                            |
| **HTTP 头**     | HTTP/HTTPS           | 自定义头（添加键值对）。                                                                                                                        |
| **命令**        | EXEC                 | 容器可执行的检查命令（例如，`sh -c "curl -I localhost:8080 \| grep OK"`）。<br />**说明**：转义特殊字符并测试命令的可行性。 |
