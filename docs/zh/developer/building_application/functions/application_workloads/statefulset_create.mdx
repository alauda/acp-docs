---
weight: 30
i18n:
  title:
    en: StatefulSets
    zh: 有状态副本集
sourceSHA: 9b03565db7ec4988bd698ce36133bd654a0d05742edb70315da4a1635b88b20a
title: 有状态副本集
---

# 有状态副本集

## 理解有状态副本集

请参考官方 Kubernetes 文档：[有状态副本集](https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/)

**有状态副本集** 是一个 Kubernetes 控制器，旨在通过协调具有稳定网络身份和持久存储的 Pod 实例来管理有状态应用程序。在单一应用架构中，您可以将多个有状态副本集作为离散组件进行部署，以提供专门的服务，同时保持有序的部署、扩展和滚动更新。

## 前提条件

获取镜像地址。镜像的来源可以是平台管理员通过工具链集成的镜像仓库，也可以是第三方平台的镜像仓库。

- 对于前者，管理员通常会将镜像仓库分配给您的项目，您可以使用其中的镜像。如果找不到所需的镜像仓库，请联系管理员进行分配。

- 如果是第三方平台的镜像仓库，请确保当前集群可以直接从中拉取镜像。

## 操作步骤

1. 进入 **Container Platform**，在左侧导航栏中，单击 **Workloads** > **StatefulSets**。

2. 单击 **创建有状态副本集**。

3. **选择** 或 **输入** 镜像，然后单击 **确认**。

   **注意**：仅在使用本平台集成的镜像仓库中的镜像时，您可以通过选择的方式筛选镜像。例如，集成项目名称如 *containers（docker-registry-projectname）* 中包括本平台的项目名称 *projectname* 和镜像仓库中的项目名称 *containers*。

### 配置基本信息

在 **基本信息** 部分，配置声明性参数以进行 Deployment 工作负载：

| **参数**                   | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :------------------------ | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **副本数**                | 定义 Deployment 中期望的 Pod 副本数量（默认为 `1`）。根据工作负载需求进行调整。请根据实际业务请求量进行设置。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **更新策略**              | 控制有状态副本集滚动更新中的分阶段更新：<br />1. **分区值**：<ul><li> 指定 Pod 更新的序号阈值。</li></ul> 2. **行为**：<ul><li> 序号 ≥ 分区值的 Pods 将立即更新。</li><li> 序号 < 分区值的 Pods 保留先前模板。</li></ul> 3. **无效情况**：<ul><li> 如果分区值 > 副本数量，将视为 0。</li></ul> **示例**：<ul><li> 副本数=5（Pods: web-0 \~ web-4）</li><li> 分区=3 → 仅更新 web-3 和 web-4。</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **卷声明模板**            | `volumeClaimTemplates` 是有状态副本集的一个关键特性，支持 **动态按 Pod 持久存储的供给**。有状态副本集中的每个 Pod 副本会自动根据预定义模板获得其专用的持久卷声明 (PVC)。<br />1. **动态 PVC 创建**：为每个 Pod 自动创建唯一 PVC：<ul><li> 命名模式：`<statefulset-name>-<claim-template-name>-<pod-ordinal>`</li><li> 示例：`web-data-0`，`web-data-1`</li></ul> 2. **访问模式**：支持所有 Kubernetes 访问模式：<ul><li> `ReadWriteOnce` (RWO)：单节点读/写</li><li> `ReadOnlyMany` (ROX)：多节点读</li><li> `ReadWriteMany` (RWX)：多节点读/写</li></ul> 3. **存储类**：通过 `storageClassName` 指定存储后端：<ul><li> 如果未指定，则使用集群的默认 StorageClass</li><li> 支持云/本地存储类型 (SSD、HDD 等)</li></ul> **容量**：通过 `resources.requests.storage` 配置容量：<ul><li> 示例：`100Gi`</li><li> 支持动态卷扩展（如果启用）</li></ul> |

### 配置 Pod

在 **Pod** 部分，请参考 [创建部署 - 配置 Pod](./deployment_create.mdx#configurepod)

### 配置容器

在 **容器** 部分，请参考 [创建部署 - 配置容器](./deployment_create.mdx#configurecontainers)

### 创建

单击 **创建**。
