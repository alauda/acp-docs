---
weight: 50
---

# 创建 CronJob

定时任务（CronJob）是 Kubernetes 的一种工作负载控制器（Controllers），您可以通过平台创建一个 CronJob 来定期或重复运行一个非持续性的程序。例如：定时备份、定时清理、定时发送邮件等。

平台中的定时任务除支持定时触发方式外，还支持手动触发方式，您可以在创建定时任务时，选择需要的执行方式。

* **定时触发**：您需要使用定时 Crontab 命令语法，定义任务触发执行的时间点，或如何周期性地运行。

* **手动触发**：选择该执行方式的任务，既不会定时执行，也不会在创建任务后立即执行。您需要在每次决定执行任务的时间点，手动触发任务执行。


## 前提条件

### 获取镜像

镜像来源包括平台管理员通过工具链集成的镜像仓库，或第三方平台的镜像仓库。

* 对于前者，平台管理员通常会将镜像仓库分配给您的项目，然后您可使用其中的镜像。如果是第三方平台的镜像仓库，需确保在当前集群可直接从中拉取镜像。

* 如果拉取的镜像需要凭据，需要您先在当前命名空间下创建凭据（保密字典）。


## 操作步骤

1. 进入 **Container Platform**。

1. 在左侧导航栏中，单击 **计算组件** > **定时任务**。

2. 单击 **创建定时任务**。

3. 配置镜像，单击 **确定**。

    **说明**：仅当使用本平台集成的镜像仓库中镜像时，可以通过 **选择** 方式筛选镜像。其中，集成项目名称例如 *containers（docker-registry-projectname）* ，包括本平台中的项目名 *projectname* ，以及镜像仓库中项目名 *containers* 。

4. 配置 **基本信息**。
    

    * 在 **定时配置** 区域，设置任务的触发执行方式等相关参数。
    
        * 如果选择了 **手动触发**，您需要在每次决定执行任务的时间点，手动触发任务执行。
        
        * 如果选择了 **定时触发**，需要配置以下定时参数。  
        
            |参数| 说明                                                         |
            | ------------ | ------------------------------------------------------------ |
            |**触发规则**|选择时区，输入使用定时 Crontab 命令语法定义的任务触发执行的时间点，平台会根据时区与时间点共同计算并显示出下次触发时间，时间转换规则和输入格式请参考：[如何设置定时任务的定时触发规则？](/developer/building_application/how_to/cronjob_rules.mdx) <br/><br/>**注意：**<ul><li>Kubernetes 为 v1.25 以下版本时，不支持选择时区，必须使用 UTC 时区，输入的时间点必须为 UTC 时间。</li><li>Kubernetes 为 v1.25 及以上版本时，可按需选择时区，默认值为用户当前所在的时区，输入的时间点是所选时区的时间点。</li></ul> |
            |**定时并发策略**| 选择当前一个任务未执行完时，触发了下一次任务的并发处理策略。 |



        * 无论选择了何种触发执行方式，需要在 **最多保留任务历史数量** 区域，设置最多要保留的 **成功任务历史** 个数和 **失败任务历史** 个数，默认均为 20 个。一旦相应状态的任务历史总个数超过了 **最多保留任务历史数量** 设置的值，系统将自动删除最早的任务历史。

    * 在 **任务配置** 区域，选择任务作业类型。

        任务的作业是通过容器组实际完成的，您可以根据实际需求选择不同的任务作业类型，相应创建一个或多个容器组执行任务。一个容器组从创建到完成业务（Succeeded or failed），即为一次作业过程；一个作业的容器组达到 Succeeded 状态，计算一次作业成功；一个作业的容器组达到 Failed 状态，计算一次作业失败。
    
        |参数| 说明                                                         |
        | ------------ | ------------------------------------------------------------ |
        |**作业类型**| <ul><li>单次作业：任务每次触发执行时，一次执行单个作业。</li><li>并行作业：任务每次触发执行时，可并行执行多个作业。</li><li>固定次数作业：任务每次触发执行时，可并行执行多个作业，并且需要固定次数的成功作业。</li></ul> |
        |**失败重试次数**|      即 backofflimit。执行作业的容器组达到 Failed 状态的次数，如果超过了设置的作业失败重试次数，任务被判定为失败。                |
        |**任务超时时间**| 即 ActiveDeadlineSeconds，整个任务的超时时间，超过这个时间后，无论任务状态如何，任务判定为失败。|
        |**计划成功次数**| 即 parallelisms，即 completions，仅当任务作业类型为 **固定次数作业** 时，需要配置此项，设置需要几次成功作业（达到 Succeeded 状态的容器组）。|
        |**最大并行次数**| 即 parallelisms，当任务类型为支持并行执行多个作业的 **并行作业** 和 **固定次数作业** 时，需要配置此项，设置最多可并行执行多少个作业（运行的容器组）。 |


8. 容器组、容器的操作与创建部署时类似，请参考 [创建部署](./deployment_create.mdx)。


10. 单击 **创建**。


## 立即执行定时任务

1. 进入 **Container Platform**。

1. 在左导航栏中，单击 **计算组件** > **定时任务**。

2. 找到定时任务，单击 ⋮ > **立即执行**，并确定。
    
    
    可在任务详情页面查看任务状态。
    
    * 执行中：任务正在执行。
    
    * 成功：任务执行成功。
    
    * 失败：任务执行失败。