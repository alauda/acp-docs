---
weight: 40
i18n:
  title:
    en: Configuring Network Policies
    zh: 配置网络策略
title: 配置网络策略
sourceSHA: 260351b84b1a7795535337f2169184b803fe9224320f9e364053a2cc426f42db
---

# 配置网络策略

:::info
该平台现在为网络策略提供了两种不同的用户界面。旧版本因兼容性原因仍在维护，而新版本则更加灵活，并且提供了原生的 YAML 编辑器。我们推荐使用新版本。

请联系平台管理员启用 `network-policy-next` 功能以访问新用户界面。
:::

NetworkPolicy 是一个以命名空间为范围的 Kubernetes 资源，由 CNI 插件实现。
通过网络策略，您可以控制 Pods 的网络流量，达到网络隔离的目的，从而降低攻击风险。

默认情况下，所有 Pods 可以自由通信，允许来自任何来源的入站和出站流量。
当应用网络策略时，目标 Pods 仅接受与规范匹配的流量。

:::warning
网络策略仅适用于容器流量。它们不影响以 **hostNetwork** 模式运行的 Pods。
:::

## 步骤

1. 进入 **容器平台**。

2. 在左侧导航栏，点击 **网络** > **网络策略**。

3. 点击 **创建网络策略**。

4. 根据以下说明完成相关配置。

   <table>
     <thead>
       <tr>
         <th>区域</th>
         <th colSpan={2}>参数</th>
         <th>描述</th>
       </tr>
     </thead>

     <tbody>
       <tr>
         <td rowSpan={2}>目标 Pod</td>
         <td colSpan={2}>Pod 选择器</td>
         <td>以键值形式输入目标 Pods 的标签；如果未设置，将应用于当前命名空间中的所有 Pods。</td>
       </tr>

       <tr>
         <td colSpan={2}>当前策略影响的目标 Pods 预览</td>
         <td>点击 <b>预览</b> 查看该网络策略影响的目标 Pods。</td>
       </tr>

       <tr>
         <td rowSpan={5}>入站</td>
         <td colSpan={2}>阻止所有入站流量</td>
         <td>阻止所有入站流量到目标 Pod。 <br /><br /><b>注意</b>:<ul><li>如果在 YAML 的 `spec.policyTypes` 字段中添加了入站，但没有配置具体规则，则在切换回表单时，<b>阻止所有入站流量</b> 选项将自动被选中。</li><li>如果在 YAML 中同时删除 `spec.ingress`、`spec.egress` 和 `spec.policyTypes` 字段，则在切换回表单时，<b>阻止所有入站流量</b> 选项将自动被选中。</li></ul></td>
       </tr>

       <tr>
         <td rowSpan={3}>规则<br /><br /><b>描述</b>: 如果在规则中添加多个来源，则它们之间存在逻辑 <b>或</b> 关系。</td>
         <td>当前命名空间中的 Pods</td>
         <td>匹配当前命名空间中具有指定标签的 Pods；只有匹配的 Pods 可以访问目标 Pod。您可以点击 <b>预览</b> 查看受当前规则影响的 Pods。如果此项未配置，默认情况下允许当前命名空间中的所有 Pods 访问目标 Pod。</td>
       </tr>

       <tr>
         <td>当前集群中的 Pods</td>
         <td>匹配集群中具有指定标签的命名空间或 Pods；只有匹配的 Pods 可以访问目标 Pod。您可以点击 <b>预览</b> 查看受当前规则影响的 Pods。 <ul><li>如果同时配置命名空间和 Pod 选择器，则将取两者的交集，这意味着将从指定命名空间中选择具有指定标签的 Pods。</li><li>如果此项未配置，默认情况下，集群中所有命名空间的所有 Pods 都可以访问目标 Pod。</li></ul></td>
       </tr>

       <tr>
         <td>IP 范围</td>
         <td>输入可以访问目标 Pod 的 CIDR，并可以排除不允许访问目标 Pod 的 CIDR 范围。如果此项未配置，任何流量都可以访问目标 Pod。<br /><br /><b>描述</b>: 您可以以 <i>exampleip</i>/32 的形式添加排除项以排除单个 IP 地址。</td>
       </tr>

       <tr>
         <td colSpan={2}>端口</td>
         <td>匹配指定协议和端口上的流量；可以添加 Pods 上的数字端口或端口名称。如果此项未配置，将匹配所有端口。</td>
       </tr>

       <tr>
         <td rowSpan={5}>出站</td>
         <td colSpan={2}>阻止所有出站流量</td>
         <td>阻止所有出站流量到目标 Pod。 <br /><br /><b>注意</b>:<ul><li>如果在 YAML 的 `spec.policyTypes` 字段中添加了出站，但没有配置具体规则，则在切换回表单时，<b>阻止所有出站流量</b> 选项将自动被选中。</li></ul></td>
       </tr>

       <tr>
         <td colSpan={2}>其他参数</td>
         <td>与 **入站** 参数类似，这里不再详细说明。</td>
       </tr>
     </tbody>
   </table>

5. 点击 **创建**。

## 参考

如果您想了解更多细节，请查看关于 [网络策略](https://kubernetes.io/docs/concepts/services-networking/network-policies/) 的官方文档。
