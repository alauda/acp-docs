---
weight: 20
---

# 配置 HPA


对于无状态应用，HPA（Horizontal Pod Autoscaler，Pod 水平自动伸缩）支持根据您的业务需求及预设策略自动扩缩 Pod 个数，以应对业务负载的急剧飙升或适当节省资源供其他业务使用。

## 前提条件

请确保当前集群已部署监控组件，且监控组件运行正常。您可通过单击平台右上角 <span style={{ display: 'inline-flex', alignItems: 'center', gap: '4px', verticalAlign: 'middle' }}><img src="./assets/question.png" alt="expand" style={{ verticalAlign: 'middle' }} /> <span>  > **平台健康状态**， 查看监控组件部署和健康状况。</span></span>。

## 操作步骤

1. 进入 **Container Platform**。

1. 在左侧导航栏中，单击 **计算组件** > **部署**。

2. 单击 ***部署的名称*** 。

3. 下拉至 **弹性伸缩** 区域，单击右侧的 **更新**。

4. 选择 **水平伸缩**，并完成策略配置。

    |参数| 说明                                                         |
    | -------- | ------------------------------------------------------------ |
    |**实例数**| 部署创建成功后，对于已知且有规律的业务量变化，您需要评估与低业务量匹配的 **最小实例数**，以及在业务高压下命名空间限额可支撑的 **最大实例数**。最大或最小实例数设置后并非不可变化，建议先通过性能测试得出较为准确的数值，并在使用过程中不断调整以满足业务需要。                                           |
    |**触发策略**| 列举对业务变化较敏感的 **指标** 及其 **目标阈值**，用以触发扩容或缩容干预。<br/>例如设置 *CPU 利用率 = 60%* 后，一旦 CPU 利用率不等于60%，便会就当前部署存在的资源不足或是利用不足问题开始自动增加或减少实例个数。<br/>**说明**：指标类型包括内置指标和自定义指标。自定义指标仅适用于原生应用中的部署，且需先 [添加自定义指标]() 。 |
    |**扩容/缩容步长（Alpha）**| 对于有特殊扩容或缩容速率要求的业务，可通过指定 **扩容步长** 或 **缩容步长** 来逐步适应业务量的变化。<br/>对于缩容步长您可以自定义 **稳定窗口**，默认为 300 秒，即需等待 300 秒过后开始执行缩容操作。  |


5. 单击 **更新**。

**说明**：

* 对于  **CPU 利用率** 和 **内存利用率** 指标，仅当实际值在目标阈值上下波动 10% 范围以外时，才会触发自动伸缩。

* 缩容可能会对正在运行的业务产生影响，请谨慎操作。

## 计算规则说明    

当业务指标变化时，平台将根据下述规则自动计算与业务量相匹配的目标实例数，并对应调整该数值。如果业务指标持续变化，该值将被调整到所设的 **最小实例数** 或 **最大实例数** 为止。

* 单策略目标实例数：ceil[(sum(指标实际值)/指标阈值)]。即各容器组的指标实际值之和除以指标阈值，取大于或者等于所得结果的最小整数。例如：当前共有 3 个容器组，CPU 利用率分别为 80、80%、90%，设置的 CPU 利用率阈值为 60%。根据公式计算，容器组实例数将被自动调整为：ceil[(80%+80%+90%)/60%] = ceil 4.1 = 5 个。

    **说明**：
    
    * 若计算所得的目标实例数超出了设置的 **最大实例数** （例如 *4* ），平台将只能扩容至 4 个实例。如果修改最大实例数后，指标仍持续居高不下，也许您应改用其他方式扩容，例如增加命名空间容器限额，或增加硬件资源。
    
    * 若计算所得的目标实例数（前例中 *5* ）小于应根据 **扩容步长** 变化后的实例数（例如 *10* ），平台将只扩容至 5 个实例。


* 多策略目标实例数：取各策略计算结果中的最大值。
