---
weight: 20
sourceSHA: 50a71ed4f4bd316160593a2371cdf2fb141654f99e6d8eab4191bfe1b0956b80
---

# 配置 HPA

对于无状态应用，HPA（Horizontal Pod Autoscaler，水平 Pod 自动扩缩器）能够根据您的业务需求和预设策略自动调整容器组的数量，以应对业务负载的急剧变化或合理节省资源供其他应用使用。

## 前提条件

请确保当前集群已部署监控组件，并且它们工作正常。您可以通过单击平台右上角的 <span style={{ display: 'inline-flex', alignItems: 'center', gap: '4px', verticalAlign: 'middle' }}><img src="./assets/question.png" alt="expand" style={{ verticalAlign: 'middle' }} /> <span>  > **平台健康状态**</span></span> 查看监控组件的部署和健康状态。

## 操作步骤

1. 进入 **容器平台**。

2. 在左侧导航栏中，点击 **工作负载** > **部署**。

3. 点击 ***部署名称***。

4. 向下滚动至 **弹性伸缩** 区域，然后单击右侧的 **更新**。

5. 选择 **水平伸缩**，并完成策略配置。

   | 参数                          | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   | ----------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Pod 数量**                  | 在部署成功创建后，您需要根据已知且规律的业务量变化评估与之对应的 **最小 Pod 数量** 和在高业务压力下命名空间配额可支撑的 **最大 Pod 数量**。设定后的最大或最小 Pod 数量可以进行修改，建议先通过性能测试得出更准确的数值，并在使用过程中持续调整以满足业务需求。                                                                                                                                                                                                                                                                                             |
   | **触发策略**                 | 列举对业务变化敏感的 **指标** 及其 **目标阈值** 用以触发扩容或缩容操作。<br />例如，设置 *CPU 利用率 = 60%* 后，一旦 CPU 利用率偏离 60%，平台将会根据当前部署的资源配置不足或过剩情况自动调整 Pod 的数量。<br />**注意**：指标类型包括内置指标和自定义指标。自定义指标仅适用于原生应用中的部署，并且您需要先 [添加自定义指标]()。                                                                                                                                                                                                                    |
   | **扩容/缩容步长（Alpha）**   | 对于有特定扩容速率要求的业务，您可以通过指定 **扩容步长** 或 **缩容步长**，逐步适应业务量的变化。<br />对于缩容，您可以自定义 **稳定窗口**，默认是 300 秒，意味着您必须等待 300 秒后才能执行缩容操作。                                                                                                                                                                                                                                                                                             |

6. 点击 **更新**。

**说明**：

- 对于 **CPU 利用率** 和 **内存利用率** 指标，仅当实际值波动超出目标阈值的±10%时，才会触发自动伸缩。

- 缩容可能会影响正在进行的业务，请谨慎操作。

## 计算规则

当业务指标发生变化时，平台将根据以下规则自动计算符合业务量的目标 Pod 数量，并进行相应调整。如果业务指标持续波动，Pod 数量将调整至设定的 **最小 Pod 数量** 或 **最大 Pod 数量**。

- 单一策略目标 Pod 数量：ceil\[(sum(实际指标值)/指标阈值)]。即所有 Pod 实际指标值之和除以指标阈值，向上取整为最小大于或等于结果的整数。例如：如果当前有 3 个 Pod，CPU 利用率分别为 80%、80% 和 90%，设置的 CPU 利用率阈值为 60%。根据公式，Pod 数量将被自动调整为：ceil\[(80%+80%+90%)/60%] = ceil 4.1 = 5 个。

  **说明**：

  - 如果计算得到的目标 Pod 数量超过设定的 **最大 Pod 数量**（例如 *4*），平台将仅扩展到 4 个 Pod。如果在更改最大 Pod 数量后，指标仍持续偏高，您可能需要考虑其他扩展方法，如增加命名空间的 Pod 限额或添加硬件资源。

  - 如果计算得到的目标 Pod 数量（在前面的例子中为 *5*）少于根据 **扩容步长** 变化后的 Pod 数量（例如 *10*），平台将仅扩展到 5 个 Pod。

- 多策略目标 Pod 数量：取各策略计算结果中的最大值。
