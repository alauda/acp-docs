---
weight: 20
---

# 添加监听端口

负载均衡器支持通过监听端口和对应协议来接收客户端的连接请求，支持的协议包括 HTTPS、HTTP、gRPC、TCP 和 UDP。

## 前提条件

如果需要添加 HTTPS 监听端口，还应联系管理员为当前项目分配一个 TLS 证书用于加密。

## 操作步骤

1. 进入 **Container Platform**。

1. 在左侧导航栏中，单击 **网络** > **负载均衡**。

2. 单击负载均衡器的名称，进入详情页面。

3. 单击 **添加监听端口**。

4. 参考以下说明，配置相关参数。

    |参数| 说明                                                         |
    | ---------- | ------------------------------------------------------------ |
    |**协议**| 支持的协议有 HTTPS、HTTP、gRPC、TCP 和 UDP。选择 HTTPS 时需要添加证书；选择 gRPC 协议时添加证书可选。<br/><br/>**注意**：<br/><ul><li>当选择 gRPC 协议时，后端协议默认为 gRPC，不支持会话保持。</li><li>若 gRPC 协议设置了证书，负载均衡会卸载 gRPC 的证书后，将不带证书的 gRPC 流量转发至后端服务中。</li><li>若使用 Google GKE 集群，同一个 **容器网路类型** 的负载均衡器中不能同时存在 TCP 和 UDP 两种协议的监听。</li></ul> |
    |**内部路由组**| - 当均衡算法选择 **轮询（RR）** 时，访问流量将按照内部路由组的顺序依次分发至内部路由的端口中。<br/>- 当均衡算法选择 **加权轮询 (WRR）** 时，权重值越高的内部路由，被轮询到的概率越高，访问流量将按照所配置 **权重** 计算出的概率分发流量至内部路由的端口中。<br/>**提示**：概率的计算方式为：当前权重值与所有权重值之和的比值。|
    |**会话保持**| 始终转发特定的访问请求至前述内部路由组对应的后端服务。<br/><br/>特定的访问请求指（任选一种）：<ul><li>源地址哈希：源自同一 IP 地址的所有访问请求。<br/>**注意**：在公有云环境中，由于源地址经常发生变化，会导致相同客户端的请求在不同时间点具有不同的源 IP 地址，使得源地址哈希技术的实际效果无法达到预期。</li><li>Cookie key：携带指定 Cookie 的访问请求。</li><li>Header name：携带指定 Header 的访问请求。</li></ul> |
    |**后端协议**| 访问流量转发到后端服务时所用的协议。例如：如需转发到后端的 Kubernetes、dex 服务，需要选择 HTTPS 协议。                                             |


5. 单击 **确定**。  

## 后续操作

对于来自 HTTP、gRPC 和 HTTPS 端口的流量，除了默认内部路由组以外，还可设置更多样的后端服务匹配  [规则](./add_rule.mdx)。负载均衡器会先根据所设规则匹配对应的后端服务；若根据规则匹配失败，才会匹配前述内部路由组对应的后端服务。

## 相关操作

您可以在列表页面单击右侧的 ⋮ 或在详情页面单击右上角的 **操作**，按需更新默认路由或删除监听端口。

**注意**：如果负载均衡器的资源分配方式为 **端口**，则只能由管理员在 **平台管理** 视图中删除相关监听端口。

