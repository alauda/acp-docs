---
weight: 10
sourceSHA: 7906699f115a1a99abb070c82048431d0c1c62c86966d91f066d305d4e833b72
---

## 创建 Service

内部路由（Kubernetes Service）可用于工作负载的服务发现，提供统一的 IP 地址或主机端口来访问这些组件。

## 操作步骤

1. 进入 **Container Platform**。

2. 在左侧导航栏中，单击 **网络** > **内部路由**。

3. 单击 **创建内部路由**。

4. 参考以下说明，配置相关参数。

   | 参数                | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   | ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **虚拟 IP**        | 如果启用，将为内部路由分配一个集群内部的 IP 地址（ClusterIP），可用于集群内部的服务发现。<br />如果禁用，将创建 Headless Service（无头服务），通常用于 **有状态副本集**（StatefulSet）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   | **外网访问**       | 如果 **虚拟 IP** 启用：<ul><li>**不启用**：端口不会对外暴露，仅在集群内部以 ClusterIP 模式提供 IP 地址。</li><li>**NodePort**：将在每个计算节点主机上打开一个固定端口（NodePort），通过此端口对外暴露内部路由，外部可以通过 `<NodeIP>:<NodePort>` 访问服务。同时，将为服务发现分配一个内部 IP 地址。</li><li>**LoadBalancer**：将使用负载均衡器将流量转发到后端服务。LoadBalancer 类型的路由只支持使用相同的传输层协议；例如，如果使用 TCP，则支持的流量协议包括 HTTP、HTTPS、gRPC 等。当使用公有云集群时，请参考 [LoadBalancer 类型内部路由注解说明](./annotation.mdx) 根据需要添加注解。</li></ul><br />如果 **虚拟 IP** 禁用：默认选择为不启用且不可修改；平台将创建一个 Headless Service，通常用于 **有状态副本集**（StatefulSet）。 |
   | **目标组件**       | <ul><li>**工作负载**：内部路由将请求转发到**特定**工作负载，匹配标签如 `project.cpaas.io/name: projectname` 和 `service.cpaas.io/name: deployment-name`。</li><br /><li>**虚拟化**：内部路由将请求转发到**特定**虚拟机或虚拟机组。</li><br /><li>**标签选择器**：内部路由将请求转发到具有指定标签的**某类**工作负载，例如 `environment: release`。</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   | **端口**           | 用于配置内部路由的访问策略。在以下示例中，集群内的其他 Pods 可以通过虚拟 IP（如果启用）和 TCP 端口 *80* 调用此内部路由；访问请求将被转发到目标组件的 Pods 中对外暴露的 TCP 端口 *6379* 或 *redis* 。<ul><li>**协议**：内部路由使用的协议，支持的协议包括：`TCP`、`UDP`、`HTTP`、`HTTP2`、`HTTPS`、`gRPC`。</li><li>**服务端口**：内部路由在集群内部暴露的服务端口号，即 Port，例如 *80*。</li><li>**容器端口**：服务端口映射的目标端口号（或名称），即 targetPort，例如 *6379* 或 *redis*。</li><li>**服务端口名称**：将自动生成。格式为 `<协议>-<服务端口>-<容器端口>`，例如：*tcp-80-6379* 或 *tcp-80-redis*。</li></ul>                                                                                                                                             |
   | **会话保持**       | 基于源 IP 地址（ClientIP）的会话保持。如果启用，来自同一 IP 地址的所有访问请求在负载均衡时将保持在同一服务器上，确保来自相同客户端的请求转发到同一服务器进行处理。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

5. 单击 **创建**。

## 相关操作

您可以在列表页面右侧单击 ⋮ 图标或在详情页面右上角单击 **操作** 按钮，根据需要更新或删除内部路由。

- 名称旁边带有 **灰度发布** 标签的内部路由是结合 Service Mesh 平台为灰度发布自动生成的，用于灰度发布的内部路由。这些内部路由仅支持查看，不支持更新或删除。

- 删除内部路由将使与该内部路由关联的入站规则失效，最终导致无法实现工作负载的服务发现和访问。
