---
weight: 50
sourceSHA: 9215967e559e9cf0343a0b46b9635f0b04640492c96acce2ee4b23140e6ca927
---

# 深入理解 CUE

平台使用 CUE 进行自定义组件及运维特征的描述，将 CUE 作为应用交付核心依赖和扩展方式，以可编程的方式，去定义和交付生产级别的应用程序。

## 概述

CUE 是一门用于处理配置、结构和数据的开源数据约束语言，它延续了 JSON 的思想，使用户可以像使用 JSON 一样轻松地处理配置信息。CUE 项目完全由 Go 语言编写，允许用户利用 CUE 提供的各种必要功能，如 encoding、strings、math 等，以完成常见的配置编写任务，通过在 Go 中实现 CUE 并提供丰富的 API 支持，使得用户能够轻松解决数据约束问题。

## 基础语法

CUE 拥有精简的语法，易于学习和使用，具体请参考 [CUE 入门](https://kubevela.io/zh/docs/platform-engineers/cue/basic/)、[CUE 教程](https://cuetorials.com/) 及 [官方文档](https://cuelang.org/docs/)。

| CUE 语法             | 说明                                                                                                                                                                                                                                                                                                 |
|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **cue**              | 使用 CUE 进行描述。                                                                                                                                                                                                                                                                                   |
| **parameter**        | 参数设置。该参数是对外暴露的参数，可在后续各模块中使用 `parameter.xxx` 的形式进行调用。                                                                                                                                                                                                             |
| **output**           | 定义主要工作负载结构数据的模板。例如：自定义复合组件 Deployment + Service，Deployment 可视为主要工作负载。                                                                                                                                                                                        |
| **outputs**          | 定义辅助资源结构数据模板。例如：自定义复合组件 Deployment + Service，Service 可视为辅助资源，可使用 `outputs: service:` 的形式进行定义。                                                                                                                                                       |
| **...**              | 可以容纳多个数据或字段。例如：`[string]` 表示数组中只能容纳一个类型为 string 的元素，而 `[...string]` 表示数组中可以容纳多个类型为 string 的元素。                                                                                                                                                     |
| **?:**               | 定义一个可选的变量。即该值可以传入数值，也可以不传入数值，一般配合判断语句使用。                                                                                                                                                                                                                          |
| **a: \*1 \| int**    | `*` 指定变量的默认值，与 `\|` 配合表示定义一个 int 类型且默认值为 1 的变量 a。                                                                                                                                                                                                                       |
| **\_\|_**            | 表示值为空。                                                                                                                                                                                                                                                                                            |
| **\\(key)**          | 引用对象，并将对应值替换该部分内容。例如：a=3，现有语句 v\\(a)，那么最终输出结果为 v3。                                                                                                                                                                                                            |
| **context.xxx**      | 使用运行时的信息替换该内容，所有预配置的 `context` 请参考 [组件中完整可用的 context](https://kubevela.io/zh/docs/platform-engineers/components/custom-component/#full-available-context-in-component)。                                                                                                  |
| **\\\\**             | 注释内容，便于用户理解，不产生实际作用。                                                                                                                                                                                                                                                              |
| **\\\ +usage**       | 特定的注释格式，用于提供有关参数、字段或其他元素用途的信息，以便将这些信息包含在文档中或在用户界面中显示给用户。在平台中，此项会显示为参数的解释信息。                                                                                                                                                           |
| **for**              | 根据条件进行语句循环，具体请参考 [更多语法](https://kubevela.io/docs/platform-engineers/cue/basic/#advanced-cue-schematic)。                                                                                                                                                                            |
| **if**               | 判断语句。                                                                                                                                                                                                                                                                                             |

## 相关说明

### 自定义组件及运维特征必填字段

|                                              | 所在字段        | 说明                                                                                                    |
|----------------------------------------------|-----------------|--------------------------------------------------------------------------------------------------------|
| **definition.oam.cpaas.io/provider: user**  | metadata.labels  | 可用于组件间相互查找和选择，此项必须填写且不可修改。                                                |
| **namespace: kube-public**                   | metadata         | 必须指定为 kube-public 命名空且不可修改。                                                               |
| **schematic**                                | spec             | 定义组件的详细信息。                                                                                    |

### 自定义组件其他字段说明

| 字段                      | 缺省           | 说明                                                                                                                                                                  |
|--------------------------|----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **metadata.annotations**  | 可缺省字段     | <ul><li>`definition.oam.cpaas.io/name: '{"zh": "中文名称", "en": "英文名称"}'`：自定义组件的名称。</li><li>`definition.oam.cpaas.io/tag: '{"zh": "中文标签", "en": "英文标签"}' `：自定义组件的标签。</li><li>`definition.oam.cpaas.io/description: '{"zh": "中文描述", "en": "英文描述"}'`：自定义组件的描述信息。</li></ul> |
| **spec.workload**        | 可缺省字段     | 为系统指明了一个组件背后对应的工作负载类型，有如下两种定义方式：<ul><li>方式一：填写 `spec.workload.definition` 的具体资源组和资源类型名称。</li><li>方式二：填写一个工作负载类型的名称，对于背后的工作负载类型不明确的组件定义，可以填写一个特殊的工作负载类型 `autodetects.core.oam.dev`，表示让平台自动发现背后的工作负载。</li></ul> |

### 自定义运维特征其他字段说明

自定义运维特征具体字段说明请参考 [运维特征定义](https://kubevela.io/docs/platform-engineers/oam/x-definition/#traitdefinition)。

| 字段                       | 缺省及类型                      | 说明                                                                                                                                                                |
|----------------------------|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **metadata.labels**        | 可缺省字段                      | `definition.oam.cpaas.io/tags: xxx`：运维特征的类型，可选项包括：dynamic（动态特性）、config（附加配置）、network（网络）及 monitor（监控分析类）。                                  |
| **spec.definition**        | 可缺省字段                      | 运维特征对应的 Kubernetes 资源定义，若运维能力通过 Kubernetes 的 RD 方式提供则可以填写此项，其中 apiVersion 和 kind 分别描述了背后对应的 Kubernetes 资源组和资源类型。                            |
| **spec.workloadRefPath**  | 可缺省字段                      | 运维能力中对于工作负载对象的引用字段路径，运维能力中如果涉及到工作负载的引用，可以填写这样一个路径地址（如操作弹性扩缩容的 HPA 对象，即可填写 spec.scaleTargetRef 字段），之后平台会自动将工作负载的实例化引用注入到运维能力的实例对象中。 |
| **spec.appliesToWorkloads**| 可缺省字段、字符串数组类型     | 运维特征能够适配的工作负载名称列表，说明这个运维特征可以用于一种或一组工作负载类型。                                                                                     |
| **spec.conflictsWith**    | 可缺省字段、字符串数组类型     | 与该运维特征冲突的其他运维特征名称列表，说明这个运维特征与哪些运维特征冲突。                                                                                           |
| **spec.podDisruptive**    | 可缺省字段，bool 类型          | 说明运维能力的参数更新会不会引起底层资源（Pod）重启。这个标识通常可以提醒用户，改动运维特征可能应该再结合一个灰度发布，以免大量资源重启导致服务不可用或其他风险。                    |
| **spec.manageWorkload**    | 可缺省字段，bool 类型         | 是否由该运维特征管理工作负载，设置为 true 则标识这个运维特征会负责工作负载的创建、更新、以及资源回收，通常灰度发布的运维特征会具备这个能力。                                          |
| **spec.skipRevisionAffect**| 可缺省字段，bool 类型         | 该运维特征是否不计入版本变化的计算，设置为 true 则标识这个运维特征的修改不计入版本的变化，即用户在应用中修改这个运维特征的字段，不会触发应用本身的版本变化。                                   |
| **spec.revisionEnabled**   | 可缺省字段，bool 类型         | 运维能力是否感知组件版本的变化，设置为 true 表示组件生成的资源后缀会带版本后缀。                                                                                     |
| **spec.controlPlaneOnly**  | 可缺省字段，bool 类型         | 运维能力产生的资源是否部署到管控集群，设置为 true 表示运维特征生成的资源会被部署到管控集群，即 global 集群。                                                                  |
