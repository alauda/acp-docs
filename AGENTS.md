# AI Coding Agent Guide

This document provides essential context, architectural background, and rules for AI coding agents to ensure all modifications comply with project standards and the **Doom framework**.

## 1. Project Context & Architecture

* **Framework**: Built with `@alauda/doom` (v1.18.3), a custom MDX-based documentation system.
* **Multi-Site Architecture**: This is an aggregate site including a main site and ~20 sub-sites (e.g., Service Mesh, AI, DevOps) registered in `sites.yaml`.
* **Single Source of Truth**: `docs/en/` is the primary source; `docs/zh/` and other languages are generated via translation workflows.
* **Config-Driven**: `doom.config.yml` controls the site structure, API references, and export scopes.

---

## 2. Core Principles

* **English-First**: All new content and structural changes must be made in `docs/en/` first.
* **Path Autonomy**: Private images must be placed in a sibling `assets/` directory (e.g., `docs/en/guides/assets/`).
* **Minimal Changes**: Preserve existing `weight` ordering logic unless explicit refactoring is requested.
* **Resource References**: Use only relative paths (e.g., `./assets/diagram.svg`). Cross-module resource references are strictly prohibited.

---

## 3. Build and Verification Commands

```bash
# Install dependencies (project uses yarn 4.12.0)
yarn install

# Start development server (live preview)
# Note: Sidebar changes (new files, weight modifications) require a restart
yarn dev

# Run lint checks (enforced by pre-commit hook)
yarn lint

# Translate documentation (sync en to zh)
yarn translate

# Update AC CLI documentation (auto-generated)
yarn update-ac-manual

# Build production static site
yarn build

```

---

## 4. Documentation Guidelines

### MDX Files and Frontmatter

Each MDX file must begin with frontmatter, and filenames should use `kebab-case`:

* **weight**: Required. Controls sidebar order (lower = higher; 1-10 recommended for top placement).
* **title**: Optional. Defaults to the H1 heading if not provided.
* **sourceSHA**: Translation tracking. **Never manually edit in the English version**; maintained by tools in the Chinese version.

### Category Index Files

Directory-level index files (e.g., `index.mdx`) must use the `<Overview />` component for auto-generated category pages.

### Component Usage

* **Import Convention**: Only import components when specific functionality is needed.
* **Skills Integration**: Refer to the `doom-doc-assistant` skill for detailed usage of `Tabs`, `Steps`, `ExternalSite`, and other components.

---

## 5. Immutable Files (Never Modify)

**The following files are auto-generated or system-protected. Never modify them manually:**

1. All files under `docs/en/ui/cli_tools/ac/` (generated by `yarn update-ac-manual`).
2. `docs/public/_remotes/` directory (auto-generated from remote repository references).
3. `node_modules/`, `dist/`, and `.yarn/` (except specific plugins).
4. `sourceSHA` fields within the English documentation.

---

## 6. Definition of Done (Final Checklist)

After modifying documentation, execute in order:

1. **Syntax Check**: Run `yarn lint` and fix all errors.
2. **Path Verification**: Ensure all `assets/` references and internal links are valid with no dead links.
3. **Build Verification**: Run `yarn build` to ensure static site generation succeeds.
4. **Inform User**:
* If the sidebar was modified: Inform that `yarn dev` needs a restart.
* If the English version was modified: Ask if `yarn translate` should be run to sync Chinese.



---

## 7. Handling Uncertainty (When to Ask)

**You must ask the user before:**

1. Modifying `doom.config.yml`, `tsconfig.json`, or `sites.yaml`.
2. Creating new top-level documentation categories.
3. Modifying YAML files under `docs/shared/`.
4. Modifying theme files in `theme/`.
